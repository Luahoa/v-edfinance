
> api@0.0.1 test C:\Users\luaho\Demo project\v-edfinance\apps\api
> vitest run

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

[1m[7m[36m RUN [39m[27m[22m [36mv2.1.9 [39m[90mC:/Users/luaho/Demo project/v-edfinance/apps/api[39m

[31m[Nest] 9948  - [39m01/03/2026, 2:17:17 AM [31m  ERROR[39m [38;5;3m[AiService] [39m[31mGEMINI_API_KEY is not defined in environment variables[39m
[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2monModuleInit[2m > [22m[2mshould initialize with GEMINI_API_KEY from ConfigService
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2monModuleInit[2m > [22m[2mshould log error when GEMINI_API_KEY is missing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2monModuleInit[2m > [22m[2mshould fallback to process.env when ConfigService is unavailable
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould throw ForbiddenException when rate limit exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould throw ForbiddenException when monthly budget exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould return total tokens used when limits not exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould handle missing tokensUsed in payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask email addresses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask displayName and fullName
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask phone and address recursively
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould handle null and undefined data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask short strings properly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould create thread with title and module
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould create thread without module
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould get threads ordered by updatedAt desc
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould get messages ordered by createdAt asc
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould save message and update thread timestamp
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould generate course advice with progress tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould use loss aversion for medium progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould use goal gradient for near completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould return fallback advice on JSON parse error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould check user AI usage before generating advice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould log token usage for advice generation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould generate response with context and history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould throw NotFoundException when thread not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould summarize history when messages exceed threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould mask PII in user context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould log token usage after response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould parse action cards from response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould use cache for FAQ questions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould cache FAQ responses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mparseActionCards[2m > [22m[2mshould parse valid action card JSON
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mparseActionCards[2m > [22m[2mshould handle text without action cards
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mparseActionCards[2m > [22m[2mshould handle invalid JSON in action card
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mgenerateCacheKey[2m > [22m[2mshould generate consistent hash for same prompt
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mgenerateCacheKey[2m > [22m[2mshould be case-insensitive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mgenerateCacheKey[2m > [22m[2mshould trim whitespace
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould classify FAQ questions (Vietnamese)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould classify FAQ questions (English)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould classify personalized queries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould handle mixed case
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2msummarizeHistory[2m > [22m[2mshould summarize message history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2msummarizeHistory[2m > [22m[2mshould return empty string on error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2msummarizeHistory[2m > [22m[2mshould reverse messages for chronological order
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mError Handling[2m > [22m[2mshould handle Gemini API timeout
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mError Handling[2m > [22m[2mshould handle invalid course ID in getCourseAdvice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle full chat flow with rate limiting and caching
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/ai/ai.service.spec.ts [2m([22m[2m47 tests[22m[2m)[22m[33m 461[2mms[22m[39m
[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mVirtual Portfolio Creation[2m > [22m[2mshould create new portfolio with default balance for new user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mVirtual Portfolio Creation[2m > [22m[2mshould return existing portfolio for existing user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mStock Trading - BUY Operations[2m > [22m[2mshould execute BUY trade for stock with sufficient balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mStock Trading - BUY Operations[2m > [22m[2mshould accumulate stock holdings on multiple BUY trades
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mStock Trading - BUY Operations[2m > [22m[2mshould throw error when balance insufficient for BUY trade
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mCrypto Trading - BUY Operations[2m > [22m[2mshould execute BUY trade for Bitcoin
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mCrypto Trading - BUY Operations[2m > [22m[2mshould execute BUY trade for Ethereum
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mCrypto Trading - BUY Operations[2m > [22m[2mshould handle fractional crypto amounts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould execute SELL trade with sufficient assets
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould remove asset from portfolio when fully sold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould throw error when trying to sell more than owned
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould throw error when trying to sell non-existent asset
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mMulti-Asset Portfolio Management[2m > [22m[2mshould handle diverse portfolio with multiple stocks and crypto
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Generation[2m > [22m[2mshould start life scenario with AI-generated event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Generation[2m > [22m[2mshould handle AI response with code block formatting
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould continue scenario based on user choice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould throw error for invalid scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould throw error for mismatched userId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould throw error for invalid choice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould occasionally age the user during scenario progression
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould validate optimal 50/30/20 budget allocation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould warn about high wants allocation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould warn about low savings allocation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould throw error when allocation does not sum to 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould provide loss aversion nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould calculate survival months accurately
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould calculate inflation impact on survival
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould emit nudge request during stress test
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould provide social proof nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould provide impact statements in Vietnamese (VI)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould provide impact statements in English (EN)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould provide impact statements in Chinese (ZH)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould calculate future value with 8% annual return
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould handle custom year periods
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould emit nudge request for budgeting context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mMarket-Specific Currency Handling[2m > [22m[2mshould handle VND (Vietnamese Dong) amounts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mMarket-Specific Currency Handling[2m > [22m[2mshould format large VND amounts with localization
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mPortfolio Assets Validation[2m > [22m[2mshould validate JSONB portfolio assets on BUY trade
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mPortfolio Assets Validation[2m > [22m[2mshould validate JSONB portfolio assets on SELL trade
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mPortfolio Assets Validation[2m > [22m[2mshould validate complex multi-asset portfolio
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Status Validation[2m > [22m[2mshould validate JSONB simulation status on scenario start
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Status Validation[2m > [22m[2mshould validate JSONB simulation status on scenario continuation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Event Validation[2m > [22m[2mshould validate JSONB event structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Decisions Validation[2m > [22m[2mshould validate JSONB decisions array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mGoal-Based Savings[2m > [22m[2mshould create market-linked commitment for retirement
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mGoal-Based Savings[2m > [22m[2mshould throw error for insufficient balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould apply 10% penalty for early withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould log early withdrawal behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould return full amount without penalty for on-time withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould use transaction for withdrawal process
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould throw error for invalid commitment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould throw error for mismatched user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mScenario Quality Checks[2m > [22m[2mshould validate AI-generated scenario has required fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mScenario Quality Checks[2m > [22m[2mshould reject AI scenario missing required options
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mScenario Quality Checks[2m > [22m[2mshould validate option impact values are numeric
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mExecution State Machine[2m > [22m[2mshould track scenario execution state through lifecycle
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mExecution State Machine[2m > [22m[2mshould prevent state transition without valid choice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mMultiple User Simulations[2m > [22m[2mshould handle concurrent portfolio trades from different users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mMultiple User Simulations[2m > [22m[2mshould handle concurrent scenario generations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mResult Calculation Accuracy[2m > [22m[2mshould accurately calculate portfolio value with multiple assets
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mResult Calculation Accuracy[2m > [22m[2mshould precisely calculate trade costs with decimals
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mResult Calculation Accuracy[2m > [22m[2mshould maintain precision in scenario impact calculations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/simulation/market-simulation.service.spec.ts [2m([22m[2m62 tests[22m[2m)[22m[90m 197[2mms[22m[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mNudging user user-1 to maintain their 7-day streak![39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 1 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 0 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 0 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mNudging user user-1 to maintain their 3-day streak![39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mNudging user user-2 to maintain their 10-day streak![39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 2 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 0 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 0 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mNudging user user-1 to maintain their 15-day streak![39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 1 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 0 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 0 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mNudging user user-123 to maintain their 7-day streak![39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 1 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mNudging user user-1 to maintain their 5-day streak![39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 1 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mNudging user user-1 to maintain their 3-day streak![39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 1 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mNudging user user-1 to maintain their 5-day streak![39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 1 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mNudging user user-1 to maintain their 12-day streak![39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 1 users.[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 0 users.[39m
[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould generate initial life scenario with AI
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould handle AI response with markdown code blocks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould continue scenario based on previous choice
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould throw error for invalid choice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould throw error for unauthorized scenario access
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould throw error when scenario does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mDifficulty Scaling[2m > [22m[2mshould generate age-appropriate scenarios for young users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mDifficulty Scaling[2m > [22m[2mshould update user status based on choice impact
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mDifficulty Scaling[2m > [22m[2mshould occasionally age the user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Vietnamese-localized scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate English-localized scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Chinese-localized scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould handle malformed JSON from LLM gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould parse JSON with extra whitespace
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould handle nested markdown code blocks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould mock complex multi-choice scenarios
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould validate initial status structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould validate scenario event structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould validate decisions array structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould reject invalid JSONB structure
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould preserve all required fields in status updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mNudge Strategy Integration[2m > [22m[2mshould include loss aversion nudge in prompts
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mNudging user user-1 to maintain their 5-day streak![39m
[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mNudge Strategy Integration[2m > [22m[2mshould include Hooked strategy trigger
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mNudge Strategy Integration[2m > [22m[2mshould pass previous choice context to next event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle zero impact choices
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle negative savings (debt)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mEdge Cases[2m > [22m[2mshould cap happiness at boundaries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/simulation/scenario-generator.service.spec.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 51[2mms[22m[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mChecking for users who need a streak nudge...[39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mNudging user user-complete to maintain their 20-day streak![39m
[32m[Nest] 17736  - [39m01/03/2026, 2:17:20 AM [32m    LOG[39m [38;5;3m[NudgeService] [39m[32mSent nudges to 1 users.[39m
[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould trigger nudge for user inactive for 22 hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould NOT trigger for user inactive for 19 hours (too early)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould NOT trigger for user inactive for 25 hours (too late)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould trigger for multiple users in the time window
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould trigger SOCIAL_PROOF for HUNTER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould trigger LOSS_AVERSION for high risk level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould trigger LOSS_AVERSION for SAVER persona regardless of risk
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould return default SOCIAL_PROOF for moderate risk
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mBudgeting Trigger[2m > [22m[2mshould trigger GOAL_GRADIENT for SAVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mBudgeting Trigger[2m > [22m[2mshould trigger SALIENCE with coffee mapping for default persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mBudgeting Trigger[2m > [22m[2mshould calculate coffee equivalents correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mMilestone Trigger[2m > [22m[2mshould trigger GOAL_GRADIENT for streak warning
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mRealtime Social Proof Trigger[2m > [22m[2mshould trigger SOCIAL_PROOF when many users active
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mRealtime Social Proof Trigger[2m > [22m[2mshould return null when no active users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mRealtime Social Proof Trigger[2m > [22m[2mshould query behavioral logs from last 24 hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mStreak Conditions[2m > [22m[2mshould NOT trigger for frozen streaks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mStreak Conditions[2m > [22m[2mshould NOT trigger for zero streaks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mStreak Conditions[2m > [22m[2mshould trigger for high-value streaks (7+ days)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mInactivity Conditions[2m > [22m[2mshould identify users approaching streak expiration
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mInactivity Conditions[2m > [22m[2mshould exclude users with recent activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mMulti-language Support[2m > [22m[2mshould generate Vietnamese message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mMulti-language Support[2m > [22m[2mshould generate English message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mMulti-language Support[2m > [22m[2mshould generate Chinese message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mPriority Assignment[2m > [22m[2mshould assign HIGH priority to loss aversion nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mPriority Assignment[2m > [22m[2mshould assign MEDIUM priority to default social proof
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mPriority Assignment[2m > [22m[2mshould assign LOW priority to salience nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mBehavioral Logging[2m > [22m[2mshould log streak nudge to BehaviorLog
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mBehavioral Logging[2m > [22m[2mshould use system session ID for automated nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mBehavioral Logging[2m > [22m[2mshould include correct event type
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mPersona-Based Behavior[2m > [22m[2mshould fetch user persona from analytics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mPersona-Based Behavior[2m > [22m[2mshould handle OBSERVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mPersona-Based Behavior[2m > [22m[2mshould handle missing user gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mActivity Tracking[2m > [22m[2mshould query user activity correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mInvestment Data Structure[2m > [22m[2mshould handle riskLevel in payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mInvestment Data Structure[2m > [22m[2mshould handle missing riskLevel gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mBudgeting Data Structure[2m > [22m[2mshould validate amount field in budgeting context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mBudgeting Data Structure[2m > [22m[2mshould calculate coffee mapping from amount
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mStreak Data Structure[2m > [22m[2mshould validate streak payload in notification
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould track action count for specific target
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould filter by event type and path
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould only count events from last 24 hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould return zero count when no matching events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould return null for unknown context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle empty streak list gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle persona fetch failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle database query failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle behavioral log creation failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle complete streak nudge workflow
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle complete investment decision workflow
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/nudge/trigger.service.spec.ts [2m([22m[2m49 tests[22m[2m)[22m[90m 98[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Test 1 (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Test 2 (exp-002)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-targeted)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-targeted)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment paused: exp-001[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment completed: exp-001[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment paused: exp-001[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-targeted)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[32m[Nest] 15980  - [39m01/03/2026, 2:17:21 AM [32m    LOG[39m [38;5;3m[ABTestingService] [39m[32mExperiment registered: Homepage CTA Test (exp-001)[39m
[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould register a valid experiment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould throw error if variant weights do not sum to 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould throw error if traffic allocation is out of range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould throw error if experiment has less than 2 variants
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould handle experiments with multiple variants (A/B/C testing)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould retrieve all registered experiments
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould assign variant to new user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould return existing assignment for returning user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould return null if experiment is not active
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould return null if experiment does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould respect traffic allocation percentage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould assign variants consistently based on user ID hash
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould handle targeted experiments based on user points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould include user if within target audience range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould distribute variants according to weight ratios
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mConversion Tracking[2m > [22m[2mshould track conversion events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mConversion Tracking[2m > [22m[2mshould track conversions without value
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mConversion Tracking[2m > [22m[2mshould handle multiple conversion types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould calculate performance metrics for each variant
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould handle zero conversions gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould throw error for non-existent experiment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould aggregate conversion values correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould calculate statistical significance with sufficient data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould mark results as significant when p-value < 0.05
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould throw error with insufficient data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould throw error for non-existent variants
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould calculate correct uplift percentage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould provide confidence level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould pause an active experiment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould complete an experiment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould not assign variants to paused experiments
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould handle experiments with date ranges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle user with no points in targeted experiment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle experiment with zero traffic allocation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle partial traffic allocation correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle experiments with custom configuration per variant
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould maintain consistent hashing across service instances
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/analytics/ab-testing.service.spec.ts [2m([22m[2m37 tests[22m[2m)[22m[90m 78[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[31m[Nest] 18252  - [39m01/03/2026, 2:17:21 AM [31m  ERROR[39m [38;5;3m[AnalyticsService] [39m[31mLog aggregation failed[39m
Error: Database error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\analytics\analytics.integration.spec.ts:504:59
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
[31m[Nest] 18252  - [39m01/03/2026, 2:17:21 AM [31m  ERROR[39m [38;5;3m[AnalyticsService] [39m[31mLog aggregation failed[39m
Error: Delete failed
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\analytics\analytics.integration.spec.ts:694:59
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mUser Behavior Analysis Pipeline[2m > [22m[2mshould analyze user behavior from raw logs to persona classification
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mUser Behavior Analysis Pipeline[2m > [22m[2mshould handle SAVER persona with commitment-focused behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mUser Behavior Analysis Pipeline[2m > [22m[2mshould default to OBSERVER for mixed behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mLearning Habits Analysis[2m > [22m[2mshould identify peak learning hours from activity patterns
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mLearning Habits Analysis[2m > [22m[2mshould return null for users with no activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould generate complete financial future simulation with persona context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould predict churn risk based on activity gaps
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould return HIGH churn risk for large activity gaps
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould return LOW churn risk for consistent daily activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mMentor Service with Analytics Integration[2m > [22m[2mshould integrate persona, churn risk, and user profile for personalized advice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mMentor Service with Analytics Integration[2m > [22m[2mshould select WISE_SAGE persona for SAVER users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mMentor Service with Analytics Integration[2m > [22m[2mshould include high churn risk warning in AI context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mSystem-Wide Statistics Aggregation[2m > [22m[2mshould aggregate data from multiple Prisma models
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mSystem-Wide Statistics Aggregation[2m > [22m[2mshould handle null aggregate values gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mSystem Health Monitoring[2m > [22m[2mshould execute complete health check workflow
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mSystem Health Monitoring[2m > [22m[2mshould detect and warn about critical error rates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mSystem Health Monitoring[2m > [22m[2mshould handle database connection failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mLog Aggregation and Archiving[2m > [22m[2mshould aggregate and archive behavior logs successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mLog Aggregation and Archiving[2m > [22m[2mshould skip aggregation when no logs exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mLog Aggregation and Archiving[2m > [22m[2mshould handle aggregation errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mVariable Reward Distribution[2m > [22m[2mshould award variable rewards based on lesson completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mVariable Reward Distribution[2m > [22m[2mshould not award rewards when random threshold not met
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mVariable Reward Distribution[2m > [22m[2mshould include reward notification in AI response context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould properly mock all Prisma dependencies
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould properly mock GeminiService
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould properly mock EventEmitter2
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould ensure service dependencies are injected correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould handle circular dependencies between analytics and predictive services
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle empty user data gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle invalid date ranges in log queries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle concurrent health checks without race conditions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould maintain data consistency during aggregation failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mPerformance and Scalability[2m > [22m[2mshould efficiently handle large behavior log datasets
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mPerformance and Scalability[2m > [22m[2mshould batch process multiple user personas efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/analytics.integration.spec.ts [2m([22m[2m34 tests[22m[2m)[22m[90m 209[2mms[22m[39m
[32m[Nest] 3388  - [39m01/03/2026, 2:17:22 AM [32m    LOG[39m [38;5;3m[ReportsService] [39m[32mGenerating daily report from Fri Jan 02 2026 02:17:22 GMT+0700 (Indochina Time) to Sat Jan 03 2026 02:17:22 GMT+0700 (Indochina Time)[39m
[32m[Nest] 3388  - [39m01/03/2026, 2:17:22 AM [32m    LOG[39m [38;5;3m[ReportsService] [39m[32mGenerating weekly report from Sat Dec 27 2025 02:17:22 GMT+0700 (Indochina Time) to Sat Jan 03 2026 02:17:22 GMT+0700 (Indochina Time)[39m
[32m[Nest] 3388  - [39m01/03/2026, 2:17:22 AM [32m    LOG[39m [38;5;3m[ReportsService] [39m[32mGenerating monthly report from Wed Dec 03 2025 02:17:22 GMT+0700 (Indochina Time) to Sat Jan 03 2026 02:17:22 GMT+0700 (Indochina Time)[39m
[32m[Nest] 3388  - [39m01/03/2026, 2:17:22 AM [32m    LOG[39m [38;5;3m[ReportsService] [39m[32mGenerating daily report from Fri Jan 02 2026 02:17:22 GMT+0700 (Indochina Time) to Sat Jan 03 2026 02:17:22 GMT+0700 (Indochina Time)[39m
[32m[Nest] 3388  - [39m01/03/2026, 2:17:22 AM [32m    LOG[39m [38;5;3m[ReportsService] [39m[32mGenerating weekly report from Mon Dec 01 2025 07:00:00 GMT+0700 (Indochina Time) to Mon Dec 15 2025 07:00:00 GMT+0700 (Indochina Time)[39m
[32m[Nest] 3388  - [39m01/03/2026, 2:17:22 AM [32m    LOG[39m [38;5;3m[ReportsService] [39m[32mGenerating monthly report from Wed Dec 03 2025 02:17:22 GMT+0700 (Indochina Time) to Sat Jan 03 2026 02:17:22 GMT+0700 (Indochina Time)[39m
[32m[Nest] 3388  - [39m01/03/2026, 2:17:22 AM [32m    LOG[39m [38;5;3m[ReportsService] [39m[32mGenerating daily report from Fri Jan 02 2026 02:17:22 GMT+0700 (Indochina Time) to Sat Jan 03 2026 02:17:22 GMT+0700 (Indochina Time)[39m
[32m[Nest] 3388  - [39m01/03/2026, 2:17:22 AM [32m    LOG[39m [38;5;3m[ReportsService] [39m[32mGenerating daily report from Fri Jan 02 2026 02:17:22 GMT+0700 (Indochina Time) to Sat Jan 03 2026 02:17:22 GMT+0700 (Indochina Time)[39m
[32m[Nest] 3388  - [39m01/03/2026, 2:17:22 AM [32m    LOG[39m [38;5;3m[ReportsService] [39m[32mGenerating daily report from Fri Jan 02 2026 02:17:22 GMT+0700 (Indochina Time) to Sat Jan 03 2026 02:17:22 GMT+0700 (Indochina Time)[39m
[32m[Nest] 3388  - [39m01/03/2026, 2:17:22 AM [32m    LOG[39m [38;5;3m[ReportsService] [39m[32mGenerating daily report from Fri Jan 02 2026 02:17:22 GMT+0700 (Indochina Time) to Sat Jan 03 2026 02:17:22 GMT+0700 (Indochina Time)[39m
[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould generate daily report with correct metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould generate weekly report with aggregated data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould generate monthly report with top users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould filter report by userId when provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould handle custom date range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToCSV[2m > [22m[2mshould export report to CSV format in Vietnamese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToCSV[2m > [22m[2mshould export report to CSV format in English
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToCSV[2m > [22m[2mshould export report to CSV format in Chinese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToPDF[2m > [22m[2mshould export report to PDF format in Vietnamese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToPDF[2m > [22m[2mshould export report to PDF format in English
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToPDF[2m > [22m[2mshould export report to PDF format in Chinese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for bar chart visualization
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for pie chart (activity distribution)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for horizontal bar chart (top users)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for gauge chart (progress)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2maggregated data mocking[2m > [22m[2mshould handle large datasets efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2maggregated data mocking[2m > [22m[2mshould sort activities by count descending
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2maggregated data mocking[2m > [22m[2mshould limit activities to top 10
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2medge cases[2m > [22m[2mshould handle zero metrics gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2medge cases[2m > [22m[2mshould handle report with no activities
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/analytics/reports.service.spec.ts [2m([22m[2m20 tests[22m[2m)[22m[90m 43[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/reports.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log PAGE_VIEW event with correct structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log BUTTON_CLICK event with element metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log SCROLL event with scroll depth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log VIDEO_PLAY event with playback metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log FORM_SUBMIT event with validation results
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould track multiple events within same session
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould retrieve all events for a specific session
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould count active sessions in time window
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould handle session timeout edge cases
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Aggregation Logic[2m > [22m[2mshould aggregate events by type for date range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Aggregation Logic[2m > [22m[2mshould handle empty event set in aggregation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Aggregation Logic[2m > [22m[2mshould aggregate events with missing duration
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould validate nested JSONB payload structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould handle multi-locale JSONB content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould preserve deviceInfo JSONB structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould handle array data in JSONB payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle database create success
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle database create failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle concurrent database operations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle findMany with complex filters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle empty result set from database
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle undefined userId for anonymous tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle null userId for anonymous tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould set default actionCategory when not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould set default duration to 0 when not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle extremely large payload data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle special characters in path and eventType
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould handle rapid sequential logging without blocking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould handle parallel event logging efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould aggregate large datasets efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/behavior-tracking.service.spec.ts [2m([22m[2m30 tests[22m[2m)[22m[90m 43[2mms[22m[39m
[31m[Nest] 8084  - [39m01/03/2026, 2:17:24 AM [31m  ERROR[39m [38;5;3m[DiagnosticService] [39m[31m[ERR-STRESS-KV9J9B] AI Stress Test Failed: API quota exceeded[39m
[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould collect real-time metrics from last 10 minutes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould handle zero events gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould update Prometheus gauges on metrics collection
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould export metrics in Prometheus format
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould track active WebSocket connections
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould broadcast real-time events to all connected clients
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould send targeted events to specific users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould broadcast to groups (rooms)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould handle client disconnection and cleanup
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould aggregate behavior logs efficiently for daily archival
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould perform health check aggregation every hour
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould calculate global system stats efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould analyze user learning habits from behavior logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould handle empty user learning habits
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould generate mock behavioral data for stress testing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould run AI stress test with different complexity levels
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould handle AI stress test failures gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould simulate complete user flow for integration testing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould run comprehensive diagnostics with all subsystems
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould detect database connection failure in diagnostics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould validate JSONB schema integrity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould warn on JSONB schema drift
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mPerformance Benchmarks[2m > [22m[2mshould complete metrics collection in under 100ms (mocked)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mPerformance Benchmarks[2m > [22m[2mshould handle high-volume log aggregation efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mUser Persona Classification[2m > [22m[2mshould classify user as HUNTER (risk-taker)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mUser Persona Classification[2m > [22m[2mshould classify user as SAVER (conservative)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mUser Persona Classification[2m > [22m[2mshould classify user as OBSERVER (default)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/realtime-dashboard.service.spec.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 247[2mms[22m[39m
[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect and flag explicit profanity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect hate speech
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect sexual content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect violence and threats
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect spam and promotional content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould allow safe content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould moderate Vietnamese content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould moderate English content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould moderate Chinese content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould auto-detect language when not specified
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould handle language-specific profanity patterns
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify NONE severity for clean content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify LOW severity for minor issues
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify MEDIUM severity for moderate issues
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify HIGH severity for serious violations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify CRITICAL severity for extreme violations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould escalate severity based on multiple category violations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle empty content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle very long content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle special characters and emojis
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle API errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle rate limiting from API
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle null/undefined content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mLogging and Auditing[2m > [22m[2mshould log all moderation attempts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mLogging and Auditing[2m > [22m[2mshould log flagged content with detailed metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mLogging and Auditing[2m > [22m[2mshould not store full content for privacy (hash only)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mUser Strike System[2m > [22m[2mshould increment strike count for HIGH severity violations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mUser Strike System[2m > [22m[2mshould ban user after 3 CRITICAL violations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mUser Strike System[2m > [22m[2mshould not count LOW severity towards strikes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mContext-Aware Moderation[2m > [22m[2mshould allow educational discussions about sensitive topics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mContext-Aware Moderation[2m > [22m[2mshould be stricter in public forums than private messages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mPerformance and Caching[2m > [22m[2mshould cache moderation results for identical content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mPerformance and Caching[2m > [22m[2mshould handle batch moderation efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mAI API Mocking[2m > [22m[2mshould mock OpenAI Moderation API response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mAI API Mocking[2m > [22m[2mshould mock Google Perspective API response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mAI API Mocking[2m > [22m[2mshould mock custom Gemini Moderation API
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mReal-World Scenarios[2m > [22m[2mshould handle financial scam attempts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mReal-World Scenarios[2m > [22m[2mshould handle phishing attempts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mReal-World Scenarios[2m > [22m[2mshould allow legitimate financial discussions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/ai/moderation.service.spec.ts [2m([22m[2m39 tests[22m[2m)[22m[90m 144[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould create a commitment contract with valid data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould reject contract creation with insufficient balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould calculate correct unlock date based on months
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould create multiple contracts for different goals
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mStake Locking[2m > [22m[2mshould lock funds by decrementing portfolio balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mStake Locking[2m > [22m[2mshould verify locked amount matches commitment record
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mStake Locking[2m > [22m[2mshould prevent negative balance after locking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould successfully withdraw on-time commitment without penalty
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould apply penalty for early withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould reject withdrawal for non-existent commitment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould reject withdrawal by unauthorized user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mMock Financial Data[2m > [22m[2mshould simulate portfolio with realistic balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mMock Financial Data[2m > [22m[2mshould handle zero balance portfolio gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mMock Financial Data[2m > [22m[2mshould support large commitment amounts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould calculate 10% penalty for early withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould calculate penalty with different rates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould return full amount when unlockDate is exactly now
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould log penalty event with correct metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould handle edge case: zero penalty rate
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mIntegration: Full Lifecycle[2m > [22m[2mshould complete full commitment lifecycle: create â†’ withdraw early â†’ log penalty
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mIntegration: Full Lifecycle[2m > [22m[2mshould handle complete lifecycle: create â†’ wait â†’ withdraw without penalty
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/commitment.service.spec.ts [2m([22m[2m21 tests[22m[2m)[22m[90m 44[2mms[22m[39m
[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcreatePost[2m > [22m[2mshould create a post and broadcast it
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mjoinGroup[2m > [22m[2mshould allow a user to join a group and create a welcome post
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mjoinGroup[2m > [22m[2mshould throw error if group is full
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mupdateGroupStreak[2m > [22m[2mshould increment group streak if all members are active
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mupdateGroupStreak[2m > [22m[2mshould nudge group if some members are inactive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcheckChallengeProgress[2m > [22m[2mshould complete challenge and reward members if target reached
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcheckChallengeProgress[2m > [22m[2mshould fail challenge if expired and target not reached
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgenerateCompetitiveNudge[2m > [22m[2mshould generate nudge for the user in second place
[22m[39m[Push Notification] to u2: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch leader 200 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 200 points behind leader. Finish one more lesson to overtake!","zh":"ä½ åªè½åŽ leader 200 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetFeed[2m > [22m[2mshould return posts for user groups and public posts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcreateGroup[2m > [22m[2mshould create a group and add the creator as leader
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetGroupDetails[2m > [22m[2mshould return group with members and challenges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetRecommendedGroups[2m > [22m[2mshould return fallback groups if user has no profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetRecommendedGroups[2m > [22m[2mshould return learning groups for beginners
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcreateGroupChallenge[2m > [22m[2mshould create a challenge and announce it
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mChallenge Progress Tracking (S005)[2m > [22m[2mshould calculate progress correctly with partial completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mChallenge Progress Tracking (S005)[2m > [22m[2mshould handle challenge with no members
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mChallenge Progress Tracking (S005)[2m > [22m[2mshould handle concurrent challenge checks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Membership Validation (S005)[2m > [22m[2mshould prevent joining already joined group
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Membership Validation (S005)[2m > [22m[2mshould validate group exists before joining
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Membership Validation (S005)[2m > [22m[2mshould handle group at max capacity minus one
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mWebSocket Broadcast Integration (S005)[2m > [22m[2mshould broadcast post creation to all members
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mWebSocket Broadcast Integration (S005)[2m > [22m[2mshould handle broadcast failure gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Streak Edge Cases (S005)[2m > [22m[2mshould not increment streak if any member inactive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Streak Edge Cases (S005)[2m > [22m[2mshould handle group with all active members
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Streak Edge Cases (S005)[2m > [22m[2mshould handle missing streak data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mFeed Generation (S005)[2m > [22m[2mshould return empty feed if user has no groups
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mFeed Generation (S005)[2m > [22m[2mshould include public posts for all users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mFeed Generation (S005)[2m > [22m[2mshould combine group and public posts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mCompetitive Nudge Generation (S005)[2m > [22m[2mshould not generate nudge if only one member
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mCompetitive Nudge Generation (S005)[2m > [22m[2mshould target second place correctly
[22m[39m[Push Notification] to u2: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch first 100 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 100 points behind first. Finish one more lesson to overtake!","zh":"ä½ åªè½åŽ first 100 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/social.service.spec.ts [2m([22m[2m30 tests[22m[2m)[22m[90m 84[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould calculate daily active users correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould handle empty logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould deduplicate users within the same day
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould filter out null userId entries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateWAU[2m > [22m[2mshould calculate weekly active users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateWAU[2m > [22m[2mshould return 0 for no active users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateMAU[2m > [22m[2mshould calculate monthly active users for December 2025
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateMAU[2m > [22m[2mshould handle edge case of February
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateRetention[2m > [22m[2mshould calculate cohort retention correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateRetention[2m > [22m[2mshould handle zero retention
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateRetention[2m > [22m[2mshould handle empty cohort
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateEngagement[2m > [22m[2mshould calculate engagement metrics correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateEngagement[2m > [22m[2mshould handle empty logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateEngagement[2m > [22m[2mshould calculate 100% bounce rate when all sessions have 1 event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 50th percentile (median) correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 95th percentile correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 0th percentile (minimum)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 100th percentile (maximum)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould handle single value array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould return 0 for empty array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould throw error for invalid percentile < 0
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould throw error for invalid percentile > 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould handle unsorted input correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mgetUserPointsPercentiles[2m > [22m[2mshould calculate multiple percentiles for user points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mgetUserPointsPercentiles[2m > [22m[2mshould handle users with zero points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mgetUserPointsPercentiles[2m > [22m[2mshould handle empty user list
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mevents metric[2m > [22m[2mshould aggregate events by day
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mevents metric[2m > [22m[2mshould aggregate events by hour
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2musers metric[2m > [22m[2mshould aggregate unique users by day
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2musers metric[2m > [22m[2mshould filter out null userIds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2msessions metric[2m > [22m[2mshould aggregate unique sessions by day
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mweek interval[2m > [22m[2mshould aggregate by week starting Monday
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mweek interval[2m > [22m[2mshould handle Sunday correctly (week starts Monday)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mshould return empty array for no logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mshould sort results chronologically
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mDatabase Integration[2m > [22m[2mshould use correct Prisma query for DAU
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mDatabase Integration[2m > [22m[2mshould use distinct query for WAU
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle timezone differences correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle large datasets efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/metrics.service.spec.ts [2m([22m[2m39 tests[22m[2m)[22m[90m 54[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/reward.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mVariable Reward Algorithms[2m > [22m[2mshould apply RANDOM variable ratio schedule (VR-3: avg 3 actions per reward)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mVariable Reward Algorithms[2m > [22m[2mshould apply FIXED interval schedule (FI-5: reward every 5th minute)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mVariable Reward Algorithms[2m > [22m[2mshould calculate progressive reward multiplier based on streak
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mVariable Reward Algorithms[2m > [22m[2mshould implement jackpot mechanic (1% chance for 10x reward)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Timing Optimization[2m > [22m[2mshould delay reward delivery for suspense (200-500ms)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Timing Optimization[2m > [22m[2mshould trigger reward immediately after critical milestone
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould estimate tokens correctly (1 token ~ 4 chars)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould estimate multipart tokens
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould handle empty array in multipart estimation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould truncate text to token budget
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould not truncate if within budget
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould validate token budget
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould mask email addresses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould mask displayName
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould mask phone numbers
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould handle short strings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould recursively mask nested objects
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould handle null and undefined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould not mask non-PII fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build course advice prompt for low progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build course advice prompt for medium progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build course advice prompt for high progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build persona prompt for WISE_SAGE
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build persona prompt for STRICT_COACH
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould include group streak context when high
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build system instruction with all context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould parse action cards from response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould handle response without action cards
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould handle malformed action card JSON
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould extract JSON from markdown
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould throw on invalid JSON
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould parse valid course advice response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould return fallback for invalid course advice response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould generate consistent cache keys
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould be case-insensitive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould trim whitespace
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould start with ai_response prefix
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould classify FAQ intents (Vietnamese)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould classify FAQ intents (English)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould classify personalized advice intents
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould handle v-edfinance specific questions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould be case-insensitive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould create fallback response for Vietnamese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould create fallback response for English
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould create fallback response for Chinese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould default to English for unknown locale
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould handle AI errors with context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstderr[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould handle AI errors with context
[22m[39mAI Error in generateResponse: Network timeout Error: Network timeout
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\modules\ai\utils\ai.utils.spec.ts:572:21
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould handle AI errors without context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould handle empty strings in all utilities
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould handle very long texts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould handle special characters in prompts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould maintain type safety in metadata parsing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/ai/utils/ai.utils.spec.ts [2m([22m[2m46 tests[22m[2m)[22m[90m 34[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mService Initialization[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mService Initialization[2m > [22m[2mshould inject all dependencies correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mCron Job Configuration[2m > [22m[2mshould register daily nudge cron job at 9 AM
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mCron Job Configuration[2m > [22m[2mshould register hourly streak check cron job
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mCron Job Configuration[2m > [22m[2mshould register evening reminder cron job at 7 PM
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mCron Job Configuration[2m > [22m[2mshould handle cron job registration errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mCron Job Configuration[2m > [22m[2mshould remove existing cron job before re-registering
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mOptimal Timing Algorithms[2m > [22m[2mshould calculate optimal send time based on user timezone
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mOptimal Timing Algorithms[2m > [22m[2mshould use historical engagement data for optimal timing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mOptimal Timing Algorithms[2m > [22m[2mshould default to 9 AM if no engagement history exists
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mOptimal Timing Algorithms[2m > [22m[2mshould adjust timing for weekend vs weekday
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mOptimal Timing Algorithms[2m > [22m[2mshould avoid sending during sleep hours (11 PM - 7 AM)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mFrequency Capping[2m > [22m[2mshould not send nudge if daily cap exceeded based on in-memory history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mFrequency Capping[2m > [22m[2mshould allow nudge if under daily cap
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mFrequency Capping[2m > [22m[2mshould enforce weekly frequency cap
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mFrequency Capping[2m > [22m[2mshould respect user-specific frequency preferences
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mFrequency Capping[2m > [22m[2mshould implement exponential backoff after consecutive ignores
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mFrequency Capping[2m > [22m[2mshould reset frequency counter after successful engagement
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mFrequency Capping[2m > [22m[2mshould skip users who opted out of nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mNotification Service Integration[2m > [22m[2mshould send push notification when nudge is scheduled
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mNotification Service Integration[2m > [22m[2mshould fallback to email if push notification fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mNotification Service Integration[2m > [22m[2mshould not send notification if frequency cap exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mNotification Service Integration[2m > [22m[2mshould log nudge delivery in behavior log
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mNotification Service Integration[2m > [22m[2mshould track nudge history in memory
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mTimezone Handling[2m > [22m[2mshould convert UTC time to user timezone
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mTimezone Handling[2m > [22m[2mshould handle different timezone formats
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mTimezone Handling[2m > [22m[2mshould default to UTC if timezone is invalid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mTimezone Handling[2m > [22m[2mshould schedule nudges at same local time across timezones
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mTimezone Handling[2m > [22m[2mshould handle daylight saving time transitions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mTimezone Handling[2m > [22m[2mshould batch users by timezone for efficient scheduling
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mError Handling & Edge Cases[2m > [22m[2mshould handle missing user data gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mError Handling & Edge Cases[2m > [22m[2mshould retry failed notification sends
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mError Handling & Edge Cases[2m > [22m[2mshould handle database connection errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mError Handling & Edge Cases[2m > [22m[2mshould skip nudge generation if engine returns null
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mError Handling & Edge Cases[2m > [22m[2mshould handle concurrent nudge sends without duplication
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould batch process users efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould use database connection pooling
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts[2m > [22m[2mNudgeSchedulerService[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould implement rate limiting for notification service
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-scheduler.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/nudge-scheduler.service.spec.ts [2m([22m[2m38 tests[22m[2m)[22m[33m 572[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Timing Optimization[2m > [22m[2mshould batch rewards during high-frequency actions (debounce 2s)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Timing Optimization[2m > [22m[2mshould schedule prime-time bonuses (7-9 PM: +20% rewards)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Value Calculation[2m > [22m[2mshould scale rewards based on user level (exponential curve)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Value Calculation[2m > [22m[2mshould apply persona-based reward weights (HUNTER: 1.5x risk rewards)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Value Calculation[2m > [22m[2mshould cap daily rewards to prevent exploitation (max 500 points/day)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Value Calculation[2m > [22m[2mshould calculate diminishing returns for repeated actions (5% decay per repeat)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mGamification Service Integration (Mocked)[2m > [22m[2mshould emit points.earned event after reward distribution
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mGamification Service Integration (Mocked)[2m > [22m[2mshould trigger nudge after reward threshold reached
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mGamification Service Integration (Mocked)[2m > [22m[2mshould validate sufficient points before deduction
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mGamification Service Integration (Mocked)[2m > [22m[2mshould successfully deduct points and log behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mGamification Service Integration (Mocked)[2m > [22m[2mshould handle concurrent reward distributions without race conditions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould implement near-miss mechanic (show "almost won" at 95% threshold)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould trigger achievement unlock with celebration animation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould implement loss aversion nudge (show potential loss: -20 points)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould apply social proof to boost motivation
[22m[39mðŸ§¹ Cleaning up after test...

 [2m[90mâ†“[39m[22m src/ai/ai.integration.spec.ts [2m([22m[2m18 tests[22m[2m | [22m[33m18 skipped[39m[2m)[22m
[32m[Nest] 15180  - [39m01/03/2026, 2:17:35 AM [32m    LOG[39m [38;5;3m[AiService] [39m[32mCache hit (FAQ) for prompt: Cá»• phiáº¿u lÃ  gÃ¬?...[39m
[32m[Nest] 15180  - [39m01/03/2026, 2:17:35 AM [32m    LOG[39m [38;5;3m[AiService] [39m[32mCache hit (FAQ) for prompt: Cá»• phiáº¿u lÃ  gÃ¬?...[39m
[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould return cached response on cache hit for GENERAL_FAQ
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould make AI call on cache miss for GENERAL_FAQ
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould skip cache for PERSONALIZED_ADVICE queries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould generate consistent cache keys for identical prompts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould generate different cache keys for different prompts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mTTL Expiration[2m > [22m[2mshould set cache with 24-hour TTL for FAQ responses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mTTL Expiration[2m > [22m[2mshould handle expired cache gracefully (cache miss scenario)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Invalidation[2m > [22m[2mshould allow manual cache deletion via cache manager
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Invalidation[2m > [22m[2mshould handle cache reset operation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Invalidation[2m > [22m[2mshould re-cache response after invalidation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould enforce rate limit (20 requests per minute)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould allow requests under rate limit
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould enforce monthly token budget (50,000 tokens)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould calculate token usage from behavior logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould handle missing tokensUsed in payload gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mIntent Classification (Cache Eligibility)[2m > [22m[2mshould classify FAQ queries correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mIntent Classification (Cache Eligibility)[2m > [22m[2mshould classify personalized queries correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mIntent Classification (Cache Eligibility)[2m > [22m[2mshould be case-insensitive for intent classification
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle thread not found error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould save both user and assistant messages when cache hit occurs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle cache manager errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould track token usage in behavior logs after AI call
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/ai/ai-cache.service.spec.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 44[2mms[22m[39m
 [32mâœ“[39m src/modules/nudge/reward.service.spec.ts [2m([22m[2m28 tests[22m[2m)[22m[33m 6885[2mms[22m[39m
   [33m[2mâœ“[22m[39m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Timing Optimization[2m > [22mshould batch rewards during high-frequency actions (debounce 2s) [33m3564[2mms[22m[39m
   [33m[2mâœ“[22m[39m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould create anticipation phase before big reward reveal (3s countdown) [33m3009[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould create anticipation phase before big reward reveal (3s countdown)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould implement progress bar momentum (90% completion triggers urgency)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould randomize reward particle effects for variety
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle negative reward values gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould prevent reward overflow (max 999999 points)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle missing user gracefully during reward distribution
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould log simulation events without incrementing real points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/reward.service.spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould generate high-percentage cohort message for popular action
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould generate medium-priority message for moderate adoption
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould generate low-priority message for low adoption
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould return null if user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould return null if cohort has zero users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould handle action without targetId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould generate congratulatory message when user is above average
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould generate motivational message when user is below average
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould handle middle-ranked user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould return null if user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould handle edge case with no peers
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould generate positive message when user is aligned with norm
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould generate motivational message when user is NOT aligned
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould handle different behavior types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould return null if no social norm data available
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgetRealtimeActivity - Real-time social proof[2m > [22m[2mshould get activity count for last 24 hours by default
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgetRealtimeActivity - Real-time social proof[2m > [22m[2mshould support custom time windows
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgetRealtimeActivity - Real-time social proof[2m > [22m[2mshould handle zero activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMessage localization[2m > [22m[2mshould provide messages in all three locales (vi, en, zh)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMessage localization[2m > [22m[2mshould use appropriate language-specific terminology
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould handle database errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould handle missing investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould round percentages correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould handle very small cohorts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mPriority calculation[2m > [22m[2mshould assign HIGH priority for >= 75%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mPriority calculation[2m > [22m[2mshould assign MEDIUM priority for 50-74%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mPriority calculation[2m > [22m[2mshould assign LOW priority for < 50%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMetadata accuracy[2m > [22m[2mshould include accurate cohort metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMetadata accuracy[2m > [22m[2mshould include accurate peer metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMetadata accuracy[2m > [22m[2mshould include accurate social norm metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/social-proof.service.spec.ts [2m([22m[2m31 tests[22m[2m)[22m[90m 39[2mms[22m[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: SIGNUP â†’ ONBOARDING â†’ FIRST_LESSON â†’ QUIZ_PASSED[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: SIGNUP â†’ ONBOARDING[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: LESSON_START â†’ LESSON_COMPLETED[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: LESSON_START â†’ LESSON_COMPLETED[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: SIGNUP â†’ ONBOARDING â†’ FIRST_LESSON â†’ QUIZ_START[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mDetected 1 critical drop-off points[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: SIGNUP â†’ ONBOARDING[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mDetected 1 critical drop-off points[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: STAGE1 â†’ STAGE2 â†’ STAGE3[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mDetected 0 critical drop-off points[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: STAGE1 â†’ STAGE2[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mDetected 1 critical drop-off points[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: SINGLE_STAGE[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: START â†’ END[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: STAGE1 â†’ STAGE2[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: REGISTRATION â†’ EMAIL_VERIFIED â†’ PROFILE_CREATED â†’ FIRST_DEPOSIT â†’ FIRST_LESSON_STARTED â†’ FIRST_LESSON_COMPLETED[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: S1 â†’ S2 â†’ S3 â†’ S4 â†’ S5[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mDetected 2 critical drop-off points[39m
[32m[Nest] 12944  - [39m01/03/2026, 2:17:37 AM [32m    LOG[39m [38;5;3m[FunnelAnalysisService] [39m[32mAnalyzing funnel for stages: STAGE_0 â†’ STAGE_1 â†’ STAGE_2 â†’ STAGE_3 â†’ STAGE_4 â†’ STAGE_5 â†’ STAGE_6 â†’ STAGE_7 â†’ STAGE_8 â†’ STAGE_9[39m
[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould calculate conversion funnel with correct drop-off rates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould handle empty funnel data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould calculate average time to next stage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould handle users who never complete next stage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould identify critical drop-off points above threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould return severe reasons for high drop-off rates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould return empty array when no critical drop-offs exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould use custom threshold for detection
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould analyze cohort retention across stages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould calculate average completion time for cohort
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould handle cohort with no users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould track week-over-week cohort performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould track complete user journey with all stages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould mark journey as incomplete when no completion events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould return empty journey for new users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould calculate journey duration in seconds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould preserve timestamp order for journey reconstruction
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle single-stage funnel
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle null userId in cohort analysis
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle concurrent user sessions in time calculation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle users with incomplete journeys in cohort
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle zero division in conversion rate calculation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mComplex Funnel Scenarios[2m > [22m[2mshould analyze multi-step onboarding funnel
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mComplex Funnel Scenarios[2m > [22m[2mshould identify multiple drop-off points in complex funnel
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mComplex Funnel Scenarios[2m > [22m[2mshould compare cohort performance across different time periods
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mPerformance and Optimization[2m > [22m[2mshould handle large dataset efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mPerformance and Optimization[2m > [22m[2mshould batch process funnel stages
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/analytics/funnel-analysis.service.spec.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 48[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould analyze behavior patterns from BehaviorLog data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould handle empty behavior log gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould prioritize recent behavior (last 50 logs)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould analyze mixed behavior patterns accurately
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as HUNTER for dominant risk-taking behavior (>5 events)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as SAVER for dominant commitment behavior (>5 events)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as OBSERVER when risk-taking events â‰¤5
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as OBSERVER when saving events â‰¤5
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as OBSERVER when behaviors are balanced
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould handle edge case: exactly 5 risk-taking events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as HUNTER when exactly 6 risk-taking events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould identify HUNTER profile: high risk tolerance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould identify SAVER profile: commitment-focused
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould identify OBSERVER profile: passive engagement
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould profile based on event frequency distribution
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould analyze behavioral consistency over time
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould process various event types correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould handle malformed log data gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould process logs with complete metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould handle database query errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould respect the 50-log limit
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould recommend HUNTER persona for aggressive investors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould recommend SAVER persona for conservative users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould recommend OBSERVER persona for new users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould validate persona transitions over time
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould handle persona ambiguity with default to OBSERVER
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould provide consistent recommendations for similar behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle single behavior log entry
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle exactly threshold behaviors (boundary)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle maximum logs (50 entries)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle mixed event types with unknown events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould return consistent results for multiple calls
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPerformance & Data Quality[2m > [22m[2mshould handle large datasets efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPerformance & Data Quality[2m > [22m[2mshould validate data integrity of behavior logs
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/ai/persona-analysis.service.spec.ts [2m([22m[2m34 tests[22m[2m)[22m[33m 667[2mms[22m[39m
[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould generate GAIN-framed message with positive outcome emphasis
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould generate LOSS-framed message with loss aversion emphasis
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould use GAIN framing for opportunity contexts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould use LOSS framing for risk scenarios
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to LOSS framing for streak contexts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to LOSS framing for risk contexts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to GAIN framing for opportunity contexts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to LOSS for SAVER persona (risk-averse)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to GAIN for HUNTER persona in neutral contexts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould apply DEFAULT framing and select based on context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Vietnamese framed message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate English framed message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Chinese framed message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould fallback to Vietnamese if locale is invalid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould get all localized templates for a context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould handle parameter interpolation in all locales
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould correctly interpolate amount parameter
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould correctly interpolate days parameter
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould correctly interpolate count parameter
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould handle multiple parameters in template
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould assign variant from A/B test when experimentId is provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould use original framing if no A/B test assignment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould work without experimentId (no A/B testing)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould track variant assignment for analytics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould handle A/B test error gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle missing parameters gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle empty locale with fallback
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould return valid message key when translation not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould handle undefined userProfile in getDefaultFraming
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould handle null params in generateFramedMessage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould correctly identify multiple loss context keywords
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould generate consistent messages for same inputs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould handle concurrent framing requests
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/nudge/framing.service.spec.ts [2m([22m[2m34 tests[22m[2m)[22m[33m 699[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/framing.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mPersona-Based Nudging[2m > [22m[2mHUNTER Persona (Risk-Taker)[2m > [22m[2mshould deliver SOCIAL_PROOF nudge emphasizing competition
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mPersona-Based Nudging[2m > [22m[2mHUNTER Persona (Risk-Taker)[2m > [22m[2mshould maintain high engagement for HUNTER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mPersona-Based Nudging[2m > [22m[2mHUNTER Persona (Risk-Taker)[2m > [22m[2mshould use competitive language for HUNTER
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mPersona-Based Nudging[2m > [22m[2mSAVER Persona (Conservative)[2m > [22m[2mshould deliver LOSS_AVERSION nudge for high-risk scenarios
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mPersona-Based Nudging[2m > [22m[2mSAVER Persona (Conservative)[2m > [22m[2mshould prioritize GOAL_GRADIENT for budgeting context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mPersona-Based Nudging[2m > [22m[2mSAVER Persona (Conservative)[2m > [22m[2mshould emphasize security and caution for SAVER
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mPersona-Based Nudging[2m > [22m[2mSAVER Persona (Conservative)[2m > [22m[2mshould calculate progress correctly for SAVER budgeting
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mPersona-Based Nudging[2m > [22m[2mOBSERVER Persona (Passive)[2m > [22m[2mshould deliver default SOCIAL_PROOF nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mPersona-Based Nudging[2m > [22m[2mOBSERVER Persona (Passive)[2m > [22m[2mshould use neutral language for OBSERVER
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mPersona-Based Nudging[2m > [22m[2mOBSERVER Persona (Passive)[2m > [22m[2mshould provide informative mapping for OBSERVER budgeting
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mBehavior-Adaptive Messaging[2m > [22m[2mshould adapt message based on risk level threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mBehavior-Adaptive Messaging[2m > [22m[2mshould calculate real-world value mapping correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mBehavior-Adaptive Messaging[2m > [22m[2mshould override persona logic when risk is critically high
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mBehavior-Adaptive Messaging[2m > [22m[2mshould maintain persona preference when risk is moderate
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mContext-Specific Triggers[2m > [22m[2mshould handle INVESTMENT_DECISION context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mContext-Specific Triggers[2m > [22m[2mshould handle BUDGETING context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mContext-Specific Triggers[2m > [22m[2mshould handle STREAK_WARNING context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mContext-Specific Triggers[2m > [22m[2mshould handle SOCIAL_PROOF_REALTIME context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mContext-Specific Triggers[2m > [22m[2mshould return null for unknown context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mEngagement Optimization[2m > [22m[2mshould prioritize HIGH for streak-critical situations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mEngagement Optimization[2m > [22m[2mshould prioritize HIGH for HUNTER investment decisions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mEngagement Optimization[2m > [22m[2mshould prioritize HIGH for SAVER loss aversion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mEngagement Optimization[2m > [22m[2mshould prioritize MEDIUM for default social proof
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mEngagement Optimization[2m > [22m[2mshould prioritize LOW for OBSERVER budgeting nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mRealtime Social Proof[2m > [22m[2mshould fetch realtime social proof data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mRealtime Social Proof[2m > [22m[2mshould query behavior logs from last 24 hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mRealtime Social Proof[2m > [22m[2mshould generate realtime social nudge when users are active
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mRealtime Social Proof[2m > [22m[2mshould return null when no active users in last 24h
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mMulti-Language Support[2m > [22m[2mshould provide Vietnamese translations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mMulti-Language Support[2m > [22m[2mshould provide English translations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mMulti-Language Support[2m > [22m[2mshould provide Chinese translations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle missing user gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle zero amount in budgeting
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very large amounts in budgeting
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle missing data object
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle undefined risk level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould deliver cohesive persona journey for HUNTER
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould deliver cohesive persona journey for SAVER
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts[2m > [22m[2mNudgeEngineService - Personalization[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould adapt dynamically to changing user behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/personalization.service.spec.ts [2m([22m[2m39 tests[22m[2m)[22m[90m 126[2mms[22m[39m
[90mstdout[2m | src/auth/auth.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mgenerateTokens[2m > [22m[2mshould generate tokens and save to DB
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mvalidateUser[2m > [22m[2mshould return user without password if valid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mvalidateUser[2m > [22m[2mshould return null if password invalid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mvalidateUser[2m > [22m[2mshould return null if user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mlogin[2m > [22m[2mshould throw UnauthorizedException if validation fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mlogin[2m > [22m[2mshould return access and refresh tokens on success
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mrefreshToken[2m > [22m[2mshould refresh tokens correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mrefreshToken[2m > [22m[2mshould throw if token is expired
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mrefreshToken[2m > [22m[2mshould revoke all tokens if reused
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould create user and return tokens
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould throw ConflictException if email already exists
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould hash password with bcrypt before saving
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould handle Prisma P2002 error (duplicate email)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould generate default i18n name from email if name not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould handle concurrent login requests
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould handle refresh token near expiry
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould reject refresh token exactly at expiry boundary
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould handle missing refresh token in database
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mPassword Reset Race Conditions (S001)[2m > [22m[2mshould handle empty or null password gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mPassword Reset Race Conditions (S001)[2m > [22m[2mshould handle concurrent password validation attempts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mPassword Reset Race Conditions (S001)[2m > [22m[2mshould prevent timing attacks on user lookup
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mLogin Error Handling (S001)[2m > [22m[2mshould handle JWT signing failure gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mLogin Error Handling (S001)[2m > [22m[2mshould handle database errors during token generation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Security Edge Cases (S001)[2m > [22m[2mshould generate unique refresh tokens for same user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Security Edge Cases (S001)[2m > [22m[2mshould hash refresh tokens before storage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Security Edge Cases (S001)[2m > [22m[2mshould revoke all user tokens on token reuse detection
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m src/auth/auth.service.spec.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 1711[2mms[22m[39m
   [33m[2mâœ“[22m[39m AuthService[2m > [22mPassword Reset Race Conditions (S001)[2m > [22mshould prevent timing attacks on user lookup [33m351[2mms[22m[39m
[31m[Nest] 17460  - [39m01/03/2026, 2:17:43 AM [31m  ERROR[39m [38;5;3m[NudgeListener] [39m[31mFailed to deduct points for user user-5: Insufficient points[39m
[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete full streak warning flow: trigger â†’ nudge â†’ log
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete investment decision flow: request â†’ persona analysis â†’ nudge generation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete budgeting flow with SAVER persona: context â†’ persona â†’ mapping nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete social proof flow with realtime data aggregation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould process points.earned event â†’ generate nudge â†’ log behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould handle nudge.request event â†’ generate personalized nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould handle points.deduct event â†’ call gamification service
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould handle failed point deduction gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mCross-Service Integration[2m > [22m[2mshould integrate with Analytics service for persona-driven nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mCross-Service Integration[2m > [22m[2mshould integrate with Prisma for streak data retrieval and logging
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mCross-Service Integration[2m > [22m[2mshould integrate with Gamification service for point adjustments
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMock Dependencies Validation[2m > [22m[2mshould mock PrismaService correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMock Dependencies Validation[2m > [22m[2mshould mock AnalyticsService correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMock Dependencies Validation[2m > [22m[2mshould mock GamificationService correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle user not found in database
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle invalid nudge context gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle failed behavior logging without crashing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould skip nudge generation if simulation flag is false
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle high-risk investment with SAVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle empty streak list without errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMulti-Language Support[2m > [22m[2mshould return nudges with all three language variants
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMulti-Language Support[2m > [22m[2mshould provide localized budgeting nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Social Proof tactic for HUNTER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Loss Aversion tactic for high-risk scenarios
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Goal Gradient tactic for streak warnings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Salience tactic with mapping for budgeting
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mRealtime Social Proof Integration[2m > [22m[2mshould aggregate activity counts for social proof nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mRealtime Social Proof Integration[2m > [22m[2mshould return null if no active users found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/nudge.integration.spec.ts [2m([22m[2m28 tests[22m[2m)[22m[90m 133[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould track click coordinates with all parameters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould track click without elementId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould handle anonymous users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould track negative coordinates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackScrollDepth[2m > [22m[2mshould track scroll depth with percentage calculation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackScrollDepth[2m > [22m[2mshould handle 100% scroll depth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackScrollDepth[2m > [22m[2mshould handle zero scroll depth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould generate heatmap grid from click data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould normalize intensity to 0-1 range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould handle empty click data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould skip invalid coordinates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould use custom grid size
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould aggregate clicks in same grid cell
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould calculate average and max scroll depth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould handle no scroll events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould skip events without scrollPercentage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould find maximum scroll depth correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetClickPatterns[2m > [22m[2mshould retrieve user click patterns
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetClickPatterns[2m > [22m[2mshould filter out invalid coordinates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetClickPatterns[2m > [22m[2mshould respect limit parameter
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetHotspots[2m > [22m[2mshould filter cells by intensity threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetHotspots[2m > [22m[2mshould return empty array if no hotspots meet threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetHotspots[2m > [22m[2mshould use default threshold of 0.7
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould calculate comprehensive engagement metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould handle user with no activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould limit most visited pages to top 5
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould aggregate session durations correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould sort pages by visit count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/heatmap.service.spec.ts [2m([22m[2m28 tests[22m[2m)[22m[90m 57[2mms[22m[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Youth High Engagement (youth-high)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Savers (saver-segment)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Vietnamese/English Learners (vn-en-learners)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Mid Points Users (mid-points)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Mid Points Users updated with 2 users[39m
[33m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [33m   WARN[39m [38;5;3m[UserSegmentationService] [39m[33mSegment non-existent not found[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Age 20-30 (age-segment)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Age 20-30 updated with 1 users[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Active Learners (active-learners)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Active Learners updated with 2 users[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Low Engagement (low-engage)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Low Engagement updated with 1 users[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Medium Engagement (med-engage)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Medium Engagement updated with 1 users[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: High Engagement (high-engage)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment High Engagement updated with 1 users[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Risk Takers (hunters)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Risk Takers updated with 1 users[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Savers (savers)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Savers updated with 1 users[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Observers (observers)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Observers updated with 1 users[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Asian Users (asian-users)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Asian Users updated with 2 users[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Test (test-seg)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Test updated with 2 users[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mTargeting 2 users in segment "Test" with message: Special offer for you![39m
[33m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [33m   WARN[39m [38;5;3m[UserSegmentationService] [39m[33mCannot target segment non-existent: not found or empty[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Empty (empty-seg)[39m
[33m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [33m   WARN[39m [38;5;3m[UserSegmentationService] [39m[33mCannot target segment empty-seg: not found or empty[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Segment 1 (seg1)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Segment 1 (seg1)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Segment 2 (seg2)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Segment 3 (seg3)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: To Delete (to-delete)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment to-delete deleted[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Complex Segment (complex-seg)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Complex Segment updated with 1 users[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment defined: Strict Segment (strict-seg)[39m
[32m[Nest] 10496  - [39m01/03/2026, 2:17:45 AM [32m    LOG[39m [38;5;3m[UserSegmentationService] [39m[32mSegment Strict Segment updated with 0 users[39m
[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Definition[2m > [22m[2mshould define a new segment with criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Definition[2m > [22m[2mshould define segment with behavior type criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Definition[2m > [22m[2mshould define segment with locale criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould update segment with matching users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould return null when updating non-existent segment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter users by age range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter users by completed lessons minimum
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by LOW engagement level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by MEDIUM engagement level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by HIGH engagement level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by HUNTER behavior type
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by SAVER behavior type
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by OBSERVER behavior type
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by locale criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Targeting[2m > [22m[2mshould target segment with message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Targeting[2m > [22m[2mshould return false when targeting non-existent segment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Targeting[2m > [22m[2mshould return false when targeting empty segment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould return user demographics with all fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould classify user as SAVER based on behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould classify user as OBSERVER when no strong behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould return null when user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould return null when user has no date of birth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould default to "vi" locale when user has no preferred language
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould retrieve segment by ID
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould return null for non-existent segment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould get all segments
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould delete segment successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould return false when deleting non-existent segment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mComplex Multi-Criteria Filtering[2m > [22m[2mshould apply multiple criteria filters together
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mComplex Multi-Criteria Filtering[2m > [22m[2mshould handle empty result when no users match all criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mAge Calculation Edge Cases[2m > [22m[2mshould calculate age correctly for birthday today
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mAge Calculation Edge Cases[2m > [22m[2mshould calculate age correctly for birthday tomorrow
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/user-segmentation.service.spec.ts [2m([22m[2m32 tests[22m[2m)[22m[90m 67[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return CRITICAL warning for high-value streak (>= 7 days) about to expire
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return HIGH priority for low-value streak (< 7 days) about to expire
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when streak is already expired (>24 hours)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when activity is too recent (<20 hours)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when user has no streak
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when streak data does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould calculate hours remaining correctly at exact 20-hour mark
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould generate CRITICAL nudge when progress is 90%+
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould generate HIGH nudge when progress is 70-89%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould return null when progress is below 70%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould return null when progress is already 100%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould handle edge case at exactly 70% threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould handle multi-language goal names correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould generate commitment contract with penalty warning
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould format large amounts correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould return null when user does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould handle small amounts correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould include all three language translations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould frame as LOSS with HIGH priority
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould frame as GAIN with MEDIUM priority
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould include inflation context in loss framing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould emphasize action in gain framing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould handle edge case with zero amount
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould process multiple users and return nudges for each
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould return empty arrays for users without warnings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould handle empty user list
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould process users independently even if one fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle future dates gracefully in streak calculation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle very large streak numbers
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle progress percentage edge cases
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle very small commitment amounts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle very large commitment durations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mMessage Quality & Localization[2m > [22m[2mshould ensure all messages contain required emoji/icons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mMessage Quality & Localization[2m > [22m[2mshould ensure message consistency across all three languages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/loss-aversion.service.spec.ts [2m([22m[2m34 tests[22m[2m)[22m[90m 47[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould find users with streaks between 20-24 hours ago and send nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould not send nudges if no users match criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould filter out frozen streaks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould filter out zero-streak users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould send nudges to multiple users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould include correct time boundaries (20-24 hours)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould log user streak data in nudge payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould use nudge-system as sessionId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould use correct event path
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mTrigger Frequency Limits[2m > [22m[2mshould not send nudge to same user within 24 hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mTrigger Frequency Limits[2m > [22m[2mshould enforce max 3 nudges per day per user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mTrigger Frequency Limits[2m > [22m[2mshould allow nudge after 24 hours cooldown
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mUser Preference Overrides[2m > [22m[2mshould respect user opt-out from nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mUser Preference Overrides[2m > [22m[2mshould respect quiet hours preference
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mUser Preference Overrides[2m > [22m[2mshould send nudge outside quiet hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mThaler Pattern Validation[2m > [22m[2mshould apply loss aversion nudge for streak preservation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mThaler Pattern Validation[2m > [22m[2mshould use social proof for high streaks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mThaler Pattern Validation[2m > [22m[2mshould use framing for milestone streaks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mA/B Test Integration[2m > [22m[2mshould track nudge variant for A/B testing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mA/B Test Integration[2m > [22m[2mshould support different nudge message variants
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mA/B Test Integration[2m > [22m[2mshould log A/B test metadata for analytics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/nudge.service.spec.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 75[2mms[22m[39m
[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould recommend LEVEL_UP for high score (>80)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould recommend REINFORCE for low score (<50)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould recommend STAY for medium score (50-80)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle edge case: score exactly 80
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle edge case: score exactly 50
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle missing score gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle score of 0
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle perfect score (100)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mUser Success Rate Tracking[2m > [22m[2mshould log behavior for performance tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mUser Success Rate Tracking[2m > [22m[2mshould track lesson completion metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mUser Success Rate Tracking[2m > [22m[2mshould maintain consistent session tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould optimize for Flow State with quick high-score completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould detect struggle with long time + low score
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould maintain engagement with moderate performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould handle zero time spent edge case
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould handle beginner user progression
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould handle advanced user performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould handle user without investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould process multiple rapid adjustments
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle negative score gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle score over 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould return correct response structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle very large timeSpent values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle different user IDs correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle different lesson IDs correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mIntegration with User Profile[2m > [22m[2mshould fetch user with investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mIntegration with User Profile[2m > [22m[2mshould work with users having different risk tolerances
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/ai/adaptive-difficulty.service.spec.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 55[2mms[22m[39m
[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould create a new thread with title only
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould create a new thread with title and module
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould handle service errors when creating thread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould require authentication (JwtAuthGuard)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads - getThreads[2m > [22m[2mshould return all threads for authenticated user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads - getThreads[2m > [22m[2mshould return empty array when user has no threads
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads - getThreads[2m > [22m[2mshould handle service errors when fetching threads
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould return all messages for a thread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould return empty array for thread with no messages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould handle non-existent thread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould handle service errors when fetching messages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould generate AI response for user prompt
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle empty prompt
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle rate limit exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle monthly budget exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle non-existent thread in chat
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle unauthorized access to thread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle AI service errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mInput Validation[2m > [22m[2mshould validate title is required for createThread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mInput Validation[2m > [22m[2mshould validate prompt is required for chat
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mInput Validation[2m > [22m[2mshould handle invalid threadId format
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect createThread with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect getThreads with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect getMessages with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect chat with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mError Response Handling[2m > [22m[2mshould propagate service exceptions to client
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mError Response Handling[2m > [22m[2mshould handle unexpected errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long thread titles
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long prompts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in title
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in prompt
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/ai/ai.controller.spec.ts [2m([22m[2m32 tests[22m[2m)[22m[90m 134[2mms[22m[39m
[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mBasic Recommendation[2m > [22m[2mshould return personalized recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mBasic Recommendation[2m > [22m[2mshould return fallback recommendations if AI fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersona-Based Filtering[2m > [22m[2mshould recommend risk-focused courses for HUNTER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersona-Based Filtering[2m > [22m[2mshould recommend savings courses for SAVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersona-Based Filtering[2m > [22m[2mshould recommend diverse courses for OBSERVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mContent Freshness[2m > [22m[2mshould filter out completed courses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mContent Freshness[2m > [22m[2mshould prioritize recently published courses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mCache Invalidation[2m > [22m[2mshould bypass cache when user completes new lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mCache Invalidation[2m > [22m[2mshould refresh recommendations when persona changes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersonalization Accuracy[2m > [22m[2mshould match recommendations to user learning habits
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersonalization Accuracy[2m > [22m[2mshould validate AI recommendation output structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersonalization Accuracy[2m > [22m[2mshould apply nudge strategies correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/recommendations/recommendation.service.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 29[2mms[22m[39m
[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mcreateCourse[2m > [22m[2mshould create a course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mfindOneCourse[2m > [22m[2mshould return course with lessons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mfindOneCourse[2m > [22m[2mshould throw NotFoundException if course not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mupdateProgress[2m > [22m[2mshould upsert progress and reward points for first completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mupdateProgress[2m > [22m[2mshould not reward points if already completed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mcreateLesson[2m > [22m[2mshould determine order automatically if not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mcreateLesson[2m > [22m[2mshould start with order 1 if no lessons exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mupdateLesson[2m > [22m[2mshould update lesson data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mremoveLesson[2m > [22m[2mshould delete lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mEnrollment Constraints (S003)[2m > [22m[2mshould handle getUserProgress for empty course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mEnrollment Constraints (S003)[2m > [22m[2mshould include lesson details in user progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould handle progress update with zero duration
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould increment duration for existing progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould not reward points for re-completing same lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould set completedAt timestamp on first completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mLesson Ordering Logic (S003)[2m > [22m[2mshould handle manual order override
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mLesson Ordering Logic (S003)[2m > [22m[2mshould auto-assign order for empty course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mLesson Ordering Logic (S003)[2m > [22m[2mshould respect existing lesson order sequence
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCourse Query Pagination (S003)[2m > [22m[2mshould enforce max limit of 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCourse Query Pagination (S003)[2m > [22m[2mshould enforce min page of 1
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCourse Query Pagination (S003)[2m > [22m[2mshould filter by published and level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCRUD Error Handling (S003)[2m > [22m[2mshould throw NotFoundException for invalid lesson ID
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCRUD Error Handling (S003)[2m > [22m[2mshould delete course successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCRUD Error Handling (S003)[2m > [22m[2mshould update course with partial data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/courses/courses.service.spec.ts [2m([22m[2m24 tests[22m[2m)[22m[90m 56[2mms[22m[39m
[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mcreateCourse[2m > [22m[2mshould create a new course successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mcreateCourse[2m > [22m[2mshould validate required fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould return all courses with default pagination
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould apply pagination parameters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould filter by level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould convert string params to numbers
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindOne[2m > [22m[2mshould return a single course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindOne[2m > [22m[2mshould throw NotFoundException for non-existent course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindLesson[2m > [22m[2mshould return a single lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindLesson[2m > [22m[2mshould throw NotFoundException for non-existent lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateCourse[2m > [22m[2mshould update course successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateCourse[2m > [22m[2mshould handle partial updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mremoveCourse[2m > [22m[2mshould delete course successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mremoveCourse[2m > [22m[2mshould throw NotFoundException for non-existent course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mcreateLesson[2m > [22m[2mshould create a new lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateLesson[2m > [22m[2mshould update lesson successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mremoveLesson[2m > [22m[2mshould delete lesson successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateProgress[2m > [22m[2mshould update user progress successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateProgress[2m > [22m[2mshould handle IN_PROGRESS status
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateProgress[2m > [22m[2mshould validate duration is non-negative
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mgetMentorAdvice[2m > [22m[2mshould get AI mentor advice for course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mgetMentorAdvice[2m > [22m[2mshould handle AI service errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould require ADMIN or TEACHER role for createCourse
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould require ADMIN or TEACHER role for updateCourse
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould require only ADMIN role for removeCourse
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould not require specific roles for public endpoints
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/courses/courses.controller.spec.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 112[2mms[22m[39m
[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log lesson completion event with points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log achievement unlocked event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log streak milestone event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould handle missing userId gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould validate eventType is required
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log multiple rapid events without collision
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyHistory - Behavior Analytics[2m > [22m[2mshould return user behavior history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyHistory - Behavior Analytics[2m > [22m[2mshould return empty array for user with no history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyHistory - Behavior Analytics[2m > [22m[2mshould throw UnauthorizedException for missing auth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyStreak - Gamification Streak Tracking[2m > [22m[2mshould return current streak (placeholder)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyStreak - Gamification Streak Tracking[2m > [22m[2mshould work without errors for new users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect log endpoint with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect getMyHistory with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect getMyStreak with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGamification Integration Tests[2m > [22m[2mshould trigger XP calculation on lesson completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGamification Integration Tests[2m > [22m[2mshould track badge awarding event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGamification Integration Tests[2m > [22m[2mshould log leaderboard position change
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mError Handling[2m > [22m[2mshould propagate service errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mError Handling[2m > [22m[2mshould handle getUserBehaviors service errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/behavior/behavior.controller.spec.ts [2m([22m[2m20 tests[22m[2m)[22m[90m 78[2mms[22m[39m
[90mstdout[2m | src/ai/ai-agent-data.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/ai/ai-agent-data.spec.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[90m 51[2mms[22m[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 50 points for LESSON_COMPLETED[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 0 points for TEST[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 5000 points for ACHIEVEMENT_UNLOCKED[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 100 points for CUSTOM_EVENT[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 0 points for LOGIN[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned -10 points for PENALTY[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 0 points for DECAY[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 10 points for EVENT1[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 20 points for EVENT2[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 30 points for EVENT3[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 100 points for ACHIEVEMENT[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 50 points for LEADERBOARD_CLIMB[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 0 points for RANK_UP[39m
[32m[Nest] 17900  - [39m01/03/2026, 2:17:57 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser u1 earned 20 points for STREAK_RECOVERED[39m
[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mlogEvent[2m > [22m[2mshould increment user points and log behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mlogEvent[2m > [22m[2mshould use simulation system ID when metadata has isSimulation true
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould deduct points if user has enough
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould throw error if user has insufficient points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould throw error if user does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould log deduction with correct session ID
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mPoint calculation with streak multipliers (edge cases)[2m > [22m[2mshould handle zero points correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mPoint calculation with streak multipliers (edge cases)[2m > [22m[2mshould handle large point values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mPoint calculation with streak multipliers (edge cases)[2m > [22m[2mshould include custom metadata in payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mXP Decay Logic (S004)[2m > [22m[2mshould handle zero-point events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mXP Decay Logic (S004)[2m > [22m[2mshould handle negative point values gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mXP Decay Logic (S004)[2m > [22m[2mshould track point decay in metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mAchievement Unlock Race Conditions (S004)[2m > [22m[2mshould handle concurrent point updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mAchievement Unlock Race Conditions (S004)[2m > [22m[2mshould emit event for each point gain
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mLeaderboard Ranking Updates (S004)[2m > [22m[2mshould log events with unique event types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mLeaderboard Ranking Updates (S004)[2m > [22m[2mshould handle metadata for ranking changes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mStreak Recovery (S004)[2m > [22m[2mshould log streak recovery events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mDeduction Edge Cases (S004)[2m > [22m[2mshould handle deduction when points exactly match
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mDeduction Edge Cases (S004)[2m > [22m[2mshould emit deduction event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/common/gamification.service.spec.ts [2m([22m[2m19 tests[22m[2m)[22m[90m 50[2mms[22m[39m
[90mstdout[2m | src/database/pgvector.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2monModuleInit[2m > [22m[2mshould load embeddings model on initialization
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 15760  - [39m01/03/2026, 2:17:57 AM [31m  ERROR[39m [38;5;3m[PgvectorService] [39m[31mFailed to load embeddings model: Model download failed[39m
[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2monModuleInit[2m > [22m[2mshould handle model loading failure gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mgenerateEmbedding[2m > [22m[2mshould generate 384-dimensional embedding vector
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mgenerateEmbedding[2m > [22m[2mshould handle different text inputs
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 15760  - [39m01/03/2026, 2:17:57 AM [31m  ERROR[39m [38;5;3m[PgvectorService] [39m[31mEmbedding generation failed: Pipeline error[39m
[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mgenerateEmbedding[2m > [22m[2mshould return zero vector when model not loaded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mgenerateEmbedding[2m > [22m[2mshould handle embedding generation error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mstoreOptimization[2m > [22m[2mshould store optimization with generated embedding
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mstoreOptimization[2m > [22m[2mshould handle metadata defaults
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mfindSimilarOptimizations[2m > [22m[2mshould find similar optimizations with pgvector
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mfindSimilarOptimizations[2m > [22m[2mshould use default options
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mfindSimilarOptimizations[2m > [22m[2mshould fallback to in-memory search if pgvector unavailable
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2misPgvectorAvailable[2m > [22m[2mshould return true when pgvector extension exists
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2misPgvectorAvailable[2m > [22m[2mshould return false when pgvector extension missing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2misPgvectorAvailable[2m > [22m[2mshould return false on database error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mgetModelStatus[2m > [22m[2mshould return model status when loaded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mgetModelStatus[2m > [22m[2mshould return model status when not loaded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty query text
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long query text
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in query
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/pgvector.service.spec.ts[2m > [22m[2mPgvectorService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle similarity threshold edge cases
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/database/pgvector.service.spec.ts [2m([22m[2m20 tests[22m[2m)[22m[90m 95[2mms[22m[39m
[90mstdout[2m | src/database/pgvector.service.spec.ts
[22m[39mâœ… Vitest teardown complete

[32m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mRunning system health hub check...[39m
[33m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [33m   WARN[39m [38;5;3m[AnalyticsService] [39m[33mCRITICAL: High error rate detected! 60 errors in the last hour.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mStarting BehaviorLog aggregation and archiving...[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mAggregated 3 logs into 2 unique summaries.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mArchived 0 old behavior logs.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mStarting BehaviorLog aggregation and archiving...[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mNo logs to aggregate for yesterday.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mStarting BehaviorLog aggregation and archiving...[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mAggregated 1 logs into 1 unique summaries.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mArchived 15 old behavior logs.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mStarting BehaviorLog aggregation and archiving...[39m
[31m[Nest] 2492  - [39m01/03/2026, 2:17:58 AM [31m  ERROR[39m [38;5;3m[AnalyticsService] [39m[31mLog aggregation failed[39m
Error: DB Error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\analytics\analytics.service.spec.ts:159:57
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mRunning system health hub check...[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mStarting BehaviorLog aggregation and archiving...[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mAggregated 2 logs into 1 unique summaries.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mArchived 0 old behavior logs.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mRunning system health hub check...[39m
[33m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [33m   WARN[39m [38;5;3m[AnalyticsService] [39m[33mCRITICAL: High error rate detected! 75 errors in the last hour.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mRunning system health hub check...[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mStarting BehaviorLog aggregation and archiving...[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mAggregated 1 logs into 1 unique summaries.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mArchived 100 old behavior logs.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mStarting BehaviorLog aggregation and archiving...[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mAggregated 1 logs into 1 unique summaries.[39m
[32m[Nest] 2492  - [39m01/03/2026, 2:17:59 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mArchived 0 old behavior logs.[39m
[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleSystemHealthCheck[2m > [22m[2mshould log health check and warn on high error rates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserLearningHabits[2m > [22m[2mshould return habits based on logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserLearningHabits[2m > [22m[2mshould return null if no logs found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould classify as HUNTER for risk-taking behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould classify as SAVER for commitment-focused behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould aggregate logs from yesterday by user and eventType
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould handle empty log set gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould delete logs older than 30 days
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould handle aggregation errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetGlobalSystemStats[2m > [22m[2mshould return aggregated system statistics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetGlobalSystemStats[2m > [22m[2mshould handle null points sum gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mDate Range Validation[2m > [22m[2mshould correctly calculate 1-hour time window for health check
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mDate Range Validation[2m > [22m[2mshould handle date boundary edge cases in aggregation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mReal-Time Metrics Updates[2m > [22m[2mshould track error rate spikes in real-time
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mReal-Time Metrics Updates[2m > [22m[2mshould update health metrics every hour
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mBehavior Log Archiving[2m > [22m[2mshould archive logs in batches based on age threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mBehavior Log Archiving[2m > [22m[2mshould preserve recent logs during archiving
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/analytics.service.spec.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 40[2mms[22m[39m
[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mcreateCourse[2m > [22m[2mshould create course with localized JSONB content (vi/en/zh)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mcreateCourse[2m > [22m[2mshould validate JSONB structure via ValidationService
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould return paginated courses with default values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould filter by published status
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould filter by level (BEGINNER, INTERMEDIATE, ADVANCED)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould enforce max limit of 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould handle page boundaries correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneCourse[2m > [22m[2mshould return course with published lessons ordered by order field
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneCourse[2m > [22m[2mshould throw NotFoundException if course not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateCourse[2m > [22m[2mshould update course and preserve localization structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateCourse[2m > [22m[2mshould allow partial updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mremoveCourse[2m > [22m[2mshould delete course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould update progress and award points on first completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould not award points if already completed (idempotent)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould increment durationSpent on existing progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould set completedAt timestamp on first completion only
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mgetUserProgress[2m > [22m[2mshould return all progress for a user in a specific course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneLesson[2m > [22m[2mshould return lesson by id
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneLesson[2m > [22m[2mshould throw NotFoundException if lesson not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/unit/courses/courses.service.spec.ts [2m([22m[2m19 tests[22m[2m)[22m[90m 51[2mms[22m[39m
[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mGET /simulation/portfolio[2m > [22m[2mshould return user simulation portfolio
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mGET /simulation/portfolio[2m > [22m[2mshould handle empty portfolio
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/trade[2m > [22m[2mshould execute buy trade successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/trade[2m > [22m[2mshould execute sell trade successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/trade[2m > [22m[2mshould validate insufficient funds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/start[2m > [22m[2mshould start a new life scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/start[2m > [22m[2mshould generate AI-powered scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/continue[2m > [22m[2mshould process user choice and continue scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/continue[2m > [22m[2mshould handle scenario completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/budget/process[2m > [22m[2mshould process budget allocation decision
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/stress-test[2m > [22m[2mshould run financial stress test
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/stress-test[2m > [22m[2mshould test multiple economic scenarios
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/impact-analysis[2m > [22m[2mshould calculate long-term impact with default years
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/impact-analysis[2m > [22m[2mshould calculate impact for custom time horizon
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/commitment/create[2m > [22m[2mshould create financial commitment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/commitment/create[2m > [22m[2mshould enforce loss aversion logic
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/commitment/withdraw[2m > [22m[2mshould withdraw commitment with penalty
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/simulation/simulation.controller.spec.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 79[2mms[22m[39m
[90mstdout[2m | src/database/database.service.seed.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/database/database.service.seed.spec.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[90m 45[2mms[22m[39m
[90mstdout[2m | src/users/users.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mfindOne[2m > [22m[2mshould find user by email
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mfindById[2m > [22m[2mshould find user by id
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mcreate[2m > [22m[2mshould create a new user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould return correct stats
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould handle zero stats
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mProfile Update Validation (S002)[2m > [22m[2mshould update user profile successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mProfile Update Validation (S002)[2m > [22m[2mshould handle JSONB preference updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mProfile Update Validation (S002)[2m > [22m[2mshould reject invalid user ID
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mSoft Delete & User Search (S002)[2m > [22m[2mshould find user by ID even if not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mSoft Delete & User Search (S002)[2m > [22m[2mshould include investment profile in findById
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mInvestment Profile Management (S002)[2m > [22m[2mshould create investment profile if not exists
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mInvestment Profile Management (S002)[2m > [22m[2mshould update existing investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mInvestment Profile Management (S002)[2m > [22m[2mshould return null if no investment profile exists
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mPassword Management (S002)[2m > [22m[2mshould change password with valid old password
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mPassword Management (S002)[2m > [22m[2mshould reject invalid old password
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mPassword Management (S002)[2m > [22m[2mshould throw NotFoundException if user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mDashboard Stats Edge Cases (S002)[2m > [22m[2mshould handle multiple courses with same lessons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mDashboard Stats Edge Cases (S002)[2m > [22m[2mshould handle large duration values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.service.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m src/users/users.service.spec.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 457[2mms[22m[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Vector search failed[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[31m[Nest] 15636  - [39m01/03/2026, 2:18:05 AM [31m  ERROR[39m [38;5;3m[DatabaseArchitectAgent] [39m[31mRAG lookup failed: Cannot read properties of undefined (reading 'length')[39m
[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mHeuristic Rules Engine[2m > [22m[2mshould detect SELECT * anti-pattern
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mHeuristic Rules Engine[2m > [22m[2mshould detect LIKE with leading wildcard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mHeuristic Rules Engine[2m > [22m[2mshould detect multiple JOINs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mHeuristic Rules Engine[2m > [22m[2mshould detect NOT IN anti-pattern
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mHeuristic Rules Engine[2m > [22m[2mshould detect high OFFSET pagination
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mRAG Integration[2m > [22m[2mshould find cached recommendations via PgvectorService
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mRAG Integration[2m > [22m[2mshould fallback to heuristics when no RAG match found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mRAG Integration[2m > [22m[2mshould store new recommendations for future RAG
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mRAG Integration[2m > [22m[2mshould handle RAG lookup failures gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mQuery Pattern Analysis[2m > [22m[2mshould return mock patterns in development mode
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mQuery Pattern Analysis[2m > [22m[2mshould query pg_stat_statements in production mode
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mQuery Pattern Analysis[2m > [22m[2mshould fallback to mock data when pg_stat_statements unavailable
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mWeekly Audit[2m > [22m[2mshould generate audit report with high-confidence recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mWeekly Audit[2m > [22m[2mshould filter out low-confidence recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mWeekly Audit[2m > [22m[2mshould handle empty query patterns gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mEdge Cases[2m > [22m[2mshould return generic recommendation when no rules match
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty query strings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mEdge Cases[2m > [22m[2mshould normalize queries correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts[2m > [22m[2mDatabaseArchitectAgent[2m > [22m[2mAgent Status[2m > [22m[2mshould return agent status with all components
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/database-architect.agent.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/database/database-architect.agent.spec.ts [2m([22m[2m19 tests[22m[2m)[22m[90m 135[2mms[22m[39m
[90mstdout[2m | test/simulation-ai.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould start simulation and generate AI scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould continue simulation, make decision and calculate impact
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould verify market simulation trade updates portfolio
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould validate simulation history logs via behavior tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/simulation-ai.integration.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m test/simulation-ai.integration.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 504[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mPOST /nudge/check[2m > [22m[2mshould trigger nudge check with context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mPOST /nudge/check[2m > [22m[2mshould use default context and data when not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mPOST /nudge/check[2m > [22m[2mshould generate loss aversion nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould return multiple dashboard nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould filter out null nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould generate streak warning nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould generate social proof nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould get realtime social proof for course enrollment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould get social proof for lesson completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould get social proof for commitment creation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould handle zero activity gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould include user demographics in social proof
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould return percentage for social proof
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould show time-based scarcity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould display user testimonials count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould show trending badge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould include peer comparison
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould validate commitment contract nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould show framing effect
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould integrate with investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/nudge.controller.spec.ts [2m([22m[2m21 tests[22m[2m)[22m[90m 95[2mms[22m[39m
[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould update item and calculate progress correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould reward when 100% completed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould not reward if already 100% completed before
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould throw NotFoundException for non-existent checklist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould throw NotFoundException for wrong user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould mark item as incomplete and recalculate progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould set completedAt timestamp when completing item
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mcreate[2m > [22m[2mshould create a new checklist with 0 progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mfindAll[2m > [22m[2mshould return all checklists ordered by updatedAt desc
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mfindAll[2m > [22m[2mshould return empty array if no checklists exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mProgress calculation[2m > [22m[2mshould calculate 0% for all incomplete items
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mProgress calculation[2m > [22m[2mshould round progress correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/checklists/checklists.service.spec.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 25[2mms[22m[39m
[90mstdout[2m | src/common/health.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould return ok status
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould return timestamp
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould return uptime
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould respond quickly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould handle concurrent health checks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould return ready status when DB is connected
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould execute DB connectivity check
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould return not ready when DB is disconnected
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould handle DB timeout
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould retry on transient failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return user count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return course count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return behavior log count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return timestamp
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould fetch all metrics in parallel
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould handle zero counts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould handle large counts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mDB Connectivity[2m > [22m[2mshould verify Prisma connection
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mDB Connectivity[2m > [22m[2mshould handle connection pool exhaustion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mDB Connectivity[2m > [22m[2mshould handle SSL connection errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mService Status[2m > [22m[2mshould indicate healthy service
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mService Status[2m > [22m[2mshould detect degraded performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mService Status[2m > [22m[2mshould handle service unavailability
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mError Handling[2m > [22m[2mshould handle metrics query failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mError Handling[2m > [22m[2mshould handle partial metric failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mError Handling[2m > [22m[2mshould not leak DB errors to client
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle uptime overflow
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle timezone differences
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle rapid successive checks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m src/common/health.controller.spec.ts [2m([22m[2m30 tests[22m[2m)[22m[33m 624[2mms[22m[39m
[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mgetFeed[2m > [22m[2mshould return social feed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcreatePost[2m > [22m[2mshould create a new post
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mgetRecommendations[2m > [22m[2mshould return group recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcreateGroup[2m > [22m[2mshould create a new group
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mjoinGroup[2m > [22m[2mshould join a group
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mgetGroupDetails[2m > [22m[2mshould return group details
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcreateChallenge[2m > [22m[2mshould create a group challenge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mError Handling[2m > [22m[2mshould propagate errors from social service
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mlikePost[2m > [22m[2mshould like a post successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mlikePost[2m > [22m[2mshould handle duplicate likes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcommentOnPost[2m > [22m[2mshould add comment to post successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcommentOnPost[2m > [22m[2mshould validate empty content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mWebSocket Integration (Mocked)[2m > [22m[2mshould handle real-time feed updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mWebSocket Integration (Mocked)[2m > [22m[2mshould support pagination for feed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mGroup Challenge Tests[2m > [22m[2mshould create challenge with all required fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mGroup Challenge Tests[2m > [22m[2mshould validate challenge target is positive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect all endpoints with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/social/social.controller.spec.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 75[2mms[22m[39m
[90mstdout[2m | src/modules/social/social.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould return user profile successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould throw NotFoundException when user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould throw UnauthorizedException when userId is missing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould handle service errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetInvestmentProfile[2m > [22m[2mshould return investment profile successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetInvestmentProfile[2m > [22m[2mshould handle user without investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetInvestmentProfile[2m > [22m[2mshould throw NotFoundException for non-existent user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould update investment profile successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould handle partial updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould validate investment goals array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould throw NotFoundException for non-existent user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould return dashboard statistics successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould return empty stats for new user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect all endpoints with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mGuard Protection[2m > [22m[2mshould require authentication for investment profile endpoints
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mGuard Protection[2m > [22m[2mshould require authentication for dashboard stats
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/users/users.controller.spec.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 97[2mms[22m[39m
[90mstdout[2m | src/storage/storage.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould upload file successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould generate unique key with timestamp
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould preserve original filename in key
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould return public URL
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould handle PNG files
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould handle PDF files
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould accept files under 5MB
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould accept files exactly at 5MB limit
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould handle empty files
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould handle large buffer efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept image/jpeg
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept image/png
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept application/pdf
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept video/mp4
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould handle unknown MIME types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mSpecial Characters in Filename[2m > [22m[2mshould handle spaces in filename
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mSpecial Characters in Filename[2m > [22m[2mshould handle unicode characters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mSpecial Characters in Filename[2m > [22m[2mshould handle special characters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mError Handling[2m > [22m[2mshould handle upload failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mError Handling[2m > [22m[2mshould handle storage service unavailability
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mError Handling[2m > [22m[2mshould handle network timeout
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mConcurrent Uploads[2m > [22m[2mshould handle multiple concurrent uploads
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/storage/storage.controller.spec.ts [2m([22m[2m28 tests[22m[2m)[22m[90m 141[2mms[22m[39m
[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mConcurrent Uploads[2m > [22m[2mshould generate unique keys for concurrent uploads
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long filenames
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle files with no extension
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle files with multiple dots
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle different file encodings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/my-habits[2m > [22m[2mshould return user learning habits
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/my-habits[2m > [22m[2mshould handle user with no learning history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/my-habits[2m > [22m[2mshould aggregate multi-day data correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/predictive/future[2m > [22m[2mshould simulate user financial future
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/predictive/future[2m > [22m[2mshould handle user with minimal financial data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/predictive/future[2m > [22m[2mshould project multiple time horizons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould return personalized mentor advice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould use default module and lesson when not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould respect user locale preference
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould handle Chinese locale
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/system-stats (ADMIN)[2m > [22m[2mshould return global system statistics for admin
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/system-stats (ADMIN)[2m > [22m[2mshould include platform-wide metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/system-stats (ADMIN)[2m > [22m[2mshould aggregate user behavior metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/analytics.controller.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 68[2mms[22m[39m
[90mstdout[2m | src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mEnd-to-end Social Flow[2m > [22m[2mshould handle full cycle: join group -> welcome post -> leaderboard nudge -> notification
[22m[39m[Push Notification] to u2: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch user1 200 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 200 points behind user1. Finish one more lesson to overtake!","zh":"ä½ åªè½åŽ user1 200 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mEnd-to-end Social Flow[2m > [22m[2mshould synchronize WebSocket broadcasts with REST API actions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mEnd-to-end Social Flow[2m > [22m[2mshould handle challenge progression and cross-service rewards
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/social/social.integration.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 786[2mms[22m[39m
   [33m[2mâœ“[22m[39m Social Integration[2m > [22mEnd-to-end Social Flow[2m > [22mshould handle full cycle: join group -> welcome post -> leaderboard nudge -> notification [33m750[2mms[22m[39m
[90mstdout[2m | src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mWebSocket + Service Interactions[2m > [22m[2mshould handle group streak updates and conditional nudging
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mshould analyze behavior and sync profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mRisk score calculation[2m > [22m[2mshould calculate risk score from high-risk behavior logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mRisk score calculation[2m > [22m[2mshould calculate risk score from conservative behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mKnowledge level assessment[2m > [22m[2mshould set knowledge to BEGINNER for new user with few lessons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mKnowledge level assessment[2m > [22m[2mshould assess knowledge from completed lessons count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould sync profile with JSONB investment philosophy
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould create new profile if none exists
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould update existing profile with new analysis
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould include locale in AI prompt
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/behavior/investment-profile.service.spec.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 22[2mms[22m[39m
[90mstdout[2m | src/auth/auth.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignIn[2m > [22m[2mshould call authService.login
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignIn[2m > [22m[2mshould return access_token, refresh_token, and user object
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mValidation (Integration)[2m > [22m[2mshould fail if email is invalid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mValidation (Integration)[2m > [22m[2mshould fail if password is too short in RegisterDto
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignUp[2m > [22m[2mshould call authService.register
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignUp[2m > [22m[2mshould return tokens and user on successful registration
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mrefresh[2m > [22m[2mshould call authService.refreshToken
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mrefresh[2m > [22m[2mshould return new tokens on successful refresh
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mGuards[2m > [22m[2mshould have JwtAuthGuard on profile-related endpoints in UsersController
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Expired Tokens[2m > [22m[2mshould reject expired refresh token
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Expired Tokens[2m > [22m[2mshould handle missing refresh token
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Password Reset Flow[2m > [22m[2mshould reject login with invalid credentials
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Password Reset Flow[2m > [22m[2mshould reject login with non-existent email
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: JWT Refresh Race Conditions[2m > [22m[2mshould handle token reuse detection
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: JWT Refresh Race Conditions[2m > [22m[2mshould generate new tokens on valid refresh
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/auth/auth.controller.spec.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 158[2mms[22m[39m
[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Registration Conflicts[2m > [22m[2mshould reject duplicate email registration
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould run full diagnostics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould return database check status
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould return AI service check
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould return WebSocket connection count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/metrics[2m > [22m[2mshould return Prometheus metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/metrics[2m > [22m[2mshould return metrics in Prometheus format
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/metrics[2m > [22m[2mshould expose throughput metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/verify-integrity[2m > [22m[2mshould verify system integrity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/verify-integrity[2m > [22m[2mshould check database integrity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/verify-integrity[2m > [22m[2mshould validate schema consistency
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/simulate[2m > [22m[2mshould simulate user flow
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/simulate[2m > [22m[2mshould handle invalid userId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/simulate[2m > [22m[2mshould handle empty userId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/mock-behaviors[2m > [22m[2mshould generate mock behavioral data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/mock-behaviors[2m > [22m[2mshould use default count if not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/mock-behaviors[2m > [22m[2mshould handle large counts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould run AI stress test with LOW complexity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould run AI stress test with MEDIUM complexity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould run AI stress test with HIGH complexity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould handle stress test failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mHealth Checks[2m > [22m[2mshould verify all critical services
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mHealth Checks[2m > [22m[2mshould report unhealthy status on failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle concurrent diagnostic requests
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle service unavailability
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mEdge Cases[2m > [22m[2mshould validate stress test complexity values
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/debug/diagnostic.controller.spec.ts [2m([22m[2m26 tests[22m[2m)[22m[90m 93[2mms[22m[39m
[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate correct BEHAVIOR_LOG_PAYLOAD
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate minimal BEHAVIOR_LOG_PAYLOAD
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate correct I18N_TEXT with all locales
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject I18N_TEXT missing required locale
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate USER_METADATA with optional fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject USER_METADATA with invalid URL
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SOCIAL_POST_CONTENT
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SIMULATION_EVENT with nested options
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject SIMULATION_EVENT with missing required fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate INVESTMENT_PHILOSOPHY
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject INVESTMENT_PHILOSOPHY with invalid enum
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate FINANCIAL_GOALS array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate CHECKLIST_ITEMS
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate PORTFOLIO_ASSETS with mixed types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SIMULATION_STATUS with optional fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate COURSE_RECOMMENDATION with i18n reason
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate CHAT_MESSAGE_METADATA
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould throw error for validation failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould throw error for undefined schema key
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate empty BEHAVIOR_LOG_PAYLOAD as valid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SIMULATION_DECISIONS with multiple decision types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould handle passthrough fields in INVESTMENT_PHILOSOPHY
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/common/validation.service.spec.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 27[2mms[22m[39m
[90mstdout[2m | src/common/validation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould return personalized course recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould integrate with user investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould recommend based on learning progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould recommend based on similar user behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould handle new users with minimal data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould return empty array if no suitable recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould limit number of recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould consider user locale for recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould include AI-generated recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould refresh recommendations based on recent activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould handle service errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould include diversity in recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould prioritize high-match scores
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/recommendations/recommendation.controller.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 66[2mms[22m[39m
[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | test/social-ws.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m test/social-ws.integration.spec.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[90m 78[2mms[22m[39m
[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleInit[2m > [22m[2mshould connect to database on module init
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleInit[2m > [22m[2mshould handle connection failure gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleInit[2m > [22m[2mshould not throw error when database is unavailable
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleDestroy[2m > [22m[2mshould disconnect from database on module destroy
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleDestroy[2m > [22m[2mshould handle disconnection errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mtransaction handling[2m > [22m[2mshould support Prisma transactions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mtransaction handling[2m > [22m[2mshould rollback transaction on error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mtransaction handling[2m > [22m[2mshould support sequential operations in transaction
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2merror handling[2m > [22m[2mshould handle unique constraint violation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2merror handling[2m > [22m[2mshould handle foreign key constraint violation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2merror handling[2m > [22m[2mshould handle record not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mconnection lifecycle[2m > [22m[2mshould allow reconnection after disconnect
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mconnection lifecycle[2m > [22m[2mshould be singleton across module
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support findMany queries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support findUnique queries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support create operations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support update operations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support delete operations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/prisma/prisma.service.spec.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 210[2mms[22m[39m
[31m[Nest] 4080  - [39m01/03/2026, 2:18:25 AM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39m[31mFailed to load system settings (Reference Error expected if DB not running)[39m
[31m[Nest] 4080  - [39m01/03/2026, 2:18:25 AM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39mError: Database connection failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\config\dynamic-config.service.spec.ts:98:17
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
[31m[Nest] 4080  - [39m01/03/2026, 2:18:25 AM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39m[31mFailed to load system settings (Reference Error expected if DB not running)[39m
[31m[Nest] 4080  - [39m01/03/2026, 2:18:25 AM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39mError: Database error
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\config\dynamic-config.service.spec.ts:107:17
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2monModuleInit[2m > [22m[2mshould load config on module init in production
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2monModuleInit[2m > [22m[2mshould skip loading config in test environment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2monModuleInit[2m > [22m[2mshould skip loading config when VITEST is set
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould load settings from database
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould cache loaded settings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould handle database errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould log error when database fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould retrieve cached config value
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould return default value when key not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould return empty string when no default provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould handle multiple sequential gets
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mConfig Updates[2m > [22m[2mshould reflect new values after reload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mConfig Updates[2m > [22m[2mshould handle empty settings array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle settings with special characters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle settings with empty values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long setting values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/config/dynamic-config.service.spec.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 83[2mms[22m[39m
[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould adjust learning path after lesson completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould handle lesson completion without score
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould increase difficulty for high-performing users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould decrease difficulty for struggling users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould maintain flow state for optimal performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould recommend break after extended session
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould suggest review for spaced repetition
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould track time efficiency
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould integrate with investment profile risk assessment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould suggest parallel learning paths
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould validate JSONB lesson metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould calculate adaptive difficulty based on success rate
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould provide AI-generated personalized feedback
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/adaptive/adaptive.controller.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 59[2mms[22m[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mFile uploaded: test/file.txt[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould upload file successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould download file successfully
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to download file: missing.txt[39m
[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: File not found: missing.txt
    at UnstorageService.downloadFile [90m(C:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.ts:118:15[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould throw error when downloading non-existent file
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mFile deleted: test/file.txt[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould delete file successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould check file existence
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to check file existence: test.txt[39m
[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Storage error
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.spec.ts:95:51
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould return false when file existence check fails
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mList Operations[2m > [22m[2mshould list files with prefix
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mList Operations[2m > [22m[2mshould list all files when no prefix provided
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to list files with prefix: test/[39m
[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: List error
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.spec.ts:121:51
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mList Operations[2m > [22m[2mshould throw error when listing fails
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPublic URL Generation[2m > [22m[2mshould generate public URL for fs driver
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: gcs[39m
[33m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [33m   WARN[39m [38;5;3m[UnstorageService] [39m[33mGCS driver configured via HTTP (install @google-cloud/storage for native driver)[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPublic URL Generation[2m > [22m[2mshould generate public URL for gcs driver
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: r2[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mR2 Config: Endpoint=https://account.r2.cloudflarestorage.com, Bucket=test-bucket, KeyID=test-...[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mR2 driver configured for CDN assets with S3-compatible client[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPublic URL Generation[2m > [22m[2mshould generate public URL for r2 driver
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[33m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [33m   WARN[39m [38;5;3m[UnstorageService] [39m[33mPresigned URL generation not yet implemented - returning placeholder[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPresigned URLs[2m > [22m[2mshould return presigned upload URL placeholder
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[33m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [33m   WARN[39m [38;5;3m[UnstorageService] [39m[33mPresigned URL generation not yet implemented - returning placeholder[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould initialize streak if it does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould increment streak if last activity was yesterday
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould reward points for 7-day milestone
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould use freeze if streak is broken but freezes are available
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould reset streak if broken and no freezes remaining
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to upload file: test.txt[39m
[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould not update if user already active today
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould update longest streak when current exceeds it
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould unfreeze streak when user becomes active
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould reward for multiple of 7 days (14, 21, etc)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mgetStreak[2m > [22m[2mshould return user streak
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mgetStreak[2m > [22m[2mshould return null if streak does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Upload failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.spec.ts:181:54
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
[90mstdout[2m | src/behavior/streak.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/behavior/streak.service.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 22[2mms[22m[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPresigned URLs[2m > [22m[2mshould use default expiration time
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to download file: test.txt[39m
[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Download failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.spec.ts:189:54
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle upload failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle download failure
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to delete file: test.txt[39m
[31m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Delete failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.spec.ts:195:54
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle delete failure
[22m[39mðŸ§¹ Cleaning up after test...

[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: fs[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mâœ… Storage initialized successfully[39m
[32m[Nest] 3820  - [39m01/03/2026, 2:18:26 AM [32m    LOG[39m [38;5;3m[UnstorageService] [39m[32mInitializing storage with driver: invalid-driver[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mDriver Initialization[2m > [22m[2mshould initialize with fs driver by default
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mDriver Initialization[2m > [22m[2mshould throw error for unsupported driver
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m src/storage/unstorage.service.spec.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 476[2mms[22m[39m
   [33m[2mâœ“[22m[39m UnstorageService[2m > [22mPublic URL Generation[2m > [22mshould generate public URL for r2 driver [33m405[2mms[22m[39m
[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould create VIDEO lesson with localized content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould create READING lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould create QUIZ lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould auto-assign order if not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould set order to 1 for first lesson in course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould respect explicitly provided order
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mupdateLesson[2m > [22m[2mshould update lesson content preserving localization
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mupdateLesson[2m > [22m[2mshould allow reordering lessons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mupdateLesson[2m > [22m[2mshould allow changing lesson type
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mremoveLesson[2m > [22m[2mshould delete lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mlesson ordering[2m > [22m[2mshould maintain sequential order for multiple lessons
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m test/unit/courses/lessons.service.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 20[2mms[22m[39m
[90mstdout[2m | test/unit/courses/lessons.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mChallenge Creation & Invitation[2m > [22m[2mshould create a challenge and post an announcement from the leader
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mChallenge Creation & Invitation[2m > [22m[2mshould fallback to system user if no leader is found for announcement
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mProgress Tracking & Winner Determination[2m > [22m[2mshould reward all members and delete challenge when target is reached
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mProgress Tracking & Winner Determination[2m > [22m[2mshould fail and delete challenge if expired without reaching target
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mProgress Tracking & Winner Determination[2m > [22m[2mshould do nothing if challenge is neither reached nor expired
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mCompetitive P2P Nudges[2m > [22m[2mshould send push notification to trailing user when someone is leading
[22m[39m[Push Notification] to follower: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch leader 50 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 50 points behind leader. Finish one more lesson to overtake!","zh":"ä½ åªè½åŽ leader 50 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mCompetitive P2P Nudges[2m > [22m[2mshould return null if there are fewer than 2 members
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/social/challenges.service.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 23[2mms[22m[39m
[90mstdout[2m | src/modules/social/challenges.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [2m[90mâ†“[39m[22m test/course-progress.integration.spec.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m
[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mlistOptimizations[2m > [22m[2mshould return list of optimizations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mlistOptimizations[2m > [22m[2mshould filter by minimum confidence
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mlistOptimizations[2m > [22m[2mshould limit results correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mfindSimilar[2m > [22m[2mshould find similar optimizations using RAG
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mfindSimilar[2m > [22m[2mshould return error if query is missing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mfindSimilar[2m > [22m[2mshould respect limit parameter
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mgetStats[2m > [22m[2mshould return optimization statistics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mtriggerAudit[2m > [22m[2mshould trigger manual audit successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mtriggerAudit[2m > [22m[2mshould handle audit errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mtriggerAudit[2m > [22m[2mshould return top 10 recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mgetHeuristics[2m > [22m[2mshould return list of heuristic rules
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts[2m > [22m[2mOptimizationController[2m > [22m[2mgetHeuristics[2m > [22m[2mshould format heuristic rules correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/database/optimization.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/database/optimization.controller.spec.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 103[2mms[22m[39m
[90mstdout[2m | test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mPipeline: Actions -> BehaviorLog -> Daily Report -> Export CSV[2m > [22m[2mshould complete the full analytics pipeline
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mConversion Funnel: Register -> First Simulation[2m > [22m[2mshould calculate funnel conversion rates correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mReal-time Metrics: Prometheus/WS Updates[2m > [22m[2mshould update Prometheus gauges and emit via WebSocket
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mSegment-based Filtering[2m > [22m[2mshould filter users by behavior segment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/analytics-reporting.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/analytics-reporting.integration.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 50[2mms[22m[39m
[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetCommunityImpact[2m > [22m[2mshould calculate total community impact correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetCommunityImpact[2m > [22m[2mshould return 0 impact points if aggregate returns null
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetUsersOnline[2m > [22m[2mshould aggregate users online based on recent behavior logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetRecentGlobalAchievements[2m > [22m[2mshould fetch recent global achievements
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mtriggerRealtimeUpdate[2m > [22m[2mshould fetch all stats and emit to gateway
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mHigh-concurrency data updates (Mock)[2m > [22m[2mshould handle multiple simultaneous update requests
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/social/community-stats.service.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 51[2mms[22m[39m
[90mstdout[2m | src/modules/social/community-stats.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mshould log an event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mshould fetch user behaviors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mEvent aggregation by session[2m > [22m[2mshould log events with same session ID
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mJSONB payload handling[2m > [22m[2mshould store complex nested JSONB payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mJSONB payload handling[2m > [22m[2mshould handle JSONB deviceInfo
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mHigh-volume event streams[2m > [22m[2mshould handle 100+ events without error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mHigh-volume event streams[2m > [22m[2mshould handle rapid sequential logging
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mPrivacy filtering[2m > [22m[2mshould allow undefined userId for anonymous tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mPrivacy filtering[2m > [22m[2mshould set default actionCategory to GENERAL if not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mPrivacy filtering[2m > [22m[2mshould set default duration to 0 if not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/behavior/behavior.service.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 43[2mms[22m[39m
[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould send push notification via SocialService
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould broadcast notification via WebSocket
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould handle notification with empty body
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould handle notification errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould send notifications to multiple users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mWebSocket broadcast validation[2m > [22m[2mshould validate WebSocket room targeting
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mWebSocket broadcast validation[2m > [22m[2mshould handle WebSocket disconnection gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mWebSocket broadcast validation[2m > [22m[2mshould broadcast to group via gateway
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mgetNotifications[2m > [22m[2mshould return empty array for user with no notifications
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mgetNotifications[2m > [22m[2mshould handle invalid userId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mmarkAsRead[2m > [22m[2mshould mark notification as read
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mmarkAsRead[2m > [22m[2mshould handle invalid notification ID
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in notification content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long notification bodies
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle concurrent notifications
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/notification.controller.spec.ts [2m([22m[2m16 tests[22m[2m)[22m[90m 31[2mms[22m[39m
[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mVirtual Portfolio[2m > [22m[2mshould create portfolio if not exists
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mVirtual Portfolio[2m > [22m[2mshould process trade BUY correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mVirtual Portfolio[2m > [22m[2mshould throw error for insufficient balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mBudget Decision[2m > [22m[2mshould provide feedback for 50/30/20 rule
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mBudget Decision[2m > [22m[2mshould warn for high wants
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mStress Test[2m > [22m[2mshould calculate survival months and emit nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mCommitment Devices[2m > [22m[2mshould create a commitment and lock funds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mCommitment Devices[2m > [22m[2mshould penalize early withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mCommitment Devices[2m > [22m[2mshould return full amount for on-time withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mLong Term Impact[2m > [22m[2mshould calculate future value and emit nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/simulation/simulation.service.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 42[2mms[22m[39m
[32m[Nest] 4508  - [39m01/03/2026, 2:18:38 AM [32m    LOG[39m [38;5;3m[HTTP] [39m[32mGET /api/test 200 1234B - Mozilla/5.0 127.0.0.1 +0ms[39m
[32m[Nest] 4508  - [39m01/03/2026, 2:18:38 AM [32m    LOG[39m [38;5;3m[HTTP] [39m[32mGET /api/test 200 1234B - Mozilla/5.0 127.0.0.1 +0ms[39m
[32m[Nest] 4508  - [39m01/03/2026, 2:18:38 AM [32m    LOG[39m [38;5;3m[HTTP] [39m[32mGET /api/test 200 1234B - Mozilla/5.0 127.0.0.1 +0ms[39m
[32m[Nest] 4508  - [39m01/03/2026, 2:18:38 AM [32m    LOG[39m [38;5;3m[HTTP] [39m[32mGET /api/test 200 1234B - Mozilla/5.0 127.0.0.1 +0ms[39m
[32m[Nest] 4508  - [39m01/03/2026, 2:18:38 AM [32m    LOG[39m [38;5;3m[HTTP] [39m[32mGET /api/test 200 1234B - Mozilla/5.0 127.0.0.1 +0ms[39m
[32m[Nest] 4508  - [39m01/03/2026, 2:18:38 AM [32m    LOG[39m [38;5;3m[HTTP] [39m[32mGET /api/test 200 1234B -  127.0.0.1 +0ms[39m
[32m[Nest] 4508  - [39m01/03/2026, 2:18:38 AM [32m    LOG[39m [38;5;3m[HTTP] [39m[32mGET /api/test 200 1234B - Mozilla/5.0 127.0.0.1 +0ms[39m
[32m[Nest] 4508  - [39m01/03/2026, 2:18:38 AM [32m    LOG[39m [38;5;3m[HTTP] [39m[32mGET /api/test 404 1234B - Mozilla/5.0 127.0.0.1 +0ms[39m
[32m[Nest] 4508  - [39m01/03/2026, 2:18:38 AM [32m    LOG[39m [38;5;3m[HTTP] [39m[32mGET /api/test 500 1234B - Mozilla/5.0 127.0.0.1 +0ms[39m
[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould call next function
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould register finish event listener
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log request method and URL
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log status code
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log response time in milliseconds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log user agent
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log IP address
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould handle missing user agent
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log content length
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould handle 404 status codes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould handle 500 status codes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/common/logger-middleware.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 20[2mms[22m[39m
[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage persistence[2m > [22m[2mshould save a message and update thread timestamp
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mchat history retrieval[2m > [22m[2mshould retrieve messages for a thread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mchat history retrieval[2m > [22m[2mshould return empty list if no messages found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mgroup chat creation[2m > [22m[2mshould create a new group with the creator as leader
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask emails in content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask names and addresses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask content before saving
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask content when retrieving history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mthread management[2m > [22m[2mshould create a thread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mthread management[2m > [22m[2mshould get user threads
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/chat.service.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 58[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/analytics.repository.spec.ts[2m > [22m[2mAnalyticsRepository[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.repository.spec.ts[2m > [22m[2mAnalyticsRepository[2m > [22m[2mgetDailyActiveUsers[2m > [22m[2mshould return DAU results with default 30 days
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.repository.spec.ts[2m > [22m[2mAnalyticsRepository[2m > [22m[2mgetDailyActiveUsers[2m > [22m[2mshould accept custom days parameter
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.repository.spec.ts[2m > [22m[2mAnalyticsRepository[2m > [22m[2mgetMonthlyActiveUsers[2m > [22m[2mshould return MAU results
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.repository.spec.ts[2m > [22m[2mAnalyticsRepository[2m > [22m[2mgetLearningFunnel[2m > [22m[2mshould return funnel stages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.repository.spec.ts[2m > [22m[2mAnalyticsRepository[2m > [22m[2mgetLearningFunnel[2m > [22m[2mshould calculate correct percentages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.repository.spec.ts[2m > [22m[2mAnalyticsRepository[2m > [22m[2mgetLeaderboard[2m > [22m[2mshould return leaderboard entries with default limit
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.repository.spec.ts[2m > [22m[2mAnalyticsRepository[2m > [22m[2mgetEngagementMetrics[2m > [22m[2mshould return engagement metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.repository.spec.ts[2m > [22m[2mAnalyticsRepository[2m > [22m[2mgetStudentBehaviorPattern[2m > [22m[2mshould return behavior pattern for a user
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/analytics/analytics.repository.spec.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 59[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/analytics.repository.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return Vietnamese translation by default
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return English translation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return Chinese translation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould replace parameters correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return the key if translation is not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould replace multiple parameters in all locales
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould handle complex parameter replacement
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould fallback to Vietnamese when locale not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould handle nested key lookups
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return key if intermediate path is invalid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould handle empty parameters object
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould convert non-string parameter values to strings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return field for specific locale
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould fallback to vi if locale not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return empty string if field is null
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould extract Vietnamese field from JSONB
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould extract Chinese field from JSONB
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould fallback to en if vi is missing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould handle plain string as-is
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return empty string if field is undefined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return empty string if field is empty object
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould prioritize requested locale over fallbacks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/common/i18n.service.spec.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 19[2mms[22m[39m
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-FCE2853929] POST /test-endpoint 400 - {"errorId":"ERR-FCE2853929","statusCode":400,"timestamp":"2026-01-02T19:18:43.110Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:39:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-1DFDA8F99E] POST /test-endpoint 500 - {"errorId":"ERR-1DFDA8F99E","statusCode":500,"timestamp":"2026-01-02T19:18:43.118Z","path":"/test-endpoint","message":"Internal server error","suggestion":"Please contact support with Error ID"}[39m
Error: Unexpected error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:49:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-DB80029E9A] POST /test-endpoint 404 - {"errorId":"ERR-DB80029E9A","statusCode":404,"timestamp":"2026-01-02T19:18:43.124Z","path":"/test-endpoint","message":"Not found","suggestion":"Please contact support with Error ID"}[39m
HttpException: Not found
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:57:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-001AE74D56] POST /test-endpoint 400 - {"errorId":"ERR-001AE74D56","statusCode":400,"timestamp":"2026-01-02T19:18:43.125Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:65:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-A57EC2DCC2] POST /test-endpoint 400 - {"errorId":"ERR-A57EC2DCC2","statusCode":400,"timestamp":"2026-01-02T19:18:43.127Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:75:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-9348EB4811] POST /test-endpoint 401 - {"errorId":"ERR-9348EB4811","statusCode":401,"timestamp":"2026-01-02T19:18:43.128Z","path":"/test-endpoint","message":"Unauthorized","suggestion":"Please login again"}[39m
HttpException: Unauthorized
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:84:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-C70BE37DB0] POST /test-endpoint 500 - {"errorId":"ERR-C70BE37DB0","statusCode":500,"timestamp":"2026-01-02T19:18:43.129Z","path":"/test-endpoint","message":"Server error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Server error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:93:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-C5B24FEA22] POST /test-endpoint 400 - {"errorId":"ERR-C5B24FEA22","statusCode":400,"timestamp":"2026-01-02T19:18:43.131Z","path":"/test-endpoint","message":"Validation failed","suggestion":"Please contact support with Error ID"}[39m
HttpException: Validation failed
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:102:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-0280DEE73B] POST /test-endpoint 500 - {"errorId":"ERR-0280DEE73B","statusCode":500,"timestamp":"2026-01-02T19:18:43.133Z","path":"/test-endpoint","message":"Server error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Server error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:115:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-1EB0608358] POST /test-endpoint 400 - {"errorId":"ERR-1EB0608358","statusCode":400,"timestamp":"2026-01-02T19:18:43.135Z","path":"/test-endpoint","message":"Simple error message","suggestion":"Please contact support with Error ID"}[39m
HttpException: Simple error message
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:127:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-6F7568A841] POST /test-endpoint 400 - {"errorId":"ERR-6F7568A841","statusCode":400,"timestamp":"2026-01-02T19:18:43.136Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-F3B4317D40] POST /test-endpoint 400 - {"errorId":"ERR-F3B4317D40","statusCode":400,"timestamp":"2026-01-02T19:18:43.137Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-682E094C9A] POST /test-endpoint 400 - {"errorId":"ERR-682E094C9A","statusCode":400,"timestamp":"2026-01-02T19:18:43.137Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-F06571C674] POST /test-endpoint 400 - {"errorId":"ERR-F06571C674","statusCode":400,"timestamp":"2026-01-02T19:18:43.140Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-9FB701D060] POST /test-endpoint 400 - {"errorId":"ERR-9FB701D060","statusCode":400,"timestamp":"2026-01-02T19:18:43.140Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-E2E29538FF] POST /test-endpoint 400 - {"errorId":"ERR-E2E29538FF","statusCode":400,"timestamp":"2026-01-02T19:18:43.141Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-9244B68578] POST /test-endpoint 400 - {"errorId":"ERR-9244B68578","statusCode":400,"timestamp":"2026-01-02T19:18:43.141Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-6361375C55] POST /test-endpoint 400 - {"errorId":"ERR-6361375C55","statusCode":400,"timestamp":"2026-01-02T19:18:43.142Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-43DD66A90B] POST /test-endpoint 400 - {"errorId":"ERR-43DD66A90B","statusCode":400,"timestamp":"2026-01-02T19:18:43.142Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 14912  - [39m01/03/2026, 2:18:43 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-0F9DD26DFA] POST /test-endpoint 400 - {"errorId":"ERR-0F9DD26DFA","statusCode":400,"timestamp":"2026-01-02T19:18:43.142Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould generate unique ErrorId for each exception
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould return 500 for non-HTTP exceptions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould return correct status for HttpException
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould include timestamp in error response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould include request path in error response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould provide login suggestion for 401 errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould provide contact support suggestion for other errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould handle complex HttpException message objects
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould log errors with stack trace for 400+ status codes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould handle string message from HttpException
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mErrorId Generation[2m > [22m[2mshould generate unique ErrorIds for concurrent exceptions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/common/filters/all-exceptions.filter.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 42[2mms[22m[39m
[90mstdout[2m | src/modules/ai/vanna.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/modules/ai/vanna.service.spec.ts[2m > [22m[2mVannaService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 2592  - [39m01/03/2026, 2:18:44 AM [31m  ERROR[39m [38;5;3m[VannaService] [39m[31mVanna API error: getaddrinfo ENOTFOUND api.vanna.test[39m
Error: getaddrinfo ENOTFOUND api.vanna.test
    at AxiosError.from (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/AxiosError.js:96:14)
    at RedirectableRequest.handleRequestError (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/adapters/http.js:817:25)
    at RedirectableRequest.emit (node:events:520:35)
    at ClientRequest.eventHandlers.<computed> (C:\Users\luaho\Demo project\v-edfinance\node_modules\.pnpm\follow-redirects@1.15.11\node_modules\follow-redirects\index.js:49:24)
    at ClientRequest.emit (node:events:508:28)
    at emitErrorEvent (node:_http_client:108:11)
    at TLSSocket.socketErrorListener (node:_http_client:575:5)
    at TLSSocket.emit (node:events:508:28)
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at Axios.request (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/Axios.js:45:41)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at VannaService.generateSQL (C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.ts:78:24)
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.spec.ts:40:22
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[90mstdout[2m | src/modules/ai/vanna.service.spec.ts[2m > [22m[2mVannaService[2m > [22m[2mgenerateSQL[2m > [22m[2mshould return mock SQL when API fails
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 2592  - [39m01/03/2026, 2:18:44 AM [31m  ERROR[39m [38;5;3m[VannaService] [39m[31mVanna API error: getaddrinfo ENOTFOUND api.vanna.test[39m
Error: getaddrinfo ENOTFOUND api.vanna.test
    at AxiosError.from (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/AxiosError.js:96:14)
    at RedirectableRequest.handleRequestError (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/adapters/http.js:817:25)
    at RedirectableRequest.emit (node:events:520:35)
    at ClientRequest.eventHandlers.<computed> (C:\Users\luaho\Demo project\v-edfinance\node_modules\.pnpm\follow-redirects@1.15.11\node_modules\follow-redirects\index.js:49:24)
    at ClientRequest.emit (node:events:508:28)
    at emitErrorEvent (node:_http_client:108:11)
    at TLSSocket.socketErrorListener (node:_http_client:575:5)
    at TLSSocket.emit (node:events:508:28)
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at Axios.request (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/Axios.js:45:41)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at VannaService.generateSQL (C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.ts:78:24)
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.spec.ts:54:24
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 2592  - [39m01/03/2026, 2:18:44 AM [31m  ERROR[39m [38;5;3m[VannaService] [39m[31mVanna API error: getaddrinfo ENOTFOUND api.vanna.test[39m
Error: getaddrinfo ENOTFOUND api.vanna.test
    at AxiosError.from (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/AxiosError.js:96:14)
    at RedirectableRequest.handleRequestError (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/adapters/http.js:817:25)
    at RedirectableRequest.emit (node:events:520:35)
    at ClientRequest.eventHandlers.<computed> (C:\Users\luaho\Demo project\v-edfinance\node_modules\.pnpm\follow-redirects@1.15.11\node_modules\follow-redirects\index.js:49:24)
    at ClientRequest.emit (node:events:508:28)
    at emitErrorEvent (node:_http_client:108:11)
    at TLSSocket.socketErrorListener (node:_http_client:575:5)
    at TLSSocket.emit (node:events:508:28)
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at Axios.request (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/Axios.js:45:41)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at VannaService.generateSQL (C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.ts:78:24)
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.spec.ts:54:24
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 2592  - [39m01/03/2026, 2:18:44 AM [31m  ERROR[39m [38;5;3m[VannaService] [39m[31mVanna API error: getaddrinfo ENOTFOUND api.vanna.test[39m
Error: getaddrinfo ENOTFOUND api.vanna.test
    at AxiosError.from (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/AxiosError.js:96:14)
    at RedirectableRequest.handleRequestError (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/adapters/http.js:817:25)
    at RedirectableRequest.emit (node:events:520:35)
    at ClientRequest.eventHandlers.<computed> (C:\Users\luaho\Demo project\v-edfinance\node_modules\.pnpm\follow-redirects@1.15.11\node_modules\follow-redirects\index.js:49:24)
    at ClientRequest.emit (node:events:508:28)
    at emitErrorEvent (node:_http_client:108:11)
    at TLSSocket.socketErrorListener (node:_http_client:575:5)
    at TLSSocket.emit (node:events:508:28)
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at Axios.request (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/Axios.js:45:41)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at VannaService.generateSQL (C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.ts:78:24)
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.spec.ts:54:24
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[90mstdout[2m | src/modules/ai/vanna.service.spec.ts[2m > [22m[2mVannaService[2m > [22m[2mgenerateSQL[2m > [22m[2mshould handle multi-language queries
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 2592  - [39m01/03/2026, 2:18:44 AM [31m  ERROR[39m [38;5;3m[VannaService] [39m[31mVanna API error: getaddrinfo ENOTFOUND api.vanna.test[39m
Error: getaddrinfo ENOTFOUND api.vanna.test
    at AxiosError.from (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/AxiosError.js:96:14)
    at RedirectableRequest.handleRequestError (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/adapters/http.js:817:25)
    at RedirectableRequest.emit (node:events:520:35)
    at ClientRequest.eventHandlers.<computed> (C:\Users\luaho\Demo project\v-edfinance\node_modules\.pnpm\follow-redirects@1.15.11\node_modules\follow-redirects\index.js:49:24)
    at ClientRequest.emit (node:events:508:28)
    at emitErrorEvent (node:_http_client:108:11)
    at TLSSocket.socketErrorListener (node:_http_client:575:5)
    at TLSSocket.emit (node:events:508:28)
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at Axios.request (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/Axios.js:45:41)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at VannaService.generateSQL (C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.ts:78:24)
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.spec.ts:65:22
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[90mstdout[2m | src/modules/ai/vanna.service.spec.ts[2m > [22m[2mVannaService[2m > [22m[2mgenerateSQL[2m > [22m[2mshould include embedding in result
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 2592  - [39m01/03/2026, 2:18:44 AM [31m  ERROR[39m [38;5;3m[VannaService] [39m[31mTraining failed: getaddrinfo ENOTFOUND api.vanna.test[39m
Error: getaddrinfo ENOTFOUND api.vanna.test
    at AxiosError.from (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/AxiosError.js:96:14)
    at RedirectableRequest.handleRequestError (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/adapters/http.js:817:25)
    at RedirectableRequest.emit (node:events:520:35)
    at ClientRequest.eventHandlers.<computed> (C:\Users\luaho\Demo project\v-edfinance\node_modules\.pnpm\follow-redirects@1.15.11\node_modules\follow-redirects\index.js:49:24)
    at ClientRequest.emit (node:events:508:28)
    at emitErrorEvent (node:_http_client:108:11)
    at TLSSocket.socketErrorListener (node:_http_client:575:5)
    at TLSSocket.emit (node:events:508:28)
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at Axios.request (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/Axios.js:45:41)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at VannaService.trainModel (C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.ts:112:7)
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.spec.ts:79:7
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[90mstdout[2m | src/modules/ai/vanna.service.spec.ts[2m > [22m[2mVannaService[2m > [22m[2mtrainModel[2m > [22m[2mshould accept training data without errors
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 2592  - [39m01/03/2026, 2:18:44 AM [31m  ERROR[39m [38;5;3m[VannaService] [39m[31mTraining failed: getaddrinfo ENOTFOUND api.vanna.test[39m
Error: getaddrinfo ENOTFOUND api.vanna.test
    at AxiosError.from (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/AxiosError.js:96:14)
    at RedirectableRequest.handleRequestError (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/adapters/http.js:817:25)
    at RedirectableRequest.emit (node:events:520:35)
    at ClientRequest.eventHandlers.<computed> (C:\Users\luaho\Demo project\v-edfinance\node_modules\.pnpm\follow-redirects@1.15.11\node_modules\follow-redirects\index.js:49:24)
    at ClientRequest.emit (node:events:508:28)
    at emitErrorEvent (node:_http_client:108:11)
    at TLSSocket.socketErrorListener (node:_http_client:575:5)
    at TLSSocket.emit (node:events:508:28)
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at Axios.request (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/Axios.js:45:41)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at VannaService.trainModel (C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.ts:112:7)
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.spec.ts:96:9
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 2592  - [39m01/03/2026, 2:18:44 AM [31m  ERROR[39m [38;5;3m[VannaService] [39m[31mTraining failed: getaddrinfo ENOTFOUND api.vanna.test[39m
Error: getaddrinfo ENOTFOUND api.vanna.test
    at AxiosError.from (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/AxiosError.js:96:14)
    at RedirectableRequest.handleRequestError (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/adapters/http.js:817:25)
    at RedirectableRequest.emit (node:events:520:35)
    at ClientRequest.eventHandlers.<computed> (C:\Users\luaho\Demo project\v-edfinance\node_modules\.pnpm\follow-redirects@1.15.11\node_modules\follow-redirects\index.js:49:24)
    at ClientRequest.emit (node:events:508:28)
    at emitErrorEvent (node:_http_client:108:11)
    at TLSSocket.socketErrorListener (node:_http_client:575:5)
    at TLSSocket.emit (node:events:508:28)
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at Axios.request (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/Axios.js:45:41)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at VannaService.trainModel (C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.ts:112:7)
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.spec.ts:96:9
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 2592  - [39m01/03/2026, 2:18:44 AM [31m  ERROR[39m [38;5;3m[VannaService] [39m[31mTraining failed: getaddrinfo ENOTFOUND api.vanna.test[39m
Error: getaddrinfo ENOTFOUND api.vanna.test
    at AxiosError.from (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/AxiosError.js:96:14)
    at RedirectableRequest.handleRequestError (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/adapters/http.js:817:25)
    at RedirectableRequest.emit (node:events:520:35)
    at ClientRequest.eventHandlers.<computed> (C:\Users\luaho\Demo project\v-edfinance\node_modules\.pnpm\follow-redirects@1.15.11\node_modules\follow-redirects\index.js:49:24)
    at ClientRequest.emit (node:events:508:28)
    at emitErrorEvent (node:_http_client:108:11)
    at TLSSocket.socketErrorListener (node:_http_client:575:5)
    at TLSSocket.emit (node:events:508:28)
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at Axios.request (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/Axios.js:45:41)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at VannaService.trainModel (C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.ts:112:7)
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.spec.ts:96:9
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[90mstdout[2m | src/modules/ai/vanna.service.spec.ts[2m > [22m[2mVannaService[2m > [22m[2mtrainModel[2m > [22m[2mshould handle training with different languages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/vanna.service.spec.ts[2m > [22m[2mVannaService[2m > [22m[2mhealthCheck[2m > [22m[2mshould return false in test environment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/vanna.service.spec.ts[2m > [22m[2mVannaService[2m > [22m[2mconfiguration[2m > [22m[2mshould log warning when VANNA_API_KEY is missing
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 2592  - [39m01/03/2026, 2:18:44 AM [31m  ERROR[39m [38;5;3m[VannaService] [39m[31mVanna API error: getaddrinfo ENOTFOUND api.vanna.test[39m
Error: getaddrinfo ENOTFOUND api.vanna.test
    at AxiosError.from (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/AxiosError.js:96:14)
    at RedirectableRequest.handleRequestError (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/adapters/http.js:817:25)
    at RedirectableRequest.emit (node:events:520:35)
    at ClientRequest.eventHandlers.<computed> (C:\Users\luaho\Demo project\v-edfinance\node_modules\.pnpm\follow-redirects@1.15.11\node_modules\follow-redirects\index.js:49:24)
    at ClientRequest.emit (node:events:508:28)
    at emitErrorEvent (node:_http_client:108:11)
    at TLSSocket.socketErrorListener (node:_http_client:575:5)
    at TLSSocket.emit (node:events:508:28)
    at emitErrorNT (node:internal/streams/destroy:170:8)
    at emitErrorCloseNT (node:internal/streams/destroy:129:3)
    at Axios.request (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/axios@1.13.2/node_modules/axios/lib/core/Axios.js:45:41)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at VannaService.generateSQL (C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.ts:78:24)
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\ai\vanna.service.spec.ts:158:22
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[90mstdout[2m | src/modules/ai/vanna.service.spec.ts[2m > [22m[2mVannaService[2m > [22m[2mvector caching[2m > [22m[2mshould skip cache when disabled
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/vanna.service.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m src/modules/ai/vanna.service.spec.ts [2m([22m[2m9 tests[22m[2m)[22m[33m 320[2mms[22m[39m
[32m[Nest] 14856  - [39m01/03/2026, 2:18:47 AM [32m    LOG[39m [38;5;3m[AiService] [39m[32mCache hit (FAQ) for prompt: What is RSI?...[39m
[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mcheckUserAIUsage[2m > [22m[2mshould throw ForbiddenException if rate limit is exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mcheckUserAIUsage[2m > [22m[2mshould throw ForbiddenException if monthly budget is exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mcheckUserAIUsage[2m > [22m[2mshould return total tokens used if within limits
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mmaskPII[2m > [22m[2mshould mask email and sensitive fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mgenerateResponse[2m > [22m[2mshould return cached response for FAQ if available
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mgenerateResponse[2m > [22m[2mshould generate new response and cache it for FAQ
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mparseActionCards[2m > [22m[2mshould extract action card metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/unit/ai/ai.service.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 39[2mms[22m[39m
 [2m[90mâ†“[39m[22m test/auth-profile.integration.spec.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m
[90mstdout[2m | test/auth-profile.integration.spec.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould validate and transform valid DTO
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould reject invalid email format
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould reject password shorter than 6 characters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould strip non-whitelisted properties
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mJSONB Schema Validation Integration[2m > [22m[2mshould validate JSONB structure with I18n format
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mJSONB Schema Validation Integration[2m > [22m[2mshould reject malformed JSONB structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mCustom Validators[2m > [22m[2mshould validate nested objects
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mCustom Validators[2m > [22m[2mshould handle array validation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle null values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle undefined values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty strings
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/common/validation-pipe.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 132[2mms[22m[39m
[90mstdout[2m | src/common/validation-pipe.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mFeed Generation & Pagination[2m > [22m[2mshould fetch feed with pagination (limit and offset)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mFeed Generation & Pagination[2m > [22m[2mshould include friends activities in the feed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mLike & Comment Functionality[2m > [22m[2mshould increment likesCount when liking a post
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mLike & Comment Functionality[2m > [22m[2mshould create a behavior log when commenting on a post
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mMulti-user Activity Mocking[2m > [22m[2mshould handle feed from multiple users across different groups
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/activity-feed.service.spec.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 21[2mms[22m[39m
[31m[Nest] 1520  - [39m01/03/2026, 2:18:52 AM [31m  ERROR[39m [38;5;3m[StorageService] [39m[31mError uploading to R2[39m
[31m[Nest] 1520  - [39m01/03/2026, 2:18:52 AM [31m  ERROR[39m [38;5;3m[StorageService] [39mError: Upload failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\storage.service.spec.ts:66:53
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
[90mstdout[2m | src/storage/storage.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2muploadFile[2m > [22m[2mshould upload file successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2muploadFile[2m > [22m[2mshould throw error if upload fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mgetPresignedUrl[2m > [22m[2mshould generate a GET presigned URL
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mgetPresignedUrl[2m > [22m[2mshould generate a PUT presigned URL
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mgetSignedUrl[2m > [22m[2mshould return a presigned GET URL
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 1520  - [39m01/03/2026, 2:18:52 AM [31m  ERROR[39m [38;5;3m[StorageService] [39m[31mError generating presigned GET URL[39m
[31m[Nest] 1520  - [39m01/03/2026, 2:18:52 AM [31m  ERROR[39m [38;5;3m[StorageService] [39mError: Presigner error
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\storage.service.spec.ts:97:59
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3)
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/vitest@2.1.9_@types+node@25.0.3_@vitest+ui@2.1.9_lightningcss@1.30.2_msw@2.12.4_@types+node@2_ebmugipt3toifped36nskz2rti/node_modules/[4mvitest[24m/dist/chunks/runBaseTests.3qpJUEJM.js:126:11
[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle presigned URL generation failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mError Handling[2m > [22m[2mshould use custom expiration time for presigned URLs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mConfiguration Fallback[2m > [22m[2mshould fall back to environment variables if ConfigService unavailable
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m src/storage/storage.service.spec.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 136[2mms[22m[39m
[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleConnection[2m > [22m[2mshould emit connection_established event
[22m[39mClient connected: socket-id
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleDisconnect[2m > [22m[2mshould clean up connectedClients and emit user_offline if client was identified
[22m[39mClient disconnected: socket-id
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleDisconnect[2m > [22m[2mshould do nothing if client was not identified
[22m[39mClient disconnected: socket-id
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleIdentify[2m > [22m[2mshould map userId to socketId and join user room
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleIdentify[2m > [22m[2mshould force disconnect previous connection if same userId connects again
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleJoinGroup[2m > [22m[2mshould join group room
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mBroadcasting methods[2m > [22m[2msendToUser should emit to user room
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mBroadcasting methods[2m > [22m[2mbroadcastToGroup should emit to group room
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mBroadcasting methods[2m > [22m[2mbroadcastNewPost should emit to all
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/social.gateway.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 143[2mms[22m[39m
[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when no roles required
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has required role (STUDENT)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has required role (TEACHER)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has required role (ADMIN)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has one of multiple required roles
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould deny access when user lacks required role
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould deny access when user has no role
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould handle multiple required roles (deny if none match)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould extract roles from handler and class metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/auth/roles.guard.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 76[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mshould return null for unknown context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mINVESTMENT_DECISION[2m > [22m[2mshould return SOCIAL_PROOF nudge for HUNTER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mINVESTMENT_DECISION[2m > [22m[2mshould return LOSS_AVERSION nudge for high risk level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mBUDGETING[2m > [22m[2mshould return GOAL_GRADIENT for SAVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mBUDGETING[2m > [22m[2mshould return SALIENCE nudge showing equivalent coffee cups
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mSTREAK_WARNING[2m > [22m[2mshould return GOAL_GRADIENT for streak warning
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle missing user profile gracefully
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/nudge/nudge-engine.service.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[90m 16[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mshould extend AuthGuard with jwt strategy
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould call super.canActivate
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject missing authorization header
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject malformed authorization header
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject expired JWT token
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject invalid JWT signature
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mhandleRequest[2m > [22m[2mshould throw UnauthorizedException on error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mhandleRequest[2m > [22m[2mshould throw UnauthorizedException when user is null
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mhandleRequest[2m > [22m[2mshould return user when authentication succeeds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/auth/jwt-auth.guard.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 22[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/mentor.service.spec.ts[2m > [22m[2mMentorService (Phase 7 Integration Test)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/mentor.service.spec.ts[2m > [22m[2mMentorService (Phase 7 Integration Test)[2m > [22m[2mshould select STRICT_COACH persona for a HUNTER user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/mentor.service.spec.ts[2m > [22m[2mMentorService (Phase 7 Integration Test)[2m > [22m[2mshould trigger variable reward logic (random chance)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/mentor.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/mentor.service.spec.ts [2m([22m[2m3 tests[22m[2m)[22m[90m 36[2mms[22m[39m
[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mFriend Requests[2m > [22m[2mshould send a friend request
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mFriend Requests[2m > [22m[2mshould accept a friend request
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mFriend Requests[2m > [22m[2mshould reject a friend request
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mBlocking[2m > [22m[2mshould block a user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mBlocking[2m > [22m[2mshould unblock a user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mActivity Feed[2m > [22m[2mshould get friend activity feed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/friends.service.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 22[2mms[22m[39m
[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetTopUsers[2m > [22m[2mshould return top users with formatted names
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetGlobalRanking[2m > [22m[2mshould return correct rank and percentile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetGlobalRanking[2m > [22m[2mshould throw error if user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetPeriodicLeaderboard[2m > [22m[2mshould aggregate scores for daily period
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetPeriodicLeaderboard[2m > [22m[2mshould work for weekly period
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetPeriodicLeaderboard[2m > [22m[2mshould work for monthly period
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/leaderboard/leaderboard.service.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 19[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould calculate HIGH churn risk when activity gap is large
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould calculate LOW churn risk when activity gap is small
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould return LOW risk if not enough logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould include persona context in financial simulation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/predictive.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/predictive.service.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 31[2mms[22m[39m
[90mstdout[2m | src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mgenerateAchievementShareLink[2m > [22m[2mshould generate a base64 encoded share link and track the event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mgetSocialMetaTags[2m > [22m[2mshould generate localized meta tags for an achievement
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mgetSocialMetaTags[2m > [22m[2mshould return default tags if achievement is not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mtrackViralLoop[2m > [22m[2mshould log a visit event for the viral loop
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/social/sharing.service.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 77[2mms[22m[39m
[90mstdout[2m | src/modules/social/sharing.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculatePoints[2m > [22m[2mshould calculate base points with no streak
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculatePoints[2m > [22m[2mshould apply streak bonus correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculatePoints[2m > [22m[2mshould return 0 for unknown actions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mprocessStreak[2m > [22m[2mshould increment streak if last active was yesterday
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mprocessStreak[2m > [22m[2mshould maintain streak if active today
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mprocessStreak[2m > [22m[2mshould reset streak if last active was before yesterday
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould start at level 1
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould reach level 2 at 100 points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould reach level 3 at 400 points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould handle negative points gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcheckBadges[2m > [22m[2mshould return BRONZE_LEARNER when crossing 100 points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcheckBadges[2m > [22m[2mshould not return badge if already earned
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcheckBadges[2m > [22m[2mshould return multiple badges if crossing multiple thresholds
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/common/gamification-pure.spec.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 19[2mms[22m[39m
[90mstdout[2m | src/common/gamification-pure.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/analytics/simulation-bot.spec.ts[2m > [22m[2mBehavioral Simulation (Plan 2)[2m > [22m[2mSimulation: RUSH_USER should trigger STRICT_COACH persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/simulation-bot.spec.ts[2m > [22m[2mBehavioral Simulation (Plan 2)[2m > [22m[2mSimulation: LAZY_USER should trigger SUPPORTIVE_BUDDY persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/simulation-bot.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/simulation-bot.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 10[2mms[22m[39m
[32m[Nest] 18160  - [39m01/03/2026, 2:19:05 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mRunning system health hub check...[39m
[32m[Nest] 18160  - [39m01/03/2026, 2:19:05 AM [32m    LOG[39m [38;5;3m[AnalyticsService] [39m[32mRunning system health hub check...[39m
[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleSystemHealthCheck[2m > [22m[2mshould run health check and log results
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleSystemHealthCheck[2m > [22m[2mshould handle DB failure gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetGlobalSystemStats[2m > [22m[2mshould return global stats
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould return OBSERVER for no logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould classify as HUNTER if high risk events predominate
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/unit/analytics/analytics.service.spec.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 20[2mms[22m[39m
[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould extract user from JWT payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould handle payload with different role
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould map sub to both id and userId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould preserve email from payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mconstructor[2m > [22m[2mshould use JWT_SECRET from ConfigService
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mconstructor[2m > [22m[2mshould fallback to dev_secret if ConfigService fails
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/auth/jwt.strategy.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 50[2mms[22m[39m
[90mstdout[2m | src/auth/jwt.strategy.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mbuyStreakFreeze[2m > [22m[2mshould successfully buy a streak freeze
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mbuyStreakFreeze[2m > [22m[2mshould throw BadRequestException if user has insufficient points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mbuyStreakFreeze[2m > [22m[2mshould throw BadRequestException if user does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mgetStoreItems[2m > [22m[2mshould return list of store items
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/store/store.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/store/store.service.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 18[2mms[22m[39m
[32m[Nest] 3024  - [39m01/03/2026, 2:19:07 AM [32m    LOG[39m [38;5;3m[DiagnosticService] [39m[32m--- STARTING FULL SYSTEM DIAGNOSTICS & METRICS COLLECTION ---[39m
[32m[Nest] 3024  - [39m01/03/2026, 2:19:07 AM [32m    LOG[39m [38;5;3m[DiagnosticService] [39m[32mGenerating 1 mock events for user: test-id[39m
[32m[Nest] 3024  - [39m01/03/2026, 2:19:07 AM [32m    LOG[39m [38;5;3m[DiagnosticService] [39m[32mDiagnostics Result: {"database":{"status":"OK","latency":"low"},"aiModel":{"status":"OK","model":"gemini-2.0-flash"},"websockets":{"status":"OK","connectedClients":0,"namespace":"social"},"storage":{"status":"OK","provider":"Cloudflare R2"},"sandbox":{"status":"OK","generator":"Active","sample":"MOCK"},"logTracer":{"status":"OK","protocol":"Senior Architect (ErrorId)"},"integrity":{"status":"OK","checked":"CourseSchema, JSONB_Structure"},"metrics":{"throughput_eps":0,"error_rate":0,"nudge_engagement_potential":0,"resource_state":"OPTIMAL_UNDER_E2B_8VCPU"},"timestamp":"2026-01-02T19:19:07.949Z"}[39m
[32m[Nest] 3024  - [39m01/03/2026, 2:19:07 AM [32m    LOG[39m [38;5;3m[DiagnosticService] [39m[32mGenerating 5 mock events for user: user-1[39m
[90mstdout[2m | src/modules/debug/diagnostic.service.spec.ts[2m > [22m[2mDiagnosticService[2m > [22m[2mrunFullDiagnostics[2m > [22m[2mshould run all diagnostic checks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.service.spec.ts[2m > [22m[2mDiagnosticService[2m > [22m[2mgenerateMockBehavioralData[2m > [22m[2mshould generate requested number of logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/debug/diagnostic.service.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 25[2mms[22m[39m
[32m[Nest] 14724  - [39m01/03/2026, 2:19:09 AM [32m    LOG[39m [38;5;3m[GamificationService] [39m[32mUser user-1 earned 50 points for TEST_EVENT[39m
[90mstdout[2m | test/unit/common/gamification.service.spec.ts[2m > [22m[2mGamificationService[2m > [22m[2mlogEvent[2m > [22m[2mshould update user points and create log
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/common/gamification.service.spec.ts[2m > [22m[2mGamificationService[2m > [22m[2mdeductPoints[2m > [22m[2mshould throw error if insufficient points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/common/gamification.service.spec.ts[2m > [22m[2mGamificationService[2m > [22m[2mdeductPoints[2m > [22m[2mshould deduct points if sufficient
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/common/gamification.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/unit/common/gamification.service.spec.ts [2m([22m[2m3 tests[22m[2m)[22m[90m 17[2mms[22m[39m
[90mstdout[2m | test/unit/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould calculate stats correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/users/users.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/unit/users/users.service.spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 13[2mms[22m[39m
[90mstdout[2m | src/modules/adaptive/adaptive.service.spec.ts[2m > [22m[2mAdaptiveService[2m > [22m[2mshould adjust level up for good performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.service.spec.ts[2m > [22m[2mAdaptiveService[2m > [22m[2mshould suggest reinforcement for poor performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/adaptive/adaptive.service.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 6[2mms[22m[39m
[90mstdout[2m | test/unit/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mlogEvent[2m > [22m[2mshould create a behavior log
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/behavior/behavior.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/unit/behavior/behavior.service.spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 11[2mms[22m[39m
[90mstdout[2m | src/utils/test-helper.spec.ts[2m > [22m[2mgreet[2m > [22m[2mshould return greeting
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/utils/test-helper.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/utils/test-helper.spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 5[2mms[22m[39m
[90mstdout[2m | src/app.controller.spec.ts[2m > [22m[2mAppController[2m > [22m[2mroot[2m > [22m[2mshould return "Hello World!"
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | src/app.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/app.controller.spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 8[2mms[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1m[7m Failed Suites 3 [27m[22mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[31m[1m[7m FAIL [27m[22m[39m test/social-ws.integration.spec.ts[2m > [22mSocial WebSocket Integration
[31m[1mError[22m: Nest can't resolve dependencies of the DatabaseService (?, ConfigService). Please make sure that the argument KyselyService at index [0] is available in the DatabaseModule context.

Potential solutions:
- Is DatabaseModule a valid NestJS module?
- If KyselyService is a provider, is it part of the current DatabaseModule?
- If KyselyService is exported from a separate @Module, is that module imported within DatabaseModule?
  @Module({
    imports: [ /* the Module containing KyselyService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[90m [2mâ¯[22m TestingInjector.lookupComponentInParentModules ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m286:19[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveComponentWrapper ../../node_modules/.pnpm/@nestjs+testing@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_r_5vf4xikaifpz6ermp5d5enz4yy/node_modules/@nestjs/testing/testing-injector.js:[2m19:45[22m[39m
[90m [2mâ¯[22m resolveParam ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m140:38[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveConstructorParams ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m169:27[22m[39m
[90m [2mâ¯[22m TestingInjector.loadInstance ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m75:13[22m[39m
[90m [2mâ¯[22m TestingInjector.loadProvider ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m103:9[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m56:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/6]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/social-ws.integration.spec.ts[2m > [22mSocial WebSocket Integration
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'close')[39m
[36m [2mâ¯[22m test/social-ws.integration.spec.ts:[2m88:15[22m[39m
    [90m 86| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m 87| [39m    [90m// Cleanup[39m
    [90m 88| [39m    [35mawait[39m app[33m.[39m[34mclose[39m()[33m;[39m
    [90m   | [39m              [31m^[39m
    [90m 89| [39m  })[33m;[39m
    [90m 90| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/6]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/ai/ai-agent-data.spec.ts[2m > [22mAI Agent Data Requirements - Phase 3
[31m[1mError[22m: Nest can't resolve dependencies of the KyselyService (?). Please make sure that the argument "KYSELY_CONNECTION" at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If "KYSELY_CONNECTION" is a provider, is it part of the current RootTestModule?
- If "KYSELY_CONNECTION" is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing "KYSELY_CONNECTION" */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[90m [2mâ¯[22m TestingInjector.lookupComponentInParentModules ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m286:19[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveComponentWrapper ../../node_modules/.pnpm/@nestjs+testing@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_r_5vf4xikaifpz6ermp5d5enz4yy/node_modules/@nestjs/testing/testing-injector.js:[2m19:45[22m[39m
[90m [2mâ¯[22m resolveParam ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m140:38[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveConstructorParams ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m169:27[22m[39m
[90m [2mâ¯[22m TestingInjector.loadInstance ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m75:13[22m[39m
[90m [2mâ¯[22m TestingInjector.loadProvider ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m103:9[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m56:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/6]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/ai/ai-agent-data.spec.ts[2m > [22mAI Agent Data Requirements - Phase 3
[31m[1mTypeError[22m: Cannot read properties of undefined (reading '$disconnect')[39m
[36m [2mâ¯[22m src/ai/ai-agent-data.spec.ts:[2m41:25[22m[39m
    [90m 39| [39m
    [90m 40| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m 41| [39m    [35mawait[39m prismaService[33m.[39m[34m$disconnect[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 42| [39m    [35mawait[39m kyselyService[33m.[39m[34mdestroy[39m()[33m;[39m
    [90m 43| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/6]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/database/database.service.seed.spec.ts[2m > [22mDatabase Seed Verification - Triple ORM
[31m[1mError[22m: Nest can't resolve dependencies of the DatabaseService (KyselyService, ?). Please make sure that the argument ConfigService at index [1] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If ConfigService is a provider, is it part of the current RootTestModule?
- If ConfigService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing ConfigService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[90m [2mâ¯[22m TestingInjector.lookupComponentInParentModules ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m286:19[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveComponentWrapper ../../node_modules/.pnpm/@nestjs+testing@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_r_5vf4xikaifpz6ermp5d5enz4yy/node_modules/@nestjs/testing/testing-injector.js:[2m19:45[22m[39m
[90m [2mâ¯[22m resolveParam ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m140:38[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveConstructorParams ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m169:27[22m[39m
[90m [2mâ¯[22m TestingInjector.loadInstance ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m75:13[22m[39m
[90m [2mâ¯[22m TestingInjector.loadProvider ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m103:9[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m56:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/6]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/database/database.service.seed.spec.ts[2m > [22mDatabase Seed Verification - Triple ORM
[31m[1mTypeError[22m: Cannot read properties of undefined (reading '$disconnect')[39m
[36m [2mâ¯[22m src/database/database.service.seed.spec.ts:[2m28:25[22m[39m
    [90m 26| [39m
    [90m 27| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m 28| [39m    [35mawait[39m prismaService[33m.[39m[34m$disconnect[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 29| [39m    [35mawait[39m kyselyService[33m.[39m[34mdestroy[39m()[33m;[39m
    [90m 30| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/6]âŽ¯[22m[39m

[2m Test Files [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m99 passed[39m[22m[2m | [22m[33m3 skipped[39m[90m (105)[39m
[2m      Tests [22m [1m[32m1811 passed[39m[22m[2m | [22m[33m52 skipped[39m[90m (1863)[39m
[2m   Start at [22m 02:17:15
[2m   Duration [22m 116.87s[2m (transform 2.96s, setup 2.05s, collect 146.63s, tests 19.98s, environment 35ms, prepare 26.88s)[22m

â€‰ELIFECYCLEâ€‰ Test failed. See above for more details.
