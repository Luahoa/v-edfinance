No projects matched the filters "c:\Users\luaho\Demo project\v-edfinance" in "C:\Users\luaho\Demo project\v-edfinance"

> api@0.0.1 test:cov C:\Users\luaho\Demo project\v-edfinance\apps\api
> vitest run --coverage

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

[1m[7m[36m RUN [39m[27m[22m [36mv2.1.9 [39m[90mC:/Users/luaho/Demo project/v-edfinance/apps/api[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mVirtual Portfolio Creation[2m > [22m[2mshould create new portfolio with default balance for new user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mVirtual Portfolio Creation[2m > [22m[2mshould return existing portfolio for existing user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mStock Trading - BUY Operations[2m > [22m[2mshould execute BUY trade for stock with sufficient balance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mStock Trading - BUY Operations[2m > [22m[2mshould accumulate stock holdings on multiple BUY trades
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mStock Trading - BUY Operations[2m > [22m[2mshould throw error when balance insufficient for BUY trade
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mCrypto Trading - BUY Operations[2m > [22m[2mshould execute BUY trade for Bitcoin
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mCrypto Trading - BUY Operations[2m > [22m[2mshould execute BUY trade for Ethereum
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mCrypto Trading - BUY Operations[2m > [22m[2mshould handle fractional crypto amounts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould execute SELL trade with sufficient assets
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould remove asset from portfolio when fully sold
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould throw error when trying to sell more than owned
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould throw error when trying to sell non-existent asset
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mMulti-Asset Portfolio Management[2m > [22m[2mshould handle diverse portfolio with multiple stocks and crypto
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Generation[2m > [22m[2mshould start life scenario with AI-generated event
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Generation[2m > [22m[2mshould handle AI response with code block formatting
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould continue scenario based on user choice
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould throw error for invalid scenario
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould throw error for mismatched userId
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould throw error for invalid choice
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould occasionally age the user during scenario progression
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould validate optimal 50/30/20 budget allocation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould warn about high wants allocation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould warn about low savings allocation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould throw error when allocation does not sum to 100
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould provide loss aversion nudge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould calculate survival months accurately
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould calculate inflation impact on survival
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould emit nudge request during stress test
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould provide social proof nudge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould provide impact statements in Vietnamese (VI)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould provide impact statements in English (EN)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould provide impact statements in Chinese (ZH)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould calculate future value with 8% annual return
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould handle custom year periods
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould emit nudge request for budgeting context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mMarket-Specific Currency Handling[2m > [22m[2mshould handle VND (Vietnamese Dong) amounts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mMarket-Specific Currency Handling[2m > [22m[2mshould format large VND amounts with localization
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mPortfolio Assets Validation[2m > [22m[2mshould validate JSONB portfolio assets on BUY trade
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mPortfolio Assets Validation[2m > [22m[2mshould validate JSONB portfolio assets on SELL trade
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mPortfolio Assets Validation[2m > [22m[2mshould validate complex multi-asset portfolio
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Status Validation[2m > [22m[2mshould validate JSONB simulation status on scenario start
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Status Validation[2m > [22m[2mshould validate JSONB simulation status on scenario continuation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Event Validation[2m > [22m[2mshould validate JSONB event structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Decisions Validation[2m > [22m[2mshould validate JSONB decisions array
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mGoal-Based Savings[2m > [22m[2mshould create market-linked commitment for retirement
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mGoal-Based Savings[2m > [22m[2mshould throw error for insufficient balance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould apply 10% penalty for early withdrawal
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould log early withdrawal behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould return full amount without penalty for on-time withdrawal
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould use transaction for withdrawal process
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould throw error for invalid commitment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould throw error for mismatched user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mScenario Quality Checks[2m > [22m[2mshould validate AI-generated scenario has required fields
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mScenario Quality Checks[2m > [22m[2mshould reject AI scenario missing required options
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mScenario Quality Checks[2m > [22m[2mshould validate option impact values are numeric
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mExecution State Machine[2m > [22m[2mshould track scenario execution state through lifecycle
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mExecution State Machine[2m > [22m[2mshould prevent state transition without valid choice
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mMultiple User Simulations[2m > [22m[2mshould handle concurrent portfolio trades from different users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mMultiple User Simulations[2m > [22m[2mshould handle concurrent scenario generations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mResult Calculation Accuracy[2m > [22m[2mshould accurately calculate portfolio value with multiple assets
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mResult Calculation Accuracy[2m > [22m[2mshould precisely calculate trade costs with decimals
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mResult Calculation Accuracy[2m > [22m[2mshould maintain precision in scenario impact calculations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/market-simulation.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/simulation/market-simulation.service.spec.ts [2m([22m[2m62 tests[22m[2m)[22m[90m 103[2mms[22m[39m
[31m[Nest] 7636  - [39m12/21/2025, 9:01:11 PM [31m  ERROR[39m [38;5;3m[AiService] [39m[31mGEMINI_API_KEY is not defined in environment variables[39m
[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2monModuleInit[2m > [22m[2mshould initialize with GEMINI_API_KEY from ConfigService
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2monModuleInit[2m > [22m[2mshould log error when GEMINI_API_KEY is missing
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2monModuleInit[2m > [22m[2mshould fallback to process.env when ConfigService is unavailable
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould throw ForbiddenException when rate limit exceeded
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould throw ForbiddenException when monthly budget exceeded
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould return total tokens used when limits not exceeded
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould handle missing tokensUsed in payload
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask email addresses
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask displayName and fullName
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask phone and address recursively
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould handle null and undefined data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask short strings properly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould create thread with title and module
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould create thread without module
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould get threads ordered by updatedAt desc
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould get messages ordered by createdAt asc
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould save message and update thread timestamp
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould generate course advice with progress tracking
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould use loss aversion for medium progress
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould use goal gradient for near completion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould return fallback advice on JSON parse error
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould check user AI usage before generating advice
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould log token usage for advice generation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould generate response with context and history
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould throw NotFoundException when thread not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould summarize history when messages exceed threshold
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould mask PII in user context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould log token usage after response
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould parse action cards from response
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould use cache for FAQ questions
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould cache FAQ responses
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mparseActionCards[2m > [22m[2mshould parse valid action card JSON
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mparseActionCards[2m > [22m[2mshould handle text without action cards
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mparseActionCards[2m > [22m[2mshould handle invalid JSON in action card
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mgenerateCacheKey[2m > [22m[2mshould generate consistent hash for same prompt
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mgenerateCacheKey[2m > [22m[2mshould be case-insensitive
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mgenerateCacheKey[2m > [22m[2mshould trim whitespace
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould classify FAQ questions (Vietnamese)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould classify FAQ questions (English)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould classify personalized queries
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould handle mixed case
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2msummarizeHistory[2m > [22m[2mshould summarize message history
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2msummarizeHistory[2m > [22m[2mshould return empty string on error
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2msummarizeHistory[2m > [22m[2mshould reverse messages for chronological order
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mError Handling[2m > [22m[2mshould handle Gemini API timeout
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mError Handling[2m > [22m[2mshould handle invalid course ID in getCourseAdvice
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle full chat flow with rate limiting and caching
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/ai/ai.service.spec.ts [2m([22m[2m47 tests[22m[2m)[22m[90m 129[2mms[22m[39m
[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould generate initial life scenario with AI
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould handle AI response with markdown code blocks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould continue scenario based on previous choice
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould throw error for invalid choice
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould throw error for unauthorized scenario access
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould throw error when scenario does not exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mDifficulty Scaling[2m > [22m[2mshould generate age-appropriate scenarios for young users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mDifficulty Scaling[2m > [22m[2mshould update user status based on choice impact
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mDifficulty Scaling[2m > [22m[2mshould occasionally age the user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Vietnamese-localized scenario
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate English-localized scenario
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Chinese-localized scenario
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould handle malformed JSON from LLM gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould parse JSON with extra whitespace
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould handle nested markdown code blocks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould mock complex multi-choice scenarios
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould validate initial status structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould validate scenario event structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould validate decisions array structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould reject invalid JSONB structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould preserve all required fields in status updates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mNudge Strategy Integration[2m > [22m[2mshould include loss aversion nudge in prompts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mNudge Strategy Integration[2m > [22m[2mshould include Hooked strategy trigger
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mNudge Strategy Integration[2m > [22m[2mshould pass previous choice context to next event
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle zero impact choices
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle negative savings (debt)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mEdge Cases[2m > [22m[2mshould cap happiness at boundaries
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/scenario-generator.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/simulation/scenario-generator.service.spec.ts [2m([22m[2m27 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 73[2mms[22m[39m
[31m   [31mÃ—[31m SimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22mScenario Generation Logic[2m > [22mshould continue scenario based on previous choice[90m 16[2mms[22m[31m[39m
[31m     â†’ actual value must be number or bigint, received "undefined"[39m
[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould trigger nudge for user inactive for 22 hours
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould NOT trigger for user inactive for 19 hours (too early)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould NOT trigger for user inactive for 25 hours (too late)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould trigger for multiple users in the time window
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould trigger SOCIAL_PROOF for HUNTER persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould trigger LOSS_AVERSION for high risk level
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould trigger LOSS_AVERSION for SAVER persona regardless of risk
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould return default SOCIAL_PROOF for moderate risk
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mBudgeting Trigger[2m > [22m[2mshould trigger GOAL_GRADIENT for SAVER persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mBudgeting Trigger[2m > [22m[2mshould trigger SALIENCE with coffee mapping for default persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mBudgeting Trigger[2m > [22m[2mshould calculate coffee equivalents correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mMilestone Trigger[2m > [22m[2mshould trigger GOAL_GRADIENT for streak warning
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mRealtime Social Proof Trigger[2m > [22m[2mshould trigger SOCIAL_PROOF when many users active
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mRealtime Social Proof Trigger[2m > [22m[2mshould return null when no active users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mRealtime Social Proof Trigger[2m > [22m[2mshould query behavioral logs from last 24 hours
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mStreak Conditions[2m > [22m[2mshould NOT trigger for frozen streaks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mStreak Conditions[2m > [22m[2mshould NOT trigger for zero streaks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mStreak Conditions[2m > [22m[2mshould trigger for high-value streaks (7+ days)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mInactivity Conditions[2m > [22m[2mshould identify users approaching streak expiration
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mInactivity Conditions[2m > [22m[2mshould exclude users with recent activity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mMulti-language Support[2m > [22m[2mshould generate Vietnamese message
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mMulti-language Support[2m > [22m[2mshould generate English message
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mMulti-language Support[2m > [22m[2mshould generate Chinese message
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mPriority Assignment[2m > [22m[2mshould assign HIGH priority to loss aversion nudges
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mPriority Assignment[2m > [22m[2mshould assign MEDIUM priority to default social proof
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mPriority Assignment[2m > [22m[2mshould assign LOW priority to salience nudges
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mBehavioral Logging[2m > [22m[2mshould log streak nudge to BehaviorLog
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mBehavioral Logging[2m > [22m[2mshould use system session ID for automated nudges
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mBehavioral Logging[2m > [22m[2mshould include correct event type
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mPersona-Based Behavior[2m > [22m[2mshould fetch user persona from analytics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mPersona-Based Behavior[2m > [22m[2mshould handle OBSERVER persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mPersona-Based Behavior[2m > [22m[2mshould handle missing user gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mActivity Tracking[2m > [22m[2mshould query user activity correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mInvestment Data Structure[2m > [22m[2mshould handle riskLevel in payload
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mInvestment Data Structure[2m > [22m[2mshould handle missing riskLevel gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mBudgeting Data Structure[2m > [22m[2mshould validate amount field in budgeting context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mBudgeting Data Structure[2m > [22m[2mshould calculate coffee mapping from amount
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mStreak Data Structure[2m > [22m[2mshould validate streak payload in notification
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould track action count for specific target
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould filter by event type and path
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould only count events from last 24 hours
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould return zero count when no matching events
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould return null for unknown context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle empty streak list gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle persona fetch failure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle database query failure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle behavioral log creation failure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle complete streak nudge workflow
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle complete investment decision workflow
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/trigger.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/trigger.service.spec.ts [2m([22m[2m49 tests[22m[2m)[22m[90m 101[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould register a valid experiment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould throw error if variant weights do not sum to 100
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould throw error if traffic allocation is out of range
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould throw error if experiment has less than 2 variants
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould handle experiments with multiple variants (A/B/C testing)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould retrieve all registered experiments
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould assign variant to new user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould return existing assignment for returning user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould return null if experiment is not active
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould return null if experiment does not exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould respect traffic allocation percentage
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould assign variants consistently based on user ID hash
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould handle targeted experiments based on user points
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould include user if within target audience range
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould distribute variants according to weight ratios
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mConversion Tracking[2m > [22m[2mshould track conversion events
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mConversion Tracking[2m > [22m[2mshould track conversions without value
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mConversion Tracking[2m > [22m[2mshould handle multiple conversion types
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould calculate performance metrics for each variant
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould handle zero conversions gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould throw error for non-existent experiment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould aggregate conversion values correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould calculate statistical significance with sufficient data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould mark results as significant when p-value < 0.05
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould throw error with insufficient data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould throw error for non-existent variants
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould calculate correct uplift percentage
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould provide confidence level
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould pause an active experiment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould complete an experiment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould not assign variants to paused experiments
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould handle experiments with date ranges
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle user with no points in targeted experiment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle experiment with zero traffic allocation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle partial traffic allocation correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle experiments with custom configuration per variant
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould maintain consistent hashing across service instances
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/ab-testing.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/analytics/ab-testing.service.spec.ts [2m([22m[2m37 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 97[2mms[22m[39m
[31m   [31mÃ—[31m ABTestingService - A/B Testing Framework[2m > [22mVariant Assignment[2m > [22mshould distribute variants according to weight ratios[90m 11[2mms[22m[31m[39m
[31m     â†’ expected 0.882 to be less than 0.75[39m
[31m[Nest] 7636  - [39m12/21/2025, 9:01:12 PM [31m  ERROR[39m [38;5;3m[AnalyticsService] [39m[31mLog aggregation failed[39m
[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mUser Behavior Analysis Pipeline[2m > [22m[2mshould analyze user behavior from raw logs to persona classification
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mUser Behavior Analysis Pipeline[2m > [22m[2mshould handle SAVER persona with commitment-focused behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mUser Behavior Analysis Pipeline[2m > [22m[2mshould default to OBSERVER for mixed behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mLearning Habits Analysis[2m > [22m[2mshould identify peak learning hours from activity patterns
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mLearning Habits Analysis[2m > [22m[2mshould return null for users with no activity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould generate complete financial future simulation with persona context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould predict churn risk based on activity gaps
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould return HIGH churn risk for large activity gaps
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould return LOW churn risk for consistent daily activity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mMentor Service with Analytics Integration[2m > [22m[2mshould integrate persona, churn risk, and user profile for personalized advice
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mMentor Service with Analytics Integration[2m > [22m[2mshould select WISE_SAGE persona for SAVER users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mMentor Service with Analytics Integration[2m > [22m[2mshould include high churn risk warning in AI context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mSystem-Wide Statistics Aggregation[2m > [22m[2mshould aggregate data from multiple Prisma models
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mSystem-Wide Statistics Aggregation[2m > [22m[2mshould handle null aggregate values gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mSystem Health Monitoring[2m > [22m[2mshould execute complete health check workflow
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mSystem Health Monitoring[2m > [22m[2mshould detect and warn about critical error rates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mSystem Health Monitoring[2m > [22m[2mshould handle database connection failure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mLog Aggregation and Archiving[2m > [22m[2mshould aggregate and archive behavior logs successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mLog Aggregation and Archiving[2m > [22m[2mshould skip aggregation when no logs exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mLog Aggregation and Archiving[2m > [22m[2mshould handle aggregation errors gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mVariable Reward Distribution[2m > [22m[2mshould award variable rewards based on lesson completion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mVariable Reward Distribution[2m > [22m[2mshould not award rewards when random threshold not met
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mVariable Reward Distribution[2m > [22m[2mshould include reward notification in AI response context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould properly mock all Prisma dependencies
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould properly mock GeminiService
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould properly mock EventEmitter2
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould ensure service dependencies are injected correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould handle circular dependencies between analytics and predictive services
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle empty user data gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle invalid date ranges in log queries
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle concurrent health checks without race conditions
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould maintain data consistency during aggregation failures
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mPerformance and Scalability[2m > [22m[2mshould efficiently handle large behavior log datasets
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mPerformance and Scalability[2m > [22m[2mshould batch process multiple user personas efficiently
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.integration.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

Error: Database error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\analytics\analytics.integration.spec.ts:504:59
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:12 PM [31m  ERROR[39m [38;5;3m[AnalyticsService] [39m[31mLog aggregation failed[39m
Error: Delete failed
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\analytics\analytics.integration.spec.ts:694:59
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
 [32mâœ“[39m src/modules/analytics/analytics.integration.spec.ts [2m([22m[2m34 tests[22m[2m)[22m[90m 137[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould generate daily report with correct metrics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould generate weekly report with aggregated data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould generate monthly report with top users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould filter report by userId when provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould handle custom date range
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToCSV[2m > [22m[2mshould export report to CSV format in Vietnamese
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToCSV[2m > [22m[2mshould export report to CSV format in English
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToCSV[2m > [22m[2mshould export report to CSV format in Chinese
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToPDF[2m > [22m[2mshould export report to PDF format in Vietnamese
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToPDF[2m > [22m[2mshould export report to PDF format in English
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToPDF[2m > [22m[2mshould export report to PDF format in Chinese
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for bar chart visualization
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for pie chart (activity distribution)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for horizontal bar chart (top users)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for gauge chart (progress)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2maggregated data mocking[2m > [22m[2mshould handle large datasets efficiently
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2maggregated data mocking[2m > [22m[2mshould sort activities by count descending
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2maggregated data mocking[2m > [22m[2mshould limit activities to top 10
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2medge cases[2m > [22m[2mshould handle zero metrics gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2medge cases[2m > [22m[2mshould handle report with no activities
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/reports.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/analytics/reports.service.spec.ts [2m([22m[2m20 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 66[2mms[22m[39m
[31m   [31mÃ—[31m ReportsService[2m > [22mgenerateReport[2m > [22mshould generate daily report with correct metrics[90m 11[2mms[22m[31m[39m
[31m     â†’ expected 3 to be 2 // Object.is equality[39m
[31m   [31mÃ—[31m ReportsService[2m > [22mgenerateReport[2m > [22mshould generate monthly report with top users[90m 3[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'length')[39m
[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log PAGE_VIEW event with correct structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log BUTTON_CLICK event with element metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log SCROLL event with scroll depth
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log VIDEO_PLAY event with playback metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log FORM_SUBMIT event with validation results
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould track multiple events within same session
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould retrieve all events for a specific session
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould count active sessions in time window
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould handle session timeout edge cases
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Aggregation Logic[2m > [22m[2mshould aggregate events by type for date range
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Aggregation Logic[2m > [22m[2mshould handle empty event set in aggregation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Aggregation Logic[2m > [22m[2mshould aggregate events with missing duration
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould validate nested JSONB payload structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould handle multi-locale JSONB content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould preserve deviceInfo JSONB structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould handle array data in JSONB payload
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle database create success
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle database create failure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle concurrent database operations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle findMany with complex filters
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle empty result set from database
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle undefined userId for anonymous tracking
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle null userId for anonymous tracking
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould set default actionCategory when not provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould set default duration to 0 when not provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle extremely large payload data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle special characters in path and eventType
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould handle rapid sequential logging without blocking
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould handle parallel event logging efficiently
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould aggregate large datasets efficiently
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/behavior-tracking.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/behavior-tracking.service.spec.ts [2m([22m[2m30 tests[22m[2m)[22m[90m 94[2mms[22m[39m
[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect and flag explicit profanity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect hate speech
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect sexual content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect violence and threats
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect spam and promotional content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould allow safe content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould moderate Vietnamese content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould moderate English content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould moderate Chinese content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould auto-detect language when not specified
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould handle language-specific profanity patterns
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify NONE severity for clean content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify LOW severity for minor issues
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify MEDIUM severity for moderate issues
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify HIGH severity for serious violations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify CRITICAL severity for extreme violations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould escalate severity based on multiple category violations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle empty content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle very long content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle special characters and emojis
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle API errors gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle rate limiting from API
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle null/undefined content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mLogging and Auditing[2m > [22m[2mshould log all moderation attempts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mLogging and Auditing[2m > [22m[2mshould log flagged content with detailed metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mLogging and Auditing[2m > [22m[2mshould not store full content for privacy (hash only)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mUser Strike System[2m > [22m[2mshould increment strike count for HIGH severity violations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mUser Strike System[2m > [22m[2mshould ban user after 3 CRITICAL violations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mUser Strike System[2m > [22m[2mshould not count LOW severity towards strikes
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mContext-Aware Moderation[2m > [22m[2mshould allow educational discussions about sensitive topics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mContext-Aware Moderation[2m > [22m[2mshould be stricter in public forums than private messages
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mPerformance and Caching[2m > [22m[2mshould cache moderation results for identical content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mPerformance and Caching[2m > [22m[2mshould handle batch moderation efficiently
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mAI API Mocking[2m > [22m[2mshould mock OpenAI Moderation API response
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mAI API Mocking[2m > [22m[2mshould mock Google Perspective API response
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mAI API Mocking[2m > [22m[2mshould mock custom Gemini Moderation API
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mReal-World Scenarios[2m > [22m[2mshould handle financial scam attempts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mReal-World Scenarios[2m > [22m[2mshould handle phishing attempts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mReal-World Scenarios[2m > [22m[2mshould allow legitimate financial discussions
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/moderation.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/ai/moderation.service.spec.ts [2m([22m[2m39 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[90m 99[2mms[22m[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould increment strike count for HIGH severity violations[90m 3[2mms[22m[31m[39m
[31m     â†’ Moderation API error[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould ban user after 3 CRITICAL violations[90m 3[2mms[22m[31m[39m
[31m     â†’ expected error to be instance of ForbiddenException[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould not count LOW severity towards strikes[90m 2[2mms[22m[31m[39m
[31m     â†’ Moderation API error[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock OpenAI Moderation API response[90m 2[2mms[22m[31m[39m
[31m     â†’ expected undefined to be false // Object.is equality[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock Google Perspective API response[90m 2[2mms[22m[31m[39m
[31m     â†’ expected undefined to be false // Object.is equality[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock custom Gemini Moderation API[90m 2[2mms[22m[31m[39m
[31m     â†’ expected undefined to be false // Object.is equality[39m
[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould collect real-time metrics from last 10 minutes
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould handle zero events gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould update Prometheus gauges on metrics collection
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould export metrics in Prometheus format
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould track active WebSocket connections
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould broadcast real-time events to all connected clients
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould send targeted events to specific users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould broadcast to groups (rooms)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould handle client disconnection and cleanup
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould aggregate behavior logs efficiently for daily archival
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould perform health check aggregation every hour
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould calculate global system stats efficiently
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould analyze user learning habits from behavior logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould handle empty user learning habits
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould generate mock behavioral data for stress testing
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould run AI stress test with different complexity levels
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould handle AI stress test failures gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould simulate complete user flow for integration testing
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould run comprehensive diagnostics with all subsystems
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould detect database connection failure in diagnostics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould validate JSONB schema integrity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould warn on JSONB schema drift
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mPerformance Benchmarks[2m > [22m[2mshould complete metrics collection in under 100ms (mocked)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mPerformance Benchmarks[2m > [22m[2mshould handle high-volume log aggregation efficiently
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mUser Persona Classification[2m > [22m[2mshould classify user as HUNTER (risk-taker)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mUser Persona Classification[2m > [22m[2mshould classify user as SAVER (conservative)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mUser Persona Classification[2m > [22m[2mshould classify user as OBSERVER (default)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/realtime-dashboard.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/analytics/realtime-dashboard.service.spec.ts [2m([22m[2m27 tests[22m[2m | [22m[31m27 failed[39m[2m)[22m[90m 130[2mms[22m[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould collect real-time metrics from last 10 minutes[90m 11[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould handle zero events gracefully[90m 7[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould update Prometheus gauges on metrics collection[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould export metrics in Prometheus format[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould track active WebSocket connections[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould broadcast real-time events to all connected clients[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould send targeted events to specific users[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould broadcast to groups (rooms)[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould handle client disconnection and cleanup[90m 7[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould aggregate behavior logs efficiently for daily archival[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould perform health check aggregation every hour[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould calculate global system stats efficiently[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould analyze user learning habits from behavior logs[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould handle empty user learning habits[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould generate mock behavioral data for stress testing[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould run AI stress test with different complexity levels[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould handle AI stress test failures gracefully[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould simulate complete user flow for integration testing[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould run comprehensive diagnostics with all subsystems[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould detect database connection failure in diagnostics[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould validate JSONB schema integrity[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould warn on JSONB schema drift[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mPerformance Benchmarks[2m > [22mshould complete metrics collection in under 100ms (mocked)[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mPerformance Benchmarks[2m > [22mshould handle high-volume log aggregation efficiently[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as HUNTER (risk-taker)[90m 7[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as SAVER (conservative)[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as OBSERVER (default)[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould create a commitment contract with valid data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould reject contract creation with insufficient balance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould calculate correct unlock date based on months
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould create multiple contracts for different goals
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mStake Locking[2m > [22m[2mshould lock funds by decrementing portfolio balance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mStake Locking[2m > [22m[2mshould verify locked amount matches commitment record
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mStake Locking[2m > [22m[2mshould prevent negative balance after locking
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould successfully withdraw on-time commitment without penalty
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould apply penalty for early withdrawal
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould reject withdrawal for non-existent commitment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould reject withdrawal by unauthorized user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mMock Financial Data[2m > [22m[2mshould simulate portfolio with realistic balance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mMock Financial Data[2m > [22m[2mshould handle zero balance portfolio gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mMock Financial Data[2m > [22m[2mshould support large commitment amounts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould calculate 10% penalty for early withdrawal
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould calculate penalty with different rates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould return full amount when unlockDate is exactly now
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould log penalty event with correct metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould handle edge case: zero penalty rate
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mIntegration: Full Lifecycle[2m > [22m[2mshould complete full commitment lifecycle: create â†’ withdraw early â†’ log penalty
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mIntegration: Full Lifecycle[2m > [22m[2mshould handle complete lifecycle: create â†’ wait â†’ withdraw without penalty
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/commitment.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/commitment.service.spec.ts [2m([22m[2m21 tests[22m[2m)[22m[90m 72[2mms[22m[39m
[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcreatePost[2m > [22m[2mshould create a post and broadcast it
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mjoinGroup[2m > [22m[2mshould allow a user to join a group and create a welcome post
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mjoinGroup[2m > [22m[2mshould throw error if group is full
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mupdateGroupStreak[2m > [22m[2mshould increment group streak if all members are active
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mupdateGroupStreak[2m > [22m[2mshould nudge group if some members are inactive
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcheckChallengeProgress[2m > [22m[2mshould complete challenge and reward members if target reached
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcheckChallengeProgress[2m > [22m[2mshould fail challenge if expired and target not reached
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgenerateCompetitiveNudge[2m > [22m[2mshould generate nudge for the user in second place
[22m[39m[Push Notification] to u2: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch leader 200 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 200 points behind leader. Finish one more lesson to overtake!","zh":"ä½ åªè½å leader 200 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetFeed[2m > [22m[2mshould return posts for user groups and public posts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcreateGroup[2m > [22m[2mshould create a group and add the creator as leader
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetGroupDetails[2m > [22m[2mshould return group with members and challenges
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetRecommendedGroups[2m > [22m[2mshould return fallback groups if user has no profile
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetRecommendedGroups[2m > [22m[2mshould return learning groups for beginners
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcreateGroupChallenge[2m > [22m[2mshould create a challenge and announce it
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mChallenge Progress Tracking (S005)[2m > [22m[2mshould calculate progress correctly with partial completion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mChallenge Progress Tracking (S005)[2m > [22m[2mshould handle challenge with no members
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mChallenge Progress Tracking (S005)[2m > [22m[2mshould handle concurrent challenge checks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Membership Validation (S005)[2m > [22m[2mshould prevent joining already joined group
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Membership Validation (S005)[2m > [22m[2mshould validate group exists before joining
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Membership Validation (S005)[2m > [22m[2mshould handle group at max capacity minus one
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mWebSocket Broadcast Integration (S005)[2m > [22m[2mshould broadcast post creation to all members
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mWebSocket Broadcast Integration (S005)[2m > [22m[2mshould handle broadcast failure gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Streak Edge Cases (S005)[2m > [22m[2mshould not increment streak if any member inactive
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Streak Edge Cases (S005)[2m > [22m[2mshould handle group with all active members
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Streak Edge Cases (S005)[2m > [22m[2mshould handle missing streak data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mFeed Generation (S005)[2m > [22m[2mshould return empty feed if user has no groups
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mFeed Generation (S005)[2m > [22m[2mshould include public posts for all users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mFeed Generation (S005)[2m > [22m[2mshould combine group and public posts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mCompetitive Nudge Generation (S005)[2m > [22m[2mshould not generate nudge if only one member
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mCompetitive Nudge Generation (S005)[2m > [22m[2mshould target second place correctly
[22m[39m[Push Notification] to u2: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch first 100 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 100 points behind first. Finish one more lesson to overtake!","zh":"ä½ åªè½å first 100 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/social/social.service.spec.ts [2m([22m[2m30 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 117[2mms[22m[39m
[31m   [31mÃ—[31m SocialService[2m > [22mChallenge Progress Tracking (S005)[2m > [22mshould handle challenge with no members[90m 6[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called at least once[39m
[31m   [31mÃ—[31m SocialService[2m > [22mWebSocket Broadcast Integration (S005)[2m > [22mshould handle broadcast failure gracefully[90m 6[2mms[22m[31m[39m
[31m     â†’ promise resolved "{ id: 'p1', userId: 'u1', â€¦(1) }" instead of rejecting[39m
 [31mâ¯[39m src/modules/nudge/reward.service.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould calculate daily active users correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould handle empty logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould deduplicate users within the same day
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould filter out null userId entries
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateWAU[2m > [22m[2mshould calculate weekly active users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateWAU[2m > [22m[2mshould return 0 for no active users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateMAU[2m > [22m[2mshould calculate monthly active users for December 2025
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateMAU[2m > [22m[2mshould handle edge case of February
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateRetention[2m > [22m[2mshould calculate cohort retention correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateRetention[2m > [22m[2mshould handle zero retention
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateRetention[2m > [22m[2mshould handle empty cohort
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateEngagement[2m > [22m[2mshould calculate engagement metrics correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateEngagement[2m > [22m[2mshould handle empty logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateEngagement[2m > [22m[2mshould calculate 100% bounce rate when all sessions have 1 event
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 50th percentile (median) correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 95th percentile correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 0th percentile (minimum)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 100th percentile (maximum)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould handle single value array
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould return 0 for empty array
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould throw error for invalid percentile < 0
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould throw error for invalid percentile > 100
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould handle unsorted input correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mgetUserPointsPercentiles[2m > [22m[2mshould calculate multiple percentiles for user points
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mgetUserPointsPercentiles[2m > [22m[2mshould handle users with zero points
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mgetUserPointsPercentiles[2m > [22m[2mshould handle empty user list
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mevents metric[2m > [22m[2mshould aggregate events by day
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mevents metric[2m > [22m[2mshould aggregate events by hour
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2musers metric[2m > [22m[2mshould aggregate unique users by day
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2musers metric[2m > [22m[2mshould filter out null userIds
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2msessions metric[2m > [22m[2mshould aggregate unique sessions by day
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mweek interval[2m > [22m[2mshould aggregate by week starting Monday
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mweek interval[2m > [22m[2mshould handle Sunday correctly (week starts Monday)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mshould return empty array for no logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mshould sort results chronologically
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mDatabase Integration[2m > [22m[2mshould use correct Prisma query for DAU
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mDatabase Integration[2m > [22m[2mshould use distinct query for WAU
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle timezone differences correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle large datasets efficiently
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/metrics.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/analytics/metrics.service.spec.ts [2m([22m[2m39 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 137[2mms[22m[39m
[31m   [31mÃ—[31m MetricsService[2m > [22mcalculateRetention[2m > [22mshould handle empty cohort[90m 9[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'length')[39m
[31m   [31mÃ—[31m MetricsService[2m > [22mcalculatePercentile[2m > [22mshould calculate 95th percentile correctly[90m 3[2mms[22m[31m[39m
[31m     â†’ expected 9.549999999999999 to be 9.55 // Object.is equality[39m
[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould estimate tokens correctly (1 token ~ 4 chars)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould estimate multipart tokens
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould handle empty array in multipart estimation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould truncate text to token budget
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould not truncate if within budget
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould validate token budget
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould mask email addresses
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould mask displayName
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould mask phone numbers
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould handle short strings
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould recursively mask nested objects
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould handle null and undefined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould not mask non-PII fields
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build course advice prompt for low progress
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build course advice prompt for medium progress
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build course advice prompt for high progress
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build persona prompt for WISE_SAGE
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build persona prompt for STRICT_COACH
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould include group streak context when high
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build system instruction with all context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould parse action cards from response
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould handle response without action cards
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould handle malformed action card JSON
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould extract JSON from markdown
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould throw on invalid JSON
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould parse valid course advice response
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould return fallback for invalid course advice response
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould generate consistent cache keys
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould be case-insensitive
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould trim whitespace
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould start with ai_response prefix
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould classify FAQ intents (Vietnamese)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould classify FAQ intents (English)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould classify personalized advice intents
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould handle v-edfinance specific questions
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould be case-insensitive
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould create fallback response for Vietnamese
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould create fallback response for English
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould create fallback response for Chinese
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould default to English for unknown locale
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould handle AI errors with context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstderr[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould handle AI errors with context
[22m[39mAI Error in generateResponse: Network timeout Error: Network timeout
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\modules\ai\utils\ai.utils.spec.ts:572:21
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3)

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould handle AI errors without context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould handle empty strings in all utilities
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould handle very long texts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould handle special characters in prompts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould maintain type safety in metadata parsing
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/utils/ai.utils.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/ai/utils/ai.utils.spec.ts [2m([22m[2m46 tests[22m[2m)[22m[90m 11[2mms[22m[39m
[90mstdout[2m | src/ai/ai.integration.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/ai/ai.integration.spec.ts [2m([22m[2m18 tests[22m[2m | [22m[33m18 skipped[39m[2m)[22m[90m 28[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould generate high-percentage cohort message for popular action
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould generate medium-priority message for moderate adoption
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould generate low-priority message for low adoption
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould return null if user not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould return null if cohort has zero users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould handle action without targetId
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould generate congratulatory message when user is above average
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould generate motivational message when user is below average
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould handle middle-ranked user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould return null if user not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould handle edge case with no peers
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould generate positive message when user is aligned with norm
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould generate motivational message when user is NOT aligned
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould handle different behavior types
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould return null if no social norm data available
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgetRealtimeActivity - Real-time social proof[2m > [22m[2mshould get activity count for last 24 hours by default
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgetRealtimeActivity - Real-time social proof[2m > [22m[2mshould support custom time windows
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgetRealtimeActivity - Real-time social proof[2m > [22m[2mshould handle zero activity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMessage localization[2m > [22m[2mshould provide messages in all three locales (vi, en, zh)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMessage localization[2m > [22m[2mshould use appropriate language-specific terminology
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould handle database errors gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould handle missing investment profile
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould round percentages correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould handle very small cohorts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mPriority calculation[2m > [22m[2mshould assign HIGH priority for >= 75%
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mPriority calculation[2m > [22m[2mshould assign MEDIUM priority for 50-74%
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mPriority calculation[2m > [22m[2mshould assign LOW priority for < 50%
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMetadata accuracy[2m > [22m[2mshould include accurate cohort metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMetadata accuracy[2m > [22m[2mshould include accurate peer metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMetadata accuracy[2m > [22m[2mshould include accurate social norm metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/social-proof.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/nudge/social-proof.service.spec.ts [2m([22m[2m31 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[90m 109[2mms[22m[39m
[31m   [31mÃ—[31m SocialProofService[2m > [22mgenerateCohortMessage - "X% of users like you"[2m > [22mshould return null if cohort has zero users[90m 6[2mms[22m[31m[39m
[31m     â†’ expected { type: 'SOCIAL_PROOF', â€¦(3) } to be null[39m
[31m   [31mÃ—[31m SocialProofService[2m > [22mgeneratePeerComparison - Peer ranking logic[2m > [22mshould generate congratulatory message when user is above average[90m 5[2mms[22m[31m[39m
[31m     â†’ expected '100% ngÆ°á»i dÃ¹ng Ä‘ang dáº«n trÆ°á»›c báº¡n vá»â€¦' to contain 'vÆ°á»£t trá»™i'[39m
[31m   [31mÃ—[31m SocialProofService[2m > [22mgeneratePeerComparison - Peer ranking logic[2m > [22mshould generate motivational message when user is below average[90m 3[2mms[22m[31m[39m
[31m     â†’ expected 'MEDIUM' to be 'HIGH' // Object.is equality[39m
[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould calculate conversion funnel with correct drop-off rates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould handle empty funnel data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould calculate average time to next stage
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould handle users who never complete next stage
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould identify critical drop-off points above threshold
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould return severe reasons for high drop-off rates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould return empty array when no critical drop-offs exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould use custom threshold for detection
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould analyze cohort retention across stages
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould calculate average completion time for cohort
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould handle cohort with no users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould track week-over-week cohort performance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould track complete user journey with all stages
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould mark journey as incomplete when no completion events
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould return empty journey for new users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould calculate journey duration in seconds
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould preserve timestamp order for journey reconstruction
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle single-stage funnel
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle null userId in cohort analysis
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle concurrent user sessions in time calculation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle users with incomplete journeys in cohort
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle zero division in conversion rate calculation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mComplex Funnel Scenarios[2m > [22m[2mshould analyze multi-step onboarding funnel
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mComplex Funnel Scenarios[2m > [22m[2mshould identify multiple drop-off points in complex funnel
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mComplex Funnel Scenarios[2m > [22m[2mshould compare cohort performance across different time periods
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mPerformance and Optimization[2m > [22m[2mshould handle large dataset efficiently
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mPerformance and Optimization[2m > [22m[2mshould batch process funnel stages
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/funnel-analysis.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/funnel-analysis.service.spec.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 95[2mms[22m[39m
[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould analyze behavior patterns from BehaviorLog data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould handle empty behavior log gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould prioritize recent behavior (last 50 logs)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould analyze mixed behavior patterns accurately
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as HUNTER for dominant risk-taking behavior (>5 events)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as SAVER for dominant commitment behavior (>5 events)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as OBSERVER when risk-taking events â‰¤5
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as OBSERVER when saving events â‰¤5
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as OBSERVER when behaviors are balanced
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould handle edge case: exactly 5 risk-taking events
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as HUNTER when exactly 6 risk-taking events
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould identify HUNTER profile: high risk tolerance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould identify SAVER profile: commitment-focused
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould identify OBSERVER profile: passive engagement
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould profile based on event frequency distribution
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould analyze behavioral consistency over time
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould process various event types correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould handle malformed log data gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould process logs with complete metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould handle database query errors gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould respect the 50-log limit
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould recommend HUNTER persona for aggressive investors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould recommend SAVER persona for conservative users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould recommend OBSERVER persona for new users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould validate persona transitions over time
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould handle persona ambiguity with default to OBSERVER
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould provide consistent recommendations for similar behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle single behavior log entry
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle exactly threshold behaviors (boundary)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle maximum logs (50 entries)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle mixed event types with unknown events
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould return consistent results for multiple calls
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPerformance & Data Quality[2m > [22m[2mshould handle large datasets efficiently
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPerformance & Data Quality[2m > [22m[2mshould validate data integrity of behavior logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/persona-analysis.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/ai/persona-analysis.service.spec.ts [2m([22m[2m34 tests[22m[2m)[22m[90m 40[2mms[22m[39m
 [31mâ¯[39m src/modules/nudge/nudge-scheduler.service.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | src/modules/nudge/personalization.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/nudge/personalization.service.spec.ts [2m([22m[2m39 tests[22m[2m | [22m[31m39 failed[39m[2m)[22m[90m 16[2mms[22m[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould deliver SOCIAL_PROOF nudge emphasizing competition[90m 2[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould maintain high engagement for HUNTER persona[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould use competitive language for HUNTER[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould deliver LOSS_AVERSION nudge for high-risk scenarios[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould prioritize GOAL_GRADIENT for budgeting context[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould emphasize security and caution for SAVER[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould calculate progress correctly for SAVER budgeting[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould deliver default SOCIAL_PROOF nudge[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould use neutral language for OBSERVER[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould provide informative mapping for OBSERVER budgeting[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould adapt message based on risk level threshold[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould calculate real-world value mapping correctly[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould override persona logic when risk is critically high[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould maintain persona preference when risk is moderate[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle INVESTMENT_DECISION context[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle BUDGETING context[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle STREAK_WARNING context[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle SOCIAL_PROOF_REALTIME context[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould return null for unknown context[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for streak-critical situations[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for HUNTER investment decisions[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for SAVER loss aversion[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize MEDIUM for default social proof[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize LOW for OBSERVER budgeting nudges[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould fetch realtime social proof data[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould query behavior logs from last 24 hours[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould generate realtime social nudge when users are active[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould return null when no active users in last 24h[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Vietnamese translations[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide English translations[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Chinese translations[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing user gracefully[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle zero amount in budgeting[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle very large amounts in budgeting[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing data object[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle undefined risk level[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for HUNTER[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for SAVER[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould adapt dynamically to changing user behavior[90m 0[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m     â†’ jest is not defined[39m
[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould return cached response on cache hit for GENERAL_FAQ
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould make AI call on cache miss for GENERAL_FAQ
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould skip cache for PERSONALIZED_ADVICE queries
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould generate consistent cache keys for identical prompts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould generate different cache keys for different prompts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mTTL Expiration[2m > [22m[2mshould set cache with 24-hour TTL for FAQ responses
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mTTL Expiration[2m > [22m[2mshould handle expired cache gracefully (cache miss scenario)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Invalidation[2m > [22m[2mshould allow manual cache deletion via cache manager
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Invalidation[2m > [22m[2mshould handle cache reset operation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Invalidation[2m > [22m[2mshould re-cache response after invalidation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould enforce rate limit (20 requests per minute)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould allow requests under rate limit
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould enforce monthly token budget (50,000 tokens)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould calculate token usage from behavior logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould handle missing tokensUsed in payload gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mIntent Classification (Cache Eligibility)[2m > [22m[2mshould classify FAQ queries correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mIntent Classification (Cache Eligibility)[2m > [22m[2mshould classify personalized queries correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mIntent Classification (Cache Eligibility)[2m > [22m[2mshould be case-insensitive for intent classification
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle thread not found error
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould save both user and assistant messages when cache hit occurs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle cache manager errors gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould track token usage in behavior logs after AI call
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/ai-cache.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/ai/ai-cache.service.spec.ts [2m([22m[2m22 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[90m 78[2mms[22m[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould return cached response on cache hit for GENERAL_FAQ[90m 5[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould make AI call on cache miss for GENERAL_FAQ[90m 4[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould skip cache for PERSONALIZED_ADVICE queries[90m 4[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mTTL Expiration[2m > [22mshould set cache with 24-hour TTL for FAQ responses[90m 3[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mTTL Expiration[2m > [22mshould handle expired cache gracefully (cache miss scenario)[90m 4[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mCache Invalidation[2m > [22mshould re-cache response after invalidation[90m 3[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mEdge Cases & Error Handling[2m > [22mshould save both user and assistant messages when cache hit occurs[90m 3[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mEdge Cases & Error Handling[2m > [22mshould track token usage in behavior logs after AI call[90m 5[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m[Nest] 7636  - [39m12/21/2025, 9:01:15 PM [31m  ERROR[39m [38;5;3m[NudgeListener] [39m[31mFailed to deduct points for user user-5: Insufficient points[39m
[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete full streak warning flow: trigger â†’ nudge â†’ log
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete investment decision flow: request â†’ persona analysis â†’ nudge generation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete budgeting flow with SAVER persona: context â†’ persona â†’ mapping nudge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete social proof flow with realtime data aggregation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould process points.earned event â†’ generate nudge â†’ log behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould handle nudge.request event â†’ generate personalized nudge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould handle points.deduct event â†’ call gamification service
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould handle failed point deduction gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mCross-Service Integration[2m > [22m[2mshould integrate with Analytics service for persona-driven nudges
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mCross-Service Integration[2m > [22m[2mshould integrate with Prisma for streak data retrieval and logging
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mCross-Service Integration[2m > [22m[2mshould integrate with Gamification service for point adjustments
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMock Dependencies Validation[2m > [22m[2mshould mock PrismaService correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMock Dependencies Validation[2m > [22m[2mshould mock AnalyticsService correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMock Dependencies Validation[2m > [22m[2mshould mock GamificationService correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle user not found in database
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle invalid nudge context gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle failed behavior logging without crashing
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould skip nudge generation if simulation flag is false
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle high-risk investment with SAVER persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle empty streak list without errors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMulti-Language Support[2m > [22m[2mshould return nudges with all three language variants
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMulti-Language Support[2m > [22m[2mshould provide localized budgeting nudges
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Social Proof tactic for HUNTER persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Loss Aversion tactic for high-risk scenarios
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Goal Gradient tactic for streak warnings
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Salience tactic with mapping for budgeting
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mRealtime Social Proof Integration[2m > [22m[2mshould aggregate activity counts for social proof nudge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mRealtime Social Proof Integration[2m > [22m[2mshould return null if no active users found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.integration.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/nudge.integration.spec.ts [2m([22m[2m28 tests[22m[2m)[22m[90m 51[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould generate GAIN-framed message with positive outcome emphasis
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould generate LOSS-framed message with loss aversion emphasis
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould use GAIN framing for opportunity contexts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould use LOSS framing for risk scenarios
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to LOSS framing for streak contexts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to LOSS framing for risk contexts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to GAIN framing for opportunity contexts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to LOSS for SAVER persona (risk-averse)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to GAIN for HUNTER persona in neutral contexts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould apply DEFAULT framing and select based on context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Vietnamese framed message
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate English framed message
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Chinese framed message
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould fallback to Vietnamese if locale is invalid
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould get all localized templates for a context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould handle parameter interpolation in all locales
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould correctly interpolate amount parameter
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould correctly interpolate days parameter
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould correctly interpolate count parameter
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould handle multiple parameters in template
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould assign variant from A/B test when experimentId is provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould use original framing if no A/B test assignment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould work without experimentId (no A/B testing)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould track variant assignment for analytics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould handle A/B test error gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle missing parameters gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle empty locale with fallback
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould return valid message key when translation not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould handle undefined userProfile in getDefaultFraming
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould handle null params in generateFramedMessage
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould correctly identify multiple loss context keywords
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould generate consistent messages for same inputs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould handle concurrent framing requests
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/framing.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/nudge/framing.service.spec.ts [2m([22m[2m34 tests[22m[2m | [22m[31m26 failed[39m[2m)[22m[90m 61[2mms[22m[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould generate GAIN-framed message with positive outcome emphasis[90m 5[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould generate LOSS-framed message with loss aversion emphasis[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould use GAIN framing for opportunity contexts[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould use LOSS framing for risk scenarios[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mDefault Effect Logic[2m > [22mshould apply DEFAULT framing and select based on context[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould generate Vietnamese framed message[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould generate English framed message[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould generate Chinese framed message[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould fallback to Vietnamese if locale is invalid[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould get all localized templates for a context[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould handle parameter interpolation in all locales[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould correctly interpolate amount parameter[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould correctly interpolate days parameter[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould correctly interpolate count parameter[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould handle multiple parameters in template[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould assign variant from A/B test when experimentId is provided[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'assignVariant')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould use original framing if no A/B test assignment[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'assignVariant')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould work without experimentId (no A/B testing)[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould track variant assignment for analytics[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'assignVariant')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould handle A/B test error gracefully[90m 3[2mms[22m[31m[39m
[31m     â†’ expected [Function] to throw error including 'DB connection lost' but got 'Cannot read properties of undefined (â€¦'[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mEdge Cases & Error Handling[2m > [22mshould handle missing parameters gracefully[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mEdge Cases & Error Handling[2m > [22mshould handle empty locale with fallback[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mEdge Cases & Error Handling[2m > [22mshould return valid message key when translation not found[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mCoverage Edge Cases (85%+ Target)[2m > [22mshould handle null params in generateFramedMessage[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mCoverage Edge Cases (85%+ Target)[2m > [22mshould generate consistent messages for same inputs[90m 5[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[31m   [31mÃ—[31m FramingService - Message Framing with Nudge Theory[2m > [22mCoverage Edge Cases (85%+ Target)[2m > [22mshould handle concurrent framing requests[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'translate')[39m
[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Definition[2m > [22m[2mshould define a new segment with criteria
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Definition[2m > [22m[2mshould define segment with behavior type criteria
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Definition[2m > [22m[2mshould define segment with locale criteria
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould update segment with matching users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould return null when updating non-existent segment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter users by age range
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter users by completed lessons minimum
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by LOW engagement level
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by MEDIUM engagement level
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by HIGH engagement level
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by HUNTER behavior type
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by SAVER behavior type
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by OBSERVER behavior type
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by locale criteria
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Targeting[2m > [22m[2mshould target segment with message
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Targeting[2m > [22m[2mshould return false when targeting non-existent segment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Targeting[2m > [22m[2mshould return false when targeting empty segment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould return user demographics with all fields
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould classify user as SAVER based on behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould classify user as OBSERVER when no strong behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould return null when user not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould return null when user has no date of birth
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould default to "vi" locale when user has no preferred language
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould retrieve segment by ID
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould return null for non-existent segment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould get all segments
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould delete segment successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould return false when deleting non-existent segment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mComplex Multi-Criteria Filtering[2m > [22m[2mshould apply multiple criteria filters together
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mComplex Multi-Criteria Filtering[2m > [22m[2mshould handle empty result when no users match all criteria
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mAge Calculation Edge Cases[2m > [22m[2mshould calculate age correctly for birthday today
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mAge Calculation Edge Cases[2m > [22m[2mshould calculate age correctly for birthday tomorrow
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/user-segmentation.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/analytics/user-segmentation.service.spec.ts [2m([22m[2m32 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 150[2mms[22m[39m
[31m   [31mÃ—[31m UserSegmentationService[2m > [22mComplex Multi-Criteria Filtering[2m > [22mshould handle empty result when no users match all criteria[90m 6[2mms[22m[31m[39m
[31m     â†’ activityCounts is not iterable[39m
[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould track click coordinates with all parameters
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould track click without elementId
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould handle anonymous users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould track negative coordinates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackScrollDepth[2m > [22m[2mshould track scroll depth with percentage calculation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackScrollDepth[2m > [22m[2mshould handle 100% scroll depth
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackScrollDepth[2m > [22m[2mshould handle zero scroll depth
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould generate heatmap grid from click data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould normalize intensity to 0-1 range
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould handle empty click data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould skip invalid coordinates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould use custom grid size
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould aggregate clicks in same grid cell
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould calculate average and max scroll depth
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould handle no scroll events
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould skip events without scrollPercentage
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould find maximum scroll depth correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetClickPatterns[2m > [22m[2mshould retrieve user click patterns
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetClickPatterns[2m > [22m[2mshould filter out invalid coordinates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetClickPatterns[2m > [22m[2mshould respect limit parameter
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetHotspots[2m > [22m[2mshould filter cells by intensity threshold
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetHotspots[2m > [22m[2mshould return empty array if no hotspots meet threshold
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetHotspots[2m > [22m[2mshould use default threshold of 0.7
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould calculate comprehensive engagement metrics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould handle user with no activity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould limit most visited pages to top 5
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould aggregate session durations correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould sort pages by visit count
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/heatmap.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/analytics/heatmap.service.spec.ts [2m([22m[2m28 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 106[2mms[22m[39m
[31m   [31mÃ—[31m HeatmapService[2m > [22manalyzeScrollDepth[2m > [22mshould skip events without scrollPercentage[90m 7[2mms[22m[31m[39m
[31m     â†’ expected 32.5 to be 65 // Object.is equality[39m
[31m   [31mÃ—[31m HeatmapService[2m > [22manalyzeUserEngagement[2m > [22mshould calculate comprehensive engagement metrics[90m 5[2mms[22m[31m[39m
[31m     â†’ expected { totalClicks: 50, â€¦(3) } to deeply equal { totalClicks: 50, â€¦(3) }[39m
[90mstdout[2m | src/auth/auth.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mgenerateTokens[2m > [22m[2mshould generate tokens and save to DB
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mvalidateUser[2m > [22m[2mshould return user without password if valid
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mvalidateUser[2m > [22m[2mshould return null if password invalid
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mvalidateUser[2m > [22m[2mshould return null if user not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mlogin[2m > [22m[2mshould throw UnauthorizedException if validation fails
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mlogin[2m > [22m[2mshould return access and refresh tokens on success
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mrefreshToken[2m > [22m[2mshould refresh tokens correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mrefreshToken[2m > [22m[2mshould throw if token is expired
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mrefreshToken[2m > [22m[2mshould revoke all tokens if reused
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould create user and return tokens
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould throw ConflictException if email already exists
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould hash password with bcrypt before saving
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould handle Prisma P2002 error (duplicate email)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould generate default i18n name from email if name not provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould handle concurrent login requests
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould handle refresh token near expiry
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould reject refresh token exactly at expiry boundary
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould handle missing refresh token in database
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mPassword Reset Race Conditions (S001)[2m > [22m[2mshould handle empty or null password gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mPassword Reset Race Conditions (S001)[2m > [22m[2mshould handle concurrent password validation attempts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mPassword Reset Race Conditions (S001)[2m > [22m[2mshould prevent timing attacks on user lookup
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mLogin Error Handling (S001)[2m > [22m[2mshould handle JWT signing failure gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mLogin Error Handling (S001)[2m > [22m[2mshould handle database errors during token generation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Security Edge Cases (S001)[2m > [22m[2mshould generate unique refresh tokens for same user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Security Edge Cases (S001)[2m > [22m[2mshould hash refresh tokens before storage
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Security Edge Cases (S001)[2m > [22m[2mshould revoke all user tokens on token reuse detection
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.service.spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m src/auth/auth.service.spec.ts [2m([22m[2m27 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 808[2mms[22m[39m
[31m   [31mÃ—[31m AuthService[2m > [22mToken Rotation Edge Cases (S001)[2m > [22mshould reject refresh token exactly at expiry boundary[90m 5[2mms[22m[31m[39m
[31m     â†’ expected error to be instance of UnauthorizedException[39m
[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return CRITICAL warning for high-value streak (>= 7 days) about to expire
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return HIGH priority for low-value streak (< 7 days) about to expire
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when streak is already expired (>24 hours)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when activity is too recent (<20 hours)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when user has no streak
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when streak data does not exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould calculate hours remaining correctly at exact 20-hour mark
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould generate CRITICAL nudge when progress is 90%+
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould generate HIGH nudge when progress is 70-89%
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould return null when progress is below 70%
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould return null when progress is already 100%
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould handle edge case at exactly 70% threshold
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould handle multi-language goal names correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould generate commitment contract with penalty warning
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould format large amounts correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould return null when user does not exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould handle small amounts correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould include all three language translations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould frame as LOSS with HIGH priority
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould frame as GAIN with MEDIUM priority
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould include inflation context in loss framing
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould emphasize action in gain framing
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould handle edge case with zero amount
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould process multiple users and return nudges for each
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould return empty arrays for users without warnings
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould handle empty user list
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould process users independently even if one fails
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle future dates gracefully in streak calculation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle very large streak numbers
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle progress percentage edge cases
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle very small commitment amounts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle very large commitment durations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mMessage Quality & Localization[2m > [22m[2mshould ensure all messages contain required emoji/icons
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mMessage Quality & Localization[2m > [22m[2mshould ensure message consistency across all three languages
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/loss-aversion.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/loss-aversion.service.spec.ts [2m([22m[2m34 tests[22m[2m)[22m[90m 146[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould find users with streaks between 20-24 hours ago and send nudges
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould not send nudges if no users match criteria
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould filter out frozen streaks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould filter out zero-streak users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould send nudges to multiple users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould include correct time boundaries (20-24 hours)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould log user streak data in nudge payload
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould use nudge-system as sessionId
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould use correct event path
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mTrigger Frequency Limits[2m > [22m[2mshould not send nudge to same user within 24 hours
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mTrigger Frequency Limits[2m > [22m[2mshould enforce max 3 nudges per day per user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mTrigger Frequency Limits[2m > [22m[2mshould allow nudge after 24 hours cooldown
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mUser Preference Overrides[2m > [22m[2mshould respect user opt-out from nudges
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mUser Preference Overrides[2m > [22m[2mshould respect quiet hours preference
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mUser Preference Overrides[2m > [22m[2mshould send nudge outside quiet hours
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mThaler Pattern Validation[2m > [22m[2mshould apply loss aversion nudge for streak preservation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mThaler Pattern Validation[2m > [22m[2mshould use social proof for high streaks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mThaler Pattern Validation[2m > [22m[2mshould use framing for milestone streaks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mA/B Test Integration[2m > [22m[2mshould track nudge variant for A/B testing
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mA/B Test Integration[2m > [22m[2mshould support different nudge message variants
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mA/B Test Integration[2m > [22m[2mshould log A/B test metadata for analytics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/nudge/nudge.service.spec.ts [2m([22m[2m22 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[90m 28[2mms[22m[39m
[31m   [31mÃ—[31m NudgeService[2m > [22mhandleStreakNudges[2m > [22mshould filter out zero-streak users[90m 2[2mms[22m[31m[39m
[31m     â†’ usersToNudge is not iterable[39m
[31m   [31mÃ—[31m NudgeService[2m > [22mhandleStreakNudges[2m > [22mshould include correct time boundaries (20-24 hours)[90m 1[2mms[22m[31m[39m
[31m     â†’ usersToNudge is not iterable[39m
[31m   [31mÃ—[31m NudgeService[2m > [22mTrigger Frequency Limits[2m > [22mshould not send nudge to same user within 24 hours[90m 1[2mms[22m[31m[39m
[31m     â†’ expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T16:01:17.061Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [31mÃ—[31m NudgeService[2m > [22mTrigger Frequency Limits[2m > [22mshould enforce max 3 nudges per day per user[90m 1[2mms[22m[31m[39m
[31m     â†’ expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T16:01:17.063Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [31mÃ—[31m NudgeService[2m > [22mUser Preference Overrides[2m > [22mshould respect user opt-out from nudges[90m 1[2mms[22m[31m[39m
[31m     â†’ expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T16:01:17.065Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould recommend LEVEL_UP for high score (>80)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould recommend REINFORCE for low score (<50)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould recommend STAY for medium score (50-80)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle edge case: score exactly 80
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle edge case: score exactly 50
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle missing score gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle score of 0
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle perfect score (100)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mUser Success Rate Tracking[2m > [22m[2mshould log behavior for performance tracking
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mUser Success Rate Tracking[2m > [22m[2mshould track lesson completion metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mUser Success Rate Tracking[2m > [22m[2mshould maintain consistent session tracking
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould optimize for Flow State with quick high-score completion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould detect struggle with long time + low score
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould maintain engagement with moderate performance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould handle zero time spent edge case
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould handle beginner user progression
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould handle advanced user performance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould handle user without investment profile
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould process multiple rapid adjustments
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle negative score gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle score over 100
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould return correct response structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle very large timeSpent values
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle different user IDs correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle different lesson IDs correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mIntegration with User Profile[2m > [22m[2mshould fetch user with investment profile
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mIntegration with User Profile[2m > [22m[2mshould work with users having different risk tolerances
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/ai/adaptive-difficulty.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/ai/adaptive-difficulty.service.spec.ts [2m([22m[2m27 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 98[2mms[22m[39m
[31m   [31mÃ—[31m AdaptiveDifficultyService[2m > [22mDifficulty Adjustment Algorithms[2m > [22madjustLearningPath[2m > [22mshould handle score of 0[90m 4[2mms[22m[31m[39m
[31m     â†’ expected 'STAY' to be 'REINFORCE' // Object.is equality[39m
[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould create a new thread with title only
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould create a new thread with title and module
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould handle service errors when creating thread
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould require authentication (JwtAuthGuard)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads - getThreads[2m > [22m[2mshould return all threads for authenticated user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads - getThreads[2m > [22m[2mshould return empty array when user has no threads
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads - getThreads[2m > [22m[2mshould handle service errors when fetching threads
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould return all messages for a thread
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould return empty array for thread with no messages
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould handle non-existent thread
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould handle service errors when fetching messages
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould generate AI response for user prompt
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle empty prompt
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle rate limit exceeded
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle monthly budget exceeded
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle non-existent thread in chat
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle unauthorized access to thread
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle AI service errors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mInput Validation[2m > [22m[2mshould validate title is required for createThread
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mInput Validation[2m > [22m[2mshould validate prompt is required for chat
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mInput Validation[2m > [22m[2mshould handle invalid threadId format
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect createThread with JwtAuthGuard
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect getThreads with JwtAuthGuard
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect getMessages with JwtAuthGuard
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect chat with JwtAuthGuard
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mError Response Handling[2m > [22m[2mshould propagate service exceptions to client
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mError Response Handling[2m > [22m[2mshould handle unexpected errors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long thread titles
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long prompts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in title
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in prompt
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/ai/ai.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/ai/ai.controller.spec.ts [2m([22m[2m32 tests[22m[2m)[22m[90m 51[2mms[22m[39m
[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mBasic Recommendation[2m > [22m[2mshould return personalized recommendations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mBasic Recommendation[2m > [22m[2mshould return fallback recommendations if AI fails
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersona-Based Filtering[2m > [22m[2mshould recommend risk-focused courses for HUNTER persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersona-Based Filtering[2m > [22m[2mshould recommend savings courses for SAVER persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersona-Based Filtering[2m > [22m[2mshould recommend diverse courses for OBSERVER persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mContent Freshness[2m > [22m[2mshould filter out completed courses
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mContent Freshness[2m > [22m[2mshould prioritize recently published courses
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mCache Invalidation[2m > [22m[2mshould bypass cache when user completes new lesson
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mCache Invalidation[2m > [22m[2mshould refresh recommendations when persona changes
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersonalization Accuracy[2m > [22m[2mshould match recommendations to user learning habits
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersonalization Accuracy[2m > [22m[2mshould validate AI recommendation output structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersonalization Accuracy[2m > [22m[2mshould apply nudge strategies correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/recommendations/recommendation.service.spec.ts [2m([22m[2m12 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 65[2mms[22m[39m
[31m   [31mÃ—[31m RecommendationService[2m > [22mPersona-Based Filtering[2m > [22mshould recommend risk-focused courses for HUNTER persona[90m 8[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called with arguments: [ StringContaining "HUNTER" ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   StringContaining "HUNTER",[90m
[31m+   "[90m
[31m+       System: You are an AI Financial Advisor for V-EdFinance.[90m
[31m+       User Profile: {\"riskTolerance\":\"HIGH\"}[90m
[31m+       Learning Habits: {\"peakLearningHour\":10}[90m
[31m+       Available Courses: [{\"id\":\"c1\",\"title\":{\"vi\":\"Crypto Trading\"}}][90m
[31m+       [90m
[31m+       Task: Recommend the top 2 courses for this user. [90m
[31m+       For each recommendation, provide a reason based on NUDGE theory (e.g., Social Proof, Goal Gradient).[90m
[31m+       [90m
[31m+       Format: JSON array of { \"courseId\": string, \"reason\": { \"vi\": string, \"en\": string, \"zh\": string }, \"strategy\": string }[90m
[31m+     ",[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [31mÃ—[31m RecommendationService[2m > [22mPersona-Based Filtering[2m > [22mshould recommend savings courses for SAVER persona[90m 5[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called with arguments: [ StringContaining "SAVER" ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   StringContaining "SAVER",[90m
[31m+   "[90m
[31m+       System: You are an AI Financial Advisor for V-EdFinance.[90m
[31m+       User Profile: {\"riskTolerance\":\"LOW\"}[90m
[31m+       Learning Habits: {}[90m
[31m+       Available Courses: [{\"id\":\"c2\",\"title\":{\"vi\":\"Savings Strategies\"}}][90m
[31m+       [90m
[31m+       Task: Recommend the top 2 courses for this user. [90m
[31m+       For each recommendation, provide a reason based on NUDGE theory (e.g., Social Proof, Goal Gradient).[90m
[31m+       [90m
[31m+       Format: JSON array of { \"courseId\": string, \"reason\": { \"vi\": string, \"en\": string, \"zh\": string }, \"strategy\": string }[90m
[31m+     ",[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mcreateCourse[2m > [22m[2mshould create a new course successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mcreateCourse[2m > [22m[2mshould validate required fields
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould return all courses with default pagination
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould apply pagination parameters
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould filter by level
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould convert string params to numbers
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindOne[2m > [22m[2mshould return a single course
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindOne[2m > [22m[2mshould throw NotFoundException for non-existent course
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindLesson[2m > [22m[2mshould return a single lesson
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindLesson[2m > [22m[2mshould throw NotFoundException for non-existent lesson
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateCourse[2m > [22m[2mshould update course successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateCourse[2m > [22m[2mshould handle partial updates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mremoveCourse[2m > [22m[2mshould delete course successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mremoveCourse[2m > [22m[2mshould throw NotFoundException for non-existent course
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mcreateLesson[2m > [22m[2mshould create a new lesson
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateLesson[2m > [22m[2mshould update lesson successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mremoveLesson[2m > [22m[2mshould delete lesson successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateProgress[2m > [22m[2mshould update user progress successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateProgress[2m > [22m[2mshould handle IN_PROGRESS status
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateProgress[2m > [22m[2mshould validate duration is non-negative
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mgetMentorAdvice[2m > [22m[2mshould get AI mentor advice for course
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mgetMentorAdvice[2m > [22m[2mshould handle AI service errors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould require ADMIN or TEACHER role for createCourse
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould require ADMIN or TEACHER role for updateCourse
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould require only ADMIN role for removeCourse
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould not require specific roles for public endpoints
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/courses/courses.controller.spec.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 192[2mms[22m[39m
[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mcreateCourse[2m > [22m[2mshould create a course
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mfindOneCourse[2m > [22m[2mshould return course with lessons
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mfindOneCourse[2m > [22m[2mshould throw NotFoundException if course not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mupdateProgress[2m > [22m[2mshould upsert progress and reward points for first completion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mupdateProgress[2m > [22m[2mshould not reward points if already completed
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mcreateLesson[2m > [22m[2mshould determine order automatically if not provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mcreateLesson[2m > [22m[2mshould start with order 1 if no lessons exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mupdateLesson[2m > [22m[2mshould update lesson data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mremoveLesson[2m > [22m[2mshould delete lesson
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mEnrollment Constraints (S003)[2m > [22m[2mshould handle getUserProgress for empty course
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mEnrollment Constraints (S003)[2m > [22m[2mshould include lesson details in user progress
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould handle progress update with zero duration
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould increment duration for existing progress
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould not reward points for re-completing same lesson
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould set completedAt timestamp on first completion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mLesson Ordering Logic (S003)[2m > [22m[2mshould handle manual order override
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mLesson Ordering Logic (S003)[2m > [22m[2mshould auto-assign order for empty course
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mLesson Ordering Logic (S003)[2m > [22m[2mshould respect existing lesson order sequence
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCourse Query Pagination (S003)[2m > [22m[2mshould enforce max limit of 100
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCourse Query Pagination (S003)[2m > [22m[2mshould enforce min page of 1
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCourse Query Pagination (S003)[2m > [22m[2mshould filter by published and level
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCRUD Error Handling (S003)[2m > [22m[2mshould throw NotFoundException for invalid lesson ID
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCRUD Error Handling (S003)[2m > [22m[2mshould delete course successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCRUD Error Handling (S003)[2m > [22m[2mshould update course with partial data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/courses/courses.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/courses/courses.service.spec.ts [2m([22m[2m24 tests[22m[2m)[22m[90m 117[2mms[22m[39m
[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log lesson completion event with points
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log achievement unlocked event
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log streak milestone event
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould handle missing userId gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould validate eventType is required
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log multiple rapid events without collision
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyHistory - Behavior Analytics[2m > [22m[2mshould return user behavior history
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyHistory - Behavior Analytics[2m > [22m[2mshould return empty array for user with no history
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyHistory - Behavior Analytics[2m > [22m[2mshould throw UnauthorizedException for missing auth
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyStreak - Gamification Streak Tracking[2m > [22m[2mshould return current streak (placeholder)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyStreak - Gamification Streak Tracking[2m > [22m[2mshould work without errors for new users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect log endpoint with JwtAuthGuard
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect getMyHistory with JwtAuthGuard
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect getMyStreak with JwtAuthGuard
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGamification Integration Tests[2m > [22m[2mshould trigger XP calculation on lesson completion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGamification Integration Tests[2m > [22m[2mshould track badge awarding event
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGamification Integration Tests[2m > [22m[2mshould log leaderboard position change
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mError Handling[2m > [22m[2mshould propagate service errors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mError Handling[2m > [22m[2mshould handle getUserBehaviors service errors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/behavior/behavior.controller.spec.ts [2m([22m[2m20 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 110[2mms[22m[39m
[31m   [31mÃ—[31m BehaviorController (Gamification)[2m > [22mgetMyHistory - Behavior Analytics[2m > [22mshould throw UnauthorizedException for missing auth[90m 7[2mms[22m[31m[39m
[31m     â†’ promise resolved "[]" instead of rejecting[39m
[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mlogEvent[2m > [22m[2mshould increment user points and log behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mlogEvent[2m > [22m[2mshould use simulation system ID when metadata has isSimulation true
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould deduct points if user has enough
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould throw error if user has insufficient points
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould throw error if user does not exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould log deduction with correct session ID
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mPoint calculation with streak multipliers (edge cases)[2m > [22m[2mshould handle zero points correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mPoint calculation with streak multipliers (edge cases)[2m > [22m[2mshould handle large point values
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mPoint calculation with streak multipliers (edge cases)[2m > [22m[2mshould include custom metadata in payload
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mXP Decay Logic (S004)[2m > [22m[2mshould handle zero-point events
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mXP Decay Logic (S004)[2m > [22m[2mshould handle negative point values gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mXP Decay Logic (S004)[2m > [22m[2mshould track point decay in metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mAchievement Unlock Race Conditions (S004)[2m > [22m[2mshould handle concurrent point updates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mAchievement Unlock Race Conditions (S004)[2m > [22m[2mshould emit event for each point gain
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mLeaderboard Ranking Updates (S004)[2m > [22m[2mshould log events with unique event types
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mLeaderboard Ranking Updates (S004)[2m > [22m[2mshould handle metadata for ranking changes
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mStreak Recovery (S004)[2m > [22m[2mshould log streak recovery events
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mDeduction Edge Cases (S004)[2m > [22m[2mshould handle deduction when points exactly match
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mDeduction Edge Cases (S004)[2m > [22m[2mshould emit deduction event
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/common/gamification.service.spec.ts [2m([22m[2m19 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 97[2mms[22m[39m
[31m   [31mÃ—[31m GamificationService (Pure Unit Test)[2m > [22mDeduction Edge Cases (S004)[2m > [22mshould emit deduction event[90m 6[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called at least once[39m
[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mcreateCourse[2m > [22m[2mshould create course with localized JSONB content (vi/en/zh)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mcreateCourse[2m > [22m[2mshould validate JSONB structure via ValidationService
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould return paginated courses with default values
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould filter by published status
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould filter by level (BEGINNER, INTERMEDIATE, ADVANCED)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould enforce max limit of 100
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould handle page boundaries correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneCourse[2m > [22m[2mshould return course with published lessons ordered by order field
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneCourse[2m > [22m[2mshould throw NotFoundException if course not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateCourse[2m > [22m[2mshould update course and preserve localization structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateCourse[2m > [22m[2mshould allow partial updates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mremoveCourse[2m > [22m[2mshould delete course
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould update progress and award points on first completion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould not award points if already completed (idempotent)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould increment durationSpent on existing progress
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould set completedAt timestamp on first completion only
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mgetUserProgress[2m > [22m[2mshould return all progress for a user in a specific course
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneLesson[2m > [22m[2mshould return lesson by id
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneLesson[2m > [22m[2mshould throw NotFoundException if lesson not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/courses.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/unit/courses/courses.service.spec.ts [2m([22m[2m19 tests[22m[2m)[22m[90m 14[2mms[22m[39m
 [31mâ¯[39m test/integration/security-audit-trail.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mGET /simulation/portfolio[2m > [22m[2mshould return user simulation portfolio
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mGET /simulation/portfolio[2m > [22m[2mshould handle empty portfolio
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/trade[2m > [22m[2mshould execute buy trade successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/trade[2m > [22m[2mshould execute sell trade successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/trade[2m > [22m[2mshould validate insufficient funds
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/start[2m > [22m[2mshould start a new life scenario
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/start[2m > [22m[2mshould generate AI-powered scenario
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/continue[2m > [22m[2mshould process user choice and continue scenario
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/continue[2m > [22m[2mshould handle scenario completion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/budget/process[2m > [22m[2mshould process budget allocation decision
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/stress-test[2m > [22m[2mshould run financial stress test
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/stress-test[2m > [22m[2mshould test multiple economic scenarios
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/impact-analysis[2m > [22m[2mshould calculate long-term impact with default years
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/impact-analysis[2m > [22m[2mshould calculate impact for custom time horizon
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/commitment/create[2m > [22m[2mshould create financial commitment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/commitment/create[2m > [22m[2mshould enforce loss aversion logic
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/commitment/withdraw[2m > [22m[2mshould withdraw commitment with penalty
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/simulation/simulation.controller.spec.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 21[2mms[22m[39m
 [31mâ¯[39m test/integration/disaster-recovery.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[31m[Nest] 7636  - [39m12/21/2025, 9:01:18 PM [31m  ERROR[39m [38;5;3m[AnalyticsService] [39m[31mLog aggregation failed[39m
[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleSystemHealthCheck[2m > [22m[2mshould log health check and warn on high error rates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserLearningHabits[2m > [22m[2mshould return habits based on logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserLearningHabits[2m > [22m[2mshould return null if no logs found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould classify as HUNTER for risk-taking behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould classify as SAVER for commitment-focused behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould aggregate logs from yesterday by user and eventType
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould handle empty log set gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould delete logs older than 30 days
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould handle aggregation errors gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetGlobalSystemStats[2m > [22m[2mshould return aggregated system statistics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetGlobalSystemStats[2m > [22m[2mshould handle null points sum gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mDate Range Validation[2m > [22m[2mshould correctly calculate 1-hour time window for health check
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mDate Range Validation[2m > [22m[2mshould handle date boundary edge cases in aggregation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mReal-Time Metrics Updates[2m > [22m[2mshould track error rate spikes in real-time
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mReal-Time Metrics Updates[2m > [22m[2mshould update health metrics every hour
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mBehavior Log Archiving[2m > [22m[2mshould archive logs in batches based on age threshold
[22m[39mğŸ§¹ Cleaning up after test...

Error: DB Error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\analytics\analytics.service.spec.ts:149:57
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mBehavior Log Archiving[2m > [22m[2mshould preserve recent logs during archiving
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/analytics/analytics.service.spec.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[90m 82[2mms[22m[39m
[31m   [31mÃ—[31m AnalyticsService[2m > [22mhandleLogAggregation[2m > [22mshould handle empty log set gracefully[90m 5[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called at least once[39m
[31m   [31mÃ—[31m AnalyticsService[2m > [22mhandleLogAggregation[2m > [22mshould delete logs older than 30 days[90m 6[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading '0')[39m
[31m   [31mÃ—[31m AnalyticsService[2m > [22mBehavior Log Archiving[2m > [22mshould archive logs in batches based on age threshold[90m 4[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m AnalyticsService[2m > [22mBehavior Log Archiving[2m > [22mshould preserve recent logs during archiving[90m 4[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading '0')[39m
[90mstdout[2m | test/simulation-ai.integration.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould start simulation and generate AI scenario
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould continue simulation, make decision and calculate impact
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould verify market simulation trade updates portfolio
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould validate simulation history logs via behavior tracking
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/simulation-ai.integration.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m test/simulation-ai.integration.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 260[2mms[22m[39m
[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mgetFeed[2m > [22m[2mshould return social feed
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcreatePost[2m > [22m[2mshould create a new post
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mgetRecommendations[2m > [22m[2mshould return group recommendations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcreateGroup[2m > [22m[2mshould create a new group
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mjoinGroup[2m > [22m[2mshould join a group
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mgetGroupDetails[2m > [22m[2mshould return group details
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcreateChallenge[2m > [22m[2mshould create a group challenge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mError Handling[2m > [22m[2mshould propagate errors from social service
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mlikePost[2m > [22m[2mshould like a post successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mlikePost[2m > [22m[2mshould handle duplicate likes
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcommentOnPost[2m > [22m[2mshould add comment to post successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcommentOnPost[2m > [22m[2mshould validate empty content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mWebSocket Integration (Mocked)[2m > [22m[2mshould handle real-time feed updates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mWebSocket Integration (Mocked)[2m > [22m[2mshould support pagination for feed
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mGroup Challenge Tests[2m > [22m[2mshould create challenge with all required fields
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mGroup Challenge Tests[2m > [22m[2mshould validate challenge target is positive
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect all endpoints with JwtAuthGuard
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/social/social.controller.spec.ts [2m([22m[2m18 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 192[2mms[22m[39m
[31m   [31mÃ—[31m SocialController[2m > [22mGuard Protection[2m > [22mshould protect all endpoints with JwtAuthGuard[90m 9[2mms[22m[31m[39m
[31m     â†’ expected undefined to be defined[39m
[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mPOST /nudge/check[2m > [22m[2mshould trigger nudge check with context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mPOST /nudge/check[2m > [22m[2mshould use default context and data when not provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mPOST /nudge/check[2m > [22m[2mshould generate loss aversion nudge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould return multiple dashboard nudges
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould filter out null nudges
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould generate streak warning nudge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould generate social proof nudge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould get realtime social proof for course enrollment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould get social proof for lesson completion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould get social proof for commitment creation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould handle zero activity gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould include user demographics in social proof
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould return percentage for social proof
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould show time-based scarcity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould display user testimonials count
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould show trending badge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould include peer comparison
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould validate commitment contract nudge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould show framing effect
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould integrate with investment profile
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/nudge/nudge.controller.spec.ts [2m([22m[2m21 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 33[2mms[22m[39m
[31m   [31mÃ—[31m NudgeController[2m > [22mGET /nudge/dashboard[2m > [22mshould return multiple dashboard nudges[90m 2[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called 2 times, but got 5 times[39m
[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould update item and calculate progress correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould reward when 100% completed
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould not reward if already 100% completed before
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould throw NotFoundException for non-existent checklist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould throw NotFoundException for wrong user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould mark item as incomplete and recalculate progress
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould set completedAt timestamp when completing item
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mcreate[2m > [22m[2mshould create a new checklist with 0 progress
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mfindAll[2m > [22m[2mshould return all checklists ordered by updatedAt desc
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mfindAll[2m > [22m[2mshould return empty array if no checklists exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mProgress calculation[2m > [22m[2mshould calculate 0% for all incomplete items
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mProgress calculation[2m > [22m[2mshould round progress correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/checklists/checklists.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/checklists/checklists.service.spec.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 88[2mms[22m[39m
[90mstdout[2m | src/common/health.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould return ok status
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould return timestamp
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould return uptime
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould respond quickly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould handle concurrent health checks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould return ready status when DB is connected
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould execute DB connectivity check
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould return not ready when DB is disconnected
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould handle DB timeout
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould retry on transient failures
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return user count
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return course count
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return behavior log count
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return timestamp
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould fetch all metrics in parallel
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould handle zero counts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould handle large counts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mDB Connectivity[2m > [22m[2mshould verify Prisma connection
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mDB Connectivity[2m > [22m[2mshould handle connection pool exhaustion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mDB Connectivity[2m > [22m[2mshould handle SSL connection errors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mService Status[2m > [22m[2mshould indicate healthy service
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mService Status[2m > [22m[2mshould detect degraded performance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mService Status[2m > [22m[2mshould handle service unavailability
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mError Handling[2m > [22m[2mshould handle metrics query failures
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mError Handling[2m > [22m[2mshould handle partial metric failures
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mError Handling[2m > [22m[2mshould not leak DB errors to client
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle uptime overflow
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle timezone differences
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle rapid successive checks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/health.controller.spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m src/common/health.controller.spec.ts [2m([22m[2m30 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[90m 154[2mms[22m[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mGET /ready[2m > [22mshould return ready status when DB is connected[90m 5[2mms[22m[31m[39m
[31m     â†’ expected 'not ready' to be 'ready' // Object.is equality[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mGET /ready[2m > [22mshould execute DB connectivity check[90m 1[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called at least once[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mGET /ready[2m > [22mshould retry on transient failures[90m 1[2mms[22m[31m[39m
[31m     â†’ expected 'not ready' to be 'ready' // Object.is equality[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return user count[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'user')[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return course count[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'user')[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return behavior log count[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'user')[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return timestamp[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'user')[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mGET /metrics[2m > [22mshould fetch all metrics in parallel[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'user')[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mGET /metrics[2m > [22mshould handle zero counts[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'user')[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mGET /metrics[2m > [22mshould handle large counts[90m 3[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'user')[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mDB Connectivity[2m > [22mshould verify Prisma connection[90m 4[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called with arguments: [ ArrayContaining ["SELECT 1"] ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mService Status[2m > [22mshould indicate healthy service[90m 1[2mms[22m[31m[39m
[31m     â†’ expected 'not ready' to be 'ready' // Object.is equality[39m
[31m   [31mÃ—[31m HealthController (C015)[2m > [22mError Handling[2m > [22mshould handle metrics query failures[90m 2[2mms[22m[31m[39m
[31m     â†’ expected [Function] to throw error including 'Query failed' but got 'Cannot read properties of undefined (â€¦'[39m
 [31mâ¯[39m test/integration/multi-device-sync.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould return user profile successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould throw NotFoundException when user not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould throw UnauthorizedException when userId is missing
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould handle service errors gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetInvestmentProfile[2m > [22m[2mshould return investment profile successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetInvestmentProfile[2m > [22m[2mshould handle user without investment profile
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetInvestmentProfile[2m > [22m[2mshould throw NotFoundException for non-existent user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould update investment profile successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould handle partial updates
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould validate investment goals array
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould throw NotFoundException for non-existent user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould return dashboard statistics successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould return empty stats for new user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould handle errors gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect all endpoints with JwtAuthGuard
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mGuard Protection[2m > [22m[2mshould require authentication for investment profile endpoints
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mGuard Protection[2m > [22m[2mshould require authentication for dashboard stats
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/users/users.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/users/users.controller.spec.ts [2m([22m[2m18 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 120[2mms[22m[39m
[31m   [31mÃ—[31m UsersController[2m > [22mgetProfile[2m > [22mshould throw UnauthorizedException when userId is missing[90m 7[2mms[22m[31m[39m
[31m     â†’ expected error to be instance of UnauthorizedException[39m
[31m   [31mÃ—[31m UsersController[2m > [22mupdateInvestmentProfile[2m > [22mshould handle partial updates[90m 9[2mms[22m[31m[39m
[31m     â†’ mockInvestmentProfile is not defined[39m
 [31mâ¯[39m src/users/users.service.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould upload file successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould generate unique key with timestamp
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould preserve original filename in key
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould return public URL
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould handle PNG files
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould handle PDF files
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould accept files under 5MB
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould accept files exactly at 5MB limit
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould handle empty files
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould handle large buffer efficiently
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept image/jpeg
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept image/png
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept application/pdf
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept video/mp4
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould handle unknown MIME types
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mSpecial Characters in Filename[2m > [22m[2mshould handle spaces in filename
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mSpecial Characters in Filename[2m > [22m[2mshould handle unicode characters
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mSpecial Characters in Filename[2m > [22m[2mshould handle special characters
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mError Handling[2m > [22m[2mshould handle upload failures
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mError Handling[2m > [22m[2mshould handle storage service unavailability
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mError Handling[2m > [22m[2mshould handle network timeout
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mConcurrent Uploads[2m > [22m[2mshould handle multiple concurrent uploads
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mConcurrent Uploads[2m > [22m[2mshould generate unique keys for concurrent uploads
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long filenames
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle files with no extension
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle files with multiple dots
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle different file encodings
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/storage/storage.controller.spec.ts [2m([22m[2m28 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 75[2mms[22m[39m
[31m   [31mÃ—[31m StorageController (C013)[2m > [22mConcurrent Uploads[2m > [22mshould generate unique keys for concurrent uploads[90m 3[2mms[22m[31m[39m
[31m     â†’ expected 'uploads/1766325680527-same.jpg' not to be 'uploads/1766325680527-same.jpg' // Object.is equality[39m
[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/my-habits[2m > [22m[2mshould return user learning habits
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/my-habits[2m > [22m[2mshould handle user with no learning history
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/my-habits[2m > [22m[2mshould aggregate multi-day data correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/predictive/future[2m > [22m[2mshould simulate user financial future
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/predictive/future[2m > [22m[2mshould handle user with minimal financial data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/predictive/future[2m > [22m[2mshould project multiple time horizons
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould return personalized mentor advice
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould use default module and lesson when not provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould respect user locale preference
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould handle Chinese locale
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/system-stats (ADMIN)[2m > [22m[2mshould return global system statistics for admin
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/system-stats (ADMIN)[2m > [22m[2mshould include platform-wide metrics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/system-stats (ADMIN)[2m > [22m[2mshould aggregate user behavior metrics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/analytics.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/analytics.controller.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 26[2mms[22m[39m
[90mstdout[2m | src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mEnd-to-end Social Flow[2m > [22m[2mshould handle full cycle: join group -> welcome post -> leaderboard nudge -> notification
[22m[39m[Push Notification] to u2: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch user1 200 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 200 points behind user1. Finish one more lesson to overtake!","zh":"ä½ åªè½å user1 200 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mEnd-to-end Social Flow[2m > [22m[2mshould synchronize WebSocket broadcasts with REST API actions
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mEnd-to-end Social Flow[2m > [22m[2mshould handle challenge progression and cross-service rewards
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mWebSocket + Service Interactions[2m > [22m[2mshould handle group streak updates and conditional nudging
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.integration.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/social.integration.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 120[2mms[22m[39m
[90mstdout[2m | src/auth/auth.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignIn[2m > [22m[2mshould call authService.login
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignIn[2m > [22m[2mshould return access_token, refresh_token, and user object
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mValidation (Integration)[2m > [22m[2mshould fail if email is invalid
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mValidation (Integration)[2m > [22m[2mshould fail if password is too short in RegisterDto
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignUp[2m > [22m[2mshould call authService.register
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignUp[2m > [22m[2mshould return tokens and user on successful registration
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mrefresh[2m > [22m[2mshould call authService.refreshToken
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mrefresh[2m > [22m[2mshould return new tokens on successful refresh
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mGuards[2m > [22m[2mshould have JwtAuthGuard on profile-related endpoints in UsersController
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Expired Tokens[2m > [22m[2mshould reject expired refresh token
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Expired Tokens[2m > [22m[2mshould handle missing refresh token
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Password Reset Flow[2m > [22m[2mshould reject login with invalid credentials
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Password Reset Flow[2m > [22m[2mshould reject login with non-existent email
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: JWT Refresh Race Conditions[2m > [22m[2mshould handle token reuse detection
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: JWT Refresh Race Conditions[2m > [22m[2mshould generate new tokens on valid refresh
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Registration Conflicts[2m > [22m[2mshould reject duplicate email registration
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/auth.controller.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m src/auth/auth.controller.spec.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 34[2mms[22m[39m
[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mshould analyze behavior and sync profile
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mRisk score calculation[2m > [22m[2mshould calculate risk score from high-risk behavior logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mRisk score calculation[2m > [22m[2mshould calculate risk score from conservative behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mKnowledge level assessment[2m > [22m[2mshould set knowledge to BEGINNER for new user with few lessons
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mKnowledge level assessment[2m > [22m[2mshould assess knowledge from completed lessons count
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould sync profile with JSONB investment philosophy
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould create new profile if none exists
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould update existing profile with new analysis
[22m[39mğŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/behavior/investment-profile.service.spec.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 48[2mms[22m[39m
[90mstdout[2m | src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould include locale in AI prompt
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/investment-profile.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould run full diagnostics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould return database check status
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould return AI service check
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould return WebSocket connection count
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/metrics[2m > [22m[2mshould return Prometheus metrics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/metrics[2m > [22m[2mshould return metrics in Prometheus format
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/metrics[2m > [22m[2mshould expose throughput metrics
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/verify-integrity[2m > [22m[2mshould verify system integrity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/verify-integrity[2m > [22m[2mshould check database integrity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/verify-integrity[2m > [22m[2mshould validate schema consistency
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/simulate[2m > [22m[2mshould simulate user flow
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/simulate[2m > [22m[2mshould handle invalid userId
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/simulate[2m > [22m[2mshould handle empty userId
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/mock-behaviors[2m > [22m[2mshould generate mock behavioral data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/mock-behaviors[2m > [22m[2mshould use default count if not provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/mock-behaviors[2m > [22m[2mshould handle large counts
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould run AI stress test with LOW complexity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould run AI stress test with MEDIUM complexity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould run AI stress test with HIGH complexity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould handle stress test failures
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mHealth Checks[2m > [22m[2mshould verify all critical services
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mHealth Checks[2m > [22m[2mshould report unhealthy status on failures
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle concurrent diagnostic requests
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle service unavailability
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mEdge Cases[2m > [22m[2mshould validate stress test complexity values
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/debug/diagnostic.controller.spec.ts [2m([22m[2m26 tests[22m[2m)[22m[90m 33[2mms[22m[39m
[90mstdout[2m | test/social-ws.integration.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mConnect WS â†’ Identify â†’ Broadcast â†’ Check via REST
[22m[39mClient connected: 9Xf_kqBXmaTFn0hhAAAC
Client connected: CMdpF-N-4V9DjetxAAAD

[90mstdout[2m | test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mConnect WS â†’ Identify â†’ Broadcast â†’ Check via REST
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mJoin group â†’ Post achievement â†’ Friends notified (WS)
[22m[39mClient disconnected: 9Xf_kqBXmaTFn0hhAAAC
Client disconnected: CMdpF-N-4V9DjetxAAAD

[90mstdout[2m | test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mJoin group â†’ Post achievement â†’ Friends notified (WS)
[22m[39mClient connected: 1I3zzXOTrBl5-lftAAAF

[90mstdout[2m | test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mJoin group â†’ Post achievement â†’ Friends notified (WS)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mLeaderboard update via aggregation (Community Stats)
[22m[39mClient disconnected: 1I3zzXOTrBl5-lftAAAF

[90mstdout[2m | test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mLeaderboard update via aggregation (Community Stats)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mTest concurrent WebSocket connections
[22m[39mClient connected: Ef37VjLKBZ4b81KLAAAL
Client connected: IZOFLesj1twc5vsaAAAM
Client connected: RnOzO_sMDPsZnNNcAAAN
Client connected: 9xEf7csm3jurKhjPAAAO
Client connected: qxF69xw9MN4jLLYwAAAP
ğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration
[22m[39mClient disconnected: Ef37VjLKBZ4b81KLAAAL
Client disconnected: IZOFLesj1twc5vsaAAAM
Client disconnected: RnOzO_sMDPsZnNNcAAAN
Client disconnected: 9xEf7csm3jurKhjPAAAO
Client disconnected: qxF69xw9MN4jLLYwAAAP

[90mstdout[2m | test/social-ws.integration.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m test/social-ws.integration.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 330[2mms[22m[39m
[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate correct BEHAVIOR_LOG_PAYLOAD
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate minimal BEHAVIOR_LOG_PAYLOAD
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate correct I18N_TEXT with all locales
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject I18N_TEXT missing required locale
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate USER_METADATA with optional fields
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject USER_METADATA with invalid URL
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SOCIAL_POST_CONTENT
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SIMULATION_EVENT with nested options
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject SIMULATION_EVENT with missing required fields
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate INVESTMENT_PHILOSOPHY
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject INVESTMENT_PHILOSOPHY with invalid enum
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate FINANCIAL_GOALS array
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate CHECKLIST_ITEMS
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate PORTFOLIO_ASSETS with mixed types
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SIMULATION_STATUS with optional fields
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate COURSE_RECOMMENDATION with i18n reason
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate CHAT_MESSAGE_METADATA
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould throw error for validation failure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould throw error for undefined schema key
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate empty BEHAVIOR_LOG_PAYLOAD as valid
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SIMULATION_DECISIONS with multiple decision types
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould handle passthrough fields in INVESTMENT_PHILOSOPHY
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/common/validation.service.spec.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 142[2mms[22m[39m
[90mstdout[2m | test/gamification-nudge.e2e-spec.ts[2m > [22m[2mGamification & Nudge System (Integration)[2m > [22m[2mUser Inactivity & Streak Nudge[2m > [22m[2mshould trigger a nudge when user is inactive for 20-24 hours
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/gamification-nudge.e2e-spec.ts[2m > [22m[2mGamification & Nudge System (Integration)[2m > [22m[2mUser Inactivity & Streak Nudge[2m > [22m[2mshould preserve streak logic via LossAversionService
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/gamification-nudge.e2e-spec.ts[2m > [22m[2mGamification & Nudge System (Integration)[2m > [22m[2mSocial Proof Nudge Generation[2m > [22m[2mshould generate social proof based on cohort behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/gamification-nudge.e2e-spec.ts[2m > [22m[2mGamification & Nudge System (Integration)[2m > [22m[2mSocial Proof Nudge Generation[2m > [22m[2mshould verify realtime activity social proof
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/gamification-nudge.e2e-spec.ts[2m > [22m[2mGamification & Nudge System (Integration)[2m > [22m[2mVariable Rewards & Adaptive Adjustment[2m > [22m[2mshould simulate reward distribution/adjustment based on performance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/gamification-nudge.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/gamification-nudge.e2e-spec.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 23[2mms[22m[39m
[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould return personalized course recommendations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould integrate with user investment profile
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould recommend based on learning progress
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould recommend based on similar user behavior
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould handle new users with minimal data
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould return empty array if no suitable recommendations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould limit number of recommendations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould consider user locale for recommendations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould include AI-generated recommendations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould refresh recommendations based on recent activity
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould handle service errors gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould include diversity in recommendations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould prioritize high-match scores
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/recommendations/recommendation.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/recommendations/recommendation.controller.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 15[2mms[22m[39m
[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleInit[2m > [22m[2mshould connect to database on module init
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleInit[2m > [22m[2mshould handle connection failure gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleInit[2m > [22m[2mshould not throw error when database is unavailable
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleDestroy[2m > [22m[2mshould disconnect from database on module destroy
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleDestroy[2m > [22m[2mshould handle disconnection errors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mtransaction handling[2m > [22m[2mshould support Prisma transactions
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mtransaction handling[2m > [22m[2mshould rollback transaction on error
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mtransaction handling[2m > [22m[2mshould support sequential operations in transaction
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2merror handling[2m > [22m[2mshould handle unique constraint violation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2merror handling[2m > [22m[2mshould handle foreign key constraint violation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2merror handling[2m > [22m[2mshould handle record not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mconnection lifecycle[2m > [22m[2mshould allow reconnection after disconnect
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mconnection lifecycle[2m > [22m[2mshould be singleton across module
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support findMany queries
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support findUnique queries
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support create operations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support update operations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support delete operations
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/prisma/prisma.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/prisma/prisma.service.spec.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 179[2mms[22m[39m
[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould adjust learning path after lesson completion
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould handle lesson completion without score
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould increase difficulty for high-performing users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould decrease difficulty for struggling users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould maintain flow state for optimal performance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould recommend break after extended session
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould suggest review for spaced repetition
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould track time efficiency
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould integrate with investment profile risk assessment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould suggest parallel learning paths
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould validate JSONB lesson metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould calculate adaptive difficulty based on success rate
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould provide AI-generated personalized feedback
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/adaptive/adaptive.controller.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 15[2mms[22m[39m
[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39m[31mFailed to load system settings (Reference Error expected if DB not running)[39m
[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2monModuleInit[2m > [22m[2mshould load config on module init in production
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2monModuleInit[2m > [22m[2mshould skip loading config in test environment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2monModuleInit[2m > [22m[2mshould skip loading config when VITEST is set
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould load settings from database
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould cache loaded settings
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould handle database errors gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould log error when database fails
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould retrieve cached config value
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould return default value when key not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould return empty string when no default provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould handle multiple sequential gets
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mConfig Updates[2m > [22m[2mshould reflect new values after reload
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mConfig Updates[2m > [22m[2mshould handle empty settings array
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle settings with special characters
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle settings with empty values
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39mError: Database connection failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\config\dynamic-config.service.spec.ts:98:17
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39m[31mFailed to load system settings (Reference Error expected if DB not running)[39m
[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39mError: Database error
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\config\dynamic-config.service.spec.ts:107:17
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3)
[90mstdout[2m | src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long setting values
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/config/dynamic-config.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/config/dynamic-config.service.spec.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 31[2mms[22m[39m
 [31mâ¯[39m test/integration/recommendation-refresh.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | test/integration/ai-course-flow.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m test/integration/ai-course-flow.e2e-spec.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[90m 12[2mms[22m[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould upload file successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould download file successfully
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to download file: missing.txt[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould throw error when downloading non-existent file
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: File not found: missing.txt
    at UnstorageService.downloadFile [90m(C:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.ts:118:15[90m)[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould delete file successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould check file existence
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to check file existence: test.txt[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould return false when file existence check fails
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Storage error
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.spec.ts:95:51
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3)
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mList Operations[2m > [22m[2mshould list files with prefix
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mList Operations[2m > [22m[2mshould list all files when no prefix provided
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to list files with prefix: test/[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mList Operations[2m > [22m[2mshould throw error when listing fails
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: List error
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.spec.ts:121:51
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3)
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPublic URL Generation[2m > [22m[2mshould generate public URL for fs driver
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPublic URL Generation[2m > [22m[2mshould generate public URL for gcs driver
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPublic URL Generation[2m > [22m[2mshould generate public URL for r2 driver
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPresigned URLs[2m > [22m[2mshould return presigned upload URL placeholder
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPresigned URLs[2m > [22m[2mshould use default expiration time
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to upload file: test.txt[39m
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle upload failure
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Upload failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.spec.ts:181:54
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3)
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle download failure
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to download file: test.txt[39m
[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Download failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.spec.ts:189:54
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3)
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle delete failure
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to delete file: test.txt[39m
[31m[Nest] 7636  - [39m12/21/2025, 9:01:23 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Delete failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\unstorage.service.spec.ts:195:54
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3)
[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mDriver Initialization[2m > [22m[2mshould initialize with fs driver by default
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mDriver Initialization[2m > [22m[2mshould throw error for unsupported driver
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/unstorage.service.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m src/storage/unstorage.service.spec.ts [2m([22m[2m20 tests[22m[2m)[22m[90m 128[2mms[22m[39m
[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould initialize streak if it does not exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould increment streak if last activity was yesterday
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould reward points for 7-day milestone
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould use freeze if streak is broken but freezes are available
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould reset streak if broken and no freezes remaining
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould not update if user already active today
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould update longest streak when current exceeds it
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould unfreeze streak when user becomes active
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould reward for multiple of 7 days (14, 21, etc)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mgetStreak[2m > [22m[2mshould return user streak
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mgetStreak[2m > [22m[2mshould return null if streak does not exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/streak.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/behavior/streak.service.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 66[2mms[22m[39m
[90mstdout[2m | test/integration/behavior-flow.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/integration/behavior-flow.e2e-spec.ts[2m > [22m[2mBehavior & Gamification Integration (e2e)[2m > [22m[2mBehavior Tracking[2m > [22m[2mshould log a user behavior event
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/integration/behavior-flow.e2e-spec.ts[2m > [22m[2mBehavior & Gamification Integration (e2e)[2m > [22m[2mBehavior Tracking[2m > [22m[2mshould retrieve behavior logs for user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/integration/behavior-flow.e2e-spec.ts[2m > [22m[2mBehavior & Gamification Integration (e2e)[2m > [22m[2mGamification & Streaks[2m > [22m[2mshould get current streak
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/integration/behavior-flow.e2e-spec.ts[2m > [22m[2mBehavior & Gamification Integration (e2e)[2m > [22m[2mGamification & Streaks[2m > [22m[2mshould trigger a nudge check (social proof)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/integration/behavior-flow.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m test/integration/behavior-flow.e2e-spec.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 67[2mms[22m[39m
[31m   [31mÃ—[31m Behavior & Gamification Integration (e2e)[2m > [22mBehavior Tracking[2m > [22mshould retrieve behavior logs for user[90m 7[2mms[22m[31m[39m
[31m     â†’ expected 0 to be greater than 0[39m
[31m   [31mÃ—[31m Behavior & Gamification Integration (e2e)[2m > [22mGamification & Streaks[2m > [22mshould trigger a nudge check (social proof)[90m 8[2mms[22m[31m[39m
[31m     â†’ expected {} to have property "type"[39m
 [31mâ¯[39m test/integration/admin-dashboard.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
 [31mâ¯[39m test/integration/user-lifecycle.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mChallenge Creation & Invitation[2m > [22m[2mshould create a challenge and post an announcement from the leader
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mChallenge Creation & Invitation[2m > [22m[2mshould fallback to system user if no leader is found for announcement
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mProgress Tracking & Winner Determination[2m > [22m[2mshould reward all members and delete challenge when target is reached
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mProgress Tracking & Winner Determination[2m > [22m[2mshould fail and delete challenge if expired without reaching target
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mProgress Tracking & Winner Determination[2m > [22m[2mshould do nothing if challenge is neither reached nor expired
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mCompetitive P2P Nudges[2m > [22m[2mshould send push notification to trailing user when someone is leading
[22m[39m[Push Notification] to follower: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch leader 50 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 50 points behind leader. Finish one more lesson to overtake!","zh":"ä½ åªè½å leader 50 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mCompetitive P2P Nudges[2m > [22m[2mshould return null if there are fewer than 2 members
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/challenges.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/challenges.service.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 48[2mms[22m[39m
[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould create VIDEO lesson with localized content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould create READING lesson
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould create QUIZ lesson
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould auto-assign order if not provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould set order to 1 for first lesson in course
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould respect explicitly provided order
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mupdateLesson[2m > [22m[2mshould update lesson content preserving localization
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mupdateLesson[2m > [22m[2mshould allow reordering lessons
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mupdateLesson[2m > [22m[2mshould allow changing lesson type
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mremoveLesson[2m > [22m[2mshould delete lesson
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mlesson ordering[2m > [22m[2mshould maintain sequential order for multiple lessons
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/courses/lessons.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/unit/courses/lessons.service.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 9[2mms[22m[39m
[90mstdout[2m | test/course-progress.integration.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[31m[Nest] 7636  - [39m12/21/2025, 9:01:28 PM [31m  ERROR[39m [38;5;3m[AiService] [39m[31mGEMINI_API_KEY is not defined in environment variables[39m
 [31mâ¯[39m test/course-progress.integration.spec.ts [2m([22m[2m6 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[33m 12261[2mms[22m[39m
[90mstdout[2m | test/course-progress.integration.spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mPipeline: Actions -> BehaviorLog -> Daily Report -> Export CSV[2m > [22m[2mshould complete the full analytics pipeline
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mConversion Funnel: Register -> First Simulation[2m > [22m[2mshould calculate funnel conversion rates correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mReal-time Metrics: Prometheus/WS Updates[2m > [22m[2mshould update Prometheus gauges and emit via WebSocket
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mSegment-based Filtering[2m > [22m[2mshould filter users by behavior segment
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/analytics-reporting.integration.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/analytics-reporting.integration.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 33[2mms[22m[39m
[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetCommunityImpact[2m > [22m[2mshould calculate total community impact correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetCommunityImpact[2m > [22m[2mshould return 0 impact points if aggregate returns null
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetUsersOnline[2m > [22m[2mshould aggregate users online based on recent behavior logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetRecentGlobalAchievements[2m > [22m[2mshould fetch recent global achievements
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mtriggerRealtimeUpdate[2m > [22m[2mshould fetch all stats and emit to gateway
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mHigh-concurrency data updates (Mock)[2m > [22m[2mshould handle multiple simultaneous update requests
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/community-stats.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/community-stats.service.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 45[2mms[22m[39m
[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mshould log an event
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mshould fetch user behaviors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mEvent aggregation by session[2m > [22m[2mshould log events with same session ID
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mJSONB payload handling[2m > [22m[2mshould store complex nested JSONB payload
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mJSONB payload handling[2m > [22m[2mshould handle JSONB deviceInfo
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mHigh-volume event streams[2m > [22m[2mshould handle 100+ events without error
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mHigh-volume event streams[2m > [22m[2mshould handle rapid sequential logging
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mPrivacy filtering[2m > [22m[2mshould allow undefined userId for anonymous tracking
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mPrivacy filtering[2m > [22m[2mshould set default actionCategory to GENERAL if not provided
[22m[39mğŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/behavior/behavior.service.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 55[2mms[22m[39m
[90mstdout[2m | src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mPrivacy filtering[2m > [22m[2mshould set default duration to 0 if not provided
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/behavior/behavior.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mVirtual Portfolio[2m > [22m[2mshould create portfolio if not exists
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mVirtual Portfolio[2m > [22m[2mshould process trade BUY correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mVirtual Portfolio[2m > [22m[2mshould throw error for insufficient balance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mBudget Decision[2m > [22m[2mshould provide feedback for 50/30/20 rule
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mBudget Decision[2m > [22m[2mshould warn for high wants
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mStress Test[2m > [22m[2mshould calculate survival months and emit nudge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mCommitment Devices[2m > [22m[2mshould create a commitment and lock funds
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mCommitment Devices[2m > [22m[2mshould penalize early withdrawal
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mCommitment Devices[2m > [22m[2mshould return full amount for on-time withdrawal
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mLong Term Impact[2m > [22m[2mshould calculate future value and emit nudge
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/simulation/simulation.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/simulation/simulation.service.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 57[2mms[22m[39m
[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould send push notification via SocialService
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould broadcast notification via WebSocket
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould handle notification with empty body
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould handle notification errors gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould send notifications to multiple users
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mWebSocket broadcast validation[2m > [22m[2mshould validate WebSocket room targeting
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mWebSocket broadcast validation[2m > [22m[2mshould handle WebSocket disconnection gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mWebSocket broadcast validation[2m > [22m[2mshould broadcast to group via gateway
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mgetNotifications[2m > [22m[2mshould return empty array for user with no notifications
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mgetNotifications[2m > [22m[2mshould handle invalid userId
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mmarkAsRead[2m > [22m[2mshould mark notification as read
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mmarkAsRead[2m > [22m[2mshould handle invalid notification ID
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in notification content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long notification bodies
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle concurrent notifications
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/notification.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/social/notification.controller.spec.ts [2m([22m[2m16 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[90m 21[2mms[22m[39m
[31m   [31mÃ—[31m NotificationController (C011)[2m > [22msendNotification[2m > [22mshould send push notification via SocialService[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'sendPushNotification')[39m
[31m   [31mÃ—[31m NotificationController (C011)[2m > [22msendNotification[2m > [22mshould broadcast notification via WebSocket[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'sendPushNotification')[39m
[31m   [31mÃ—[31m NotificationController (C011)[2m > [22msendNotification[2m > [22mshould handle notification with empty body[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'sendPushNotification')[39m
[31m   [31mÃ—[31m NotificationController (C011)[2m > [22msendNotification[2m > [22mshould handle notification errors gracefully[90m 2[2mms[22m[31m[39m
[31m     â†’ expected [Function] to throw error including 'Service down' but got 'Cannot read properties of undefined (â€¦'[39m
[31m   [31mÃ—[31m NotificationController (C011)[2m > [22msendNotification[2m > [22mshould send notifications to multiple users[90m 3[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'sendPushNotification')[39m
[31m   [31mÃ—[31m NotificationController (C011)[2m > [22mWebSocket broadcast validation[2m > [22mshould validate WebSocket room targeting[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'sendPushNotification')[39m
[31m   [31mÃ—[31m NotificationController (C011)[2m > [22mEdge Cases[2m > [22mshould handle special characters in notification content[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'sendPushNotification')[39m
[31m   [31mÃ—[31m NotificationController (C011)[2m > [22mEdge Cases[2m > [22mshould handle very long notification bodies[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'sendPushNotification')[39m
[31m   [31mÃ—[31m NotificationController (C011)[2m > [22mEdge Cases[2m > [22mshould handle concurrent notifications[90m 1[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'sendPushNotification')[39m
[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould call next function
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould register finish event listener
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log request method and URL
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log status code
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log response time in milliseconds
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log user agent
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log IP address
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould handle missing user agent
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log content length
[22m[39mğŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/common/logger-middleware.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 4[2mms[22m[39m
[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould handle 404 status codes
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould handle 500 status codes
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/logger-middleware.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage persistence[2m > [22m[2mshould save a message and update thread timestamp
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mchat history retrieval[2m > [22m[2mshould retrieve messages for a thread
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mchat history retrieval[2m > [22m[2mshould return empty list if no messages found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mgroup chat creation[2m > [22m[2mshould create a new group with the creator as leader
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask emails in content
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask names and addresses
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask content before saving
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask content when retrieving history
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mthread management[2m > [22m[2mshould create a thread
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mthread management[2m > [22m[2mshould get user threads
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/chat.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/chat.service.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 65[2mms[22m[39m
[90mstdout[2m | test/massive-stress.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/massive-stress.e2e-spec.ts[2m > [22m[2mMassive Persona Stress Test (1000+ Actions Simulation)
[22m[39mğŸ‘¥ Setting up 50 users...

[90mstdout[2m | test/massive-stress.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m test/massive-stress.e2e-spec.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 9157[2mms[22m[39m
[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return Vietnamese translation by default
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return English translation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return Chinese translation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould replace parameters correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return the key if translation is not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould replace multiple parameters in all locales
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould handle complex parameter replacement
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould fallback to Vietnamese when locale not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould handle nested key lookups
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return key if intermediate path is invalid
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould handle empty parameters object
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould convert non-string parameter values to strings
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return field for specific locale
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould fallback to vi if locale not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return empty string if field is null
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould extract Vietnamese field from JSONB
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould extract Chinese field from JSONB
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould fallback to en if vi is missing
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould handle plain string as-is
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return empty string if field is undefined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return empty string if field is empty object
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould prioritize requested locale over fallbacks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/i18n.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/common/i18n.service.spec.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 4[2mms[22m[39m
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-7BB9BCE535] POST /test-endpoint 400 - {"errorId":"ERR-7BB9BCE535","statusCode":400,"timestamp":"2025-12-21T14:01:46.477Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould generate unique ErrorId for each exception
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould return 500 for non-HTTP exceptions
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould return correct status for HttpException
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould include timestamp in error response
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould include request path in error response
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould provide login suggestion for 401 errors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould provide contact support suggestion for other errors
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould handle complex HttpException message objects
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould log errors with stack trace for 400+ status codes
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould handle string message from HttpException
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mErrorId Generation[2m > [22m[2mshould generate unique ErrorIds for concurrent exceptions
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/filters/all-exceptions.filter.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:39:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-6261637259] POST /test-endpoint 500 - {"errorId":"ERR-6261637259","statusCode":500,"timestamp":"2025-12-21T14:01:46.478Z","path":"/test-endpoint","message":"Internal server error","suggestion":"Please contact support with Error ID"}[39m
Error: Unexpected error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:49:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-817C8A7DAE] POST /test-endpoint 404 - {"errorId":"ERR-817C8A7DAE","statusCode":404,"timestamp":"2025-12-21T14:01:46.479Z","path":"/test-endpoint","message":"Not found","suggestion":"Please contact support with Error ID"}[39m
HttpException: Not found
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:57:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-35DAC1DB0B] POST /test-endpoint 400 - {"errorId":"ERR-35DAC1DB0B","statusCode":400,"timestamp":"2025-12-21T14:01:46.479Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:65:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-F455924CB5] POST /test-endpoint 400 - {"errorId":"ERR-F455924CB5","statusCode":400,"timestamp":"2025-12-21T14:01:46.480Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:75:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-FDE99C94FD] POST /test-endpoint 401 - {"errorId":"ERR-FDE99C94FD","statusCode":401,"timestamp":"2025-12-21T14:01:46.480Z","path":"/test-endpoint","message":"Unauthorized","suggestion":"Please login again"}[39m
HttpException: Unauthorized
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:84:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-D8804E1005] POST /test-endpoint 500 - {"errorId":"ERR-D8804E1005","statusCode":500,"timestamp":"2025-12-21T14:01:46.481Z","path":"/test-endpoint","message":"Server error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Server error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:93:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-10000E3255] POST /test-endpoint 400 - {"errorId":"ERR-10000E3255","statusCode":400,"timestamp":"2025-12-21T14:01:46.481Z","path":"/test-endpoint","message":"Validation failed","suggestion":"Please contact support with Error ID"}[39m
HttpException: Validation failed
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:102:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-F7DD437FDA] POST /test-endpoint 500 - {"errorId":"ERR-F7DD437FDA","statusCode":500,"timestamp":"2025-12-21T14:01:46.487Z","path":"/test-endpoint","message":"Server error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Server error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:115:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-168A5DBA0F] POST /test-endpoint 400 - {"errorId":"ERR-168A5DBA0F","statusCode":400,"timestamp":"2025-12-21T14:01:46.487Z","path":"/test-endpoint","message":"Simple error message","suggestion":"Please contact support with Error ID"}[39m
HttpException: Simple error message
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:127:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-0B0960C7FF] POST /test-endpoint 400 - {"errorId":"ERR-0B0960C7FF","statusCode":400,"timestamp":"2025-12-21T14:01:46.488Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-5EDDDA8B97] POST /test-endpoint 400 - {"errorId":"ERR-5EDDDA8B97","statusCode":400,"timestamp":"2025-12-21T14:01:46.488Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-2FF6D1912C] POST /test-endpoint 400 - {"errorId":"ERR-2FF6D1912C","statusCode":400,"timestamp":"2025-12-21T14:01:46.488Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-15BC6C5EAB] POST /test-endpoint 400 - {"errorId":"ERR-15BC6C5EAB","statusCode":400,"timestamp":"2025-12-21T14:01:46.488Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-AE2D35789D] POST /test-endpoint 400 - {"errorId":"ERR-AE2D35789D","statusCode":400,"timestamp":"2025-12-21T14:01:46.489Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-7FBB0DFDE0] POST /test-endpoint 400 - {"errorId":"ERR-7FBB0DFDE0","statusCode":400,"timestamp":"2025-12-21T14:01:46.489Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-6AADD189EA] POST /test-endpoint 400 - {"errorId":"ERR-6AADD189EA","statusCode":400,"timestamp":"2025-12-21T14:01:46.489Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-1B33D5DF4D] POST /test-endpoint 400 - {"errorId":"ERR-1B33D5DF4D","statusCode":400,"timestamp":"2025-12-21T14:01:46.489Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-62DA32AE11] POST /test-endpoint 400 - {"errorId":"ERR-62DA32AE11","statusCode":400,"timestamp":"2025-12-21T14:01:46.489Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 7636  - [39m12/21/2025, 9:01:46 PM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-9440A13725] POST /test-endpoint 400 - {"errorId":"ERR-9440A13725","statusCode":400,"timestamp":"2025-12-21T14:01:46.489Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
 [32mâœ“[39m src/common/filters/all-exceptions.filter.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 14[2mms[22m[39m
[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mcheckUserAIUsage[2m > [22m[2mshould throw ForbiddenException if rate limit is exceeded
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mcheckUserAIUsage[2m > [22m[2mshould throw ForbiddenException if monthly budget is exceeded
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mcheckUserAIUsage[2m > [22m[2mshould return total tokens used if within limits
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mmaskPII[2m > [22m[2mshould mask email and sensitive fields
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mgenerateResponse[2m > [22m[2mshould return cached response for FAQ if available
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mgenerateResponse[2m > [22m[2mshould generate new response and cache it for FAQ
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mparseActionCards[2m > [22m[2mshould extract action card metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/ai/ai.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/unit/ai/ai.service.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 4[2mms[22m[39m
[90mstdout[2m | test/persona-simulation.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/persona-simulation.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m test/persona-simulation.e2e-spec.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 8155[2mms[22m[39m
[90mstdout[2m | test/auth-profile.integration.spec.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit
ğŸ”§ Vitest setup: Starting MSW mock server...

[31m[Nest] 7636  - [39m12/21/2025, 9:02:03 PM [31m  ERROR[39m [38;5;3m[ExceptionsHandler] [39mPrismaClientInitializationError: 
Invalid `this.prisma.user.findUnique()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\src\users\users.service.ts:11:29

   8 constructor(@Inject(PrismaService) private prisma: PrismaService) {}
   9 
  10 async findOne(email: string): Promise<User | null> {
â†’ 11   return this.prisma.user.findUnique(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.
    at $n.handleRequestError (C:\Users\luaho\Demo project\v-edfinance\node_modules\[4m.pnpm[24m\@prisma+client@5.22.0_prisma@5.22.0\node_modules\[4m@prisma\client[24m\runtime\library.js:121:7615)
    at $n.handleAndLogRequestError (C:\Users\luaho\Demo project\v-edfinance\node_modules\[4m.pnpm[24m\@prisma+client@5.22.0_prisma@5.22.0\node_modules\[4m@prisma\client[24m\runtime\library.js:121:6623)
    at $n.request (C:\Users\luaho\Demo project\v-edfinance\node_modules\[4m.pnpm[24m\@prisma+client@5.22.0_prisma@5.22.0\node_modules\[4m@prisma\client[24m\runtime\library.js:121:6307)
    at l (C:\Users\luaho\Demo project\v-edfinance\node_modules\[4m.pnpm[24m\@prisma+client@5.22.0_prisma@5.22.0\node_modules\[4m@prisma\client[24m\runtime\library.js:130:9633)
    at AuthService.register [90m(C:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\auth\auth.service.ts:169:26[90m)[39m
    at C:\Users\luaho\Demo project\v-edfinance\node_modules\[4m.pnpm[24m\@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm\node_modules\[4m@nestjs\core[24m\router\router-execution-context.js:46:28
    at C:\Users\luaho\Demo project\v-edfinance\node_modules\[4m.pnpm[24m\@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm\node_modules\[4m@nestjs\core[24m\router\router-proxy.js:9:17 {
  clientVersion: [32m'5.22.0'[39m,
  errorCode: [90mundefined[39m
}
[90mstdout[2m | test/auth-profile.integration.spec.ts[2m > [22m[2mAuth & Profile Integration[2m > [22m[2m1. Register â†’ Login â†’ Get Profile
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/auth-profile.integration.spec.ts[2m > [22m[2mAuth & Profile Integration[2m > [22m[2m2. Update Profile (Multi-locale)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/auth-profile.integration.spec.ts[2m > [22m[2mAuth & Profile Integration[2m > [22m[2m3. Change Password
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/auth-profile.integration.spec.ts[2m > [22m[2mAuth & Profile Integration[2m > [22m[2m4. Token Refresh Logic
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:02:07 PM [31m  ERROR[39m [38;5;3m[ExceptionsHandler] [39mPrismaClientInitializationError: Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.
    at t (C:\Users\luaho\Demo project\v-edfinance\node_modules\[4m.pnpm[24m\@prisma+client@5.22.0_prisma@5.22.0\node_modules\[4m@prisma\client[24m\runtime\library.js:112:2488)
    at _r.transaction (C:\Users\luaho\Demo project\v-edfinance\node_modules\[4m.pnpm[24m\@prisma+client@5.22.0_prisma@5.22.0\node_modules\[4m@prisma\client[24m\runtime\library.js:111:11891)
    at Proxy._transactionWithCallback (C:\Users\luaho\Demo project\v-edfinance\node_modules\[4m.pnpm[24m\@prisma+client@5.22.0_prisma@5.22.0\node_modules\[4m@prisma\client[24m\runtime\library.js:130:7924)
    at C:\Users\luaho\Demo project\v-edfinance\node_modules\[4m.pnpm[24m\@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm\node_modules\[4m@nestjs\core[24m\router\router-execution-context.js:46:28
    at C:\Users\luaho\Demo project\v-edfinance\node_modules\[4m.pnpm[24m\@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm\node_modules\[4m@nestjs\core[24m\router\router-proxy.js:9:17 {
  clientVersion: [32m'5.22.0'[39m,
  errorCode: [32m'P1001'[39m
}
[90mstdout[2m | test/auth-profile.integration.spec.ts[2m > [22m[2mAuth & Profile Integration[2m > [22m[2m5. Token Reuse Detection (Security)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/auth-profile.integration.spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m test/auth-profile.integration.spec.ts [2m([22m[2m5 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 16312[2mms[22m[39m
[31m   [31mÃ—[31m Auth & Profile Integration[2m > [22m1. Register â†’ Login â†’ Get Profile[33m 4072[2mms[22m[31m[39m
[31m     â†’ expected 201 "Created", got 500 "Internal Server Error"[39m
[31m   [31mÃ—[31m Auth & Profile Integration[2m > [22m2. Update Profile (Multi-locale)[90m 7[2mms[22m[31m[39m
[31m     â†’ expected 200 "OK", got 401 "Unauthorized"[39m
[31m   [31mÃ—[31m Auth & Profile Integration[2m > [22m3. Change Password[90m 6[2mms[22m[31m[39m
[31m     â†’ expected 200 "OK", got 401 "Unauthorized"[39m
[31m   [31mÃ—[31m Auth & Profile Integration[2m > [22m4. Token Refresh Logic[90m 4[2mms[22m[31m[39m
[31m     â†’ expected 200 "OK", got 400 "Bad Request"[39m
[31m   [31mÃ—[31m Auth & Profile Integration[2m > [22m5. Token Reuse Detection (Security)[33m 4072[2mms[22m[31m[39m
[31m     â†’ expected 401 "Unauthorized", got 500 "Internal Server Error"[39m
[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould validate and transform valid DTO
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould reject invalid email format
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould reject password shorter than 6 characters
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould strip non-whitelisted properties
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mJSONB Schema Validation Integration[2m > [22m[2mshould validate JSONB structure with I18n format
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mJSONB Schema Validation Integration[2m > [22m[2mshould reject malformed JSONB structure
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mCustom Validators[2m > [22m[2mshould validate nested objects
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mCustom Validators[2m > [22m[2mshould handle array validation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle null values
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle undefined values
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty strings
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/validation-pipe.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/common/validation-pipe.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 11[2mms[22m[39m
[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mFeed Generation & Pagination[2m > [22m[2mshould fetch feed with pagination (limit and offset)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mFeed Generation & Pagination[2m > [22m[2mshould include friends activities in the feed
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mLike & Comment Functionality[2m > [22m[2mshould increment likesCount when liking a post
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mLike & Comment Functionality[2m > [22m[2mshould create a behavior log when commenting on a post
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mMulti-user Activity Mocking[2m > [22m[2mshould handle feed from multiple users across different groups
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/activity-feed.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/activity-feed.service.spec.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 36[2mms[22m[39m
[31m[Nest] 7636  - [39m12/21/2025, 9:02:11 PM [31m  ERROR[39m [38;5;3m[StorageService] [39m[31mError uploading to R2[39m
[90mstdout[2m | src/storage/storage.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2muploadFile[2m > [22m[2mshould upload file successfully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2muploadFile[2m > [22m[2mshould throw error if upload fails
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mgetPresignedUrl[2m > [22m[2mshould generate a GET presigned URL
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mgetPresignedUrl[2m > [22m[2mshould generate a PUT presigned URL
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mgetSignedUrl[2m > [22m[2mshould return a presigned GET URL
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:02:11 PM [31m  ERROR[39m [38;5;3m[StorageService] [39mError: Upload failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\storage.service.spec.ts:66:53
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3)
[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle presigned URL generation failure
[22m[39mğŸ§¹ Cleaning up after test...

[31m[Nest] 7636  - [39m12/21/2025, 9:02:11 PM [31m  ERROR[39m [38;5;3m[StorageService] [39m[31mError generating presigned GET URL[39m
[31m[Nest] 7636  - [39m12/21/2025, 9:02:11 PM [31m  ERROR[39m [38;5;3m[StorageService] [39mError: Presigner error
    at [90mC:\Users\luaho\Demo project\v-edfinance\apps\api\[39msrc\storage\storage.service.spec.ts:97:59
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:5
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:11)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3)
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/vitest@2.1.9_@types+node@25.0.3_@vitest+ui@2.1.9_lightningcss@1.30.2_msw@2.12.4_@types+node@2_ebmugipt3toifped36nskz2rti/node_modules/[4mvitest[24m/dist/chunks/runBaseTests.3qpJUEJM.js:126:11
    at withEnv (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/[4m.pnpm[24m/vitest@2.1.9_@types+node@25.0.3_@vitest+ui@2.1.9_lightningcss@1.30.2_msw@2.12.4_@types+node@2_ebmugipt3toifped36nskz2rti/node_modules/[4mvitest[24m/dist/chunks/runBaseTests.3qpJUEJM.js:90:5)
[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mError Handling[2m > [22m[2mshould use custom expiration time for presigned URLs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mConfiguration Fallback[2m > [22m[2mshould fall back to environment variables if ConfigService unavailable
[22m[39mğŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/storage/storage.service.spec.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 107[2mms[22m[39m
[90mstdout[2m | src/storage/storage.service.spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | test/multi-market-stress.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/multi-market-stress.e2e-spec.ts[2m > [22m[2mMulti-Market Market Stress Test (VI/EN/ZH Localized Content)
[22m[39mğŸ‘¥ Setting up 60 users across vi, en, zh...

 [31mâ¯[39m test/multi-market-stress.e2e-spec.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 8145[2mms[22m[39m
[90mstdout[2m | test/multi-market-stress.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleConnection[2m > [22m[2mshould emit connection_established event
[22m[39mClient connected: socket-id
ğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleDisconnect[2m > [22m[2mshould clean up connectedClients and emit user_offline if client was identified
[22m[39mClient disconnected: socket-id
ğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleDisconnect[2m > [22m[2mshould do nothing if client was not identified
[22m[39mClient disconnected: socket-id
ğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleIdentify[2m > [22m[2mshould map userId to socketId and join user room
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleIdentify[2m > [22m[2mshould force disconnect previous connection if same userId connects again
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleJoinGroup[2m > [22m[2mshould join group room
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mBroadcasting methods[2m > [22m[2msendToUser should emit to user room
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mBroadcasting methods[2m > [22m[2mbroadcastToGroup should emit to group room
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mBroadcasting methods[2m > [22m[2mbroadcastNewPost should emit to all
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/social.gateway.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/social.gateway.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 79[2mms[22m[39m
[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when no roles required
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has required role (STUDENT)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has required role (TEACHER)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has required role (ADMIN)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has one of multiple required roles
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould deny access when user lacks required role
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould deny access when user has no role
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould handle multiple required roles (deny if none match)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould extract roles from handler and class metadata
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/roles.guard.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/auth/roles.guard.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 15[2mms[22m[39m
[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mshould return null for unknown context
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mINVESTMENT_DECISION[2m > [22m[2mshould return SOCIAL_PROOF nudge for HUNTER persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mINVESTMENT_DECISION[2m > [22m[2mshould return LOSS_AVERSION nudge for high risk level
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mBUDGETING[2m > [22m[2mshould return GOAL_GRADIENT for SAVER persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mBUDGETING[2m > [22m[2mshould return SALIENCE nudge showing equivalent coffee cups
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mSTREAK_WARNING[2m > [22m[2mshould return GOAL_GRADIENT for streak warning
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle missing user profile gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/nudge/nudge-engine.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/nudge/nudge-engine.service.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[90m 50[2mms[22m[39m
[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mshould extend AuthGuard with jwt strategy
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould call super.canActivate
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject missing authorization header
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject malformed authorization header
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject expired JWT token
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject invalid JWT signature
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mhandleRequest[2m > [22m[2mshould throw UnauthorizedException on error
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mhandleRequest[2m > [22m[2mshould throw UnauthorizedException when user is null
[22m[39mğŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/auth/jwt-auth.guard.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 3[2mms[22m[39m
[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mhandleRequest[2m > [22m[2mshould return user when authentication succeeds
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt-auth.guard.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/analytics/mentor.service.spec.ts[2m > [22m[2mMentorService (Phase 7 Integration Test)[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/mentor.service.spec.ts[2m > [22m[2mMentorService (Phase 7 Integration Test)[2m > [22m[2mshould select STRICT_COACH persona for a HUNTER user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/mentor.service.spec.ts[2m > [22m[2mMentorService (Phase 7 Integration Test)[2m > [22m[2mshould trigger variable reward logic (random chance)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/mentor.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/mentor.service.spec.ts [2m([22m[2m3 tests[22m[2m)[22m[90m 21[2mms[22m[39m
[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mFriend Requests[2m > [22m[2mshould send a friend request
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mFriend Requests[2m > [22m[2mshould accept a friend request
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mFriend Requests[2m > [22m[2mshould reject a friend request
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mBlocking[2m > [22m[2mshould block a user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mBlocking[2m > [22m[2mshould unblock a user
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mActivity Feed[2m > [22m[2mshould get friend activity feed
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/friends.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/social/friends.service.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 52[2mms[22m[39m
[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetTopUsers[2m > [22m[2mshould return top users with formatted names
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetGlobalRanking[2m > [22m[2mshould return correct rank and percentile
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetGlobalRanking[2m > [22m[2mshould throw error if user not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetPeriodicLeaderboard[2m > [22m[2mshould aggregate scores for daily period
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetPeriodicLeaderboard[2m > [22m[2mshould work for weekly period
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetPeriodicLeaderboard[2m > [22m[2mshould work for monthly period
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/leaderboard/leaderboard.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/leaderboard/leaderboard.service.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 61[2mms[22m[39m
[90mstdout[2m | test/integration/auth-flow.e2e-spec.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | test/integration/auth-flow.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/integration/auth-flow.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m test/integration/auth-flow.e2e-spec.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 12201[2mms[22m[39m
[90mstdout[2m | test/system-resilience.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m test/system-resilience.e2e-spec.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[90m 21[2mms[22m[39m
[90mstdout[2m | src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mgenerateAchievementShareLink[2m > [22m[2mshould generate a base64 encoded share link and track the event
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mgetSocialMetaTags[2m > [22m[2mshould generate localized meta tags for an achievement
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mgetSocialMetaTags[2m > [22m[2mshould return default tags if achievement is not found
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mtrackViralLoop[2m > [22m[2mshould log a visit event for the viral loop
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/social/sharing.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m src/modules/social/sharing.service.spec.ts [2m([22m[2m4 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 34[2mms[22m[39m
[31m   [31mÃ—[31m SharingService[2m > [22mgetSocialMetaTags[2m > [22mshould generate localized meta tags for an achievement[90m 9[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'en')[39m
[90mstdout[2m | src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould calculate HIGH churn risk when activity gap is large
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould calculate LOW churn risk when activity gap is small
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould return LOW risk if not enough logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould include persona context in financial simulation
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/predictive.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/analytics/predictive.service.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 28[2mms[22m[39m
[90mstdout[2m | test/social-stress.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mğŸš€ Äang khá»Ÿi táº¡o 500 káº¿t ná»‘i trÃªn port 63798...

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: o1maOt1hDShGmDyzAABC
Client connected: hrWBe9E7GZMxfHraAABD
Client connected: 6vo1LGsuwvSQG1yoAABE
Client connected: cDQdgx49rQWLtDoMAABF
Client connected: ulJg0WWU78Z-HHVCAABG
Client connected: 7VCfD6U1zzfIVXDJAABH
Client connected: 8GJwMXwHGRBU_uRkAABI
Client connected: CDA2eq030XGicr2eAABJ
Client connected: plItb9CiQFVOozjQAABK
Client connected: bUBYxENMaT9Hdx5dAABL
Client connected: xv2mTauduHPRXqyeAABM
Client connected: jcKNP81L-mP5t_2NAABN
Client connected: VVeR3_MIphXS8i_lAABO
Client connected: rsTWJuUNmYNJBAOgAABP
Client connected: HGDb3ARJiOZkIRmUAABQ
Client connected: vmMUEefoKOKLZgioAABR
Client connected: TsbTeVDhR6JTmyQIAABS
Client connected: MdfqDWEmlvfgYGVDAABT
Client connected: nnAY8nzKFWRfVLdBAABU
Client connected: SH3pGrS1W3pMHo2iAABV
Client connected: hWCh68lDEFwWhK1_AABW
Client connected: nhVh82ESYLhd_q1VAABX
Client connected: yNMoFpONPjhaQ-M9AABY
Client connected: l16dWAsWHzkQpwPrAABZ
Client connected: jO57CsjmM5ZIhPn-AABa
Client connected: 7WnOm2zDmieM3RHWAABb
Client connected: 1-ENDxWsCY3I4plfAABc
Client connected: HCx4SvnIy2sw5lTLAABd
Client connected: U5x7TBfQunAdAAOzAABe
Client connected: QQwrF3gM0Buqnf0CAABf
Client connected: GQzDW-WgUWmUueFiAABg
Client connected: eKw6DAx03muxPtebAABh
Client connected: yaBQDjwTf8j0y0emAABi
Client connected: yGpLnDpd41lZkoBpAABj
Client connected: R0Sb_Appu8mQgU1IAABk
Client connected: 2sdKFKMlTKku7Y3BAABl
Client connected: qfVKxZBDA-jT32YqAABm
Client connected: iAsK6HsurTrYOX8CAABn
Client connected: tqtJ-2ez_8YH-kmbAABo
Client connected: cA_lrT4tdY2FGTf2AABp
Client connected: UZh2GZ4tA1Q6MALkAABq
Client connected: vX5JaYTWJImnOjoYAABr
Client connected: -L0s4vUGzbEeL5WFAABs
Client connected: EvluTZeOWHXhjGAEAABt
Client connected: l-KbSZDhFLNfe0DJAABu
Client connected: hQGlduI9wCy_0qG6AABv
Client connected: m54haolLYuvC578WAABw
Client connected: brqFBbIMIzTjayUHAABx
Client connected: aC4vxf-WnNgjtetzAABy
Client connected: CVcRNGMbzyISNz6FAABz

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: PRFjRGepCEVLiFAHAACm
Client connected: qe44uhel5eKWxh31AACn
Client connected: kF3VzPkyox3RYtSVAACo
Client connected: d27E_TGxBqI1jiEGAACp
Client connected: 4zWnqlijbH4HkFjxAACq
Client connected: goJwYK89pEqI5yCvAACr
Client connected: 8uoCqiXzrccbN-urAACs
Client connected: KS9mYko75_7FrMgsAACt
Client connected: o0dWZK9q1uBI_EvAAACu
Client connected: udIFUxunOJhYomIEAACv
Client connected: K6AHscmUHdOipkTaAACw
Client connected: YgKXSXT_hF56XWk8AACx
Client connected: 94avr6lg1mLa2GbDAACy
Client connected: wpqbEljQ7Yoxh_bVAACz
Client connected: mROrLPSf6OypA_s9AAC0
Client connected: heWRYNswrkN-ebmoAAC1
Client connected: z1Daa4KwkRIYXsBrAAC2
Client connected: 103X6QX3pQgEI33pAAC3
Client connected: K9OYWGlb8K168ShWAAC4
Client connected: 8BOqMDVNcjvqENoFAAC5
Client connected: efHVjfVbTAddTdwsAAC6
Client connected: 6aVHJ7QMvDhfPeArAAC7
Client connected: mO46Zm2M4fqSx8p6AAC8
Client connected: EmSRvu6mjrQmN1B2AAC9
Client connected: GpwWKekoh0Yn3POWAAC-
Client connected: pVFzNbCgPQROJPPEAAC_
Client connected: rbH9fylreJd2VZ6OAADA
Client connected: 4yjjMIuW5hcr0z15AADB
Client connected: 79ev72JBCmc5YCsjAADC
Client connected: fxCqZ6uyvNyZlQMOAADD
Client connected: lE87VOmAr12whg7QAADE
Client connected: GN1CAzQaKglzPHJfAADF
Client connected: 15MnWWRA21EWR_TyAADG
Client connected: ET14KdbGMnhrHMDIAADH
Client connected: 5f5VKpZ19IAwWPB2AADI
Client connected: -fCd0CQia6U9mDz5AADJ
Client connected: tv3PH59PJitYxYKeAADK
Client connected: oD6fBsXblmNdL4jpAADL
Client connected: zZ2mQUvROXbtDRJ5AADM
Client connected: Or59xmHUbNp-zYOYAADN
Client connected: LM8-S-W0byxUpqRNAADO
Client connected: Qn9rWvzZlFxRkZbtAADP
Client connected: UAJKIEVDcri-IeEIAADQ
Client connected: UQ_NG2XLCeaVnHRyAADR
Client connected: xR73OFbDIzevCr9AAADS
Client connected: fq-9gsmZv3UWpq-QAADT
Client connected: LYsS1bRWLnQJzVjXAADU
Client connected: ZkqWCLPJT6X6oH-ZAADV
Client connected: 5NRvvW7LgCg3j3OHAADW
Client connected: DImyZlruCjzrr9d3AADX

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: er-0Rv507n8bra2uAAEK
Client connected: CODjFWm4B5s2tAYHAAEL
Client connected: F_PSSTehO5c5jAZQAAEM
Client connected: b5GOUz307T3try2UAAEN
Client connected: KbOyCzmcUXFBhI2cAAEO
Client connected: VtepozqmL8dHeUrVAAEP
Client connected: 9xcIczrRroNDADY8AAEQ
Client connected: CsYJh82detYVXNkiAAER
Client connected: j7Lxb4ee1hhbpPNoAAES
Client connected: htToHqgG9wKvVI_qAAET
Client connected: D7-4u2JkrpGI9uoVAAEU
Client connected: znb8CHIuMGCgCL-GAAEV
Client connected: O2nOAXkzlIIQ08kRAAEW
Client connected: SkrjG3zsiBm0jG8OAAEX
Client connected: -XgZTE-vQiuaiXlOAAEY
Client connected: 3Da5sGHKNEZg_02oAAEZ
Client connected: QTeBWxbyT4KE0X2MAAEa
Client connected: R0lTgnAGN3h8ACN3AAEb
Client connected: VVNHt6AricGZxCgAAAEc
Client connected: DVI1-gMvcFRoDeDfAAEd
Client connected: iQdQYS-qJf7DfHNOAAEe
Client connected: Ut2Z0gl6leba-EdhAAEf
Client connected: 9Ds0ZSW6gvxoyUobAAEg
Client connected: GAKP-6r29PKENynXAAEh
Client connected: KF_JjCiN0bQI6MYKAAEi
Client connected: vELKjkv2W9InuwdVAAEj
Client connected: u2asnryW5DLqkzgzAAEk
Client connected: jYRP2kv9E25LbUHiAAEl
Client connected: V2nziR_flx2i9XfOAAEm
Client connected: 7bzb-BGGnCd6hRyXAAEn
Client connected: Q2mSJ_uBjOslatFsAAEo
Client connected: lJG8_1HijaaPLFI7AAEp
Client connected: EOPEx3rznT6w-b7jAAEq
Client connected: 0aW7Bzvw1EL34dAsAAEr
Client connected: I-nqH8PGj0uQ-UtRAAEs
Client connected: AXWQPIrr4PfJtYf_AAEt
Client connected: WpjNQKzcjdsrnVESAAEu
Client connected: V8bq2zy0ZXAR4hOzAAEv
Client connected: 5Vj_sWJGeoedhPx-AAEw
Client connected: srTy37WTR68eIPsHAAEx
Client connected: QxDFLvoFU4bB8JowAAEy
Client connected: J1cCuiM4Y4n8YaK-AAEz
Client connected: Gnf8EdfsT2YuMeOEAAE0
Client connected: pcCrKeCVV4VdEaMtAAE1
Client connected: QNBJ0XKXxxMNE4XAAAE2
Client connected: vGTyY7IlLdl04BOyAAE3
Client connected: VNUg_mC2sojPLlp1AAE4
Client connected: EYIMvQYVFHyqpDYIAAE5
Client connected: PrQ4qlVw3DBBCG_1AAE6
Client connected: Bk0-BwnTbWedYj2xAAE7

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: 6XD0hLmfPHM9wSquAAFu
Client connected: 6zHfSee0sQP6ZOV2AAFv
Client connected: LgvTu2A1tfrP0wcnAAFw
Client connected: wmjbJwqaV8ydUIUiAAFx
Client connected: 8R8V8nBE22HVJ9adAAFy
Client connected: jHZxzTXhHw00NCjBAAFz
Client connected: RKRsf3Fw-kqv5hx0AAF0
Client connected: QqjXa_J6zCiysx3BAAF1
Client connected: DHY9feG6Zc9D9v8mAAF2
Client connected: NnB7KNPe3bcXHculAAF3
Client connected: BkKdAI-MRB6qhyfwAAF4
Client connected: ORtRU9ouarIc4b18AAF5
Client connected: kpMPgnKkxkSRP04-AAF6
Client connected: D_uWM7aL3VLKxuQ3AAF7
Client connected: _oQVpcMEIaX9TyTJAAF8
Client connected: poJKzkKnnuTxSkgcAAF9
Client connected: 9NRHuCIESuK2WCUWAAF-
Client connected: 1wVlfziM5UYs74QeAAF_
Client connected: PjsuBJ-uu_w5aBUsAAGA
Client connected: ULT-liDbTsAe7FpUAAGB
Client connected: dTibnQRA2HmueGylAAGC
Client connected: iorZIKSsLFQJQdUZAAGD
Client connected: GStrdXgqb1wJ1kwwAAGE
Client connected: WSUMQlH3tDAKqX95AAGF
Client connected: b30cHsvk5qAAqrz7AAGG
Client connected: IuS_v03GsKapxn2EAAGH
Client connected: L48_mgmnbPbMCVRBAAGI
Client connected: Aaqd_g5yCrebmAjDAAGJ
Client connected: h4d0wBbv7el8r4VbAAGK
Client connected: 8Jv6WcwN0UuIoIweAAGL
Client connected: pavUYSpmYEVmEc-sAAGM
Client connected: oSdZ5Kq5lBdycNL9AAGN
Client connected: eIsfCc1t6dzGg917AAGO
Client connected: 23UscKbktrvXjF8pAAGP
Client connected: JBeUsTiHSKMnKdFjAAGQ
Client connected: ZkSBIFl5TtCnR01IAAGR
Client connected: quLRb7_1h4bHjykDAAGS
Client connected: Avd7jO7MLD1UKs6DAAGT
Client connected: tn-8c0z9aMrKZb2JAAGU
Client connected: FiuHI704K7VArPDBAAGV
Client connected: U24bwrbm7GVxlAriAAGW
Client connected: jagkI5YLclKnIDZMAAGX
Client connected: ehx-QjGpRYdAh0viAAGY
Client connected: 7Tv2ZX8KOvByfepfAAGZ
Client connected: xMzycwyPTshx2ox-AAGa
Client connected: U9k13y6qMJT81Z27AAGb
Client connected: KtjHR5-YaSYJ4pQLAAGc
Client connected: aqwEZYBi-g9JylhYAAGd
Client connected: 82w8bbYrzunl_n-rAAGe
Client connected: DfQxo1zMiZCbIPegAAGf

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: 9-DOGTVhVHVSh55lAAHS
Client connected: iOofctK_F8qE-eLHAAHT
Client connected: DVjG8fMK1vunsYKsAAHU
Client connected: yXBLyuoSRC2KbT31AAHV
Client connected: 9XIKZAWwqgOdmQ1nAAHW
Client connected: -5n1MiDXdKjWfLlMAAHX
Client connected: C_8-MRWXiWe6vLhJAAHY
Client connected: 7k6vPg53amD15vYCAAHZ
Client connected: R0P198J5wHJ5yZEIAAHa
Client connected: kjfZlOVu158gyGOMAAHb
Client connected: tLlHlaF-EwPMZhzeAAHc
Client connected: L13LATyw-PESSO-HAAHd
Client connected: PxpHUwFpxO-elhpgAAHe
Client connected: 0b3tdjhc4beAjftoAAHf
Client connected: c_qFisxbBk1LiuIkAAHg
Client connected: bmyIP3v5bya8W_tzAAHh
Client connected: 1LUuoYp9TpWh0OjYAAHi
Client connected: VMKcUD8YJz4X1ml4AAHj
Client connected: NPiam4QXi9YohWmHAAHk
Client connected: 25-UTnCwiN5hCP4PAAHl
Client connected: xtUe828owjeYNUpcAAHm
Client connected: aKqMXN9IDu6tInn1AAHn
Client connected: 1rKA8VkcdrBkr6XnAAHo
Client connected: JuixwgPJmwHeJ3mcAAHp
Client connected: gNHjPOOnYI8aMKH-AAHq
Client connected: s8fNSsPnWNL1r9qSAAHr
Client connected: 1KCLxi0_TyeJF1mrAAHs
Client connected: lcgMocwW7txgw4ygAAHt
Client connected: S860nbS1o9GFxuSEAAHu
Client connected: zyAx7RDECjYoNDZUAAHv
Client connected: _JXW9svhSBhpS89KAAHw
Client connected: kRJ7q-CfU9HjKlBKAAHx
Client connected: 1AxG5u3TwN3UneTwAAHy
Client connected: Oyqx-ZqOEAFVYJ__AAHz
Client connected: gB8YufgAYg63ePslAAH0
Client connected: gKaHkWVF4ZyhVlbYAAH1
Client connected: Wu3Y1psChgZVkpxOAAH2
Client connected: UZxPad6Kkj09H0XMAAH3
Client connected: XDy2z_uaGqNnrhkUAAH4
Client connected: oL-dtJfli05U3UQZAAH5
Client connected: OB7HNwpzrrHUtXvIAAH6
Client connected: kN8LlBiEcGaChoJKAAH7
Client connected: 3M_uOl1hjoE-sZtAAAH8
Client connected: Dl4-z4iv2j2PC9BAAAH9
Client connected: 5CrVd9bVKvWAb7DvAAH-
Client connected: EGaiALEazoYn3gTqAAH_
Client connected: NMd2CNgBtA6A6LNxAAIA
Client connected: 6nDjXkiycIS6MTFfAAIB
Client connected: EpO84ozD5riFE-a2AAIC
Client connected: ICDYLZk62_yFSgfcAAID

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: YyOJCPqHCVW9_q5jAAI2
Client connected: S9ahfJehp3QGge2dAAI3
Client connected: vEO7nqPZu8i1N3VOAAI4
Client connected: XNH51us0OdSXSqABAAI5
Client connected: -hKuTUaoQfEKIlMcAAI6
Client connected: 7w43Bu5SF6GV2qanAAI7
Client connected: d7gTbzFVEy9mDzBXAAI8
Client connected: TBh9FU0gwRp72PXsAAI9
Client connected: mK-nP07_8DaGQEcqAAI-
Client connected: wrDQuBLK5glCx_V4AAI_
Client connected: qVD1IqKGE3Y5i0AfAAJA
Client connected: jdbKFk4JULX51q7GAAJB
Client connected: YfhK-12SJCbRvSZJAAJC
Client connected: gtK1N1Z1uVARDIFJAAJD
Client connected: C7f678HeKQv8IUhyAAJE
Client connected: _JF0N1dsl754r0IJAAJF
Client connected: sOZuPwBgCOynjwVEAAJG
Client connected: C--wFqZkQny0Jn26AAJH
Client connected: kLtOwegH02mBy-YDAAJI
Client connected: srJ8LBYZRiAloEBfAAJJ
Client connected: 0WTsEO3V53GzL4-XAAJK
Client connected: hunud7PWTpLE7_zsAAJL
Client connected: 0yP62WvCBMWqYhQZAAJM
Client connected: uRNPULNcO6Xb_wXWAAJN
Client connected: J_cO9EtepjJo6l7rAAJO
Client connected: hd4em1frzOwSNUqDAAJP
Client connected: 29ByaTJ5hv8HsQ1lAAJQ
Client connected: iR3nNSyrmEnfcvuFAAJR
Client connected: 6GHLMg8D177XbHUpAAJS
Client connected: bhBeJLpXwS36QBcIAAJT
Client connected: MZ1rDhsoMs-Az3ASAAJU
Client connected: cJ7iSnubh8kGXjhgAAJV
Client connected: pxtDG-OBt2eo9xYlAAJW
Client connected: RurEZ_o-Yy6jV-VUAAJX
Client connected: hmkmFNfNqT16rOuvAAJY
Client connected: Rh12pbwclvfiaud7AAJZ
Client connected: 913LRC6NkhC7vIMlAAJa
Client connected: 9EnelyHZZEixCvZMAAJb
Client connected: WvnOrLD9qO6OWlhUAAJc
Client connected: d_oLz9ThuBLczS9VAAJd
Client connected: tGHUr3V6wldUNHsVAAJe
Client connected: IQNXwUYqvpc0pNvyAAJf
Client connected: Tcjy8PfGELmqaft2AAJg
Client connected: cgPOuXgp6Xg-e67DAAJh
Client connected: wE3PBumf5YJXTHP0AAJi
Client connected: Au6gY_HkBHrqtqB1AAJj
Client connected: ZLW822Ug489Wzb7oAAJk
Client connected: DVnWW_os9r9TjmifAAJl
Client connected: NGR7jwvKTrrwjDwdAAJm
Client connected: 83WjT3-CQmfGo15VAAJn

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: slXhXkxLqfu6Ap62AAKa
Client connected: E8dww-kuWXsZ3Zx1AAKb
Client connected: bs7DgmP2lvSuwTUUAAKc
Client connected: pxT66Ur4xjdA9TgWAAKd
Client connected: kccd-G7DcC5b5SG4AAKe
Client connected: cesMSSdpFoKkmBJ4AAKf
Client connected: ZPbkGuj6W7cVrt6jAAKg
Client connected: 1cDns5f6Srmx7XmyAAKh
Client connected: nW4ABdamSjD18Be4AAKi
Client connected: Lx9aFoensbs0rN6hAAKj
Client connected: p4LuHk_82fcJGZXsAAKk
Client connected: NlRZskg0Gzb-2MOgAAKl
Client connected: EkOO3Qzo-W3YotxIAAKm
Client connected: VrsxxJBS2N2wlD7QAAKn
Client connected: uq2QoNRhSH8ySeaLAAKo
Client connected: TbRAnJxoM8ryKlATAAKp
Client connected: 3F19FSzUXK9eDwTGAAKq
Client connected: dEBu1nFXz6hj6bwvAAKr
Client connected: 4cwrIbBfTDB9pNSPAAKs
Client connected: cC-GVnqNsqXudA_nAAKt
Client connected: 1MX0Ca7aYUcRfReVAAKu
Client connected: dfiLzZRS_hG3xvSMAAKv
Client connected: 0IHiB62oQZaIiKVhAAKw
Client connected: 2-sqZyOGUjXu3DxDAAKx
Client connected: mbfT6AhOW3Zi-Wn2AAKy
Client connected: FUcMVlbGBDqiREIBAAKz
Client connected: kGGFR5iMwNPSApMqAAK0
Client connected: d1w_uiso1OOBKtBgAAK1
Client connected: m_0pP3Yv79sHU4myAAK2
Client connected: BDPTvFmig8-amhvpAAK3
Client connected: TcxnPyh6t08cEbDcAAK4
Client connected: E8LnW3t9jAlCma1GAAK5
Client connected: E8Ba-_FZojqI907UAAK6
Client connected: LEX1pKYNcG_Ff5eEAAK7
Client connected: coMXTc-nh130Zpx9AAK8
Client connected: xPxRkHM3FaNctbEaAAK9
Client connected: k-y24MFgEz281gLTAAK-
Client connected: uoLRxML1RNhTfQMyAAK_
Client connected: xwIl00evmnzqDXavAALA
Client connected: QMav2CDt1iy2dTpHAALB
Client connected: 7nU1i-m3gMDlgijFAALC
Client connected: STBBXiZVTVrOn2xwAALD
Client connected: 12QOQi9Oqhyhq_8mAALE
Client connected: o5sVZDt44WeBJ3LqAALF
Client connected: 9VhHCcm55Knr-f4EAALG
Client connected: H5KGNiFzToh0QbEPAALH
Client connected: u4GgD1x4-hCrXfi0AALI
Client connected: 3N8GlqFXiR2UpCwoAALJ
Client connected: CTAdxJtQIxxQyO8KAALK
Client connected: DzXABgNjg8bjsADeAALL

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: GIHPtJj9DZj0rqNWAAL-
Client connected: akkAa60YhEyNQTC3AAL_
Client connected: GyOiTp3HGsMNmoO2AAMA
Client connected: tiXWFCK2QbLZk24yAAMB
Client connected: QOb7Jjo_zdXcCOkWAAMC
Client connected: lQYnzZFdOSVcJaHXAAMD
Client connected: 04t1OqTjzy3YkC1VAAME
Client connected: o2aCZCKxnK0TxY8fAAMF
Client connected: G9ebt0_clpB6eFngAAMG
Client connected: qx4xDnrxu45-mRclAAMH
Client connected: 9JqZFkhawpoMDzDxAAMI
Client connected: Wbi8ti7XIHz0nLguAAMJ
Client connected: 3HYoNGfeFz5U3PYGAAMK
Client connected: aI4yNGziTGoJWp_0AAML
Client connected: IRi0tJF9sdxcp6VMAAMM
Client connected: D6yr4-8kEhsmWSH3AAMN
Client connected: qakvCUvWpYnYcCHeAAMO
Client connected: 5-yKf95E7_cNfJ0PAAMP
Client connected: Jje4y9Ex99HgNkQGAAMQ
Client connected: aJloEhqGvt_WuZA5AAMR
Client connected: M1PGAfJsApCZjrWHAAMS
Client connected: xKrnJRJv3Vi2lAjzAAMT
Client connected: JHmZltbX9d4p_NpTAAMU
Client connected: C2aTfrrCtZWfhwTPAAMV
Client connected: n0mmbJuDWZuRlsxGAAMW
Client connected: MYal0xrsO3x41o1lAAMX
Client connected: MtsrrTljuCOjHUQHAAMY
Client connected: O2RFeV_qQpU_AI2uAAMZ
Client connected: uJZ_7608lU1PSAykAAMa
Client connected: NfLqusS-RmokcKd1AAMb
Client connected: CIqv_w66BmOgfT9jAAMc
Client connected: fTuOw2WFMHO2ErGrAAMd
Client connected: 4IvzOaOElio7W7jUAAMe
Client connected: U8RNpiQKlakzJIBEAAMf
Client connected: VEqpOEtIbObJmtfrAAMg
Client connected: OUlfzHVql0AuvWhWAAMh
Client connected: lVvvv4zoQgY2wKGKAAMi
Client connected: 2FK3cf91ikHvoxR0AAMj
Client connected: M_xgGnLU81w7qh-xAAMk
Client connected: 7N0_VKOCKdrXX6SBAAMl
Client connected: R_lQjbSWthmt7CA1AAMm
Client connected: f5iWh1raCmOghIaBAAMn
Client connected: X4PNvkVunyz8POteAAMo
Client connected: mCLW-nPJqjBeJmFEAAMp
Client connected: mbQW3YdjAxkCTVDeAAMq
Client connected: Z8aHmgQrUjFDYm9qAAMr
Client connected: SpiE4ct9nrIq6wUfAAMs
Client connected: XXUn2EAdjv2UYco_AAMt
Client connected: kLASCw6abb1zI1HRAAMu
Client connected: eZwAii1i9qUmZnhIAAMv

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: AuJIzDnJa1KZILyoAANi
Client connected: Yzp4E6BiSOabphpdAANj
Client connected: I937DHSx9GxhR8D1AANk
Client connected: Bf08uoNbACCsI3gnAANl
Client connected: 38gF6GM5r_5w7EQOAANm
Client connected: d5XXxUN0vey-Kd79AANn
Client connected: TUgEMM7dMHvOGQYkAANo
Client connected: 9z_vDp6qvUMy5RlcAANp
Client connected: fQjo_cfDy-Q8a33bAANq
Client connected: oBJyYNShW3_k_CcUAANr
Client connected: rcpXFyRDmOcBJ4n5AANs
Client connected: uBrxsoGLEVUZKILVAANt
Client connected: 0W7_Hs9ByQaCzil4AANu
Client connected: nEKDMnhMxoUkifWcAANv
Client connected: RiEYNgu6SWk-1S8lAANw
Client connected: f0hTs7VusIGkOnjTAANx
Client connected: 5W5wJSfyX6GjcdigAANy
Client connected: zRBCcU_lyo-8AlckAANz
Client connected: le295FV05yCNOe4fAAN0
Client connected: hVl8XUMs0vvDaLDOAAN1
Client connected: 6Nl1M6y_osD-htvGAAN2
Client connected: 7FnPqPA-b-33zFm8AAN3
Client connected: EyMtd0dCklx051s1AAN4
Client connected: SfZJlFku7nxME2wtAAN5
Client connected: MOELAJqi4iodlnC6AAN6
Client connected: mxFYU26fuL2IiAQLAAN7
Client connected: cRr34L2fYI_cRXi8AAN8
Client connected: S2BXocf2ea-qucWmAAN9
Client connected: K_Obn-zGCpfpwehMAAN-
Client connected: I34VKG8wtiKP683LAAN_
Client connected: eN_s11iwch-HqtplAAOA
Client connected: JloQoQgPErihAr5jAAOB
Client connected: wnVQYwxkVDHGMDY9AAOC
Client connected: Oyk-6s3BR9SD5HZ3AAOD
Client connected: gqSbKP--IyAM6hO6AAOE
Client connected: J2cxJ-6DsjdqmXuXAAOF
Client connected: KcayDjsV-G1-MTgmAAOG
Client connected: Cz_JJaMEj8M6woLEAAOH
Client connected: f0OUNE2q-C5LLMmlAAOI
Client connected: MneiY6zaTfCMS2kLAAOJ
Client connected: 2y4WJMefcB9vz8LeAAOK
Client connected: sombuh9PK14bflvLAAOL
Client connected: P7FJt1TbdO7tOj7dAAOM
Client connected: 4zyaCiXxIpIi_qygAAON
Client connected: QJ7U1Ay8znSTGQFvAAOO
Client connected: k4pyx7Aj9oT7ncXWAAOP
Client connected: 8SMngPH8Bt73P_r5AAOQ
Client connected: 4izFGBFFr9F4x50MAAOR
Client connected: 6GVk_EV38A_AhwyjAAOS
Client connected: DDOYcsYB8NyemhRLAAOT

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: s1dWKGjF9SWmA3uEAAPG
Client connected: 1qVYLjHG8jjcbVnTAAPH
Client connected: r_xV9FVnhbdMYjvqAAPI
Client connected: nlKZhhpPJQidNzH0AAPJ
Client connected: 5eOvqwsVZTaT5yEFAAPK
Client connected: XBU_xjGHdznyeVXVAAPL
Client connected: 6IAYnZ3YdSrDHjOqAAPM
Client connected: g12m8CgKz5YE1CQ9AAPN
Client connected: ebHw6tqif2vqQ82HAAPO
Client connected: T6Kw5bSqThj8LuNnAAPP
Client connected: FvEFq6-eBR9vXBpfAAPQ
Client connected: fpP8jbHmbnH6q1CLAAPR
Client connected: uvxiYkFlNWWzOw8JAAPS
Client connected: kBg3b_3e3CDttkMCAAPT
Client connected: 3aV9QEnZ9PkydMFJAAPU
Client connected: EjxSpz9pKvWfHBgFAAPV
Client connected: Htit0UBOHl3V3uVhAAPW
Client connected: iRv2KAxou-HrRrwLAAPX
Client connected: HXo-Vr8rLH3ZORjEAAPY
Client connected: dvFnxvixhrmFtxLZAAPZ
Client connected: fF8Fq9tZyhMKjIDtAAPa
Client connected: TALB7EaKW-w-rlqWAAPb
Client connected: YJq3uE6DvSBe9t7JAAPc
Client connected: 4wk_iiDLxSANISvzAAPd
Client connected: Bl1Mj1Cj0_lPqKjEAAPe
Client connected: jaL10QQhdRAWC1pmAAPf
Client connected: iqRi3RwSIADEMKraAAPg
Client connected: POp7bTzlUoA_IOtbAAPh
Client connected: 2J1_hhaJOsbu17tbAAPi
Client connected: igWKkfnUlTlUDBCAAAPj
Client connected: pg_HCfz3JEABRkCsAAPk
Client connected: 23vMz7IyjtSs3T4nAAPl
Client connected: wPKWh7g0-ktjp585AAPm
Client connected: fTYH6LOubdLIQa5QAAPn
Client connected: fuPJcuLZAbtwgmF9AAPo
Client connected: KrrOaoQWFm4HO9tEAAPp
Client connected: vr_NU4sETtDz4bh5AAPq
Client connected: 5beiSVesS9X0liIWAAPr
Client connected: qAZG6_x4pW6leCoZAAPs
Client connected: 5s1OxBFeiS5jAKCYAAPt
Client connected: hi0hwTIKhKTJyLsqAAPu
Client connected: W-3JkcCPPjppLSbKAAPv
Client connected: _60thMQRq_mmjryEAAPw
Client connected: vTy1mw00JMraBXCWAAPx
Client connected: j6rdBQyMJ8ESShPRAAPy
Client connected: r9adKfi0ASryvFiwAAPz
Client connected: yImNv2AutPBwr0XAAAP0
Client connected: krY91zwhFxKu3-EDAAP1
Client connected: xLoJVwNPEum74EvEAAP2
Client connected: H-w9SUTPjo6DEFk3AAP3
âœ… ÄÃ£ káº¿t ná»‘i 500 clients.
ğŸ“¢ Testing Broadcast latency...
â±ï¸ Broadcast duration: 16ms
ğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)
[22m[39mClient disconnected: o1maOt1hDShGmDyzAABC
Client disconnected: hrWBe9E7GZMxfHraAABD
Client disconnected: 6vo1LGsuwvSQG1yoAABE
Client disconnected: cDQdgx49rQWLtDoMAABF
Client disconnected: ulJg0WWU78Z-HHVCAABG
Client disconnected: 7VCfD6U1zzfIVXDJAABH
Client disconnected: 8GJwMXwHGRBU_uRkAABI
Client disconnected: CDA2eq030XGicr2eAABJ
Client disconnected: plItb9CiQFVOozjQAABK
Client disconnected: bUBYxENMaT9Hdx5dAABL
Client disconnected: xv2mTauduHPRXqyeAABM
Client disconnected: jcKNP81L-mP5t_2NAABN
Client disconnected: VVeR3_MIphXS8i_lAABO
Client disconnected: rsTWJuUNmYNJBAOgAABP
Client disconnected: HGDb3ARJiOZkIRmUAABQ
Client disconnected: vmMUEefoKOKLZgioAABR
Client disconnected: TsbTeVDhR6JTmyQIAABS
Client disconnected: MdfqDWEmlvfgYGVDAABT
Client disconnected: nnAY8nzKFWRfVLdBAABU
Client disconnected: SH3pGrS1W3pMHo2iAABV
Client disconnected: hWCh68lDEFwWhK1_AABW
Client disconnected: nhVh82ESYLhd_q1VAABX
Client disconnected: yNMoFpONPjhaQ-M9AABY
Client disconnected: l16dWAsWHzkQpwPrAABZ
Client disconnected: jO57CsjmM5ZIhPn-AABa
Client disconnected: 7WnOm2zDmieM3RHWAABb
Client disconnected: 1-ENDxWsCY3I4plfAABc
Client disconnected: HCx4SvnIy2sw5lTLAABd
Client disconnected: U5x7TBfQunAdAAOzAABe
Client disconnected: QQwrF3gM0Buqnf0CAABf
Client disconnected: GQzDW-WgUWmUueFiAABg
Client disconnected: eKw6DAx03muxPtebAABh
Client disconnected: yaBQDjwTf8j0y0emAABi
Client disconnected: yGpLnDpd41lZkoBpAABj
Client disconnected: R0Sb_Appu8mQgU1IAABk
Client disconnected: 2sdKFKMlTKku7Y3BAABl
Client disconnected: qfVKxZBDA-jT32YqAABm
Client disconnected: iAsK6HsurTrYOX8CAABn
Client disconnected: tqtJ-2ez_8YH-kmbAABo
Client disconnected: cA_lrT4tdY2FGTf2AABp
Client disconnected: UZh2GZ4tA1Q6MALkAABq
Client disconnected: vX5JaYTWJImnOjoYAABr
Client disconnected: -L0s4vUGzbEeL5WFAABs
Client disconnected: EvluTZeOWHXhjGAEAABt
Client disconnected: l-KbSZDhFLNfe0DJAABu
Client disconnected: hQGlduI9wCy_0qG6AABv
Client disconnected: m54haolLYuvC578WAABw
Client disconnected: brqFBbIMIzTjayUHAABx
Client disconnected: aC4vxf-WnNgjtetzAABy
Client disconnected: CVcRNGMbzyISNz6FAABz
Client disconnected: PRFjRGepCEVLiFAHAACm
Client disconnected: qe44uhel5eKWxh31AACn
Client disconnected: kF3VzPkyox3RYtSVAACo
Client disconnected: d27E_TGxBqI1jiEGAACp
Client disconnected: 4zWnqlijbH4HkFjxAACq
Client disconnected: goJwYK89pEqI5yCvAACr
Client disconnected: 8uoCqiXzrccbN-urAACs
Client disconnected: KS9mYko75_7FrMgsAACt
Client disconnected: o0dWZK9q1uBI_EvAAACu
Client disconnected: udIFUxunOJhYomIEAACv
Client disconnected: K6AHscmUHdOipkTaAACw
Client disconnected: YgKXSXT_hF56XWk8AACx
Client disconnected: 94avr6lg1mLa2GbDAACy
Client disconnected: wpqbEljQ7Yoxh_bVAACz
Client disconnected: mROrLPSf6OypA_s9AAC0
Client disconnected: heWRYNswrkN-ebmoAAC1
Client disconnected: z1Daa4KwkRIYXsBrAAC2
Client disconnected: 103X6QX3pQgEI33pAAC3
Client disconnected: K9OYWGlb8K168ShWAAC4
Client disconnected: 8BOqMDVNcjvqENoFAAC5
Client disconnected: efHVjfVbTAddTdwsAAC6
Client disconnected: 6aVHJ7QMvDhfPeArAAC7
Client disconnected: mO46Zm2M4fqSx8p6AAC8
Client disconnected: EmSRvu6mjrQmN1B2AAC9
Client disconnected: GpwWKekoh0Yn3POWAAC-
Client disconnected: pVFzNbCgPQROJPPEAAC_
Client disconnected: rbH9fylreJd2VZ6OAADA
Client disconnected: 4yjjMIuW5hcr0z15AADB
Client disconnected: 79ev72JBCmc5YCsjAADC
Client disconnected: fxCqZ6uyvNyZlQMOAADD
Client disconnected: lE87VOmAr12whg7QAADE
Client disconnected: GN1CAzQaKglzPHJfAADF
Client disconnected: 15MnWWRA21EWR_TyAADG
Client disconnected: ET14KdbGMnhrHMDIAADH
Client disconnected: 5f5VKpZ19IAwWPB2AADI
Client disconnected: -fCd0CQia6U9mDz5AADJ
Client disconnected: tv3PH59PJitYxYKeAADK
Client disconnected: oD6fBsXblmNdL4jpAADL
Client disconnected: zZ2mQUvROXbtDRJ5AADM
Client disconnected: Or59xmHUbNp-zYOYAADN
Client disconnected: LM8-S-W0byxUpqRNAADO
Client disconnected: Qn9rWvzZlFxRkZbtAADP
Client disconnected: UAJKIEVDcri-IeEIAADQ
Client disconnected: UQ_NG2XLCeaVnHRyAADR
Client disconnected: xR73OFbDIzevCr9AAADS
Client disconnected: fq-9gsmZv3UWpq-QAADT
Client disconnected: LYsS1bRWLnQJzVjXAADU
Client disconnected: ZkqWCLPJT6X6oH-ZAADV
Client disconnected: 5NRvvW7LgCg3j3OHAADW
Client disconnected: DImyZlruCjzrr9d3AADX
Client disconnected: er-0Rv507n8bra2uAAEK
Client disconnected: CODjFWm4B5s2tAYHAAEL
Client disconnected: F_PSSTehO5c5jAZQAAEM
Client disconnected: b5GOUz307T3try2UAAEN
Client disconnected: KbOyCzmcUXFBhI2cAAEO
Client disconnected: VtepozqmL8dHeUrVAAEP
Client disconnected: 9xcIczrRroNDADY8AAEQ
Client disconnected: CsYJh82detYVXNkiAAER
Client disconnected: j7Lxb4ee1hhbpPNoAAES
Client disconnected: htToHqgG9wKvVI_qAAET
Client disconnected: D7-4u2JkrpGI9uoVAAEU
Client disconnected: znb8CHIuMGCgCL-GAAEV
Client disconnected: O2nOAXkzlIIQ08kRAAEW
Client disconnected: SkrjG3zsiBm0jG8OAAEX
Client disconnected: -XgZTE-vQiuaiXlOAAEY
Client disconnected: 3Da5sGHKNEZg_02oAAEZ
Client disconnected: QTeBWxbyT4KE0X2MAAEa
Client disconnected: R0lTgnAGN3h8ACN3AAEb
Client disconnected: VVNHt6AricGZxCgAAAEc
Client disconnected: DVI1-gMvcFRoDeDfAAEd
Client disconnected: iQdQYS-qJf7DfHNOAAEe
Client disconnected: Ut2Z0gl6leba-EdhAAEf
Client disconnected: 9Ds0ZSW6gvxoyUobAAEg
Client disconnected: GAKP-6r29PKENynXAAEh
Client disconnected: KF_JjCiN0bQI6MYKAAEi
Client disconnected: vELKjkv2W9InuwdVAAEj
Client disconnected: u2asnryW5DLqkzgzAAEk
Client disconnected: jYRP2kv9E25LbUHiAAEl
Client disconnected: V2nziR_flx2i9XfOAAEm
Client disconnected: 7bzb-BGGnCd6hRyXAAEn
Client disconnected: Q2mSJ_uBjOslatFsAAEo
Client disconnected: lJG8_1HijaaPLFI7AAEp
Client disconnected: EOPEx3rznT6w-b7jAAEq
Client disconnected: 0aW7Bzvw1EL34dAsAAEr
Client disconnected: I-nqH8PGj0uQ-UtRAAEs
Client disconnected: AXWQPIrr4PfJtYf_AAEt
Client disconnected: WpjNQKzcjdsrnVESAAEu
Client disconnected: V8bq2zy0ZXAR4hOzAAEv
Client disconnected: 5Vj_sWJGeoedhPx-AAEw
Client disconnected: srTy37WTR68eIPsHAAEx
Client disconnected: QxDFLvoFU4bB8JowAAEy
Client disconnected: J1cCuiM4Y4n8YaK-AAEz
Client disconnected: Gnf8EdfsT2YuMeOEAAE0
Client disconnected: pcCrKeCVV4VdEaMtAAE1
Client disconnected: QNBJ0XKXxxMNE4XAAAE2
Client disconnected: vGTyY7IlLdl04BOyAAE3
Client disconnected: VNUg_mC2sojPLlp1AAE4
Client disconnected: EYIMvQYVFHyqpDYIAAE5
Client disconnected: PrQ4qlVw3DBBCG_1AAE6
Client disconnected: Bk0-BwnTbWedYj2xAAE7
Client disconnected: 6XD0hLmfPHM9wSquAAFu
Client disconnected: 6zHfSee0sQP6ZOV2AAFv
Client disconnected: LgvTu2A1tfrP0wcnAAFw
Client disconnected: wmjbJwqaV8ydUIUiAAFx
Client disconnected: 8R8V8nBE22HVJ9adAAFy
Client disconnected: jHZxzTXhHw00NCjBAAFz
Client disconnected: RKRsf3Fw-kqv5hx0AAF0
Client disconnected: QqjXa_J6zCiysx3BAAF1
Client disconnected: DHY9feG6Zc9D9v8mAAF2
Client disconnected: NnB7KNPe3bcXHculAAF3
Client disconnected: BkKdAI-MRB6qhyfwAAF4
Client disconnected: ORtRU9ouarIc4b18AAF5
Client disconnected: kpMPgnKkxkSRP04-AAF6
Client disconnected: D_uWM7aL3VLKxuQ3AAF7
Client disconnected: _oQVpcMEIaX9TyTJAAF8
Client disconnected: poJKzkKnnuTxSkgcAAF9
Client disconnected: 9NRHuCIESuK2WCUWAAF-
Client disconnected: 1wVlfziM5UYs74QeAAF_
Client disconnected: PjsuBJ-uu_w5aBUsAAGA
Client disconnected: ULT-liDbTsAe7FpUAAGB
Client disconnected: dTibnQRA2HmueGylAAGC
Client disconnected: iorZIKSsLFQJQdUZAAGD
Client disconnected: GStrdXgqb1wJ1kwwAAGE
Client disconnected: WSUMQlH3tDAKqX95AAGF
Client disconnected: b30cHsvk5qAAqrz7AAGG
Client disconnected: IuS_v03GsKapxn2EAAGH
Client disconnected: L48_mgmnbPbMCVRBAAGI
Client disconnected: Aaqd_g5yCrebmAjDAAGJ
Client disconnected: h4d0wBbv7el8r4VbAAGK
Client disconnected: 8Jv6WcwN0UuIoIweAAGL
Client disconnected: pavUYSpmYEVmEc-sAAGM
Client disconnected: oSdZ5Kq5lBdycNL9AAGN
Client disconnected: eIsfCc1t6dzGg917AAGO
Client disconnected: 23UscKbktrvXjF8pAAGP
Client disconnected: JBeUsTiHSKMnKdFjAAGQ
Client disconnected: ZkSBIFl5TtCnR01IAAGR
Client disconnected: quLRb7_1h4bHjykDAAGS
Client disconnected: Avd7jO7MLD1UKs6DAAGT
Client disconnected: tn-8c0z9aMrKZb2JAAGU
Client disconnected: FiuHI704K7VArPDBAAGV
Client disconnected: U24bwrbm7GVxlAriAAGW
Client disconnected: jagkI5YLclKnIDZMAAGX
Client disconnected: ehx-QjGpRYdAh0viAAGY
Client disconnected: 7Tv2ZX8KOvByfepfAAGZ
Client disconnected: xMzycwyPTshx2ox-AAGa
Client disconnected: U9k13y6qMJT81Z27AAGb
Client disconnected: KtjHR5-YaSYJ4pQLAAGc
Client disconnected: aqwEZYBi-g9JylhYAAGd
Client disconnected: 82w8bbYrzunl_n-rAAGe
Client disconnected: DfQxo1zMiZCbIPegAAGf
Client disconnected: 9-DOGTVhVHVSh55lAAHS
Client disconnected: iOofctK_F8qE-eLHAAHT
Client disconnected: DVjG8fMK1vunsYKsAAHU
Client disconnected: yXBLyuoSRC2KbT31AAHV
Client disconnected: 9XIKZAWwqgOdmQ1nAAHW
Client disconnected: -5n1MiDXdKjWfLlMAAHX
Client disconnected: C_8-MRWXiWe6vLhJAAHY
Client disconnected: 7k6vPg53amD15vYCAAHZ
Client disconnected: R0P198J5wHJ5yZEIAAHa
Client disconnected: kjfZlOVu158gyGOMAAHb
Client disconnected: tLlHlaF-EwPMZhzeAAHc
Client disconnected: L13LATyw-PESSO-HAAHd
Client disconnected: PxpHUwFpxO-elhpgAAHe
Client disconnected: 0b3tdjhc4beAjftoAAHf
Client disconnected: c_qFisxbBk1LiuIkAAHg
Client disconnected: bmyIP3v5bya8W_tzAAHh
Client disconnected: 1LUuoYp9TpWh0OjYAAHi
Client disconnected: VMKcUD8YJz4X1ml4AAHj
Client disconnected: NPiam4QXi9YohWmHAAHk
Client disconnected: 25-UTnCwiN5hCP4PAAHl
Client disconnected: xtUe828owjeYNUpcAAHm
Client disconnected: aKqMXN9IDu6tInn1AAHn
Client disconnected: 1rKA8VkcdrBkr6XnAAHo
Client disconnected: JuixwgPJmwHeJ3mcAAHp
Client disconnected: gNHjPOOnYI8aMKH-AAHq
Client disconnected: s8fNSsPnWNL1r9qSAAHr
Client disconnected: 1KCLxi0_TyeJF1mrAAHs
Client disconnected: lcgMocwW7txgw4ygAAHt
Client disconnected: S860nbS1o9GFxuSEAAHu
Client disconnected: zyAx7RDECjYoNDZUAAHv
Client disconnected: _JXW9svhSBhpS89KAAHw
Client disconnected: kRJ7q-CfU9HjKlBKAAHx
Client disconnected: 1AxG5u3TwN3UneTwAAHy
Client disconnected: Oyqx-ZqOEAFVYJ__AAHz
Client disconnected: gB8YufgAYg63ePslAAH0
Client disconnected: gKaHkWVF4ZyhVlbYAAH1
Client disconnected: Wu3Y1psChgZVkpxOAAH2
Client disconnected: UZxPad6Kkj09H0XMAAH3
Client disconnected: XDy2z_uaGqNnrhkUAAH4
Client disconnected: oL-dtJfli05U3UQZAAH5
Client disconnected: OB7HNwpzrrHUtXvIAAH6
Client disconnected: kN8LlBiEcGaChoJKAAH7
Client disconnected: 3M_uOl1hjoE-sZtAAAH8
Client disconnected: Dl4-z4iv2j2PC9BAAAH9
Client disconnected: 5CrVd9bVKvWAb7DvAAH-
Client disconnected: EGaiALEazoYn3gTqAAH_
Client disconnected: NMd2CNgBtA6A6LNxAAIA
Client disconnected: 6nDjXkiycIS6MTFfAAIB
Client disconnected: EpO84ozD5riFE-a2AAIC
Client disconnected: ICDYLZk62_yFSgfcAAID
Client disconnected: YyOJCPqHCVW9_q5jAAI2
Client disconnected: S9ahfJehp3QGge2dAAI3
Client disconnected: vEO7nqPZu8i1N3VOAAI4
Client disconnected: XNH51us0OdSXSqABAAI5
Client disconnected: -hKuTUaoQfEKIlMcAAI6
Client disconnected: 7w43Bu5SF6GV2qanAAI7
Client disconnected: d7gTbzFVEy9mDzBXAAI8
Client disconnected: TBh9FU0gwRp72PXsAAI9
Client disconnected: mK-nP07_8DaGQEcqAAI-
Client disconnected: wrDQuBLK5glCx_V4AAI_
Client disconnected: qVD1IqKGE3Y5i0AfAAJA
Client disconnected: jdbKFk4JULX51q7GAAJB
Client disconnected: YfhK-12SJCbRvSZJAAJC
Client disconnected: gtK1N1Z1uVARDIFJAAJD
Client disconnected: C7f678HeKQv8IUhyAAJE
Client disconnected: _JF0N1dsl754r0IJAAJF
Client disconnected: sOZuPwBgCOynjwVEAAJG
Client disconnected: C--wFqZkQny0Jn26AAJH
Client disconnected: kLtOwegH02mBy-YDAAJI
Client disconnected: srJ8LBYZRiAloEBfAAJJ
Client disconnected: 0WTsEO3V53GzL4-XAAJK
Client disconnected: hunud7PWTpLE7_zsAAJL
Client disconnected: 0yP62WvCBMWqYhQZAAJM
Client disconnected: uRNPULNcO6Xb_wXWAAJN
Client disconnected: J_cO9EtepjJo6l7rAAJO
Client disconnected: hd4em1frzOwSNUqDAAJP
Client disconnected: 29ByaTJ5hv8HsQ1lAAJQ
Client disconnected: iR3nNSyrmEnfcvuFAAJR
Client disconnected: 6GHLMg8D177XbHUpAAJS
Client disconnected: bhBeJLpXwS36QBcIAAJT
Client disconnected: MZ1rDhsoMs-Az3ASAAJU
Client disconnected: cJ7iSnubh8kGXjhgAAJV
Client disconnected: pxtDG-OBt2eo9xYlAAJW
Client disconnected: RurEZ_o-Yy6jV-VUAAJX
Client disconnected: hmkmFNfNqT16rOuvAAJY
Client disconnected: Rh12pbwclvfiaud7AAJZ
Client disconnected: 913LRC6NkhC7vIMlAAJa
Client disconnected: 9EnelyHZZEixCvZMAAJb
Client disconnected: WvnOrLD9qO6OWlhUAAJc
Client disconnected: d_oLz9ThuBLczS9VAAJd
Client disconnected: tGHUr3V6wldUNHsVAAJe
Client disconnected: IQNXwUYqvpc0pNvyAAJf
Client disconnected: Tcjy8PfGELmqaft2AAJg
Client disconnected: cgPOuXgp6Xg-e67DAAJh
Client disconnected: wE3PBumf5YJXTHP0AAJi
Client disconnected: Au6gY_HkBHrqtqB1AAJj
Client disconnected: ZLW822Ug489Wzb7oAAJk
Client disconnected: DVnWW_os9r9TjmifAAJl
Client disconnected: NGR7jwvKTrrwjDwdAAJm
Client disconnected: 83WjT3-CQmfGo15VAAJn
Client disconnected: slXhXkxLqfu6Ap62AAKa
Client disconnected: E8dww-kuWXsZ3Zx1AAKb
Client disconnected: bs7DgmP2lvSuwTUUAAKc
Client disconnected: pxT66Ur4xjdA9TgWAAKd
Client disconnected: kccd-G7DcC5b5SG4AAKe
Client disconnected: cesMSSdpFoKkmBJ4AAKf
Client disconnected: ZPbkGuj6W7cVrt6jAAKg
Client disconnected: 1cDns5f6Srmx7XmyAAKh
Client disconnected: nW4ABdamSjD18Be4AAKi
Client disconnected: Lx9aFoensbs0rN6hAAKj
Client disconnected: p4LuHk_82fcJGZXsAAKk
Client disconnected: NlRZskg0Gzb-2MOgAAKl
Client disconnected: EkOO3Qzo-W3YotxIAAKm
Client disconnected: VrsxxJBS2N2wlD7QAAKn
Client disconnected: uq2QoNRhSH8ySeaLAAKo
Client disconnected: TbRAnJxoM8ryKlATAAKp
Client disconnected: 3F19FSzUXK9eDwTGAAKq
Client disconnected: dEBu1nFXz6hj6bwvAAKr
Client disconnected: 4cwrIbBfTDB9pNSPAAKs
Client disconnected: cC-GVnqNsqXudA_nAAKt
Client disconnected: 1MX0Ca7aYUcRfReVAAKu
Client disconnected: dfiLzZRS_hG3xvSMAAKv
Client disconnected: 0IHiB62oQZaIiKVhAAKw
Client disconnected: 2-sqZyOGUjXu3DxDAAKx
Client disconnected: mbfT6AhOW3Zi-Wn2AAKy
Client disconnected: FUcMVlbGBDqiREIBAAKz
Client disconnected: kGGFR5iMwNPSApMqAAK0
Client disconnected: d1w_uiso1OOBKtBgAAK1
Client disconnected: m_0pP3Yv79sHU4myAAK2
Client disconnected: BDPTvFmig8-amhvpAAK3
Client disconnected: TcxnPyh6t08cEbDcAAK4
Client disconnected: E8LnW3t9jAlCma1GAAK5
Client disconnected: E8Ba-_FZojqI907UAAK6
Client disconnected: LEX1pKYNcG_Ff5eEAAK7
Client disconnected: coMXTc-nh130Zpx9AAK8
Client disconnected: xPxRkHM3FaNctbEaAAK9
Client disconnected: k-y24MFgEz281gLTAAK-
Client disconnected: uoLRxML1RNhTfQMyAAK_
Client disconnected: xwIl00evmnzqDXavAALA
Client disconnected: QMav2CDt1iy2dTpHAALB
Client disconnected: 7nU1i-m3gMDlgijFAALC
Client disconnected: STBBXiZVTVrOn2xwAALD
Client disconnected: 12QOQi9Oqhyhq_8mAALE
Client disconnected: o5sVZDt44WeBJ3LqAALF
Client disconnected: 9VhHCcm55Knr-f4EAALG
Client disconnected: H5KGNiFzToh0QbEPAALH
Client disconnected: u4GgD1x4-hCrXfi0AALI
Client disconnected: 3N8GlqFXiR2UpCwoAALJ
Client disconnected: CTAdxJtQIxxQyO8KAALK
Client disconnected: DzXABgNjg8bjsADeAALL
Client disconnected: GIHPtJj9DZj0rqNWAAL-
Client disconnected: akkAa60YhEyNQTC3AAL_
Client disconnected: GyOiTp3HGsMNmoO2AAMA
Client disconnected: tiXWFCK2QbLZk24yAAMB
Client disconnected: QOb7Jjo_zdXcCOkWAAMC
Client disconnected: lQYnzZFdOSVcJaHXAAMD
Client disconnected: 04t1OqTjzy3YkC1VAAME
Client disconnected: o2aCZCKxnK0TxY8fAAMF
Client disconnected: G9ebt0_clpB6eFngAAMG
Client disconnected: qx4xDnrxu45-mRclAAMH
Client disconnected: 9JqZFkhawpoMDzDxAAMI
Client disconnected: Wbi8ti7XIHz0nLguAAMJ
Client disconnected: 3HYoNGfeFz5U3PYGAAMK
Client disconnected: aI4yNGziTGoJWp_0AAML
Client disconnected: IRi0tJF9sdxcp6VMAAMM
Client disconnected: D6yr4-8kEhsmWSH3AAMN
Client disconnected: qakvCUvWpYnYcCHeAAMO
Client disconnected: 5-yKf95E7_cNfJ0PAAMP
Client disconnected: Jje4y9Ex99HgNkQGAAMQ
Client disconnected: aJloEhqGvt_WuZA5AAMR
Client disconnected: M1PGAfJsApCZjrWHAAMS
Client disconnected: xKrnJRJv3Vi2lAjzAAMT
Client disconnected: JHmZltbX9d4p_NpTAAMU
Client disconnected: C2aTfrrCtZWfhwTPAAMV
Client disconnected: n0mmbJuDWZuRlsxGAAMW
Client disconnected: MYal0xrsO3x41o1lAAMX
Client disconnected: MtsrrTljuCOjHUQHAAMY
Client disconnected: O2RFeV_qQpU_AI2uAAMZ
Client disconnected: uJZ_7608lU1PSAykAAMa
Client disconnected: NfLqusS-RmokcKd1AAMb
Client disconnected: CIqv_w66BmOgfT9jAAMc
Client disconnected: fTuOw2WFMHO2ErGrAAMd
Client disconnected: 4IvzOaOElio7W7jUAAMe
Client disconnected: U8RNpiQKlakzJIBEAAMf
Client disconnected: VEqpOEtIbObJmtfrAAMg
Client disconnected: OUlfzHVql0AuvWhWAAMh
Client disconnected: lVvvv4zoQgY2wKGKAAMi
Client disconnected: 2FK3cf91ikHvoxR0AAMj
Client disconnected: M_xgGnLU81w7qh-xAAMk
Client disconnected: 7N0_VKOCKdrXX6SBAAMl
Client disconnected: R_lQjbSWthmt7CA1AAMm
Client disconnected: f5iWh1raCmOghIaBAAMn
Client disconnected: X4PNvkVunyz8POteAAMo
Client disconnected: mCLW-nPJqjBeJmFEAAMp
Client disconnected: mbQW3YdjAxkCTVDeAAMq
Client disconnected: Z8aHmgQrUjFDYm9qAAMr
Client disconnected: SpiE4ct9nrIq6wUfAAMs
Client disconnected: XXUn2EAdjv2UYco_AAMt
Client disconnected: kLASCw6abb1zI1HRAAMu
Client disconnected: eZwAii1i9qUmZnhIAAMv
Client disconnected: AuJIzDnJa1KZILyoAANi
Client disconnected: Yzp4E6BiSOabphpdAANj
Client disconnected: I937DHSx9GxhR8D1AANk
Client disconnected: Bf08uoNbACCsI3gnAANl
Client disconnected: 38gF6GM5r_5w7EQOAANm
Client disconnected: d5XXxUN0vey-Kd79AANn
Client disconnected: TUgEMM7dMHvOGQYkAANo
Client disconnected: 9z_vDp6qvUMy5RlcAANp
Client disconnected: fQjo_cfDy-Q8a33bAANq
Client disconnected: oBJyYNShW3_k_CcUAANr
Client disconnected: rcpXFyRDmOcBJ4n5AANs
Client disconnected: uBrxsoGLEVUZKILVAANt
Client disconnected: 0W7_Hs9ByQaCzil4AANu
Client disconnected: nEKDMnhMxoUkifWcAANv
Client disconnected: RiEYNgu6SWk-1S8lAANw
Client disconnected: f0hTs7VusIGkOnjTAANx
Client disconnected: 5W5wJSfyX6GjcdigAANy
Client disconnected: zRBCcU_lyo-8AlckAANz
Client disconnected: le295FV05yCNOe4fAAN0
Client disconnected: hVl8XUMs0vvDaLDOAAN1
Client disconnected: 6Nl1M6y_osD-htvGAAN2
Client disconnected: 7FnPqPA-b-33zFm8AAN3
Client disconnected: EyMtd0dCklx051s1AAN4
Client disconnected: SfZJlFku7nxME2wtAAN5
Client disconnected: MOELAJqi4iodlnC6AAN6
Client disconnected: mxFYU26fuL2IiAQLAAN7
Client disconnected: cRr34L2fYI_cRXi8AAN8
Client disconnected: S2BXocf2ea-qucWmAAN9
Client disconnected: K_Obn-zGCpfpwehMAAN-
Client disconnected: I34VKG8wtiKP683LAAN_
Client disconnected: eN_s11iwch-HqtplAAOA
Client disconnected: JloQoQgPErihAr5jAAOB
Client disconnected: wnVQYwxkVDHGMDY9AAOC
Client disconnected: Oyk-6s3BR9SD5HZ3AAOD
Client disconnected: gqSbKP--IyAM6hO6AAOE
Client disconnected: J2cxJ-6DsjdqmXuXAAOF
Client disconnected: KcayDjsV-G1-MTgmAAOG
Client disconnected: Cz_JJaMEj8M6woLEAAOH
Client disconnected: f0OUNE2q-C5LLMmlAAOI
Client disconnected: MneiY6zaTfCMS2kLAAOJ
Client disconnected: 2y4WJMefcB9vz8LeAAOK
Client disconnected: sombuh9PK14bflvLAAOL
Client disconnected: P7FJt1TbdO7tOj7dAAOM
Client disconnected: 4zyaCiXxIpIi_qygAAON
Client disconnected: QJ7U1Ay8znSTGQFvAAOO
Client disconnected: k4pyx7Aj9oT7ncXWAAOP
Client disconnected: 8SMngPH8Bt73P_r5AAOQ
Client disconnected: 4izFGBFFr9F4x50MAAOR
Client disconnected: 6GVk_EV38A_AhwyjAAOS
Client disconnected: DDOYcsYB8NyemhRLAAOT
Client disconnected: s1dWKGjF9SWmA3uEAAPG
Client disconnected: 1qVYLjHG8jjcbVnTAAPH
Client disconnected: r_xV9FVnhbdMYjvqAAPI
Client disconnected: nlKZhhpPJQidNzH0AAPJ
Client disconnected: 5eOvqwsVZTaT5yEFAAPK
Client disconnected: XBU_xjGHdznyeVXVAAPL
Client disconnected: 6IAYnZ3YdSrDHjOqAAPM
Client disconnected: g12m8CgKz5YE1CQ9AAPN
Client disconnected: ebHw6tqif2vqQ82HAAPO
Client disconnected: T6Kw5bSqThj8LuNnAAPP
Client disconnected: FvEFq6-eBR9vXBpfAAPQ
Client disconnected: fpP8jbHmbnH6q1CLAAPR
Client disconnected: uvxiYkFlNWWzOw8JAAPS
Client disconnected: kBg3b_3e3CDttkMCAAPT
Client disconnected: 3aV9QEnZ9PkydMFJAAPU
Client disconnected: EjxSpz9pKvWfHBgFAAPV
Client disconnected: Htit0UBOHl3V3uVhAAPW
Client disconnected: iRv2KAxou-HrRrwLAAPX
Client disconnected: HXo-Vr8rLH3ZORjEAAPY
Client disconnected: dvFnxvixhrmFtxLZAAPZ
Client disconnected: fF8Fq9tZyhMKjIDtAAPa
Client disconnected: TALB7EaKW-w-rlqWAAPb
Client disconnected: YJq3uE6DvSBe9t7JAAPc
Client disconnected: 4wk_iiDLxSANISvzAAPd
Client disconnected: Bl1Mj1Cj0_lPqKjEAAPe
Client disconnected: jaL10QQhdRAWC1pmAAPf
Client disconnected: iqRi3RwSIADEMKraAAPg
Client disconnected: POp7bTzlUoA_IOtbAAPh
Client disconnected: 2J1_hhaJOsbu17tbAAPi
Client disconnected: igWKkfnUlTlUDBCAAAPj
Client disconnected: pg_HCfz3JEABRkCsAAPk
Client disconnected: 23vMz7IyjtSs3T4nAAPl
Client disconnected: wPKWh7g0-ktjp585AAPm
Client disconnected: fTYH6LOubdLIQa5QAAPn
Client disconnected: fuPJcuLZAbtwgmF9AAPo
Client disconnected: KrrOaoQWFm4HO9tEAAPp
Client disconnected: vr_NU4sETtDz4bh5AAPq
Client disconnected: 5beiSVesS9X0liIWAAPr
Client disconnected: qAZG6_x4pW6leCoZAAPs
Client disconnected: 5s1OxBFeiS5jAKCYAAPt
Client disconnected: hi0hwTIKhKTJyLsqAAPu
Client disconnected: W-3JkcCPPjppLSbKAAPv
Client disconnected: _60thMQRq_mmjryEAAPw
Client disconnected: vTy1mw00JMraBXCWAAPx
Client disconnected: j6rdBQyMJ8ESShPRAAPy
Client disconnected: r9adKfi0ASryvFiwAAPz
Client disconnected: yImNv2AutPBwr0XAAAP0
Client disconnected: krY91zwhFxKu3-EDAAP1
Client disconnected: xLoJVwNPEum74EvEAAP2
Client disconnected: H-w9SUTPjo6DEFk3AAP3

[90mstdout[2m | test/social-stress.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m test/social-stress.e2e-spec.ts [2m([22m[2m1 test[22m[2m)[22m[33m 5369[2mms[22m[39m
   [33m[2mâœ“[22m[39m Social Stress Test (1000+ Connections Simulation)[2m > [22mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i [33m1066[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/simulation-bot.spec.ts[2m > [22m[2mBehavioral Simulation (Plan 2)[2m > [22m[2mSimulation: RUSH_USER should trigger STRICT_COACH persona
[22m[39mğŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/analytics/simulation-bot.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 14[2mms[22m[39m
[90mstdout[2m | src/modules/analytics/simulation-bot.spec.ts[2m > [22m[2mBehavioral Simulation (Plan 2)[2m > [22m[2mSimulation: LAZY_USER should trigger SUPPORTIVE_BUDDY persona
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/analytics/simulation-bot.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculatePoints[2m > [22m[2mshould calculate base points with no streak
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculatePoints[2m > [22m[2mshould apply streak bonus correctly
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculatePoints[2m > [22m[2mshould return 0 for unknown actions
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mprocessStreak[2m > [22m[2mshould increment streak if last active was yesterday
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mprocessStreak[2m > [22m[2mshould maintain streak if active today
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mprocessStreak[2m > [22m[2mshould reset streak if last active was before yesterday
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould start at level 1
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould reach level 2 at 100 points
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould reach level 3 at 400 points
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould handle negative points gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcheckBadges[2m > [22m[2mshould return BRONZE_LEARNER when crossing 100 points
[22m[39mğŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/common/gamification-pure.spec.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 2[2mms[22m[39m
[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcheckBadges[2m > [22m[2mshould not return badge if already earned
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcheckBadges[2m > [22m[2mshould return multiple badges if crossing multiple thresholds
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/common/gamification-pure.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mshould be defined
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould extract user from JWT payload
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould handle payload with different role
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould map sub to both id and userId
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould preserve email from payload
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mconstructor[2m > [22m[2mshould use JWT_SECRET from ConfigService
[22m[39mğŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/auth/jwt.strategy.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 8[2mms[22m[39m
[90mstdout[2m | src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mconstructor[2m > [22m[2mshould fallback to dev_secret if ConfigService fails
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/auth/jwt.strategy.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | test/example-usage.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m test/example-usage.e2e-spec.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[90m 19[2mms[22m[39m
[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleSystemHealthCheck[2m > [22m[2mshould run health check and log results
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleSystemHealthCheck[2m > [22m[2mshould handle DB failure gracefully
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetGlobalSystemStats[2m > [22m[2mshould return global stats
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould return OBSERVER for no logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould classify as HUNTER if high risk events predominate
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/analytics/analytics.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/unit/analytics/analytics.service.spec.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 3[2mms[22m[39m
[90mstdout[2m | test/behavioral-stress.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/behavioral-stress.e2e-spec.ts[2m > [22m[2mPHÆ¯Æ NG ÃN 2: Behavioral Stress Test (E2B Inspired)[2m > [22m[2mNÃªn giáº£ láº­p thÃ nh cÃ´ng 50 hÃ nh vi ngÆ°á»i dÃ¹ng mÃ  khÃ´ng cÃ³ lá»—i schema
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/behavioral-stress.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m test/behavioral-stress.e2e-spec.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 4071[2mms[22m[39m
[31m   [31mÃ—[31m PHÆ¯Æ NG ÃN 2: Behavioral Stress Test (E2B Inspired)[2m > [22mNÃªn giáº£ láº­p thÃ nh cÃ´ng 50 hÃ nh vi ngÆ°á»i dÃ¹ng mÃ  khÃ´ng cÃ³ lá»—i schema[33m 4071[2mms[22m[31m[39m
[31m     â†’ 
Invalid `prismaService.user.upsert()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\behavioral-stress.e2e-spec.ts:31:30

  28 
  29 // Äáº£m báº£o user tá»“n táº¡i Ä‘á»ƒ trÃ¡nh vi pháº¡m Foreign Key
  30 // LÆ°u Ã½: Field 'name' khÃ´ng cÃ³ trong User model, thay vÃ o Ä‘Ã³ lÃ  JSONB 'metadata'
â†’ 31 await prismaService.user.upsert(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90mstdout[2m | test/app.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/app.e2e-spec.ts[2m > [22m[2mAppController (e2e)
[22m[39mğŸš€ Starting beforeAll...
ğŸ“¦ Module compiled
ğŸ—ï¸ App created
âœ… App initialized

[90mstdout[2m | test/app.e2e-spec.ts[2m > [22m[2mAppController (e2e)[2m > [22m[2m/ (GET)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/app.e2e-spec.ts[2m > [22m[2mAppController (e2e)
[22m[39mğŸ§¹ Starting afterAll...
ğŸ›‘ App closed

[90mstdout[2m | test/app.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m test/app.e2e-spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 12[2mms[22m[39m
[90mstdout[2m | src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mbuyStreakFreeze[2m > [22m[2mshould successfully buy a streak freeze
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mbuyStreakFreeze[2m > [22m[2mshould throw BadRequestException if user has insufficient points
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mbuyStreakFreeze[2m > [22m[2mshould throw BadRequestException if user does not exist
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mgetStoreItems[2m > [22m[2mshould return list of store items
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/store/store.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/store/store.service.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 29[2mms[22m[39m
[90mstdout[2m | test/guards.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/guards.e2e-spec.ts[2m > [22m[2mGuards (Integration)[2m > [22m[2m/users/profile (GET) - should fail without token
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/guards.e2e-spec.ts[2m > [22m[2mGuards (Integration)[2m > [22m[2m/users/profile (GET) - should succeed with valid token
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/guards.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m test/guards.e2e-spec.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 14[2mms[22m[39m
[90mstdout[2m | src/modules/debug/diagnostic.service.spec.ts[2m > [22m[2mDiagnosticService[2m > [22m[2mrunFullDiagnostics[2m > [22m[2mshould run all diagnostic checks
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.service.spec.ts[2m > [22m[2mDiagnosticService[2m > [22m[2mgenerateMockBehavioralData[2m > [22m[2mshould generate requested number of logs
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/debug/diagnostic.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/modules/debug/diagnostic.service.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 15[2mms[22m[39m
[90mstdout[2m | test/unit/common/gamification.service.spec.ts[2m > [22m[2mGamificationService[2m > [22m[2mlogEvent[2m > [22m[2mshould update user points and create log
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/common/gamification.service.spec.ts[2m > [22m[2mGamificationService[2m > [22m[2mdeductPoints[2m > [22m[2mshould throw error if insufficient points
[22m[39mğŸ§¹ Cleaning up after test...

 [32mâœ“[39m test/unit/common/gamification.service.spec.ts [2m([22m[2m3 tests[22m[2m)[22m[90m 2[2mms[22m[39m
[90mstdout[2m | test/unit/common/gamification.service.spec.ts[2m > [22m[2mGamificationService[2m > [22m[2mdeductPoints[2m > [22m[2mshould deduct points if sufficient
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/common/gamification.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | test/admin-integrity.e2e-spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | test/admin-integrity.e2e-spec.ts[2m > [22m[2mPHÆ¯Æ NG ÃN 3: Admin Integrity Audit[2m > [22m[2mHá»‡ thá»‘ng pháº£i vÆ°á»£t qua bÃ i kiá»ƒm tra tÃ­nh toÃ n váº¹n (Integrity Check)
[22m[39mğŸ” Äang thá»±c hiá»‡n Audit toÃ n bá»™ há»‡ thá»‘ng...

[90mstdout[2m | test/admin-integrity.e2e-spec.ts[2m > [22m[2mPHÆ¯Æ NG ÃN 3: Admin Integrity Audit[2m > [22m[2mHá»‡ thá»‘ng pháº£i vÆ°á»£t qua bÃ i kiá»ƒm tra tÃ­nh toÃ n váº¹n (Integrity Check)
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/admin-integrity.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m test/admin-integrity.e2e-spec.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 16272[2mms[22m[39m
[31m   [31mÃ—[31m PHÆ¯Æ NG ÃN 3: Admin Integrity Audit[2m > [22mHá»‡ thá»‘ng pháº£i vÆ°á»£t qua bÃ i kiá»ƒm tra tÃ­nh toÃ n váº¹n (Integrity Check)[33m 16272[2mms[22m[31m[39m
[31m     â†’ 
Invalid `this.prisma.behaviorLog.count()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\debug\diagnostic.service.ts:94:31

  91 private async collectRealTimeMetrics() {
  92   const last10Min = new Date(Date.now() - 10 * 60 * 1000);
  93   const [behaviorCount, errorCount, nudgeCount] = await Promise.all([
â†’ 94     this.prisma.behaviorLog.count(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90mstdout[2m | test/unit/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould calculate stats correctly
[22m[39mğŸ§¹ Cleaning up after test...

 [32mâœ“[39m test/unit/users/users.service.spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 1[2mms[22m[39m
[90mstdout[2m | test/unit/users/users.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | src/modules/adaptive/adaptive.service.spec.ts[2m > [22m[2mAdaptiveService[2m > [22m[2mshould adjust level up for good performance
[22m[39mğŸ§¹ Cleaning up after test...

 [32mâœ“[39m src/modules/adaptive/adaptive.service.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 12[2mms[22m[39m
[90mstdout[2m | src/modules/adaptive/adaptive.service.spec.ts[2m > [22m[2mAdaptiveService[2m > [22m[2mshould suggest reinforcement for poor performance
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/modules/adaptive/adaptive.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | test/unit/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mlogEvent[2m > [22m[2mshould create a behavior log
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | test/unit/behavior/behavior.service.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m test/unit/behavior/behavior.service.spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 1[2mms[22m[39m
[90mstdout[2m | src/app.controller.spec.ts[2m > [22m[2mAppController[2m > [22m[2mroot[2m > [22m[2mshould return "Hello World!"
[22m[39mğŸ§¹ Cleaning up after test...

[90mstdout[2m | src/app.controller.spec.ts
[22m[39mğŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m src/app.controller.spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 1[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[1m[7m Failed Suites 19 [27m[22mâ¯â¯â¯â¯â¯â¯[39m

[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prisma.refreshToken.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\auth-profile.integration.spec.ts:59:33

  56 
  57 afterAll(async () => {
  58   if (app) {
â†’ 59     await prisma.refreshToken.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m test/auth-profile.integration.spec.ts:[2m59:7[22m[39m
    [90m 57| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m 58| [39m    [35mif[39m (app) {
    [90m 59| [39m      [35mawait[39m prisma[33m.[39mrefreshToken[33m.[39m[34mdeleteMany[39m({
    [90m   | [39m      [31m^[39m
    [90m 60| [39m        where[33m:[39m { user[33m:[39m { email[33m:[39m testUser[33m.[39memail } }[33m,[39m
    [90m 61| [39m      })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/course-progress.integration.spec.ts[2m > [22mCourse Learning Flow (Integration)
[31m[1m[7m FAIL [27m[22m[39m test/course-progress.integration.spec.ts[2m > [22mCourse Learning Flow (Integration)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prisma.chatMessage.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\helpers\test-utils.ts:43:24

  40 export async function cleanupDatabase(): Promise<void> {
  41   await prisma.$transaction([
  42     // Delete child records first
â†’ 43     prisma.chatMessage.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/example-usage.e2e-spec.ts[2m > [22mExample: Test Helpers Usage (E2E)
[31m[1m[7m FAIL [27m[22m[39m test/system-resilience.e2e-spec.ts[2m > [22mSystem Resilience (e2e)
[31m[1mError[22m: Unsupported storage driver: invalid-driver[39m
[36m [2mâ¯[22m UnstorageService.initializeStorage src/storage/unstorage.service.ts:[2m86:15[22m[39m
    [90m 84| [39m
    [90m 85| [39m      [35mdefault[39m[33m:[39m
    [90m 86| [39m        [35mthrow[39m [35mnew[39m [33mError[39m([32m`Unsupported storage driver: [39m[36m${[39m[35mthis[39m[33m.[39mdriver[36m}[39m[32m`[39m)[33m;[39m
    [90m   | [39m              [31m^[39m
    [90m 87| [39m    }
    [90m 88| [39m
[90m [2mâ¯[22m new UnstorageService src/storage/unstorage.service.ts:[2m22:10[22m[39m
[90m [2mâ¯[22m TestingInjector.instantiateClass ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m418:19[22m[39m
[90m [2mâ¯[22m callback ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m70:45[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveConstructorParams ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m170:24[22m[39m
[90m [2mâ¯[22m TestingInjector.loadInstance ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m75:13[22m[39m
[90m [2mâ¯[22m TestingInjector.loadProvider ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m103:9[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m56:13[22m[39m
[90m [2mâ¯[22m TestingInstanceLoader.createInstancesOfProviders ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m55:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/example-usage.e2e-spec.ts[2m > [22mExample: Test Helpers Usage (E2E)
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'close')[39m
[36m [2mâ¯[22m test/example-usage.e2e-spec.ts:[2m41:15[22m[39m
    [90m 39| [39m
    [90m 40| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m 41| [39m    [35mawait[39m app[33m.[39m[34mclose[39m()[33m;[39m
    [90m   | [39m              [31m^[39m
    [90m 42| [39m    [35mawait[39m [34mdisconnectPrisma[39m()[33m;[39m
    [90m 43| [39m  })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/massive-stress.e2e-spec.ts[2m > [22mMassive Persona Stress Test (1000+ Actions Simulation)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.user.upsert()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\massive-stress.e2e-spec.ts:46:32

  43 console.log(`ğŸ‘¥ Setting up ${USER_IDS.length} users...`);
  44 for (const id of USER_IDS) {
  45   const persona = Math.random() > 0.5 ? 'HUNTER' : 'SAVER';
â†’ 46   await prismaService.user.upsert(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m test/massive-stress.e2e-spec.ts:[2m46:7[22m[39m
    [90m 44| [39m    [35mfor[39m ([35mconst[39m id [35mof[39m [33mUSER_IDS[39m) {
    [90m 45| [39m      [35mconst[39m persona [33m=[39m [33mMath[39m[33m.[39m[34mrandom[39m() [33m>[39m [34m0.5[39m [33m?[39m [32m'HUNTER'[39m [33m:[39m [32m'SAVER'[39m[33m;[39m
    [90m 46| [39m      [35mawait[39m prismaService[33m.[39muser[33m.[39m[34mupsert[39m({
    [90m   | [39m      [31m^[39m
    [90m 47| [39m        where[33m:[39m { id }[33m,[39m
    [90m 48| [39m        update[33m:[39m { points[33m:[39m [34m1000[39m }[33m,[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/massive-stress.e2e-spec.ts[2m > [22mMassive Persona Stress Test (1000+ Actions Simulation)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.behaviorLog.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\massive-stress.e2e-spec.ts:129:37

  126 // Small delay to allow pending DB operations to finish
  127 await new Promise((resolve) => setTimeout(resolve, 1000));
  128 
â†’ 129 await prismaService.behaviorLog.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m test/massive-stress.e2e-spec.ts:[2m129:5[22m[39m
    [90m127| [39m    [35mawait[39m [35mnew[39m [33mPromise[39m((resolve) [33m=>[39m [34msetTimeout[39m(resolve[33m,[39m [34m1000[39m))[33m;[39m
    [90m128| [39m
    [90m129| [39m    [35mawait[39m prismaService[33m.[39mbehaviorLog[33m.[39m[34mdeleteMany[39m({
    [90m   | [39m    [31m^[39m
    [90m130| [39m      where[33m:[39m { userId[33m:[39m { [35min[39m[33m:[39m [33mUSER_IDS[39m } }[33m,[39m
    [90m131| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/multi-market-stress.e2e-spec.ts[2m > [22mMulti-Market Market Stress Test (VI/EN/ZH Localized Content)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.user.upsert()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\multi-market-stress.e2e-spec.ts:42:32

  39 console.log(`ğŸ‘¥ Setting up ${USER_IDS.length} users across ${LOCALES.join(', ')}...`);
  40 for (const id of USER_IDS) {
  41   const locale = id.split('-')[2];
â†’ 42   await prismaService.user.upsert(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m test/multi-market-stress.e2e-spec.ts:[2m42:7[22m[39m
    [90m 40| [39m    [35mfor[39m ([35mconst[39m id [35mof[39m [33mUSER_IDS[39m) {
    [90m 41| [39m      [35mconst[39m locale [33m=[39m id[33m.[39m[34msplit[39m([32m'-'[39m)[[34m2[39m][33m;[39m
    [90m 42| [39m      [35mawait[39m prismaService[33m.[39muser[33m.[39m[34mupsert[39m({
    [90m   | [39m      [31m^[39m
    [90m 43| [39m        where[33m:[39m { id }[33m,[39m
    [90m 44| [39m        update[33m:[39m { points[33m:[39m [34m1000[39m }[33m,[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/multi-market-stress.e2e-spec.ts[2m > [22mMulti-Market Market Stress Test (VI/EN/ZH Localized Content)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.behaviorLog.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\multi-market-stress.e2e-spec.ts:116:37

  113 }, 60000);
  114 
  115 afterAll(async () => {
â†’ 116   await prismaService.behaviorLog.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m test/multi-market-stress.e2e-spec.ts:[2m116:5[22m[39m
    [90m114| [39m
    [90m115| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m116| [39m    [35mawait[39m prismaService[33m.[39mbehaviorLog[33m.[39m[34mdeleteMany[39m({
    [90m   | [39m    [31m^[39m
    [90m117| [39m      where[33m:[39m { userId[33m:[39m { [35min[39m[33m:[39m [33mUSER_IDS[39m } }[33m,[39m
    [90m118| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/persona-simulation.e2e-spec.ts[2m > [22mDeep Persona Simulation (Whale vs Risk-Averse)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.user.upsert()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\persona-simulation.e2e-spec.ts:37:30

  34 eventEmitter.on('points.earned', (payload) => nudgeListener.handlePointsEarnedEvent(payload));
  35 
  36 // Setup personas
â†’ 37 await prismaService.user.upsert(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m test/persona-simulation.e2e-spec.ts:[2m37:5[22m[39m
    [90m 35| [39m
    [90m 36| [39m    [90m// Setup personas[39m
    [90m 37| [39m    [35mawait[39m prismaService[33m.[39muser[33m.[39m[34mupsert[39m({
    [90m   | [39m    [31m^[39m
    [90m 38| [39m      where[33m:[39m { id[33m:[39m [33mWHALE_ID[39m }[33m,[39m
    [90m 39| [39m      update[33m:[39m { points[33m:[39m [34m10000[39m }[33m,[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/persona-simulation.e2e-spec.ts[2m > [22mDeep Persona Simulation (Whale vs Risk-Averse)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.behaviorLog.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\persona-simulation.e2e-spec.ts:137:37

  134 });
  135 
  136 afterAll(async () => {
â†’ 137   await prismaService.behaviorLog.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m test/persona-simulation.e2e-spec.ts:[2m137:5[22m[39m
    [90m135| [39m
    [90m136| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m137| [39m    [35mawait[39m prismaService[33m.[39mbehaviorLog[33m.[39m[34mdeleteMany[39m({
    [90m   | [39m    [31m^[39m
    [90m138| [39m      where[33m:[39m { userId[33m:[39m { [35min[39m[33m:[39m [[33mWHALE_ID[39m[33m,[39m [33mSAVER_ID[39m] } }[33m,[39m
    [90m139| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/ai/ai.integration.spec.ts[2m > [22mAI Module - Integration Tests
[31m[1mError[22m: Nest can't resolve dependencies of the AiService (?, PrismaService, CACHE_MANAGER). Please make sure that the argument ConfigService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If ConfigService is a provider, is it part of the current RootTestModule?
- If ConfigService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing ConfigService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[90m [2mâ¯[22m TestingInjector.lookupComponentInParentModules ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m286:19[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveComponentWrapper ../../node_modules/.pnpm/@nestjs+testing@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_r_5vf4xikaifpz6ermp5d5enz4yy/node_modules/@nestjs/testing/testing-injector.js:[2m19:45[22m[39m
[90m [2mâ¯[22m resolveParam ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m140:38[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveConstructorParams ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m169:27[22m[39m
[90m [2mâ¯[22m TestingInjector.loadInstance ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m75:13[22m[39m
[90m [2mâ¯[22m TestingInjector.loadProvider ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m103:9[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m56:13[22m[39m
[90m [2mâ¯[22m TestingInstanceLoader.createInstancesOfProviders ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m55:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/ai/ai.integration.spec.ts[2m > [22mAI Module - Integration Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'chatMessage')[39m
[36m [2mâ¯[22m src/ai/ai.integration.spec.ts:[2m115:18[22m[39m
    [90m113| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m114| [39m    [90m// Cleanup[39m
    [90m115| [39m    [35mawait[39m prisma[33m.[39mchatMessage[33m.[39m[34mdeleteMany[39m()[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m116| [39m    [35mawait[39m prisma[33m.[39mchatThread[33m.[39m[34mdeleteMany[39m()[33m;[39m
    [90m117| [39m    [35mawait[39m prisma[33m.[39mbehaviorLog[33m.[39m[34mdeleteMany[39m({

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/users/users.service.spec.ts[2m [ src/users/users.service.spec.ts ][22m
[31m[1mError[22m:   x await isn't allowed in non-async function
     ,-[C:/Users/luaho/Demo project/v-edfinance/apps/api/src/users/users.service.spec.ts:197:1]
 194 |       });
 195 | 
 196 |       describe('Password Management (S002)', () => {
 197 |       const bcrypt = await import('bcrypt');
     :                      ^^^^^
 198 | 
 199 |       it('should change password with valid old password', async () => {
 200 |       const oldHash = await bcrypt.hash('oldPassword', 10);
     `----


Caused by:
    Syntax Error[39m
  Plugin: [35mswc[39m
  File: [36mC:/Users/luaho/Demo project/v-edfinance/apps/api/src/users/users.service.spec.ts[39m
[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/integration/admin-dashboard.integration.spec.ts[2m [ test/integration/admin-dashboard.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/analytics/analytics.module (resolved id: ../../src/analytics/analytics.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/admin-dashboard.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/integration/ai-course-flow.e2e-spec.ts[2m > [22mAI & Course Integration (e2e)
[31m[1mError[22m: Nest can't resolve dependencies of the GamificationService (PrismaService, ?). Please make sure that the argument EventEmitter at index [1] is available in the CommonModule context.

Potential solutions:
- Is CommonModule a valid NestJS module?
- If EventEmitter is a provider, is it part of the current CommonModule?
- If EventEmitter is exported from a separate @Module, is that module imported within CommonModule?
  @Module({
    imports: [ /* the Module containing EventEmitter */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[90m [2mâ¯[22m TestingInjector.lookupComponentInParentModules ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m286:19[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveComponentWrapper ../../node_modules/.pnpm/@nestjs+testing@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_r_5vf4xikaifpz6ermp5d5enz4yy/node_modules/@nestjs/testing/testing-injector.js:[2m19:45[22m[39m
[90m [2mâ¯[22m resolveParam ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m140:38[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveConstructorParams ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m169:27[22m[39m
[90m [2mâ¯[22m TestingInjector.loadInstance ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m75:13[22m[39m
[90m [2mâ¯[22m TestingInjector.loadProvider ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m103:9[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m56:13[22m[39m
[90m [2mâ¯[22m TestingInstanceLoader.createInstancesOfProviders ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m55:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/integration/auth-flow.e2e-spec.ts[2m > [22mAuth Integration (e2e)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prisma.user.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\integration\auth-flow.e2e-spec.ts:45:23

  42 prisma = app.get<PrismaService>(PrismaService);
  43 
  44 // Clean test data before tests
â†’ 45 await prisma.user.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m test/integration/auth-flow.e2e-spec.ts:[2m45:5[22m[39m
    [90m 43| [39m    
    [90m 44| [39m    [90m// Clean test data before tests[39m
    [90m 45| [39m    [35mawait[39m prisma[33m.[39muser[33m.[39m[34mdeleteMany[39m({
    [90m   | [39m    [31m^[39m
    [90m 46| [39m      where[33m:[39m { email[33m:[39m { contains[33m:[39m [32m'test-integration'[39m } }[33m,[39m
    [90m 47| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[16/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/integration/auth-flow.e2e-spec.ts[2m > [22mAuth Integration (e2e)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prisma.user.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\integration\auth-flow.e2e-spec.ts:52:25

  49 
  50 afterAll(async () => {
  51   if (app) {
â†’ 52     await prisma.user.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m test/integration/auth-flow.e2e-spec.ts:[2m52:7[22m[39m
    [90m 50| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m 51| [39m    [35mif[39m (app) {
    [90m 52| [39m      [35mawait[39m prisma[33m.[39muser[33m.[39m[34mdeleteMany[39m({
    [90m   | [39m      [31m^[39m
    [90m 53| [39m        where[33m:[39m { email[33m:[39m { contains[33m:[39m [32m'test-integration'[39m } }[33m,[39m
    [90m 54| [39m      })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[17/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/integration/disaster-recovery.integration.spec.ts[2m [ test/integration/disaster-recovery.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/health/health.module (resolved id: ../../src/health/health.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/disaster-recovery.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[18/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/integration/multi-device-sync.integration.spec.ts[2m [ test/integration/multi-device-sync.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/websocket/websocket.module (resolved id: ../../src/websocket/websocket.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/multi-device-sync.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[19/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/integration/recommendation-refresh.integration.spec.ts[2m [ test/integration/recommendation-refresh.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/behavior-analytics/behavior-analytics.module (resolved id: ../../src/behavior-analytics/behavior-analytics.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/recommendation-refresh.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[20/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/integration/security-audit-trail.integration.spec.ts[2m [ test/integration/security-audit-trail.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/audit/audit.module (resolved id: ../../src/audit/audit.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/security-audit-trail.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[21/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/integration/user-lifecycle.integration.spec.ts[2m [ test/integration/user-lifecycle.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/social/social.module (resolved id: ../../src/social/social.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/user-lifecycle.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge-scheduler.service.spec.ts[2m [ src/modules/nudge/nudge-scheduler.service.spec.ts ][22m
[31m[1mError[22m: Failed to load url ./nudge-scheduler.service (resolved id: ./nudge-scheduler.service) in C:/Users/luaho/Demo project/v-edfinance/apps/api/src/modules/nudge/nudge-scheduler.service.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[23/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/reward.service.spec.ts[2m [ src/modules/nudge/reward.service.spec.ts ][22m
[31m[1mReferenceError[22m: jest is not defined[39m
[36m [2mâ¯[22m src/modules/nudge/reward.service.spec.ts:[2m21:19[22m[39m
    [90m 19| [39m  [35mconst[39m mockPrisma [33m=[39m {
    [90m 20| [39m    user[33m:[39m {
    [90m 21| [39m      findUnique[33m:[39m jest[33m.[39m[34mfn[39m()[33m,[39m
    [90m   | [39m                  [31m^[39m
    [90m 22| [39m      update[33m:[39m jest[33m.[39m[34mfn[39m()[33m,[39m
    [90m 23| [39m    }[33m,[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[24/237]â¯[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[1m[7m Failed Tests 172 [27m[22mâ¯â¯â¯â¯â¯â¯[39m

[31m[1m[7m FAIL [27m[22m[39m test/admin-integrity.e2e-spec.ts[2m > [22mPHÆ¯Æ NG ÃN 3: Admin Integrity Audit[2m > [22mHá»‡ thá»‘ng pháº£i vÆ°á»£t qua bÃ i kiá»ƒm tra tÃ­nh toÃ n váº¹n (Integrity Check)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `this.prisma.behaviorLog.count()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\debug\diagnostic.service.ts:94:31

  91 private async collectRealTimeMetrics() {
  92   const last10Min = new Date(Date.now() - 10 * 60 * 1000);
  93   const [behaviorCount, errorCount, nudgeCount] = await Promise.all([
â†’ 94     this.prisma.behaviorLog.count(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m DiagnosticService.collectRealTimeMetrics src/modules/debug/diagnostic.service.ts:[2m93:53[22m[39m
    [90m 91| [39m  [35mprivate[39m [35masync[39m [34mcollectRealTimeMetrics[39m() {
    [90m 92| [39m    [35mconst[39m last10Min [33m=[39m [35mnew[39m [33mDate[39m([33mDate[39m[33m.[39m[34mnow[39m() [33m-[39m [34m10[39m [33m*[39m [34m60[39m [33m*[39m [34m1000[39m)[33m;[39m
    [90m 93| [39m    [35mconst[39m [behaviorCount[33m,[39m errorCount[33m,[39m nudgeCount] [33m=[39m [35mawait[39m [33mPromise[39m[33m.[39m[34mall[39m([
    [90m   | [39m                                                    [31m^[39m
    [90m 94| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mbehaviorLog[33m.[39m[34mcount[39m({
    [90m 95| [39m        where[33m:[39m { timestamp[33m:[39m { gte[33m:[39m last10Min } }[33m,[39m
[90m [2mâ¯[22m DiagnosticService.runFullDiagnostics src/modules/debug/diagnostic.service.ts:[2m83:16[22m[39m
[90m [2mâ¯[22m test/admin-integrity.e2e-spec.ts:[2m26:21[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[25/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration[2m > [22m1. Register â†’ Login â†’ Get Profile
[31m[1mError[22m: expected 201 "Created", got 500 "Internal Server Error"[39m
[36m [2mâ¯[22m test/auth-profile.integration.spec.ts:[2m74:8[22m[39m
    [90m 72| [39m      [33m.[39m[34mpost[39m([32m'/auth/register'[39m)
    [90m 73| [39m      [33m.[39m[34msend[39m(testUser)
    [90m 74| [39m      [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m 75| [39m    
    [90m 76| [39m    [34mexpect[39m(regRes[33m.[39mbody[33m.[39maccess_token)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
[90m [2mâ¯[22m Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[26/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration[2m > [22m2. Update Profile (Multi-locale)
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m test/auth-profile.integration.spec.ts:[2m108:8[22m[39m
    [90m106| [39m      [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39maccessToken[36m}[39m[32m`[39m)
    [90m107| [39m      [33m.[39m[34msend[39m({ name[33m:[39m updatedName[33m,[39m preferredLocale[33m:[39m [32m'en'[39m })
    [90m108| [39m      [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m109| [39m
    [90m110| [39m    [90m// Verify DB[39m
[90m [2mâ¯[22m Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[27/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration[2m > [22m3. Change Password
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m test/auth-profile.integration.spec.ts:[2m123:8[22m[39m
    [90m121| [39m      [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39maccessToken[36m}[39m[32m`[39m)
    [90m122| [39m      [33m.[39m[34msend[39m({ oldPassword[33m:[39m testUser[33m.[39mpassword[33m,[39m newPassword })
    [90m123| [39m      [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m124| [39m
    [90m125| [39m    [90m// Verify Login with new password[39m
[90m [2mâ¯[22m Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[28/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration[2m > [22m4. Token Refresh Logic
[31m[1mError[22m: expected 200 "OK", got 400 "Bad Request"[39m
[36m [2mâ¯[22m test/auth-profile.integration.spec.ts:[2m138:8[22m[39m
    [90m136| [39m      [33m.[39m[34mpost[39m([32m'/auth/refresh'[39m)
    [90m137| [39m      [33m.[39m[34msend[39m({ refreshToken[33m:[39m refreshToken })
    [90m138| [39m      [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m139| [39m
    [90m140| [39m    [34mexpect[39m(refreshRes[33m.[39mbody[33m.[39maccess_token)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
[90m [2mâ¯[22m Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[29/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration[2m > [22m5. Token Reuse Detection (Security)
[31m[1mError[22m: expected 401 "Unauthorized", got 500 "Internal Server Error"[39m
[36m [2mâ¯[22m test/auth-profile.integration.spec.ts:[2m156:8[22m[39m
    [90m154| [39m      [33m.[39m[34mpost[39m([32m'/auth/refresh'[39m)
    [90m155| [39m      [33m.[39m[34msend[39m({ refreshToken[33m:[39m [32m'invalid-or-old'[39m })
    [90m156| [39m      [33m.[39m[34mexpect[39m([34m401[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m157| [39m  })[33m;[39m
    [90m158| [39m})[33m;[39m
[90m [2mâ¯[22m Test._assertStatus ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> ../../node_modules/.pnpm/supertest@7.1.4/node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[30/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/behavioral-stress.e2e-spec.ts[2m > [22mPHÆ¯Æ NG ÃN 2: Behavioral Stress Test (E2B Inspired)[2m > [22mNÃªn giáº£ láº­p thÃ nh cÃ´ng 50 hÃ nh vi ngÆ°á»i dÃ¹ng mÃ  khÃ´ng cÃ³ lá»—i schema
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.user.upsert()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\behavioral-stress.e2e-spec.ts:31:30

  28 
  29 // Äáº£m báº£o user tá»“n táº¡i Ä‘á»ƒ trÃ¡nh vi pháº¡m Foreign Key
  30 // LÆ°u Ã½: Field 'name' khÃ´ng cÃ³ trong User model, thay vÃ o Ä‘Ã³ lÃ  JSONB 'metadata'
â†’ 31 await prismaService.user.upsert(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l ../../node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m test/behavioral-stress.e2e-spec.ts:[2m31:5[22m[39m
    [90m 29| [39m    [90m// Äáº£m báº£o user tá»“n táº¡i Ä‘á»ƒ trÃ¡nh vi pháº¡m Foreign Key[39m
    [90m 30| [39m    [90m// LÆ°u Ã½: Field 'name' khÃ´ng cÃ³ trong User model, thay vÃ o Ä‘Ã³ lÃ  J[39mâ€¦
    [90m 31| [39m    [35mawait[39m prismaService[33m.[39muser[33m.[39m[34mupsert[39m({
    [90m   | [39m    [31m^[39m
    [90m 32| [39m      where[33m:[39m { id[33m:[39m userId }[33m,[39m
    [90m 33| [39m      update[33m:[39m {}[33m,[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[31/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/auth/auth.service.spec.ts[2m > [22mAuthService[2m > [22mToken Rotation Edge Cases (S001)[2m > [22mshould reject refresh token exactly at expiry boundary
[31m[1mAssertionError[22m: expected error to be instance of UnauthorizedException[39m

[32m- Expected:[39m 
[Function UnauthorizedException]

[31m+ Received:[39m 
[TypeError: tx.refreshToken.update is not a function]

[36m [2mâ¯[22m src/auth/auth.service.spec.ts:[2m323:13[22m[39m
    [90m321| [39m            prismaService[33m.[39mrefreshToken[33m.[39mfindUnique [33m=[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockResolv[39mâ€¦
    [90m322| [39m
    [90m323| [39m            [35mawait[39m [34mexpect[39m(service[33m.[39m[34mrefreshToken[39m({ refreshToken[33m:[39m [32m'boundar[39mâ€¦
    [90m   | [39m            [31m^[39m
    [90m324| [39m                [33mUnauthorizedException[39m
    [90m325| [39m            )[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[32/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/behavior/behavior.controller.spec.ts[2m > [22mBehaviorController (Gamification)[2m > [22mgetMyHistory - Behavior Analytics[2m > [22mshould throw UnauthorizedException for missing auth
[31m[1mAssertionError[22m: promise resolved "[]" instead of rejecting[39m

[32m- Expected:[39m 
[Error: rejected promise]

[31m+ Received:[39m 
Array []

[36m [2mâ¯[22m src/behavior/behavior.controller.spec.ts:[2m221:59[22m[39m
    [90m219| [39m      [35mconst[39m testController [33m=[39m module[33m.[39m[35mget[39m[33m<[39m[33mBehaviorController[39m[33m>[39m([33mBehaviorCo[39mâ€¦
    [90m220| [39m
    [90m221| [39m      [35mawait[39m [34mexpect[39m(testController[33m.[39m[34mgetMyHistory[39m({ user[33m:[39m {} }))[33m.[39mrejects[33m.[39mâ€¦
    [90m   | [39m                                                          [31m^[39m
    [90m222| [39m        [33mUnauthorizedException[39m
    [90m223| [39m      )[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[33/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/gamification.service.spec.ts[2m > [22mGamificationService (Pure Unit Test)[2m > [22mDeduction Edge Cases (S004)[2m > [22mshould emit deduction event
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[36m [2mâ¯[22m src/common/gamification.service.spec.ts:[2m326:37[22m[39m
    [90m324| [39m
    [90m325| [39m      [35mawait[39m service[33m.[39m[34mdeductPoints[39m([32m'u1'[39m[33m,[39m [34m50[39m[33m,[39m [32m'STORE'[39m)[33m;[39m
    [90m326| [39m      [34mexpect[39m(mockEventEmitter[33m.[39memit)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m327| [39m    })[33m;[39m
    [90m328| [39m  })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[34/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /ready[2m > [22mshould return ready status when DB is connected
[31m[1mAssertionError[22m: expected 'not ready' to be 'ready' // Object.is equality[39m

Expected: [32m"ready"[39m
Received: [31m"[7mnot [27mready"[39m

[36m [2mâ¯[22m src/common/health.controller.spec.ts:[2m132:29[22m[39m
    [90m130| [39m      [35mconst[39m result [33m=[39m [35mawait[39m controller[33m.[39m[34mready[39m()[33m;[39m
    [90m131| [39m
    [90m132| [39m      [34mexpect[39m(result[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'ready'[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m133| [39m      [34mexpect[39m(result[33m.[39mdatabase)[33m.[39m[34mtoBe[39m([32m'connected'[39m)[33m;[39m
    [90m134| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[35/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /ready[2m > [22mshould execute DB connectivity check
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[36m [2mâ¯[22m src/common/health.controller.spec.ts:[2m139:36[22m[39m
    [90m137| [39m      [35mawait[39m controller[33m.[39m[34mready[39m()[33m;[39m
    [90m138| [39m
    [90m139| [39m      [34mexpect[39m(mockPrisma[33m.[39m$queryRaw)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m140| [39m    })[33m;[39m
    [90m141| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[36/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /ready[2m > [22mshould retry on transient failures
[31m[1mAssertionError[22m: expected 'not ready' to be 'ready' // Object.is equality[39m

Expected: [32m"ready"[39m
Received: [31m"[7mnot [27mready"[39m

[36m [2mâ¯[22m src/common/health.controller.spec.ts:[2m168:30[22m[39m
    [90m166| [39m
    [90m167| [39m      [34mexpect[39m(result1[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'not ready'[39m)[33m;[39m
    [90m168| [39m      [34mexpect[39m(result2[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'ready'[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m169| [39m    })[33m;[39m
    [90m170| [39m  })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[37/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return user count
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'user')[39m
[36m [2mâ¯[22m HealthController.metrics src/common/health.controller.spec.ts:[2m39:19[22m[39m
    [90m 37| [39m  [35masync[39m [34mmetrics[39m() {
    [90m 38| [39m    [35mconst[39m [userCount[33m,[39m courseCount[33m,[39m behaviorCount] [33m=[39m [35mawait[39m [33mPromise[39m[33m.[39m[34mall[39m([
    [90m 39| [39m      [35mthis[39m[33m.[39mprisma[33m.[39muser[33m.[39m[34mcount[39m()[33m,[39m
    [90m   | [39m                  [31m^[39m
    [90m 40| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mcourse[33m.[39m[34mcount[39m()[33m,[39m
    [90m 41| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mbehaviorLog[33m.[39m[34mcount[39m()[33m,[39m
[90m [2mâ¯[22m src/common/health.controller.spec.ts:[2m174:39[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[38/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return course count
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'user')[39m
[36m [2mâ¯[22m HealthController.metrics src/common/health.controller.spec.ts:[2m39:19[22m[39m
    [90m 37| [39m  [35masync[39m [34mmetrics[39m() {
    [90m 38| [39m    [35mconst[39m [userCount[33m,[39m courseCount[33m,[39m behaviorCount] [33m=[39m [35mawait[39m [33mPromise[39m[33m.[39m[34mall[39m([
    [90m 39| [39m      [35mthis[39m[33m.[39mprisma[33m.[39muser[33m.[39m[34mcount[39m()[33m,[39m
    [90m   | [39m                  [31m^[39m
    [90m 40| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mcourse[33m.[39m[34mcount[39m()[33m,[39m
    [90m 41| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mbehaviorLog[33m.[39m[34mcount[39m()[33m,[39m
[90m [2mâ¯[22m src/common/health.controller.spec.ts:[2m180:39[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[39/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return behavior log count
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'user')[39m
[36m [2mâ¯[22m HealthController.metrics src/common/health.controller.spec.ts:[2m39:19[22m[39m
    [90m 37| [39m  [35masync[39m [34mmetrics[39m() {
    [90m 38| [39m    [35mconst[39m [userCount[33m,[39m courseCount[33m,[39m behaviorCount] [33m=[39m [35mawait[39m [33mPromise[39m[33m.[39m[34mall[39m([
    [90m 39| [39m      [35mthis[39m[33m.[39mprisma[33m.[39muser[33m.[39m[34mcount[39m()[33m,[39m
    [90m   | [39m                  [31m^[39m
    [90m 40| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mcourse[33m.[39m[34mcount[39m()[33m,[39m
    [90m 41| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mbehaviorLog[33m.[39m[34mcount[39m()[33m,[39m
[90m [2mâ¯[22m src/common/health.controller.spec.ts:[2m186:39[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[40/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return timestamp
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'user')[39m
[36m [2mâ¯[22m HealthController.metrics src/common/health.controller.spec.ts:[2m39:19[22m[39m
    [90m 37| [39m  [35masync[39m [34mmetrics[39m() {
    [90m 38| [39m    [35mconst[39m [userCount[33m,[39m courseCount[33m,[39m behaviorCount] [33m=[39m [35mawait[39m [33mPromise[39m[33m.[39m[34mall[39m([
    [90m 39| [39m      [35mthis[39m[33m.[39mprisma[33m.[39muser[33m.[39m[34mcount[39m()[33m,[39m
    [90m   | [39m                  [31m^[39m
    [90m 40| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mcourse[33m.[39m[34mcount[39m()[33m,[39m
    [90m 41| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mbehaviorLog[33m.[39m[34mcount[39m()[33m,[39m
[90m [2mâ¯[22m src/common/health.controller.spec.ts:[2m192:39[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[41/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould fetch all metrics in parallel
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'user')[39m
[36m [2mâ¯[22m HealthController.metrics src/common/health.controller.spec.ts:[2m39:19[22m[39m
    [90m 37| [39m  [35masync[39m [34mmetrics[39m() {
    [90m 38| [39m    [35mconst[39m [userCount[33m,[39m courseCount[33m,[39m behaviorCount] [33m=[39m [35mawait[39m [33mPromise[39m[33m.[39m[34mall[39m([
    [90m 39| [39m      [35mthis[39m[33m.[39mprisma[33m.[39muser[33m.[39m[34mcount[39m()[33m,[39m
    [90m   | [39m                  [31m^[39m
    [90m 40| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mcourse[33m.[39m[34mcount[39m()[33m,[39m
    [90m 41| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mbehaviorLog[33m.[39m[34mcount[39m()[33m,[39m
[90m [2mâ¯[22m src/common/health.controller.spec.ts:[2m199:24[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[42/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould handle zero counts
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'user')[39m
[36m [2mâ¯[22m HealthController.metrics src/common/health.controller.spec.ts:[2m39:19[22m[39m
    [90m 37| [39m  [35masync[39m [34mmetrics[39m() {
    [90m 38| [39m    [35mconst[39m [userCount[33m,[39m courseCount[33m,[39m behaviorCount] [33m=[39m [35mawait[39m [33mPromise[39m[33m.[39m[34mall[39m([
    [90m 39| [39m      [35mthis[39m[33m.[39mprisma[33m.[39muser[33m.[39m[34mcount[39m()[33m,[39m
    [90m   | [39m                  [31m^[39m
    [90m 40| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mcourse[33m.[39m[34mcount[39m()[33m,[39m
    [90m 41| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mbehaviorLog[33m.[39m[34mcount[39m()[33m,[39m
[90m [2mâ¯[22m src/common/health.controller.spec.ts:[2m213:39[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[43/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould handle large counts
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'user')[39m
[36m [2mâ¯[22m HealthController.metrics src/common/health.controller.spec.ts:[2m39:19[22m[39m
    [90m 37| [39m  [35masync[39m [34mmetrics[39m() {
    [90m 38| [39m    [35mconst[39m [userCount[33m,[39m courseCount[33m,[39m behaviorCount] [33m=[39m [35mawait[39m [33mPromise[39m[33m.[39m[34mall[39m([
    [90m 39| [39m      [35mthis[39m[33m.[39mprisma[33m.[39muser[33m.[39m[34mcount[39m()[33m,[39m
    [90m   | [39m                  [31m^[39m
    [90m 40| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mcourse[33m.[39m[34mcount[39m()[33m,[39m
    [90m 41| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mbehaviorLog[33m.[39m[34mcount[39m()[33m,[39m
[90m [2mâ¯[22m src/common/health.controller.spec.ts:[2m224:39[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[44/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mDB Connectivity[2m > [22mshould verify Prisma connection
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ ArrayContaining ["SELECT 1"] ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m src/common/health.controller.spec.ts:[2m235:36[22m[39m
    [90m233| [39m      [35mawait[39m controller[33m.[39m[34mready[39m()[33m;[39m
    [90m234| [39m
    [90m235| [39m      [34mexpect[39m(mockPrisma[33m.[39m$queryRaw)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                                   [31m^[39m
    [90m236| [39m        expect[33m.[39m[34marrayContaining[39m([[32m'SELECT 1'[39m])
    [90m237| [39m      )[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[45/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mService Status[2m > [22mshould indicate healthy service
[31m[1mAssertionError[22m: expected 'not ready' to be 'ready' // Object.is equality[39m

Expected: [32m"ready"[39m
Received: [31m"[7mnot [27mready"[39m

[36m [2mâ¯[22m src/common/health.controller.spec.ts:[2m263:28[22m[39m
    [90m261| [39m
    [90m262| [39m      [34mexpect[39m(health[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'ok'[39m)[33m;[39m
    [90m263| [39m      [34mexpect[39m(ready[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'ready'[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m264| [39m    })[33m;[39m
    [90m265| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[46/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mError Handling[2m > [22mshould handle metrics query failures
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Query failed' but got 'Cannot read properties of undefined (â€¦'[39m

Expected: [32m"Query failed"[39m
Received: [31m"Cannot read properties of undefined (reading 'user')"[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[47/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/storage/storage.controller.spec.ts[2m > [22mStorageController (C013)[2m > [22mConcurrent Uploads[2m > [22mshould generate unique keys for concurrent uploads
[31m[1mAssertionError[22m: expected 'uploads/1766325680527-same.jpg' not to be 'uploads/1766325680527-same.jpg' // Object.is equality[39m
[36m [2mâ¯[22m src/storage/storage.controller.spec.ts:[2m268:31[22m[39m
    [90m266| [39m      ])[33m;[39m
    [90m267| [39m
    [90m268| [39m      [34mexpect[39m(result1[33m.[39mkey)[33m.[39mnot[33m.[39m[34mtoBe[39m(result2[33m.[39mkey)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m269| [39m    })[33m;[39m
    [90m270| [39m  })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[48/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/users/users.controller.spec.ts[2m > [22mUsersController[2m > [22mgetProfile[2m > [22mshould throw UnauthorizedException when userId is missing
[31m[1mAssertionError[22m: expected error to be instance of UnauthorizedException[39m

[32m- Expected:[39m 
[Function UnauthorizedException]

[31m+ Received:[39m 
[NotFoundException: User not found]

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[49/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/users/users.controller.spec.ts[2m > [22mUsersController[2m > [22mupdateInvestmentProfile[2m > [22mshould handle partial updates
[31m[1mReferenceError[22m: mockInvestmentProfile is not defined[39m
[36m [2mâ¯[22m src/users/users.controller.spec.ts:[2m171:30[22m[39m
    [90m169| [39m    [34mit[39m([32m'should handle partial updates'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m170| [39m      [35mconst[39m partialDto [33m=[39m { riskTolerance[33m:[39m [32m'CONSERVATIVE'[39m }[33m;[39m
    [90m171| [39m      [35mconst[39m updatedProfile [33m=[39m { [33m...[39mmockInvestmentProfile[33m,[39m [33m...[39mpartialDtoâ€¦
    [90m   | [39m                             [31m^[39m
    [90m172| [39m      mockUsersService[33m.[39mupdateInvestmentProfile[33m.[39m[34mmockResolvedValue[39m(updatâ€¦
    [90m173| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[50/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/integration/behavior-flow.e2e-spec.ts[2m > [22mBehavior & Gamification Integration (e2e)[2m > [22mBehavior Tracking[2m > [22mshould retrieve behavior logs for user
[31m[1mAssertionError[22m: expected 0 to be greater than 0[39m
[36m [2mâ¯[22m test/integration/behavior-flow.e2e-spec.ts:[2m185:36[22m[39m
    [90m183| [39m
    [90m184| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(response[33m.[39mbody))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m185| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mlength)[33m.[39m[34mtoBeGreaterThan[39m([34m0[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m186| [39m    })[33m;[39m
    [90m187| [39m  })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[51/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m test/integration/behavior-flow.e2e-spec.ts[2m > [22mBehavior & Gamification Integration (e2e)[2m > [22mGamification & Streaks[2m > [22mshould trigger a nudge check (social proof)
[31m[1mAssertionError[22m: expected {} to have property "type"[39m
[36m [2mâ¯[22m test/integration/behavior-flow.e2e-spec.ts:[2m212:31[22m[39m
    [90m210| [39m      [90m// Nudge might be null if no triggers meet criteria, but the end[39mâ€¦
    [90m211| [39m      [35mif[39m (response[33m.[39mbody) {
    [90m212| [39m        [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'type'[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m213| [39m        [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'content'[39m)[33m;[39m
    [90m214| [39m      }

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[52/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22mAdaptiveDifficultyService[2m > [22mDifficulty Adjustment Algorithms[2m > [22madjustLearningPath[2m > [22mshould handle score of 0
[31m[1mAssertionError[22m: expected 'STAY' to be 'REINFORCE' // Object.is equality[39m

Expected: [32m"REINFORCE"[39m
Received: [31m"STAY"[39m

[36m [2mâ¯[22m src/modules/ai/adaptive-difficulty.service.spec.ts:[2m153:35[22m[39m
    [90m151| [39m        })[33m;[39m
    [90m152| [39m
    [90m153| [39m        [34mexpect[39m(result[33m.[39madjustment)[33m.[39m[34mtoBe[39m([32m'REINFORCE'[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m154| [39m      })[33m;[39m
    [90m155| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[53/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould return cached response on cache hit for GENERAL_FAQ
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse src/ai/ai.service.ts:[2m218:20[22m[39m
[90m [2mâ¯[22m src/modules/ai/ai-cache.service.spec.ts:[2m79:22[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[54/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould make AI call on cache miss for GENERAL_FAQ
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m src/modules/ai/ai-cache.service.spec.ts:[2m122:22[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[55/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould skip cache for PERSONALIZED_ADVICE queries
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m src/modules/ai/ai-cache.service.spec.ts:[2m165:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[56/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mTTL Expiration[2m > [22mshould set cache with 24-hour TTL for FAQ responses
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m src/modules/ai/ai-cache.service.spec.ts:[2m229:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[57/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mTTL Expiration[2m > [22mshould handle expired cache gracefully (cache miss scenario)
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m src/modules/ai/ai-cache.service.spec.ts:[2m270:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[58/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Invalidation[2m > [22mshould re-cache response after invalidation
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m src/modules/ai/ai-cache.service.spec.ts:[2m330:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[59/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mEdge Cases & Error Handling[2m > [22mshould save both user and assistant messages when cache hit occurs
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse src/ai/ai.service.ts:[2m218:20[22m[39m
[90m [2mâ¯[22m src/modules/ai/ai-cache.service.spec.ts:[2m490:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[60/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mEdge Cases & Error Handling[2m > [22mshould track token usage in behavior logs after AI call
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m src/modules/ai/ai-cache.service.spec.ts:[2m576:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[61/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould increment strike count for HIGH severity violations
[31m[1mInternalServerErrorException[22m: Moderation API error[39m
[36m [2mâ¯[22m ModerationService.moderateContent src/modules/ai/moderation.service.ts:[2m99:13[22m[39m
    [90m 97| [39m      }
    [90m 98| [39m
    [90m 99| [39m      [35mthrow[39m [35mnew[39m [33mInternalServerErrorException[39m([32m'Moderation API error'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m100| [39m    }
    [90m101| [39m  }
[90m [2mâ¯[22m src/modules/ai/moderation.service.spec.ts:[2m482:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[62/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould ban user after 3 CRITICAL violations
[31m[1mAssertionError[22m: expected error to be instance of ForbiddenException[39m

[32m- Expected:[39m 
[Function ForbiddenException]

[31m+ Received:[39m 
[InternalServerErrorException: Moderation API error]

[36m [2mâ¯[22m src/modules/ai/moderation.service.spec.ts:[2m506:9[22m[39m
    [90m504| [39m        })[33m;[39m
    [90m505| [39m
    [90m506| [39m        [35mawait[39m [34mexpect[39m(
    [90m   | [39m        [31m^[39m
    [90m507| [39m          service[33m.[39m[34mmoderateContent[39m(content[33m,[39m [32m'user-29'[39m[33m,[39m [32m'en'[39m[33m,[39m { enforceSâ€¦
    [90m508| [39m        )[33m.[39mrejects[33m.[39m[34mtoThrow[39m([33mForbiddenException[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[63/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould not count LOW severity towards strikes
[31m[1mInternalServerErrorException[22m: Moderation API error[39m
[36m [2mâ¯[22m ModerationService.moderateContent src/modules/ai/moderation.service.ts:[2m99:13[22m[39m
    [90m 97| [39m      }
    [90m 98| [39m
    [90m 99| [39m      [35mthrow[39m [35mnew[39m [33mInternalServerErrorException[39m([32m'Moderation API error'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m100| [39m    }
    [90m101| [39m  }
[90m [2mâ¯[22m src/modules/ai/moderation.service.spec.ts:[2m520:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[64/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock OpenAI Moderation API response
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[39m

[32m- Expected:[39m 
false

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/modules/ai/moderation.service.spec.ts:[2m624:32[22m[39m
    [90m622| [39m        [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mmoderateContent[39m(content[33m,[39m [32m'user-36[39mâ€¦
    [90m623| [39m
    [90m624| [39m        [34mexpect[39m(result[33m.[39mflagged)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m625| [39m      })[33m;[39m
    [90m626| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[65/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock Google Perspective API response
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[39m

[32m- Expected:[39m 
false

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/modules/ai/moderation.service.spec.ts:[2m642:32[22m[39m
    [90m640| [39m        [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mmoderateContent[39m(content[33m,[39m [32m'user-37[39mâ€¦
    [90m641| [39m
    [90m642| [39m        [34mexpect[39m(result[33m.[39mflagged)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m643| [39m      })[33m;[39m
    [90m644| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[66/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock custom Gemini Moderation API
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[39m

[32m- Expected:[39m 
false

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m src/modules/ai/moderation.service.spec.ts:[2m658:32[22m[39m
    [90m656| [39m        [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mmoderateContent[39m(content[33m,[39m [32m'user-38[39mâ€¦
    [90m657| [39m
    [90m658| [39m        [34mexpect[39m(result[33m.[39mflagged)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m659| [39m      })[33m;[39m
    [90m660| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[67/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/ab-testing.service.spec.ts[2m > [22mABTestingService - A/B Testing Framework[2m > [22mVariant Assignment[2m > [22mshould distribute variants according to weight ratios
[31m[1mAssertionError[22m: expected 0.882 to be less than 0.75[39m
[36m [2mâ¯[22m src/modules/analytics/ab-testing.service.spec.ts:[2m268:28[22m[39m
    [90m266| [39m
    [90m267| [39m      [34mexpect[39m(controlRatio)[33m.[39m[34mtoBeGreaterThan[39m([34m0.65[39m)[33m;[39m
    [90m268| [39m      [34mexpect[39m(controlRatio)[33m.[39m[34mtoBeLessThan[39m([34m0.75[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m269| [39m    })[33m;[39m
    [90m270| [39m  })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[68/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mhandleLogAggregation[2m > [22mshould handle empty log set gracefully
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[36m [2mâ¯[22m src/modules/analytics/analytics.service.spec.ts:[2m135:49[22m[39m
    [90m133| [39m      [35mawait[39m service[33m.[39m[34mhandleLogAggregation[39m()[33m;[39m
    [90m134| [39m
    [90m135| [39m      [34mexpect[39m(mockPrisma[33m.[39mbehaviorLog[33m.[39mdeleteMany)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                                [31m^[39m
    [90m136| [39m    })[33m;[39m
    [90m137| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[69/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mhandleLogAggregation[2m > [22mshould delete logs older than 30 days
[31m[1mTypeError[22m: Cannot read properties of undefined (reading '0')[39m
[36m [2mâ¯[22m src/modules/analytics/analytics.service.spec.ts:[2m144:71[22m[39m
    [90m142| [39m      [35mawait[39m service[33m.[39m[34mhandleLogAggregation[39m()[33m;[39m
    [90m143| [39m
    [90m144| [39m      [35mconst[39m callArgs [33m=[39m mockPrisma[33m.[39mbehaviorLog[33m.[39mdeleteMany[33m.[39mmock[33m.[39mcalls[[34m0[39m]â€¦
    [90m   | [39m                                                                      [31m^[39m
    [90m145| [39m      [34mexpect[39m(callArgs[33m.[39mwhere[33m.[39mtimestamp[33m.[39mlt)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m146| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[70/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mBehavior Log Archiving[2m > [22mshould archive logs in batches based on age threshold
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m src/modules/analytics/analytics.service.spec.ts:[2m273:49[22m[39m
    [90m271| [39m      [35mawait[39m service[33m.[39m[34mhandleLogAggregation[39m()[33m;[39m
    [90m272| [39m
    [90m273| [39m      [34mexpect[39m(mockPrisma[33m.[39mbehaviorLog[33m.[39mdeleteMany)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                                                [31m^[39m
    [90m274| [39m        expect[33m.[39m[34mobjectContaining[39m({
    [90m275| [39m          where[33m:[39m {

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[71/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mBehavior Log Archiving[2m > [22mshould preserve recent logs during archiving
[31m[1mTypeError[22m: Cannot read properties of undefined (reading '0')[39m
[36m [2mâ¯[22m src/modules/analytics/analytics.service.spec.ts:[2m290:73[22m[39m
    [90m288| [39m      [35mawait[39m service[33m.[39m[34mhandleLogAggregation[39m()[33m;[39m
    [90m289| [39m
    [90m290| [39m      [35mconst[39m deleteCall [33m=[39m mockPrisma[33m.[39mbehaviorLog[33m.[39mdeleteMany[33m.[39mmock[33m.[39mcalls[â€¦
    [90m   | [39m                                                                        [31m^[39m
    [90m291| [39m      [35mconst[39m threshold [33m=[39m deleteCall[33m.[39mwhere[33m.[39mtimestamp[33m.[39mlt[33m;[39m
    [90m292| [39m      [35mconst[39m daysSinceThreshold [33m=[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[72/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/heatmap.service.spec.ts[2m > [22mHeatmapService[2m > [22manalyzeScrollDepth[2m > [22mshould skip events without scrollPercentage
[31m[1mAssertionError[22m: expected 32.5 to be 65 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 65[39m
[31m+ 32.5[39m

[36m [2mâ¯[22m src/modules/analytics/heatmap.service.spec.ts:[2m367:35[22m[39m
    [90m365| [39m      )[33m;[39m
    [90m366| [39m
    [90m367| [39m      [34mexpect[39m(result[33m.[39maverageDepth)[33m.[39m[34mtoBe[39m([34m65[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m368| [39m      [34mexpect[39m(result[33m.[39mmaxDepth)[33m.[39m[34mtoBe[39m([34m80[39m)[33m;[39m
    [90m369| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[73/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/heatmap.service.spec.ts[2m > [22mHeatmapService[2m > [22manalyzeUserEngagement[2m > [22mshould calculate comprehensive engagement metrics
[31m[1mAssertionError[22m: expected { totalClicks: 50, â€¦(3) } to deeply equal { totalClicks: 50, â€¦(3) }[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  Object {[22m
[32m-   "avgSessionDuration": 175,[39m
[31m+   "avgSessionDuration": 225,[39m
[2m    "mostVisitedPages": ArrayContaining [[22m
[2m      "/dashboard",[22m
[2m      "/courses",[22m
[2m    ],[22m
[2m    "totalClicks": 50,[22m
[2m    "totalScrolls": 30,[22m
[2m  }[22m

[36m [2mâ¯[22m src/modules/analytics/heatmap.service.spec.ts:[2m541:22[22m[39m
    [90m539| [39m      )[33m;[39m
    [90m540| [39m
    [90m541| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m({
    [90m   | [39m                     [31m^[39m
    [90m542| [39m        totalClicks[33m:[39m [34m50[39m[33m,[39m
    [90m543| [39m        totalScrolls[33m:[39m [34m30[39m[33m,[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[74/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/metrics.service.spec.ts[2m > [22mMetricsService[2m > [22mcalculateRetention[2m > [22mshould handle empty cohort
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2mâ¯[22m MetricsService.calculateRetention src/modules/analytics/metrics.service.ts:[2m133:42[22m[39m
    [90m131| [39m      })[33m;[39m
    [90m132| [39m
    [90m133| [39m      retainedUsers[day] [33m=[39m activeUserIds[33m.[39mlength[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m134| [39m    }
    [90m135| [39m
[90m [2mâ¯[22m src/modules/analytics/metrics.service.spec.ts:[2m204:22[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[75/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/metrics.service.spec.ts[2m > [22mMetricsService[2m > [22mcalculatePercentile[2m > [22mshould calculate 95th percentile correctly
[31m[1mAssertionError[22m: expected 9.549999999999999 to be 9.55 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 9.55[39m
[31m+ 9.549999999999999[39m

[36m [2mâ¯[22m src/modules/analytics/metrics.service.spec.ts:[2m308:22[22m[39m
    [90m306| [39m      [35mconst[39m values [33m=[39m [[34m1[39m[33m,[39m [34m2[39m[33m,[39m [34m3[39m[33m,[39m [34m4[39m[33m,[39m [34m5[39m[33m,[39m [34m6[39m[33m,[39m [34m7[39m[33m,[39m [34m8[39m[33m,[39m [34m9[39m[33m,[39m [34m10[39m][33m;[39m
    [90m307| [39m      [35mconst[39m result [33m=[39m service[33m.[39m[34mcalculatePercentile[39m(values[33m,[39m [34m95[39m)[33m;[39m
    [90m308| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([34m9.55[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m309| [39m    })[33m;[39m
    [90m310| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[76/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould collect real-time metrics from last 10 minutes
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould handle zero events gracefully
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould update Prometheus gauges on metrics collection
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould export metrics in Prometheus format
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould track active WebSocket connections
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould broadcast real-time events to all connected clients
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould send targeted events to specific users
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould broadcast to groups (rooms)
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould handle client disconnection and cleanup
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould aggregate behavior logs efficiently for daily archival
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould perform health check aggregation every hour
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould calculate global system stats efficiently
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould analyze user learning habits from behavior logs
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould handle empty user learning habits
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould generate mock behavioral data for stress testing
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould run AI stress test with different complexity levels
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould handle AI stress test failures gracefully
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould simulate complete user flow for integration testing
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould run comprehensive diagnostics with all subsystems
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould detect database connection failure in diagnostics
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould validate JSONB schema integrity
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould warn on JSONB schema drift
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mPerformance Benchmarks[2m > [22mshould complete metrics collection in under 100ms (mocked)
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mPerformance Benchmarks[2m > [22mshould handle high-volume log aggregation efficiently
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as HUNTER (risk-taker)
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as SAVER (conservative)
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as OBSERVER (default)
[31m[1mError[22m: Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[90m [2mâ¯[22m TestingInjector.lookupComponentInParentModules ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m286:19[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveComponentWrapper ../../node_modules/.pnpm/@nestjs+testing@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_r_5vf4xikaifpz6ermp5d5enz4yy/node_modules/@nestjs/testing/testing-injector.js:[2m19:45[22m[39m
[90m [2mâ¯[22m resolveParam ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m140:38[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveConstructorParams ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m169:27[22m[39m
[90m [2mâ¯[22m TestingInjector.loadInstance ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m75:13[22m[39m
[90m [2mâ¯[22m TestingInjector.loadEnhancersPerContext ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m447:9[22m[39m
[90m [2mâ¯[22m TestingInjector.loadProvider ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m104:9[22m[39m
[90m [2mâ¯[22m ../../node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m56:13[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[77/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/reports.service.spec.ts[2m > [22mReportsService[2m > [22mgenerateReport[2m > [22mshould generate daily report with correct metrics
[31m[1mAssertionError[22m: expected 3 to be 2 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 3[39m

[36m [2mâ¯[22m src/modules/analytics/reports.service.spec.ts:[2m136:42[22m[39m
    [90m134| [39m      [34mexpect[39m(result[33m.[39mperiod)[33m.[39m[34mtoBe[39m([32m'HÃ ng ngÃ y'[39m)[33m;[39m
    [90m135| [39m      [34mexpect[39m(result[33m.[39mmetrics[33m.[39mtotalUsers)[33m.[39m[34mtoBe[39m([34m100[39m)[33m;[39m
    [90m136| [39m      [34mexpect[39m(result[33m.[39mmetrics[33m.[39mactiveUsers)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m137| [39m      [34mexpect[39m(result[33m.[39mmetrics[33m.[39mcompletedLessons)[33m.[39m[34mtoBe[39m([34m50[39m)[33m;[39m
    [90m138| [39m      [34mexpect[39m(result[33m.[39mmetrics[33m.[39maverageProgress)[33m.[39m[34mtoBe[39m([34m75.5[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[78/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/reports.service.spec.ts[2m > [22mReportsService[2m > [22mgenerateReport[2m > [22mshould generate monthly report with top users
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2mâ¯[22m map src/modules/analytics/reports.service.ts:[2m276:36[22m[39m
    [90m274| [39m      userId[33m:[39m u[33m.[39mid[33m,[39m
    [90m275| [39m      points[33m:[39m u[33m.[39mpoints[33m,[39m
    [90m276| [39m      completedLessons[33m:[39m u[33m.[39mprogress[33m.[39mlength[33m,[39m
    [90m   | [39m                                   [31m^[39m
    [90m277| [39m    }))[33m;[39m
    [90m278| [39m  }
[90m [2mâ¯[22m ReportsService.getTopUsers src/modules/analytics/reports.service.ts:[2m273:18[22m[39m
[90m [2mâ¯[22m ReportsService.generateReport src/modules/analytics/reports.service.ts:[2m55:45[22m[39m
[90m [2mâ¯[22m src/modules/analytics/reports.service.spec.ts:[2m200:22[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[79/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/user-segmentation.service.spec.ts[2m > [22mUserSegmentationService[2m > [22mComplex Multi-Criteria Filtering[2m > [22mshould handle empty result when no users match all criteria
[31m[1mTypeError[22m: activityCounts is not iterable[39m
[36m [2mâ¯[22m UserSegmentationService.filterByEngagement src/modules/analytics/user-segmentation.service.ts:[2m162:25[22m[39m
    [90m160| [39m
    [90m161| [39m    [35mconst[39m result [33m=[39m [35mnew[39m [33mSet[39m[33m<[39mstring[33m>[39m()[33m;[39m
    [90m162| [39m    [35mfor[39m ([35mconst[39m entry [35mof[39m activityCounts) {
    [90m   | [39m                        [31m^[39m
    [90m163| [39m      [35mif[39m ([33m![39mentry[33m.[39muserId) [35mcontinue[39m[33m;[39m
    [90m164| [39m      [35mconst[39m count [33m=[39m entry[33m.[39m_count[33m.[39mid[33m;[39m
[90m [2mâ¯[22m UserSegmentationService.getUsersMatchingCriteria src/modules/analytics/user-segmentation.service.ts:[2m127:31[22m[39m
[90m [2mâ¯[22m UserSegmentationService.updateSegment src/modules/analytics/user-segmentation.service.ts:[2m60:19[22m[39m
[90m [2mâ¯[22m src/modules/analytics/user-segmentation.service.spec.ts:[2m553:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[80/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould generate GAIN-framed message with positive outcome emphasis
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m124:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[81/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould generate LOSS-framed message with loss aversion emphasis
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m137:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[82/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould use GAIN framing for opportunity contexts
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m150:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[83/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould use LOSS framing for risk scenarios
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m162:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[84/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mDefault Effect Logic[2m > [22mshould apply DEFAULT framing and select based on context
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m201:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[85/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould generate Vietnamese framed message
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m215:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[86/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould generate English framed message
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m227:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[87/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould generate Chinese framed message
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m240:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[88/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould fallback to Vietnamese if locale is invalid
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m252:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[89/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould get all localized templates for a context
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.getLocalizedTemplates src/modules/nudge/framing.service.spec.ts:[2m60:27[22m[39m
    [90m 58| [39m    [34mgetLocalizedTemplates[39m(context[33m:[39m string)[33m:[39m [33mRecord[39m[33m<[39m[32m'vi'[39m [33m|[39m [32m'en'[39m [33m|[39m [32m'zh'[39m[33m,[39mâ€¦
    [90m 59| [39m        [35mreturn[39m {
    [90m 60| [39m            vi[33m:[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m([32m`nudge.[39m[36m${[39mcontext[36m}[39m[32m`[39m[33m,[39m [32m'vi'[39m)[33m,[39m
    [90m   | [39m                          [31m^[39m
    [90m 61| [39m            en[33m:[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m([32m`nudge.[39m[36m${[39mcontext[36m}[39m[32m`[39m[33m,[39m [32m'en'[39m)[33m,[39m
    [90m 62| [39m            zh[33m:[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m([32m`nudge.[39m[36m${[39mcontext[36m}[39m[32m`[39m[33m,[39m [32m'zh'[39m)[33m,[39m
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m263:39[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[90/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould handle parameter interpolation in all locales
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m273:38[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[91/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould correctly interpolate amount parameter
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m285:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[92/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould correctly interpolate days parameter
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m296:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[93/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould correctly interpolate count parameter
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m307:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[94/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould handle multiple parameters in template
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m319:27[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[95/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould assign variant from A/B test when experimentId is provided
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'assignVariant')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m38:53[22m[39m
    [90m 36| [39m
    [90m 37| [39m        [35mif[39m (experimentId) {
    [90m 38| [39m            [35mconst[39m assignment [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mabTesting[33m.[39m[34massignVariant[39m(paraâ€¦
    [90m   | [39m                                                    [31m^[39m
    [90m 39| [39m            [35mif[39m (assignment) {
    [90m 40| [39m                selectedFraming [33m=[39m assignment[33m.[39mvariantId [35mas[39m [32m'GAIN'[39m [33m|[39m [32m'LO[39mâ€¦
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m343:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[96/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould use original framing if no A/B test assignment
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'assignVariant')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m38:53[22m[39m
    [90m 36| [39m
    [90m 37| [39m        [35mif[39m (experimentId) {
    [90m 38| [39m            [35mconst[39m assignment [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mabTesting[33m.[39m[34massignVariant[39m(paraâ€¦
    [90m   | [39m                                                    [31m^[39m
    [90m 39| [39m            [35mif[39m (assignment) {
    [90m 40| [39m                selectedFraming [33m=[39m assignment[33m.[39mvariantId [35mas[39m [32m'GAIN'[39m [33m|[39m [32m'LO[39mâ€¦
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m360:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[97/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould work without experimentId (no A/B testing)
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m373:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[98/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould track variant assignment for analytics
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'assignVariant')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m38:53[22m[39m
    [90m 36| [39m
    [90m 37| [39m        [35mif[39m (experimentId) {
    [90m 38| [39m            [35mconst[39m assignment [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mabTesting[33m.[39m[34massignVariant[39m(paraâ€¦
    [90m   | [39m                                                    [31m^[39m
    [90m 39| [39m            [35mif[39m (assignment) {
    [90m 40| [39m                selectedFraming [33m=[39m assignment[33m.[39mvariantId [35mas[39m [32m'GAIN'[39m [33m|[39m [32m'LO[39mâ€¦
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m393:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[99/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould handle A/B test error gracefully
[31m[1mAssertionError[22m: expected [Function] to throw error including 'DB connection lost' but got 'Cannot read properties of undefined (â€¦'[39m

Expected: [32m"DB connection lost"[39m
Received: [31m"Cannot read properties of undefined (reading 'assignVariant')"[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[100/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mEdge Cases & Error Handling[2m > [22mshould handle missing parameters gracefully
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m422:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[101/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mEdge Cases & Error Handling[2m > [22mshould handle empty locale with fallback
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m434:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[102/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mEdge Cases & Error Handling[2m > [22mshould return valid message key when translation not found
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m445:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[103/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mCoverage Edge Cases (85%+ Target)[2m > [22mshould handle null params in generateFramedMessage
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m463:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[104/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mCoverage Edge Cases (85%+ Target)[2m > [22mshould generate consistent messages for same inputs
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m481:43[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[105/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mCoverage Edge Cases (85%+ Target)[2m > [22mshould handle concurrent framing requests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'translate')[39m
[36m [2mâ¯[22m FramingService.generateFramedMessage src/modules/nudge/framing.service.spec.ts:[2m46:35[22m[39m
    [90m 44| [39m
    [90m 45| [39m        [35mconst[39m messageKey [33m=[39m [35mthis[39m[33m.[39m[34mgetMessageKey[39m(selectedFraming[33m,[39m contextâ€¦
    [90m 46| [39m        [35mconst[39m message [33m=[39m [35mthis[39m[33m.[39mi18n[33m.[39m[34mtranslate[39m(messageKey[33m,[39m locale[33m,[39m paramsâ€¦
    [90m   | [39m                                  [31m^[39m
    [90m 47| [39m
    [90m 48| [39m        [35mreturn[39m {
[90m [2mâ¯[22m from src/modules/nudge/framing.service.spec.ts:[2m489:25[22m[39m
[90m [2mâ¯[22m src/modules/nudge/framing.service.spec.ts:[2m488:36[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[106/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.controller.spec.ts[2m > [22mNudgeController[2m > [22mGET /nudge/dashboard[2m > [22mshould return multiple dashboard nudges
[31m[1mAssertionError[22m: expected "spy" to be called 2 times, but got 5 times[39m
[36m [2mâ¯[22m src/modules/nudge/nudge.controller.spec.ts:[2m86:41[22m[39m
    [90m 84| [39m      [35mconst[39m result [33m=[39m [35mawait[39m controller[33m.[39m[34mgetDashboardNudges[39m({ user[33m:[39m mockUâ€¦
    [90m 85| [39m
    [90m 86| [39m      [34mexpect[39m(nudgeEngine[33m.[39mgenerateNudge)[33m.[39m[34mtoHaveBeenCalledTimes[39m([34m2[39m)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m 87| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
    [90m 88| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[107/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mhandleStreakNudges[2m > [22mshould filter out zero-streak users
[31m[1mTypeError[22m: usersToNudge is not iterable[39m
[36m [2mâ¯[22m NudgeService.handleStreakNudges src/modules/nudge/nudge.service.ts:[2m36:26[22m[39m
    [90m 34| [39m    })[33m;[39m
    [90m 35| [39m
    [90m 36| [39m    [35mfor[39m ([35mconst[39m streak [35mof[39m usersToNudge) {
    [90m   | [39m                         [31m^[39m
    [90m 37| [39m      [35mawait[39m [35mthis[39m[33m.[39m[34msendNudge[39m(streak)[33m;[39m
    [90m 38| [39m    }
[90m [2mâ¯[22m src/modules/nudge/nudge.service.spec.ts:[2m91:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[108/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mhandleStreakNudges[2m > [22mshould include correct time boundaries (20-24 hours)
[31m[1mTypeError[22m: usersToNudge is not iterable[39m
[36m [2mâ¯[22m NudgeService.handleStreakNudges src/modules/nudge/nudge.service.ts:[2m36:26[22m[39m
    [90m 34| [39m    })[33m;[39m
    [90m 35| [39m
    [90m 36| [39m    [35mfor[39m ([35mconst[39m streak [35mof[39m usersToNudge) {
    [90m   | [39m                         [31m^[39m
    [90m 37| [39m      [35mawait[39m [35mthis[39m[33m.[39m[34msendNudge[39m(streak)[33m;[39m
    [90m 38| [39m    }
[90m [2mâ¯[22m src/modules/nudge/nudge.service.spec.ts:[2m124:7[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[109/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mTrigger Frequency Limits[2m > [22mshould not send nudge to same user within 24 hours
[31m[1mAssertionError[22m: expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T16:01:17.061Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m src/modules/nudge/nudge.service.spec.ts:[2m237:52[22m[39m
    [90m235| [39m      [35mawait[39m service[33m.[39m[34mhandleStreakNudges[39m()[33m;[39m
    [90m236| [39m
    [90m237| [39m      [34mexpect[39m(prismaService[33m.[39mbehaviorLog[33m.[39mcreate)[33m.[39mnot[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                                   [31m^[39m
    [90m238| [39m    })[33m;[39m
    [90m239| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[110/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mTrigger Frequency Limits[2m > [22mshould enforce max 3 nudges per day per user
[31m[1mAssertionError[22m: expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T16:01:17.063Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m src/modules/nudge/nudge.service.spec.ts:[2m260:52[22m[39m
    [90m258| [39m      [35mawait[39m service[33m.[39m[34mhandleStreakNudges[39m()[33m;[39m
    [90m259| [39m
    [90m260| [39m      [34mexpect[39m(prismaService[33m.[39mbehaviorLog[33m.[39mcreate)[33m.[39mnot[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                                   [31m^[39m
    [90m261| [39m    })[33m;[39m
    [90m262| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[111/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mUser Preference Overrides[2m > [22mshould respect user opt-out from nudges
[31m[1mAssertionError[22m: expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T16:01:17.065Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m src/modules/nudge/nudge.service.spec.ts:[2m307:52[22m[39m
    [90m305| [39m      [35mawait[39m service[33m.[39m[34mhandleStreakNudges[39m()[33m;[39m
    [90m306| [39m
    [90m307| [39m      [34mexpect[39m(prismaService[33m.[39mbehaviorLog[33m.[39mcreate)[33m.[39mnot[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                                   [31m^[39m
    [90m308| [39m    })[33m;[39m
    [90m309| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[112/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould deliver SOCIAL_PROOF nudge emphasizing competition
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould maintain high engagement for HUNTER persona
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould use competitive language for HUNTER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould deliver LOSS_AVERSION nudge for high-risk scenarios
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould prioritize GOAL_GRADIENT for budgeting context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould emphasize security and caution for SAVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould calculate progress correctly for SAVER budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould deliver default SOCIAL_PROOF nudge
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould use neutral language for OBSERVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould provide informative mapping for OBSERVER budgeting
[31m[1mReferenceError[22m: jest is not defined[39m
[36m [2mâ¯[22m src/modules/nudge/personalization.service.spec.ts:[2m34:21[22m[39m
    [90m 32| [39m    mockPrisma [33m=[39m {
    [90m 33| [39m      user[33m:[39m {
    [90m 34| [39m        findUnique[33m:[39m jest[33m.[39m[34mfn[39m()[33m,[39m
    [90m   | [39m                    [31m^[39m
    [90m 35| [39m      }[33m,[39m
    [90m 36| [39m      behaviorLog[33m:[39m {

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[113/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould deliver SOCIAL_PROOF nudge emphasizing competition
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould maintain high engagement for HUNTER persona
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould use competitive language for HUNTER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould deliver LOSS_AVERSION nudge for high-risk scenarios
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould prioritize GOAL_GRADIENT for budgeting context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould emphasize security and caution for SAVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould calculate progress correctly for SAVER budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould deliver default SOCIAL_PROOF nudge
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould use neutral language for OBSERVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould provide informative mapping for OBSERVER budgeting
[31m[1mReferenceError[22m: jest is not defined[39m
[36m [2mâ¯[22m src/modules/nudge/personalization.service.spec.ts:[2m59:5[22m[39m
    [90m 57| [39m
    [90m 58| [39m  [34mafterEach[39m(() [33m=>[39m {
    [90m 59| [39m    jest[33m.[39m[34mclearAllMocks[39m()[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 60| [39m  })[33m;[39m
    [90m 61| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[114/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould adapt message based on risk level threshold
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould calculate real-world value mapping correctly
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould override persona logic when risk is critically high
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould maintain persona preference when risk is moderate
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle INVESTMENT_DECISION context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle BUDGETING context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle STREAK_WARNING context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle SOCIAL_PROOF_REALTIME context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould return null for unknown context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for streak-critical situations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for HUNTER investment decisions
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for SAVER loss aversion
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize MEDIUM for default social proof
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize LOW for OBSERVER budgeting nudges
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould fetch realtime social proof data
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould query behavior logs from last 24 hours
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould generate realtime social nudge when users are active
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould return null when no active users in last 24h
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Vietnamese translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide English translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Chinese translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing user gracefully
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle zero amount in budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle very large amounts in budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing data object
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle undefined risk level
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for HUNTER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for SAVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould adapt dynamically to changing user behavior
[31m[1mReferenceError[22m: jest is not defined[39m
[36m [2mâ¯[22m src/modules/nudge/personalization.service.spec.ts:[2m34:21[22m[39m
    [90m 32| [39m    mockPrisma [33m=[39m {
    [90m 33| [39m      user[33m:[39m {
    [90m 34| [39m        findUnique[33m:[39m jest[33m.[39m[34mfn[39m()[33m,[39m
    [90m   | [39m                    [31m^[39m
    [90m 35| [39m      }[33m,[39m
    [90m 36| [39m      behaviorLog[33m:[39m {

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[115/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould adapt message based on risk level threshold
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould calculate real-world value mapping correctly
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould override persona logic when risk is critically high
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould maintain persona preference when risk is moderate
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle INVESTMENT_DECISION context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle BUDGETING context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle STREAK_WARNING context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle SOCIAL_PROOF_REALTIME context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould return null for unknown context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for streak-critical situations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for HUNTER investment decisions
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for SAVER loss aversion
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize MEDIUM for default social proof
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize LOW for OBSERVER budgeting nudges
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould fetch realtime social proof data
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould query behavior logs from last 24 hours
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould generate realtime social nudge when users are active
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould return null when no active users in last 24h
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Vietnamese translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide English translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Chinese translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing user gracefully
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle zero amount in budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle very large amounts in budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing data object
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle undefined risk level
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for HUNTER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for SAVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould adapt dynamically to changing user behavior
[31m[1mReferenceError[22m: jest is not defined[39m
[36m [2mâ¯[22m src/modules/nudge/personalization.service.spec.ts:[2m59:5[22m[39m
    [90m 57| [39m
    [90m 58| [39m  [34mafterEach[39m(() [33m=>[39m {
    [90m 59| [39m    jest[33m.[39m[34mclearAllMocks[39m()[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 60| [39m  })[33m;[39m
    [90m 61| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[116/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/social-proof.service.spec.ts[2m > [22mSocialProofService[2m > [22mgenerateCohortMessage - "X% of users like you"[2m > [22mshould return null if cohort has zero users
[31m[1mAssertionError[22m: expected { type: 'SOCIAL_PROOF', â€¦(3) } to be null[39m

[32m- Expected:[39m 
null

[31m+ Received:[39m 
Object {
  "message": Object {
    "en": "0% of users like you have completed this course. Join them!",
    "vi": "0% ngÆ°á»i dÃ¹ng giá»‘ng báº¡n Ä‘Ã£ hoÃ n thÃ nh khÃ³a há»c nÃ y. Tham gia ngay!",
    "zh": "0% çš„åƒæ‚¨è¿™æ ·çš„ç”¨æˆ·å·²ç»å®Œæˆäº†è¿™é—¨è¯¾ç¨‹ã€‚ç«‹å³åŠ å…¥ï¼",
  },
  "metadata": Object {
    "cohortSize": 1,
    "comparisonType": "SIMILAR_USERS",
    "percentage": 0,
  },
  "priority": "LOW",
  "type": "SOCIAL_PROOF",
}

[36m [2mâ¯[22m src/modules/nudge/social-proof.service.spec.ts:[2m122:22[22m[39m
    [90m120| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mgenerateCohortMessage[39m([32m'u1'[39m[33m,[39m [32m'COURSE[39mâ€¦
    [90m121| [39m
    [90m122| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeNull[39m()[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m123| [39m    })[33m;[39m
    [90m124| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[117/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/social-proof.service.spec.ts[2m > [22mSocialProofService[2m > [22mgeneratePeerComparison - Peer ranking logic[2m > [22mshould generate congratulatory message when user is above average
[31m[1mAssertionError[22m: expected '100% ngÆ°á»i dÃ¹ng Ä‘ang dáº«n trÆ°á»›c báº¡n vá»â€¦' to contain 'vÆ°á»£t trá»™i'[39m

Expected: [32m"vÆ°á»£t trá»™i"[39m
Received: [31m"100% ngÆ°á»i dÃ¹ng Ä‘ang dáº«n trÆ°á»›c báº¡n vá» há»c táº­p. HÃ£y báº¯t ká»‹p há»!"[39m

[36m [2mâ¯[22m src/modules/nudge/social-proof.service.spec.ts:[2m164:34[22m[39m
    [90m162| [39m      [34mexpect[39m(result[33m?.[39mmetadata[33m.[39mcomparisonType)[33m.[39m[34mtoBe[39m([32m'PEERS'[39m)[33m;[39m
    [90m163| [39m      [34mexpect[39m(result[33m?.[39mmetadata[33m.[39mpercentage)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m [90m// All peers below [39mâ€¦
    [90m164| [39m      [34mexpect[39m(result[33m?.[39mmessage[33m.[39mvi)[33m.[39m[34mtoContain[39m([32m'vÆ°á»£t trá»™i'[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m165| [39m      [34mexpect[39m(result[33m?.[39mmessage[33m.[39men)[33m.[39m[34mtoContain[39m([32m'outperforming'[39m)[33m;[39m
    [90m166| [39m    })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[118/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/social-proof.service.spec.ts[2m > [22mSocialProofService[2m > [22mgeneratePeerComparison - Peer ranking logic[2m > [22mshould generate motivational message when user is below average
[31m[1mAssertionError[22m: expected 'MEDIUM' to be 'HIGH' // Object.is equality[39m

Expected: [32m"HIGH"[39m
Received: [31m"MEDIUM"[39m

[36m [2mâ¯[22m src/modules/nudge/social-proof.service.spec.ts:[2m190:32[22m[39m
    [90m188| [39m
    [90m189| [39m      [34mexpect[39m(result[33m?.[39mmetadata[33m.[39mpercentage)[33m.[39m[34mtoBe[39m([34m100[39m)[33m;[39m [90m// All peers abov[39mâ€¦
    [90m190| [39m      [34mexpect[39m(result[33m?.[39mpriority)[33m.[39m[34mtoBe[39m([32m'HIGH'[39m)[33m;[39m [90m// Below average should b[39mâ€¦
    [90m   | [39m                               [31m^[39m
    [90m191| [39m      [34mexpect[39m(result[33m?.[39mmessage[33m.[39mvi)[33m.[39m[34mtoContain[39m([32m'dáº«n trÆ°á»›c'[39m)[33m;[39m
    [90m192| [39m      [34mexpect[39m(result[33m?.[39mmessage[33m.[39men)[33m.[39m[34mtoContain[39m([32m'ahead of you'[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[119/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/recommendations/recommendation.service.spec.ts[2m > [22mRecommendationService[2m > [22mPersona-Based Filtering[2m > [22mshould recommend risk-focused courses for HUNTER persona
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ StringContaining "HUNTER" ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   StringContaining "HUNTER",[90m
[31m+   "[90m
[31m+       System: You are an AI Financial Advisor for V-EdFinance.[90m
[31m+       User Profile: {\"riskTolerance\":\"HIGH\"}[90m
[31m+       Learning Habits: {\"peakLearningHour\":10}[90m
[31m+       Available Courses: [{\"id\":\"c1\",\"title\":{\"vi\":\"Crypto Trading\"}}][90m
[31m+       [90m
[31m+       Task: Recommend the top 2 courses for this user. [90m
[31m+       For each recommendation, provide a reason based on NUDGE theory (e.g., Social Proof, Goal Gradient).[90m
[31m+       [90m
[31m+       Format: JSON array of { \"courseId\": string, \"reason\": { \"vi\": string, \"en\": string, \"zh\": string }, \"strategy\": string }[90m
[31m+     ",[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m src/modules/recommendations/recommendation.service.spec.ts:[2m118:44[22m[39m
    [90m116| [39m
    [90m117| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mstrategy)[33m.[39m[34mtoBe[39m([32m'PERSONA_MATCH'[39m)[33m;[39m
    [90m118| [39m      [34mexpect[39m(mockAi[33m.[39mmodel[33m.[39mgenerateContent)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                                           [31m^[39m
    [90m119| [39m        expect[33m.[39m[34mstringContaining[39m([32m'HUNTER'[39m)
    [90m120| [39m      )[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[120/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/recommendations/recommendation.service.spec.ts[2m > [22mRecommendationService[2m > [22mPersona-Based Filtering[2m > [22mshould recommend savings courses for SAVER persona
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ StringContaining "SAVER" ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   StringContaining "SAVER",[90m
[31m+   "[90m
[31m+       System: You are an AI Financial Advisor for V-EdFinance.[90m
[31m+       User Profile: {\"riskTolerance\":\"LOW\"}[90m
[31m+       Learning Habits: {}[90m
[31m+       Available Courses: [{\"id\":\"c2\",\"title\":{\"vi\":\"Savings Strategies\"}}][90m
[31m+       [90m
[31m+       Task: Recommend the top 2 courses for this user. [90m
[31m+       For each recommendation, provide a reason based on NUDGE theory (e.g., Social Proof, Goal Gradient).[90m
[31m+       [90m
[31m+       Format: JSON array of { \"courseId\": string, \"reason\": { \"vi\": string, \"en\": string, \"zh\": string }, \"strategy\": string }[90m
[31m+     ",[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m src/modules/recommendations/recommendation.service.spec.ts:[2m155:44[22m[39m
    [90m153| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mgetPersonalizedRecommendations[39m([32m'u1'[39mâ€¦
    [90m154| [39m
    [90m155| [39m      [34mexpect[39m(mockAi[33m.[39mmodel[33m.[39mgenerateContent)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                                           [31m^[39m
    [90m156| [39m        expect[33m.[39m[34mstringContaining[39m([32m'SAVER'[39m)
    [90m157| [39m      )[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[121/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/simulation/scenario-generator.service.spec.ts[2m > [22mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22mScenario Generation Logic[2m > [22mshould continue scenario based on previous choice
[31m[1mTypeError[22m: actual value must be number or bigint, received "undefined"[39m
[36m [2mâ¯[22m src/modules/simulation/scenario-generator.service.spec.ts:[2m181:57[22m[39m
    [90m179| [39m                expect[33m.[39m[34many[39m([33mArray[39m)
    [90m180| [39m            )[33m;[39m
    [90m181| [39m            [34mexpect[39m((result[33m.[39mdecisions [35mas[39m any[])[33m?.[39mlength)[33m.[39m[34mtoBeGreaterTha[39mâ€¦
    [90m   | [39m                                                        [31m^[39m
    [90m182| [39m        })[33m;[39m
    [90m183| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[122/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22msendNotification[2m > [22mshould send push notification via SocialService
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'sendPushNotification')[39m
[36m [2mâ¯[22m NotificationController.sendNotification src/modules/social/notification.controller.spec.ts:[2m19:30[22m[39m
    [90m 17| [39m
    [90m 18| [39m  [35masync[39m [34msendNotification[39m(userId[33m:[39m string[33m,[39m title[33m:[39m string[33m,[39m body[33m:[39m string) {
    [90m 19| [39m    [35mawait[39m [35mthis[39m[33m.[39msocialService[33m.[39m[34msendPushNotification[39m(userId[33m,[39m title[33m,[39m body)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 20| [39m    [35mthis[39m[33m.[39mgateway[33m.[39m[34msendToUser[39m(userId[33m,[39m [32m'notification'[39m[33m,[39m { title[33m,[39m body })[33m;[39m
    [90m 21| [39m    [35mreturn[39m { success[33m:[39m [35mtrue[39m }[33m;[39m
[90m [2mâ¯[22m src/modules/social/notification.controller.spec.ts:[2m68:39[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[123/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22msendNotification[2m > [22mshould broadcast notification via WebSocket
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'sendPushNotification')[39m
[36m [2mâ¯[22m NotificationController.sendNotification src/modules/social/notification.controller.spec.ts:[2m19:30[22m[39m
    [90m 17| [39m
    [90m 18| [39m  [35masync[39m [34msendNotification[39m(userId[33m:[39m string[33m,[39m title[33m:[39m string[33m,[39m body[33m:[39m string) {
    [90m 19| [39m    [35mawait[39m [35mthis[39m[33m.[39msocialService[33m.[39m[34msendPushNotification[39m(userId[33m,[39m title[33m,[39m body)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 20| [39m    [35mthis[39m[33m.[39mgateway[33m.[39m[34msendToUser[39m(userId[33m,[39m [32m'notification'[39m[33m,[39m { title[33m,[39m body })[33m;[39m
    [90m 21| [39m    [35mreturn[39m { success[33m:[39m [35mtrue[39m }[33m;[39m
[90m [2mâ¯[22m src/modules/social/notification.controller.spec.ts:[2m79:24[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[124/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22msendNotification[2m > [22mshould handle notification with empty body
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'sendPushNotification')[39m
[36m [2mâ¯[22m NotificationController.sendNotification src/modules/social/notification.controller.spec.ts:[2m19:30[22m[39m
    [90m 17| [39m
    [90m 18| [39m  [35masync[39m [34msendNotification[39m(userId[33m:[39m string[33m,[39m title[33m:[39m string[33m,[39m body[33m:[39m string) {
    [90m 19| [39m    [35mawait[39m [35mthis[39m[33m.[39msocialService[33m.[39m[34msendPushNotification[39m(userId[33m,[39m title[33m,[39m body)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 20| [39m    [35mthis[39m[33m.[39mgateway[33m.[39m[34msendToUser[39m(userId[33m,[39m [32m'notification'[39m[33m,[39m { title[33m,[39m body })[33m;[39m
    [90m 21| [39m    [35mreturn[39m { success[33m:[39m [35mtrue[39m }[33m;[39m
[90m [2mâ¯[22m src/modules/social/notification.controller.spec.ts:[2m88:39[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[125/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22msendNotification[2m > [22mshould handle notification errors gracefully
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Service down' but got 'Cannot read properties of undefined (â€¦'[39m

Expected: [32m"Service down"[39m
Received: [31m"Cannot read properties of undefined (reading 'sendPushNotification')"[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[126/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22msendNotification[2m > [22mshould send notifications to multiple users
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'sendPushNotification')[39m
[36m [2mâ¯[22m NotificationController.sendNotification src/modules/social/notification.controller.spec.ts:[2m19:30[22m[39m
    [90m 17| [39m
    [90m 18| [39m  [35masync[39m [34msendNotification[39m(userId[33m:[39m string[33m,[39m title[33m:[39m string[33m,[39m body[33m:[39m string) {
    [90m 19| [39m    [35mawait[39m [35mthis[39m[33m.[39msocialService[33m.[39m[34msendPushNotification[39m(userId[33m,[39m title[33m,[39m body)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 20| [39m    [35mthis[39m[33m.[39mgateway[33m.[39m[34msendToUser[39m(userId[33m,[39m [32m'notification'[39m[33m,[39m { title[33m,[39m body })[33m;[39m
    [90m 21| [39m    [35mreturn[39m { success[33m:[39m [35mtrue[39m }[33m;[39m
[90m [2mâ¯[22m src/modules/social/notification.controller.spec.ts:[2m107:24[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[127/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22mWebSocket broadcast validation[2m > [22mshould validate WebSocket room targeting
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'sendPushNotification')[39m
[36m [2mâ¯[22m NotificationController.sendNotification src/modules/social/notification.controller.spec.ts:[2m19:30[22m[39m
    [90m 17| [39m
    [90m 18| [39m  [35masync[39m [34msendNotification[39m(userId[33m:[39m string[33m,[39m title[33m:[39m string[33m,[39m body[33m:[39m string) {
    [90m 19| [39m    [35mawait[39m [35mthis[39m[33m.[39msocialService[33m.[39m[34msendPushNotification[39m(userId[33m,[39m title[33m,[39m body)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 20| [39m    [35mthis[39m[33m.[39mgateway[33m.[39m[34msendToUser[39m(userId[33m,[39m [32m'notification'[39m[33m,[39m { title[33m,[39m body })[33m;[39m
    [90m 21| [39m    [35mreturn[39m { success[33m:[39m [35mtrue[39m }[33m;[39m
[90m [2mâ¯[22m src/modules/social/notification.controller.spec.ts:[2m117:24[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[128/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22mEdge Cases[2m > [22mshould handle special characters in notification content
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'sendPushNotification')[39m
[36m [2mâ¯[22m NotificationController.sendNotification src/modules/social/notification.controller.spec.ts:[2m19:30[22m[39m
    [90m 17| [39m
    [90m 18| [39m  [35masync[39m [34msendNotification[39m(userId[33m:[39m string[33m,[39m title[33m:[39m string[33m,[39m body[33m:[39m string) {
    [90m 19| [39m    [35mawait[39m [35mthis[39m[33m.[39msocialService[33m.[39m[34msendPushNotification[39m(userId[33m,[39m title[33m,[39m body)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 20| [39m    [35mthis[39m[33m.[39mgateway[33m.[39m[34msendToUser[39m(userId[33m,[39m [32m'notification'[39m[33m,[39m { title[33m,[39m body })[33m;[39m
    [90m 21| [39m    [35mreturn[39m { success[33m:[39m [35mtrue[39m }[33m;[39m
[90m [2mâ¯[22m src/modules/social/notification.controller.spec.ts:[2m177:39[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[129/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22mEdge Cases[2m > [22mshould handle very long notification bodies
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'sendPushNotification')[39m
[36m [2mâ¯[22m NotificationController.sendNotification src/modules/social/notification.controller.spec.ts:[2m19:30[22m[39m
    [90m 17| [39m
    [90m 18| [39m  [35masync[39m [34msendNotification[39m(userId[33m:[39m string[33m,[39m title[33m:[39m string[33m,[39m body[33m:[39m string) {
    [90m 19| [39m    [35mawait[39m [35mthis[39m[33m.[39msocialService[33m.[39m[34msendPushNotification[39m(userId[33m,[39m title[33m,[39m body)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 20| [39m    [35mthis[39m[33m.[39mgateway[33m.[39m[34msendToUser[39m(userId[33m,[39m [32m'notification'[39m[33m,[39m { title[33m,[39m body })[33m;[39m
    [90m 21| [39m    [35mreturn[39m { success[33m:[39m [35mtrue[39m }[33m;[39m
[90m [2mâ¯[22m src/modules/social/notification.controller.spec.ts:[2m188:39[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[130/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22mEdge Cases[2m > [22mshould handle concurrent notifications
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'sendPushNotification')[39m
[36m [2mâ¯[22m NotificationController.sendNotification src/modules/social/notification.controller.spec.ts:[2m19:30[22m[39m
    [90m 17| [39m
    [90m 18| [39m  [35masync[39m [34msendNotification[39m(userId[33m:[39m string[33m,[39m title[33m:[39m string[33m,[39m body[33m:[39m string) {
    [90m 19| [39m    [35mawait[39m [35mthis[39m[33m.[39msocialService[33m.[39m[34msendPushNotification[39m(userId[33m,[39m title[33m,[39m body)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 20| [39m    [35mthis[39m[33m.[39mgateway[33m.[39m[34msendToUser[39m(userId[33m,[39m [32m'notification'[39m[33m,[39m { title[33m,[39m body })[33m;[39m
    [90m 21| [39m    [35mreturn[39m { success[33m:[39m [35mtrue[39m }[33m;[39m
[90m [2mâ¯[22m from src/modules/social/notification.controller.spec.ts:[2m199:20[22m[39m
[90m [2mâ¯[22m src/modules/social/notification.controller.spec.ts:[2m198:30[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[131/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/sharing.service.spec.ts[2m > [22mSharingService[2m > [22mgetSocialMetaTags[2m > [22mshould generate localized meta tags for an achievement
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'en')[39m
[36m [2mâ¯[22m SharingService.getSocialMetaTags src/modules/social/sharing.service.ts:[2m39:36[22m[39m
    [90m 37| [39m    }
    [90m 38| [39m
    [90m 39| [39m    [35mconst[39m title [33m=[39m (achievement[33m.[39mname [35mas[39m unknown [35mas[39m [33mLocalizedContent[39m)[loâ€¦
    [90m   | [39m                                   [31m^[39m
    [90m 40| [39m    [35mconst[39m description [33m=[39m (achievement[33m.[39mdescription [35mas[39m unknown [35mas[39m [33mLocaliz[39mâ€¦
    [90m 41| [39m
[90m [2mâ¯[22m src/modules/social/sharing.service.spec.ts:[2m77:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[132/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/social.controller.spec.ts[2m > [22mSocialController[2m > [22mGuard Protection[2m > [22mshould protect all endpoints with JwtAuthGuard
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2mâ¯[22m src/modules/social/social.controller.spec.ts:[2m287:26[22m[39m
    [90m285| [39m        [35mconst[39m guards [33m=[39m [33mReflect[39m[33m.[39m[34mgetMetadata[39m([32m'__guards__'[39m[33m,[39m [33mSocialControl[39mâ€¦
    [90m286| [39m        [35mif[39m (endpoint [33m!==[39m [32m'getGroupDetails'[39m) {
    [90m287| [39m          [34mexpect[39m(guards)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m288| [39m        }
    [90m289| [39m      }

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[133/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/social.service.spec.ts[2m > [22mSocialService[2m > [22mChallenge Progress Tracking (S005)[2m > [22mshould handle challenge with no members
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[36m [2mâ¯[22m src/modules/social/social.service.spec.ts:[2m393:54[22m[39m
    [90m391| [39m
    [90m392| [39m            [35mawait[39m service[33m.[39m[34mcheckChallengeProgress[39m([32m'c1'[39m)[33m;[39m
    [90m393| [39m            [34mexpect[39m(mockPrisma[33m.[39mbuddyChallenge[33m.[39m[35mdelete[39m)[33m.[39m[34mtoHaveBeenCalled[39m(â€¦
    [90m   | [39m                                                     [31m^[39m
    [90m394| [39m        })[33m;[39m
    [90m395| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[134/237]â¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m src/modules/social/social.service.spec.ts[2m > [22mSocialService[2m > [22mWebSocket Broadcast Integration (S005)[2m > [22mshould handle broadcast failure gracefully
[31m[1mAssertionError[22m: promise resolved "{ id: 'p1', userId: 'u1', â€¦(1) }" instead of rejecting[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- [Error: rejected promise][39m
[31m+ Object {[39m
[31m+   "id": "p1",[39m
[31m+   "type": "DISCUSSION",[39m
[31m+   "userId": "u1",[39m
[31m+ }[39m

[36m [2mâ¯[22m src/modules/social/social.service.spec.ts:[2m475:100[22m[39m
    [90m473| [39m
    [90m474| [39m            [35mawait[39m [34mexpect[39m(
    [90m475| [39m                service[33m.[39m[34mcreatePost[39m([32m'u1'[39m[33m,[39m [33mPostType[39m[33m.[39m[33mDISCUSSION[39m[33m,[39m { vi[33m:[39m [32m'T[39mâ€¦
    [90m   | [39m                                                                                                   [31m^[39m
    [90m476| [39m            )[33m.[39mrejects[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m477| [39m        })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[135/237]â¯[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[1m[7m Unhandled Errors [27m[22mâ¯â¯â¯â¯â¯â¯[39m
[31m[1m
Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.[22m[39m

[31mâ¯â¯â¯â¯[1m[7m Unhandled Rejection [27m[22mâ¯â¯â¯â¯â¯[39m
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'user')[39m
[36m [2mâ¯[22m HealthController.metrics src/common/health.controller.spec.ts:[2m39:19[22m[39m
    [90m 37| [39m  [35masync[39m [34mmetrics[39m() {
    [90m 38| [39m    [35mconst[39m [userCount[33m,[39m courseCount[33m,[39m behaviorCount] [33m=[39m [35mawait[39m [33mPromise[39m[33m.[39m[34mall[39m([
    [90m 39| [39m      [35mthis[39m[33m.[39mprisma[33m.[39muser[33m.[39m[34mcount[39m()[33m,[39m
    [90m   | [39m                  [31m^[39m
    [90m 40| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mcourse[33m.[39m[34mcount[39m()[33m,[39m
    [90m 41| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mbehaviorLog[33m.[39m[34mcount[39m()[33m,[39m
[90m [2mâ¯[22m src/common/health.controller.spec.ts:[2m272:41[22m[39m
[90m [2mâ¯[22m ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:[2m146:14[22m[39m
[90m [2mâ¯[22m ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:[2m533:11[22m[39m
[90m [2mâ¯[22m runWithTimeout ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:[2m39:7[22m[39m
[90m [2mâ¯[22m runTest ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:[2m1056:17[22m[39m
[90m [2mâ¯[22m runSuite ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:[2m1205:15[22m[39m
[90m [2mâ¯[22m runSuite ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:[2m1205:15[22m[39m
[90m [2mâ¯[22m runSuite ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:[2m1205:15[22m[39m
[90m [2mâ¯[22m runFiles ../../../../Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:[2m1262:5[22m[39m

[31mThis error originated in "[1msrc/common/health.controller.spec.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould detect degraded performance[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m
[31mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[39m

[2m Test Files [22m [1m[31m49 failed[39m[22m[2m | [22m[1m[32m68 passed[39m[22m[90m (117)[39m
[2m      Tests [22m [1m[31m172 failed[39m[22m[2m | [22m[1m[32m1507 passed[39m[22m[2m | [22m[33m44 skipped[39m[90m (1723)[39m
[2m     Errors [22m [1m[31m1 error[39m[22m
[2m   Start at [22m 21:01:09
[2m   Duration [22m 112.36s[2m (transform 1.87s, setup 237ms, collect 6.38s, tests 99.07s, environment 0ms, prepare 156ms)[22m

C:\Users\luaho\Demo project\v-edfinance\apps\api:
â€‰ERR_PNPM_RECURSIVE_RUN_FIRST_FAILâ€‰ api@0.0.1 test:cov: `vitest run --coverage`
Exit status 1
