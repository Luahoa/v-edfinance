
> v-edfinance@ test C:\Users\luaho\Demo project\v-edfinance
> vitest

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

[1m[7m[34m DEV [39m[27m[22m [34mv2.1.9 [39m[90mC:/Users/luaho/Demo project/v-edfinance[39m

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mVirtual Portfolio Creation[2m > [22m[2mshould create new portfolio with default balance for new user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mVirtual Portfolio Creation[2m > [22m[2mshould return existing portfolio for existing user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mStock Trading - BUY Operations[2m > [22m[2mshould execute BUY trade for stock with sufficient balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mStock Trading - BUY Operations[2m > [22m[2mshould accumulate stock holdings on multiple BUY trades
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mStock Trading - BUY Operations[2m > [22m[2mshould throw error when balance insufficient for BUY trade
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mCrypto Trading - BUY Operations[2m > [22m[2mshould execute BUY trade for Bitcoin
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mCrypto Trading - BUY Operations[2m > [22m[2mshould execute BUY trade for Ethereum
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mCrypto Trading - BUY Operations[2m > [22m[2mshould handle fractional crypto amounts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould execute SELL trade with sufficient assets
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould remove asset from portfolio when fully sold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould throw error when trying to sell more than owned
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mAsset Trading - SELL Operations[2m > [22m[2mshould throw error when trying to sell non-existent asset
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mStock/Crypto Price Simulation[2m > [22m[2mMulti-Asset Portfolio Management[2m > [22m[2mshould handle diverse portfolio with multiple stocks and crypto
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Generation[2m > [22m[2mshould start life scenario with AI-generated event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Generation[2m > [22m[2mshould handle AI response with code block formatting
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould continue scenario based on user choice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould throw error for invalid scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould throw error for mismatched userId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould throw error for invalid choice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mLife Scenario Continuation[2m > [22m[2mshould occasionally age the user during scenario progression
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould validate optimal 50/30/20 budget allocation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould warn about high wants allocation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould warn about low savings allocation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould throw error when allocation does not sum to 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mBudget Decision Scenarios[2m > [22m[2mshould provide loss aversion nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould calculate survival months accurately
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould calculate inflation impact on survival
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould emit nudge request during stress test
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mScenario-Based Predictions[2m > [22m[2mFinancial Stress Test Scenarios[2m > [22m[2mshould provide social proof nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould provide impact statements in Vietnamese (VI)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould provide impact statements in English (EN)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould provide impact statements in Chinese (ZH)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould calculate future value with 8% annual return
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould handle custom year periods
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mLong-Term Impact Calculations[2m > [22m[2mshould emit nudge request for budgeting context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mMarket-Specific Currency Handling[2m > [22m[2mshould handle VND (Vietnamese Dong) amounts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mMulti-Market Localization[2m > [22m[2mMarket-Specific Currency Handling[2m > [22m[2mshould format large VND amounts with localization
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mPortfolio Assets Validation[2m > [22m[2mshould validate JSONB portfolio assets on BUY trade
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mPortfolio Assets Validation[2m > [22m[2mshould validate JSONB portfolio assets on SELL trade
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mPortfolio Assets Validation[2m > [22m[2mshould validate complex multi-asset portfolio
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Status Validation[2m > [22m[2mshould validate JSONB simulation status on scenario start
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Status Validation[2m > [22m[2mshould validate JSONB simulation status on scenario continuation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Event Validation[2m > [22m[2mshould validate JSONB event structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mJSONB Market Data Validation[2m > [22m[2mSimulation Decisions Validation[2m > [22m[2mshould validate JSONB decisions array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mGoal-Based Savings[2m > [22m[2mshould create market-linked commitment for retirement
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mGoal-Based Savings[2m > [22m[2mshould throw error for insufficient balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould apply 10% penalty for early withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould log early withdrawal behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould return full amount without penalty for on-time withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould use transaction for withdrawal process
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould throw error for invalid commitment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mEarly Withdrawal Penalties[2m > [22m[2mshould throw error for mismatched user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mScenario Quality Checks[2m > [22m[2mshould validate AI-generated scenario has required fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mScenario Quality Checks[2m > [22m[2mshould reject AI scenario missing required options
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mScenario Quality Checks[2m > [22m[2mshould validate option impact values are numeric
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mExecution State Machine[2m > [22m[2mshould track scenario execution state through lifecycle
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mAI Scenario Generation Validation[2m > [22m[2mExecution State Machine[2m > [22m[2mshould prevent state transition without valid choice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mMultiple User Simulations[2m > [22m[2mshould handle concurrent portfolio trades from different users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mMultiple User Simulations[2m > [22m[2mshould handle concurrent scenario generations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mResult Calculation Accuracy[2m > [22m[2mshould accurately calculate portfolio value with multiple assets
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mResult Calculation Accuracy[2m > [22m[2mshould precisely calculate trade costs with decimals
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/simulation/market-simulation.service.spec.ts [2m([22m[2m62 tests[22m[2m)[22m[90m 78[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts[2m > [22m[2mMarket Simulation Service - Comprehensive Test Suite[2m > [22m[2mCommitment Device Market Scenarios[2m > [22m[2mConcurrent Simulation Handling[2m > [22m[2mResult Calculation Accuracy[2m > [22m[2mshould maintain precision in scenario impact calculations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/market-simulation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[31m[Nest] 8600  - [39m12/22/2025, 12:47:33 AM [31m  ERROR[39m [38;5;3m[AiService] [39m[31mGEMINI_API_KEY is not defined in environment variables[39m
[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2monModuleInit[2m > [22m[2mshould initialize with GEMINI_API_KEY from ConfigService
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2monModuleInit[2m > [22m[2mshould log error when GEMINI_API_KEY is missing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2monModuleInit[2m > [22m[2mshould fallback to process.env when ConfigService is unavailable
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould throw ForbiddenException when rate limit exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould throw ForbiddenException when monthly budget exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould return total tokens used when limits not exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mRate Limiting & Token Budgeting[2m > [22m[2mshould handle missing tokensUsed in payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask email addresses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask displayName and fullName
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask phone and address recursively
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould handle null and undefined data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mPII Masking[2m > [22m[2mshould mask short strings properly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould create thread with title and module
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould create thread without module
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould get threads ordered by updatedAt desc
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould get messages ordered by createdAt asc
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mThread Management[2m > [22m[2mshould save message and update thread timestamp
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould generate course advice with progress tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould use loss aversion for medium progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould use goal gradient for near completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould return fallback advice on JSON parse error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould check user AI usage before generating advice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mCourse Advice Generation[2m > [22m[2mshould log token usage for advice generation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould generate response with context and history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould throw NotFoundException when thread not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould summarize history when messages exceed threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould mask PII in user context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould log token usage after response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould parse action cards from response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould use cache for FAQ questions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mChat Response Generation[2m > [22m[2mshould cache FAQ responses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mparseActionCards[2m > [22m[2mshould parse valid action card JSON
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mparseActionCards[2m > [22m[2mshould handle text without action cards
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mparseActionCards[2m > [22m[2mshould handle invalid JSON in action card
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mgenerateCacheKey[2m > [22m[2mshould generate consistent hash for same prompt
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mgenerateCacheKey[2m > [22m[2mshould be case-insensitive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mgenerateCacheKey[2m > [22m[2mshould trim whitespace
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould classify FAQ questions (Vietnamese)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould classify FAQ questions (English)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould classify personalized queries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2mclassifyIntent[2m > [22m[2mshould handle mixed case
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2msummarizeHistory[2m > [22m[2mshould summarize message history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2msummarizeHistory[2m > [22m[2mshould return empty string on error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mHelper Functions[2m > [22m[2msummarizeHistory[2m > [22m[2mshould reverse messages for chronological order
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mError Handling[2m > [22m[2mshould handle Gemini API timeout
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mError Handling[2m > [22m[2mshould handle invalid course ID in getCourseAdvice
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/ai/ai.service.spec.ts [2m([22m[2m47 tests[22m[2m)[22m[90m 89[2mms[22m[39m
[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle full chat flow with rate limiting and caching
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould generate initial life scenario with AI
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould handle AI response with markdown code blocks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould continue scenario based on previous choice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould throw error for invalid choice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould throw error for unauthorized scenario access
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mScenario Generation Logic[2m > [22m[2mshould throw error when scenario does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mDifficulty Scaling[2m > [22m[2mshould generate age-appropriate scenarios for young users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mDifficulty Scaling[2m > [22m[2mshould update user status based on choice impact
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mDifficulty Scaling[2m > [22m[2mshould occasionally age the user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Vietnamese-localized scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate English-localized scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Chinese-localized scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould handle malformed JSON from LLM gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould parse JSON with extra whitespace
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould handle nested markdown code blocks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mLLM Response Mocking[2m > [22m[2mshould mock complex multi-choice scenarios
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould validate initial status structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould validate scenario event structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould validate decisions array structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould reject invalid JSONB structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mJSONB Structure Validation[2m > [22m[2mshould preserve all required fields in status updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mNudge Strategy Integration[2m > [22m[2mshould include loss aversion nudge in prompts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mNudge Strategy Integration[2m > [22m[2mshould include Hooked strategy trigger
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mNudge Strategy Integration[2m > [22m[2mshould pass previous choice context to next event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle zero impact choices
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle negative savings (debt)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts[2m > [22m[2mSimulationService - AI Scenario Generation (90%+ Coverage)[2m > [22m[2mEdge Cases[2m > [22m[2mshould cap happiness at boundaries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/scenario-generator.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/modules/simulation/scenario-generator.service.spec.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 43[2mms[22m[39m
 [32mâœ“[39m apps/api/src/modules/nudge/trigger.service.spec.ts [2m([22m[2m49 tests[22m[2m)[22m[90m 86[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould trigger nudge for user inactive for 22 hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould NOT trigger for user inactive for 19 hours (too early)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould NOT trigger for user inactive for 25 hours (too late)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTime-Based Trigger Evaluation[2m > [22m[2mStreak Inactivity Trigger (20-24h)[2m > [22m[2mshould trigger for multiple users in the time window
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould trigger SOCIAL_PROOF for HUNTER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould trigger LOSS_AVERSION for high risk level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould trigger LOSS_AVERSION for SAVER persona regardless of risk
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mInvestment Decision Trigger[2m > [22m[2mshould return default SOCIAL_PROOF for moderate risk
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mBudgeting Trigger[2m > [22m[2mshould trigger GOAL_GRADIENT for SAVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mBudgeting Trigger[2m > [22m[2mshould trigger SALIENCE with coffee mapping for default persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mBudgeting Trigger[2m > [22m[2mshould calculate coffee equivalents correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mMilestone Trigger[2m > [22m[2mshould trigger GOAL_GRADIENT for streak warning
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mRealtime Social Proof Trigger[2m > [22m[2mshould trigger SOCIAL_PROOF when many users active
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mRealtime Social Proof Trigger[2m > [22m[2mshould return null when no active users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEvent-Based Trigger Evaluation[2m > [22m[2mRealtime Social Proof Trigger[2m > [22m[2mshould query behavioral logs from last 24 hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mStreak Conditions[2m > [22m[2mshould NOT trigger for frozen streaks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mStreak Conditions[2m > [22m[2mshould NOT trigger for zero streaks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mStreak Conditions[2m > [22m[2mshould trigger for high-value streaks (7+ days)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mInactivity Conditions[2m > [22m[2mshould identify users approaching streak expiration
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger Conditions[2m > [22m[2mInactivity Conditions[2m > [22m[2mshould exclude users with recent activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mMulti-language Support[2m > [22m[2mshould generate Vietnamese message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mMulti-language Support[2m > [22m[2mshould generate English message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mMulti-language Support[2m > [22m[2mshould generate Chinese message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mPriority Assignment[2m > [22m[2mshould assign HIGH priority to loss aversion nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mPriority Assignment[2m > [22m[2mshould assign MEDIUM priority to default social proof
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mPriority Assignment[2m > [22m[2mshould assign LOW priority to salience nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mBehavioral Logging[2m > [22m[2mshould log streak nudge to BehaviorLog
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mBehavioral Logging[2m > [22m[2mshould use system session ID for automated nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mNotification Generation[2m > [22m[2mBehavioral Logging[2m > [22m[2mshould include correct event type
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mPersona-Based Behavior[2m > [22m[2mshould fetch user persona from analytics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mPersona-Based Behavior[2m > [22m[2mshould handle OBSERVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mPersona-Based Behavior[2m > [22m[2mshould handle missing user gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mMock User Behavior Data[2m > [22m[2mActivity Tracking[2m > [22m[2mshould query user activity correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mInvestment Data Structure[2m > [22m[2mshould handle riskLevel in payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mInvestment Data Structure[2m > [22m[2mshould handle missing riskLevel gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mBudgeting Data Structure[2m > [22m[2mshould validate amount field in budgeting context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mBudgeting Data Structure[2m > [22m[2mshould calculate coffee mapping from amount
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mTrigger JSONB Config Validation[2m > [22m[2mStreak Data Structure[2m > [22m[2mshould validate streak payload in notification
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould track action count for specific target
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould filter by event type and path
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould only count events from last 24 hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mRealtime Social Proof Action Tracking[2m > [22m[2mshould return zero count when no matching events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould return null for unknown context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle empty streak list gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle persona fetch failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle database query failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle behavioral log creation failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle complete streak nudge workflow
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts[2m > [22m[2mNudge Trigger Service (Comprehensive)[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle complete investment decision workflow
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/trigger.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould register a valid experiment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould throw error if variant weights do not sum to 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould throw error if traffic allocation is out of range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould throw error if experiment has less than 2 variants
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould handle experiments with multiple variants (A/B/C testing)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Registration & Validation[2m > [22m[2mshould retrieve all registered experiments
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould assign variant to new user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould return existing assignment for returning user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould return null if experiment is not active
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould return null if experiment does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould respect traffic allocation percentage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould assign variants consistently based on user ID hash
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould handle targeted experiments based on user points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould include user if within target audience range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Assignment[2m > [22m[2mshould distribute variants according to weight ratios
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mConversion Tracking[2m > [22m[2mshould track conversion events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mConversion Tracking[2m > [22m[2mshould track conversions without value
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mConversion Tracking[2m > [22m[2mshould handle multiple conversion types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould calculate performance metrics for each variant
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould handle zero conversions gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould throw error for non-existent experiment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mVariant Performance Tracking[2m > [22m[2mshould aggregate conversion values correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould calculate statistical significance with sufficient data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould mark results as significant when p-value < 0.05
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould throw error with insufficient data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould throw error for non-existent variants
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould calculate correct uplift percentage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mStatistical Significance Calculations[2m > [22m[2mshould provide confidence level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould pause an active experiment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould complete an experiment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould not assign variants to paused experiments
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mExperiment Lifecycle Management[2m > [22m[2mshould handle experiments with date ranges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle user with no points in targeted experiment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle experiment with zero traffic allocation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle partial traffic allocation correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle experiments with custom configuration per variant
[22m[39mðŸ§¹ Cleaning up after test...

 [31mâ¯[39m apps/api/src/modules/analytics/ab-testing.service.spec.ts [2m([22m[2m37 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 82[2mms[22m[39m
[31m   [31mÃ—[31m ABTestingService - A/B Testing Framework[2m > [22mVariant Assignment[2m > [22mshould distribute variants according to weight ratios[90m 16[2mms[22m[31m[39m
[31m     â†’ expected 0.882 to be less than 0.75[39m
[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22m[2mABTestingService - A/B Testing Framework[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould maintain consistent hashing across service instances
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/ab-testing.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[31m[Nest] 8600  - [39m12/22/2025, 12:47:34 AM [31m  ERROR[39m [38;5;3m[AnalyticsService] [39m[31mLog aggregation failed[39m
[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mUser Behavior Analysis Pipeline[2m > [22m[2mshould analyze user behavior from raw logs to persona classification
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mUser Behavior Analysis Pipeline[2m > [22m[2mshould handle SAVER persona with commitment-focused behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mUser Behavior Analysis Pipeline[2m > [22m[2mshould default to OBSERVER for mixed behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mLearning Habits Analysis[2m > [22m[2mshould identify peak learning hours from activity patterns
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mLearning Habits Analysis[2m > [22m[2mshould return null for users with no activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould generate complete financial future simulation with persona context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould predict churn risk based on activity gaps
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould return HIGH churn risk for large activity gaps
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEnd-to-End Analytics Flows[2m > [22m[2mPredictive Analysis Pipeline[2m > [22m[2mshould return LOW churn risk for consistent daily activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mMentor Service with Analytics Integration[2m > [22m[2mshould integrate persona, churn risk, and user profile for personalized advice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mMentor Service with Analytics Integration[2m > [22m[2mshould select WISE_SAGE persona for SAVER users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mMentor Service with Analytics Integration[2m > [22m[2mshould include high churn risk warning in AI context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mSystem-Wide Statistics Aggregation[2m > [22m[2mshould aggregate data from multiple Prisma models
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mCross-Service Data Aggregation[2m > [22m[2mSystem-Wide Statistics Aggregation[2m > [22m[2mshould handle null aggregate values gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mSystem Health Monitoring[2m > [22m[2mshould execute complete health check workflow
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mSystem Health Monitoring[2m > [22m[2mshould detect and warn about critical error rates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mSystem Health Monitoring[2m > [22m[2mshould handle database connection failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mLog Aggregation and Archiving[2m > [22m[2mshould aggregate and archive behavior logs successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mLog Aggregation and Archiving[2m > [22m[2mshould skip aggregation when no logs exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mLog Aggregation and Archiving[2m > [22m[2mshould handle aggregation errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mVariable Reward Distribution[2m > [22m[2mshould award variable rewards based on lesson completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mVariable Reward Distribution[2m > [22m[2mshould not award rewards when random threshold not met
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mReport Generation Pipeline[2m > [22m[2mVariable Reward Distribution[2m > [22m[2mshould include reward notification in AI response context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould properly mock all Prisma dependencies
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould properly mock GeminiService
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould properly mock EventEmitter2
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould ensure service dependencies are injected correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mDependency Mocking and Isolation[2m > [22m[2mshould handle circular dependencies between analytics and predictive services
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle empty user data gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle invalid date ranges in log queries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle concurrent health checks without race conditions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould maintain data consistency during aggregation failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mPerformance and Scalability[2m > [22m[2mshould efficiently handle large behavior log datasets
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts[2m > [22m[2mAnalytics System Integration Tests[2m > [22m[2mPerformance and Scalability[2m > [22m[2mshould batch process multiple user personas efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/modules/analytics/analytics.integration.spec.ts [2m([22m[2m34 tests[22m[2m)[22m[90m 105[2mms[22m[39m
Error: Database error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\analytics\analytics.integration.spec.ts:504:59
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
[31m[Nest] 8600  - [39m12/22/2025, 12:47:34 AM [31m  ERROR[39m [38;5;3m[AnalyticsService] [39m[31mLog aggregation failed[39m
Error: Delete failed
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\analytics\analytics.integration.spec.ts:694:59
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould generate daily report with correct metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould generate weekly report with aggregated data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould generate monthly report with top users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould filter report by userId when provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mgenerateReport[2m > [22m[2mshould handle custom date range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToCSV[2m > [22m[2mshould export report to CSV format in Vietnamese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToCSV[2m > [22m[2mshould export report to CSV format in English
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToCSV[2m > [22m[2mshould export report to CSV format in Chinese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToPDF[2m > [22m[2mshould export report to PDF format in Vietnamese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToPDF[2m > [22m[2mshould export report to PDF format in English
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mexportToPDF[2m > [22m[2mshould export report to PDF format in Chinese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for bar chart visualization
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for pie chart (activity distribution)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for horizontal bar chart (top users)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2mprepareVisualizationData[2m > [22m[2mshould prepare data for gauge chart (progress)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2maggregated data mocking[2m > [22m[2mshould handle large datasets efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2maggregated data mocking[2m > [22m[2mshould sort activities by count descending
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2maggregated data mocking[2m > [22m[2mshould limit activities to top 10
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2medge cases[2m > [22m[2mshould handle zero metrics gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22m[2mReportsService[2m > [22m[2medge cases[2m > [22m[2mshould handle report with no activities
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/reports.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/modules/analytics/reports.service.spec.ts [2m([22m[2m20 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 53[2mms[22m[39m
[31m   [31mÃ—[31m ReportsService[2m > [22mgenerateReport[2m > [22mshould generate daily report with correct metrics[90m 6[2mms[22m[31m[39m
[31m     â†’ expected 3 to be 2 // Object.is equality[39m
[31m   [31mÃ—[31m ReportsService[2m > [22mgenerateReport[2m > [22mshould generate monthly report with top users[90m 2[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'length')[39m
[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log PAGE_VIEW event with correct structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log BUTTON_CLICK event with element metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log SCROLL event with scroll depth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log VIDEO_PLAY event with playback metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Logging - Standard Events[2m > [22m[2mshould log FORM_SUBMIT event with validation results
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould track multiple events within same session
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould retrieve all events for a specific session
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould count active sessions in time window
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mUser Session Tracking[2m > [22m[2mshould handle session timeout edge cases
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Aggregation Logic[2m > [22m[2mshould aggregate events by type for date range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Aggregation Logic[2m > [22m[2mshould handle empty event set in aggregation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEvent Aggregation Logic[2m > [22m[2mshould aggregate events with missing duration
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould validate nested JSONB payload structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould handle multi-locale JSONB content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould preserve deviceInfo JSONB structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mJSONB Metadata Structure Validation[2m > [22m[2mshould handle array data in JSONB payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle database create success
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle database create failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle concurrent database operations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle findMany with complex filters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mDatabase Operation Mocking[2m > [22m[2mshould handle empty result set from database
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle undefined userId for anonymous tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle null userId for anonymous tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould set default actionCategory when not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould set default duration to 0 when not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle extremely large payload data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle special characters in path and eventType
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould handle rapid sequential logging without blocking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould handle parallel event logging efficiently
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/analytics/behavior-tracking.service.spec.ts [2m([22m[2m30 tests[22m[2m)[22m[90m 77[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts[2m > [22m[2mBehaviorTrackingService - Comprehensive Tests[2m > [22m[2mPerformance & Scalability[2m > [22m[2mshould aggregate large datasets efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/behavior-tracking.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect and flag explicit profanity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect hate speech
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect sexual content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect violence and threats
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould detect spam and promotional content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mInappropriate Content Detection[2m > [22m[2mshould allow safe content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould moderate Vietnamese content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould moderate English content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould moderate Chinese content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould auto-detect language when not specified
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mMulti-Language Moderation[2m > [22m[2mshould handle language-specific profanity patterns
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify NONE severity for clean content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify LOW severity for minor issues
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify MEDIUM severity for moderate issues
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify HIGH severity for serious violations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould classify CRITICAL severity for extreme violations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mSeverity Classification[2m > [22m[2mshould escalate severity based on multiple category violations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle empty content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle very long content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle special characters and emojis
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle API errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle rate limiting from API
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle null/undefined content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mLogging and Auditing[2m > [22m[2mshould log all moderation attempts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mLogging and Auditing[2m > [22m[2mshould log flagged content with detailed metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mLogging and Auditing[2m > [22m[2mshould not store full content for privacy (hash only)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mUser Strike System[2m > [22m[2mshould increment strike count for HIGH severity violations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mUser Strike System[2m > [22m[2mshould ban user after 3 CRITICAL violations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mUser Strike System[2m > [22m[2mshould not count LOW severity towards strikes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mContext-Aware Moderation[2m > [22m[2mshould allow educational discussions about sensitive topics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mContext-Aware Moderation[2m > [22m[2mshould be stricter in public forums than private messages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mPerformance and Caching[2m > [22m[2mshould cache moderation results for identical content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mPerformance and Caching[2m > [22m[2mshould handle batch moderation efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mAI API Mocking[2m > [22m[2mshould mock OpenAI Moderation API response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mAI API Mocking[2m > [22m[2mshould mock Google Perspective API response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mAI API Mocking[2m > [22m[2mshould mock custom Gemini Moderation API
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mReal-World Scenarios[2m > [22m[2mshould handle financial scam attempts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mReal-World Scenarios[2m > [22m[2mshould handle phishing attempts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22m[2mModerationService (AI Content Moderation)[2m > [22m[2mmoderateContent[2m > [22m[2mReal-World Scenarios[2m > [22m[2mshould allow legitimate financial discussions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/moderation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/modules/ai/moderation.service.spec.ts [2m([22m[2m39 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[90m 98[2mms[22m[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould increment strike count for HIGH severity violations[90m 3[2mms[22m[31m[39m
[31m     â†’ Moderation API error[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould ban user after 3 CRITICAL violations[90m 3[2mms[22m[31m[39m
[31m     â†’ expected error to be instance of ForbiddenException[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould not count LOW severity towards strikes[90m 5[2mms[22m[31m[39m
[31m     â†’ Moderation API error[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock OpenAI Moderation API response[90m 2[2mms[22m[31m[39m
[31m     â†’ expected undefined to be false // Object.is equality[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock Google Perspective API response[90m 4[2mms[22m[31m[39m
[31m     â†’ expected undefined to be false // Object.is equality[39m
[31m   [31mÃ—[31m ModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock custom Gemini Moderation API[90m 2[2mms[22m[31m[39m
[31m     â†’ expected undefined to be false // Object.is equality[39m
[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould collect real-time metrics from last 10 minutes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould handle zero events gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould update Prometheus gauges on metrics collection
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mLive Metric Updates[2m > [22m[2mshould export metrics in Prometheus format
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould track active WebSocket connections
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould broadcast real-time events to all connected clients
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould send targeted events to specific users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould broadcast to groups (rooms)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mWebSocket Event Streaming[2m > [22m[2mshould handle client disconnection and cleanup
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould aggregate behavior logs efficiently for daily archival
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould perform health check aggregation every hour
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould calculate global system stats efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould analyze user learning habits from behavior logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mData Aggregation Performance[2m > [22m[2mshould handle empty user learning habits
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould generate mock behavioral data for stress testing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould run AI stress test with different complexity levels
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould handle AI stress test failures gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mMock Real-Time Data Sources[2m > [22m[2mshould simulate complete user flow for integration testing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould run comprehensive diagnostics with all subsystems
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould detect database connection failure in diagnostics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould validate JSONB schema integrity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mFull System Diagnostics Integration[2m > [22m[2mshould warn on JSONB schema drift
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mPerformance Benchmarks[2m > [22m[2mshould complete metrics collection in under 100ms (mocked)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mPerformance Benchmarks[2m > [22m[2mshould handle high-volume log aggregation efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mUser Persona Classification[2m > [22m[2mshould classify user as HUNTER (risk-taker)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mUser Persona Classification[2m > [22m[2mshould classify user as SAVER (conservative)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22m[2mRealtimeDashboardService (Integration)[2m > [22m[2mUser Persona Classification[2m > [22m[2mshould classify user as OBSERVER (default)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts [2m([22m[2m27 tests[22m[2m | [22m[31m27 failed[39m[2m)[22m[90m 212[2mms[22m[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould collect real-time metrics from last 10 minutes[90m 13[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould handle zero events gracefully[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould update Prometheus gauges on metrics collection[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould export metrics in Prometheus format[90m 8[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould track active WebSocket connections[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould broadcast real-time events to all connected clients[90m 6[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould send targeted events to specific users[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould broadcast to groups (rooms)[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould handle client disconnection and cleanup[90m 9[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould aggregate behavior logs efficiently for daily archival[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould perform health check aggregation every hour[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould calculate global system stats efficiently[90m 8[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould analyze user learning habits from behavior logs[90m 6[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould handle empty user learning habits[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould generate mock behavioral data for stress testing[90m 7[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould run AI stress test with different complexity levels[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould handle AI stress test failures gracefully[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould simulate complete user flow for integration testing[90m 13[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould run comprehensive diagnostics with all subsystems[90m 6[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould detect database connection failure in diagnostics[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould validate JSONB schema integrity[90m 8[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould warn on JSONB schema drift[90m 11[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mPerformance Benchmarks[2m > [22mshould complete metrics collection in under 100ms (mocked)[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mPerformance Benchmarks[2m > [22mshould handle high-volume log aggregation efficiently[90m 10[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as HUNTER (risk-taker)[90m 5[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as SAVER (conservative)[90m 40[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[31m   [31mÃ—[31m RealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as OBSERVER (default)[90m 4[2mms[22m[31m[39m
[31m     â†’ Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould create a commitment contract with valid data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould reject contract creation with insufficient balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould calculate correct unlock date based on months
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mContract Creation[2m > [22m[2mshould create multiple contracts for different goals
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mStake Locking[2m > [22m[2mshould lock funds by decrementing portfolio balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mStake Locking[2m > [22m[2mshould verify locked amount matches commitment record
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mStake Locking[2m > [22m[2mshould prevent negative balance after locking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould successfully withdraw on-time commitment without penalty
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould apply penalty for early withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould reject withdrawal for non-existent commitment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mCompletion Verification[2m > [22m[2mshould reject withdrawal by unauthorized user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mMock Financial Data[2m > [22m[2mshould simulate portfolio with realistic balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mMock Financial Data[2m > [22m[2mshould handle zero balance portfolio gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mMock Financial Data[2m > [22m[2mshould support large commitment amounts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould calculate 10% penalty for early withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould calculate penalty with different rates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould return full amount when unlockDate is exactly now
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould log penalty event with correct metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mPenalty Calculation[2m > [22m[2mshould handle edge case: zero penalty rate
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mIntegration: Full Lifecycle[2m > [22m[2mshould complete full commitment lifecycle: create â†’ withdraw early â†’ log penalty
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/nudge/commitment.service.spec.ts [2m([22m[2m21 tests[22m[2m)[22m[90m 73[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts[2m > [22m[2mCommitmentService (via SimulationService)[2m > [22m[2mIntegration: Full Lifecycle[2m > [22m[2mshould handle complete lifecycle: create â†’ wait â†’ withdraw without penalty
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/commitment.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcreatePost[2m > [22m[2mshould create a post and broadcast it
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mjoinGroup[2m > [22m[2mshould allow a user to join a group and create a welcome post
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mjoinGroup[2m > [22m[2mshould throw error if group is full
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mupdateGroupStreak[2m > [22m[2mshould increment group streak if all members are active
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mupdateGroupStreak[2m > [22m[2mshould nudge group if some members are inactive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcheckChallengeProgress[2m > [22m[2mshould complete challenge and reward members if target reached
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcheckChallengeProgress[2m > [22m[2mshould fail challenge if expired and target not reached
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgenerateCompetitiveNudge[2m > [22m[2mshould generate nudge for the user in second place
[22m[39m[Push Notification] to u2: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch leader 200 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 200 points behind leader. Finish one more lesson to overtake!","zh":"ä½ åªè½åŽ leader 200 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetFeed[2m > [22m[2mshould return posts for user groups and public posts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcreateGroup[2m > [22m[2mshould create a group and add the creator as leader
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetGroupDetails[2m > [22m[2mshould return group with members and challenges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetRecommendedGroups[2m > [22m[2mshould return fallback groups if user has no profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mgetRecommendedGroups[2m > [22m[2mshould return learning groups for beginners
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mcreateGroupChallenge[2m > [22m[2mshould create a challenge and announce it
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mChallenge Progress Tracking (S005)[2m > [22m[2mshould calculate progress correctly with partial completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mChallenge Progress Tracking (S005)[2m > [22m[2mshould handle challenge with no members
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mChallenge Progress Tracking (S005)[2m > [22m[2mshould handle concurrent challenge checks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Membership Validation (S005)[2m > [22m[2mshould prevent joining already joined group
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Membership Validation (S005)[2m > [22m[2mshould validate group exists before joining
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Membership Validation (S005)[2m > [22m[2mshould handle group at max capacity minus one
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mWebSocket Broadcast Integration (S005)[2m > [22m[2mshould broadcast post creation to all members
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mWebSocket Broadcast Integration (S005)[2m > [22m[2mshould handle broadcast failure gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Streak Edge Cases (S005)[2m > [22m[2mshould not increment streak if any member inactive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Streak Edge Cases (S005)[2m > [22m[2mshould handle group with all active members
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mGroup Streak Edge Cases (S005)[2m > [22m[2mshould handle missing streak data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mFeed Generation (S005)[2m > [22m[2mshould return empty feed if user has no groups
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mFeed Generation (S005)[2m > [22m[2mshould include public posts for all users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mFeed Generation (S005)[2m > [22m[2mshould combine group and public posts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mCompetitive Nudge Generation (S005)[2m > [22m[2mshould not generate nudge if only one member
[22m[39mðŸ§¹ Cleaning up after test...

 [31mâ¯[39m apps/api/src/modules/social/social.service.spec.ts [2m([22m[2m30 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 102[2mms[22m[39m
[31m   [31mÃ—[31m SocialService[2m > [22mChallenge Progress Tracking (S005)[2m > [22mshould handle challenge with no members[90m 6[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called at least once[39m
[31m   [31mÃ—[31m SocialService[2m > [22mWebSocket Broadcast Integration (S005)[2m > [22mshould handle broadcast failure gracefully[90m 8[2mms[22m[31m[39m
[31m     â†’ promise resolved "{ id: 'p1', userId: 'u1', â€¦(1) }" instead of rejecting[39m
[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts[2m > [22m[2mSocialService[2m > [22m[2mCompetitive Nudge Generation (S005)[2m > [22m[2mshould target second place correctly
[22m[39m[Push Notification] to u2: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch first 100 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 100 points behind first. Finish one more lesson to overtake!","zh":"ä½ åªè½åŽ first 100 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mVariable Reward Algorithms[2m > [22m[2mshould apply RANDOM variable ratio schedule (VR-3: avg 3 actions per reward)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mVariable Reward Algorithms[2m > [22m[2mshould apply FIXED interval schedule (FI-5: reward every 5th minute)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mVariable Reward Algorithms[2m > [22m[2mshould calculate progressive reward multiplier based on streak
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mVariable Reward Algorithms[2m > [22m[2mshould implement jackpot mechanic (1% chance for 10x reward)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Timing Optimization[2m > [22m[2mshould delay reward delivery for suspense (200-500ms)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Timing Optimization[2m > [22m[2mshould trigger reward immediately after critical milestone
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Timing Optimization[2m > [22m[2mshould batch rewards during high-frequency actions (debounce 2s)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Timing Optimization[2m > [22m[2mshould schedule prime-time bonuses (7-9 PM: +20% rewards)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Value Calculation[2m > [22m[2mshould scale rewards based on user level (exponential curve)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Value Calculation[2m > [22m[2mshould apply persona-based reward weights (HUNTER: 1.5x risk rewards)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Value Calculation[2m > [22m[2mshould cap daily rewards to prevent exploitation (max 500 points/day)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mReward Value Calculation[2m > [22m[2mshould calculate diminishing returns for repeated actions (5% decay per repeat)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mGamification Service Integration (Mocked)[2m > [22m[2mshould emit points.earned event after reward distribution
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mGamification Service Integration (Mocked)[2m > [22m[2mshould trigger nudge after reward threshold reached
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mGamification Service Integration (Mocked)[2m > [22m[2mshould validate sufficient points before deduction
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mGamification Service Integration (Mocked)[2m > [22m[2mshould successfully deduct points and log behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mGamification Service Integration (Mocked)[2m > [22m[2mshould handle concurrent reward distributions without race conditions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould implement near-miss mechanic (show "almost won" at 95% threshold)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould trigger achievement unlock with celebration animation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould implement loss aversion nudge (show potential loss: -20 points)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould apply social proof to boost motivation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould create anticipation phase before big reward reveal (3s countdown)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould implement progress bar momentum (90% completion triggers urgency)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mDopamine-Driven Mechanics[2m > [22m[2mshould randomize reward particle effects for variety
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle negative reward values gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould prevent reward overflow (max 999999 points)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle missing user gracefully during reward distribution
[22m[39mðŸ§¹ Cleaning up after test...

 [31mâ¯[39m apps/api/src/modules/nudge/reward.service.spec.ts [2m([22m[2m28 tests[22m[2m | [22m[31m28 failed[39m[2m)[22m[90m 29[2mms[22m[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mVariable Reward Algorithms[2m > [22mshould apply RANDOM variable ratio schedule (VR-3: avg 3 actions per reward)[90m 2[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mVariable Reward Algorithms[2m > [22mshould apply FIXED interval schedule (FI-5: reward every 5th minute)[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mVariable Reward Algorithms[2m > [22mshould calculate progressive reward multiplier based on streak[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mVariable Reward Algorithms[2m > [22mshould implement jackpot mechanic (1% chance for 10x reward)[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Timing Optimization[2m > [22mshould delay reward delivery for suspense (200-500ms)[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Timing Optimization[2m > [22mshould trigger reward immediately after critical milestone[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Timing Optimization[2m > [22mshould batch rewards during high-frequency actions (debounce 2s)[90m 3[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Timing Optimization[2m > [22mshould schedule prime-time bonuses (7-9 PM: +20% rewards)[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Value Calculation[2m > [22mshould scale rewards based on user level (exponential curve)[90m 2[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Value Calculation[2m > [22mshould apply persona-based reward weights (HUNTER: 1.5x risk rewards)[90m 2[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Value Calculation[2m > [22mshould cap daily rewards to prevent exploitation (max 500 points/day)[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Value Calculation[2m > [22mshould calculate diminishing returns for repeated actions (5% decay per repeat)[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mGamification Service Integration (Mocked)[2m > [22mshould emit points.earned event after reward distribution[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mGamification Service Integration (Mocked)[2m > [22mshould trigger nudge after reward threshold reached[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mGamification Service Integration (Mocked)[2m > [22mshould validate sufficient points before deduction[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mGamification Service Integration (Mocked)[2m > [22mshould successfully deduct points and log behavior[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mGamification Service Integration (Mocked)[2m > [22mshould handle concurrent reward distributions without race conditions[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould implement near-miss mechanic (show "almost won" at 95% threshold)[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould trigger achievement unlock with celebration animation[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould implement loss aversion nudge (show potential loss: -20 points)[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould apply social proof to boost motivation[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould create anticipation phase before big reward reveal (3s countdown)[90m 2[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould implement progress bar momentum (90% completion triggers urgency)[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould randomize reward particle effects for variety[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mEdge Cases & Error Handling[2m > [22mshould handle negative reward values gracefully[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mEdge Cases & Error Handling[2m > [22mshould prevent reward overflow (max 999999 points)[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mEdge Cases & Error Handling[2m > [22mshould handle missing user gracefully during reward distribution[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m RewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mEdge Cases & Error Handling[2m > [22mshould log simulation events without incrementing real points[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22m[2mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould log simulation events without incrementing real points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/reward.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould calculate daily active users correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould handle empty logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould deduplicate users within the same day
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateDAU[2m > [22m[2mshould filter out null userId entries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateWAU[2m > [22m[2mshould calculate weekly active users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateWAU[2m > [22m[2mshould return 0 for no active users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateMAU[2m > [22m[2mshould calculate monthly active users for December 2025
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateMAU[2m > [22m[2mshould handle edge case of February
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateRetention[2m > [22m[2mshould calculate cohort retention correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateRetention[2m > [22m[2mshould handle zero retention
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateRetention[2m > [22m[2mshould handle empty cohort
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateEngagement[2m > [22m[2mshould calculate engagement metrics correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateEngagement[2m > [22m[2mshould handle empty logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculateEngagement[2m > [22m[2mshould calculate 100% bounce rate when all sessions have 1 event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 50th percentile (median) correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 95th percentile correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 0th percentile (minimum)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould calculate 100th percentile (maximum)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould handle single value array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould return 0 for empty array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould throw error for invalid percentile < 0
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould throw error for invalid percentile > 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mcalculatePercentile[2m > [22m[2mshould handle unsorted input correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mgetUserPointsPercentiles[2m > [22m[2mshould calculate multiple percentiles for user points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mgetUserPointsPercentiles[2m > [22m[2mshould handle users with zero points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mgetUserPointsPercentiles[2m > [22m[2mshould handle empty user list
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mevents metric[2m > [22m[2mshould aggregate events by day
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mevents metric[2m > [22m[2mshould aggregate events by hour
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2musers metric[2m > [22m[2mshould aggregate unique users by day
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2musers metric[2m > [22m[2mshould filter out null userIds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2msessions metric[2m > [22m[2mshould aggregate unique sessions by day
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mweek interval[2m > [22m[2mshould aggregate by week starting Monday
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mweek interval[2m > [22m[2mshould handle Sunday correctly (week starts Monday)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mshould return empty array for no logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2maggregateTimeSeries[2m > [22m[2mshould sort results chronologically
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mDatabase Integration[2m > [22m[2mshould use correct Prisma query for DAU
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mDatabase Integration[2m > [22m[2mshould use distinct query for WAU
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle timezone differences correctly
[22m[39mðŸ§¹ Cleaning up after test...

 [31mâ¯[39m apps/api/src/modules/analytics/metrics.service.spec.ts [2m([22m[2m39 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 124[2mms[22m[39m
[31m   [31mÃ—[31m MetricsService[2m > [22mcalculateRetention[2m > [22mshould handle empty cohort[90m 3[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading 'length')[39m
[31m   [31mÃ—[31m MetricsService[2m > [22mcalculatePercentile[2m > [22mshould calculate 95th percentile correctly[90m 3[2mms[22m[31m[39m
[31m     â†’ expected 9.549999999999999 to be 9.55 // Object.is equality[39m
[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22m[2mMetricsService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle large datasets efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/metrics.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould estimate tokens correctly (1 token ~ 4 chars)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould estimate multipart tokens
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould handle empty array in multipart estimation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould truncate text to token budget
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould not truncate if within budget
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mTokenization Helpers[2m > [22m[2mshould validate token budget
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould mask email addresses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould mask displayName
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould mask phone numbers
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould handle short strings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould recursively mask nested objects
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould handle null and undefined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPII Masking Helpers[2m > [22m[2mshould not mask non-PII fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build course advice prompt for low progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build course advice prompt for medium progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build course advice prompt for high progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build persona prompt for WISE_SAGE
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build persona prompt for STRICT_COACH
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould include group streak context when high
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mPrompt Template Builders[2m > [22m[2mshould build system instruction with all context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould parse action cards from response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould handle response without action cards
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould handle malformed action card JSON
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould extract JSON from markdown
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould throw on invalid JSON
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould parse valid course advice response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mResponse Parsing Utilities[2m > [22m[2mshould return fallback for invalid course advice response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould generate consistent cache keys
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould be case-insensitive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould trim whitespace
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mCache Key Generation[2m > [22m[2mshould start with ai_response prefix
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould classify FAQ intents (Vietnamese)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould classify FAQ intents (English)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould classify personalized advice intents
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould handle v-edfinance specific questions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mIntent Classification[2m > [22m[2mshould be case-insensitive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould create fallback response for Vietnamese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould create fallback response for English
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould create fallback response for Chinese
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould default to English for unknown locale
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould handle AI errors with context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstderr[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould handle AI errors with context
[22m[39mAI Error in generateResponse: Network timeout Error: Network timeout
    at [90mC:\Users\luaho\Demo project\v-edfinance\[39mapps\api\src\modules\ai\utils\ai.utils.spec.ts:572:21
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7[90m)[39m
    at runTest [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runFiles [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5[90m)[39m
    at startTests [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3[90m)[39m

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mError Handling Helpers[2m > [22m[2mshould handle AI errors without context
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/ai/utils/ai.utils.spec.ts [2m([22m[2m46 tests[22m[2m)[22m[90m 10[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould handle empty strings in all utilities
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould handle very long texts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould handle special characters in prompts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts[2m > [22m[2mAI Utility Functions[2m > [22m[2mEdge Cases & Integration[2m > [22m[2mshould maintain type safety in metadata parsing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/utils/ai.utils.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/ai/ai.integration.spec.ts [2m([22m[2m18 tests[22m[2m | [22m[33m18 skipped[39m[2m)[22m[90m 20[2mms[22m[39m
[90mstdout[2m | apps/api/src/ai/ai.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould generate high-percentage cohort message for popular action
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould generate medium-priority message for moderate adoption
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould generate low-priority message for low adoption
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould return null if user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould return null if cohort has zero users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateCohortMessage - "X% of users like you"[2m > [22m[2mshould handle action without targetId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould generate congratulatory message when user is above average
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould generate motivational message when user is below average
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould handle middle-ranked user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould return null if user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgeneratePeerComparison - Peer ranking logic[2m > [22m[2mshould handle edge case with no peers
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould generate positive message when user is aligned with norm
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould generate motivational message when user is NOT aligned
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould handle different behavior types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgenerateSocialNorm - Social norm framing[2m > [22m[2mshould return null if no social norm data available
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgetRealtimeActivity - Real-time social proof[2m > [22m[2mshould get activity count for last 24 hours by default
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgetRealtimeActivity - Real-time social proof[2m > [22m[2mshould support custom time windows
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mgetRealtimeActivity - Real-time social proof[2m > [22m[2mshould handle zero activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMessage localization[2m > [22m[2mshould provide messages in all three locales (vi, en, zh)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMessage localization[2m > [22m[2mshould use appropriate language-specific terminology
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould handle database errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould handle missing investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould round percentages correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mEdge cases and error handling[2m > [22m[2mshould handle very small cohorts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mPriority calculation[2m > [22m[2mshould assign HIGH priority for >= 75%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mPriority calculation[2m > [22m[2mshould assign MEDIUM priority for 50-74%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mPriority calculation[2m > [22m[2mshould assign LOW priority for < 50%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMetadata accuracy[2m > [22m[2mshould include accurate cohort metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMetadata accuracy[2m > [22m[2mshould include accurate peer metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22m[2mSocialProofService[2m > [22m[2mMetadata accuracy[2m > [22m[2mshould include accurate social norm metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/social-proof.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/modules/nudge/social-proof.service.spec.ts [2m([22m[2m31 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[90m 105[2mms[22m[39m
[31m   [31mÃ—[31m SocialProofService[2m > [22mgenerateCohortMessage - "X% of users like you"[2m > [22mshould return null if cohort has zero users[90m 5[2mms[22m[31m[39m
[31m     â†’ expected { type: 'SOCIAL_PROOF', â€¦(3) } to be null[39m
[31m   [31mÃ—[31m SocialProofService[2m > [22mgeneratePeerComparison - Peer ranking logic[2m > [22mshould generate congratulatory message when user is above average[90m 4[2mms[22m[31m[39m
[31m     â†’ expected '100% ngÆ°á»i dÃ¹ng Ä‘ang dáº«n trÆ°á»›c báº¡n vá»â€¦' to contain 'vÆ°á»£t trá»™i'[39m
[31m   [31mÃ—[31m SocialProofService[2m > [22mgeneratePeerComparison - Peer ranking logic[2m > [22mshould generate motivational message when user is below average[90m 3[2mms[22m[31m[39m
[31m     â†’ expected 'MEDIUM' to be 'HIGH' // Object.is equality[39m
[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould calculate conversion funnel with correct drop-off rates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould handle empty funnel data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould calculate average time to next stage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mgetConversionFunnel[2m > [22m[2mshould handle users who never complete next stage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould identify critical drop-off points above threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould return severe reasons for high drop-off rates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould return empty array when no critical drop-offs exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mdetectDropOffPoints[2m > [22m[2mshould use custom threshold for detection
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould analyze cohort retention across stages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould calculate average completion time for cohort
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould handle cohort with no users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2manalyzeCohort[2m > [22m[2mshould track week-over-week cohort performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould track complete user journey with all stages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould mark journey as incomplete when no completion events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould return empty journey for new users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould calculate journey duration in seconds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mtrackUserJourney[2m > [22m[2mshould preserve timestamp order for journey reconstruction
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle single-stage funnel
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle null userId in cohort analysis
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle concurrent user sessions in time calculation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle users with incomplete journeys in cohort
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle zero division in conversion rate calculation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mComplex Funnel Scenarios[2m > [22m[2mshould analyze multi-step onboarding funnel
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mComplex Funnel Scenarios[2m > [22m[2mshould identify multiple drop-off points in complex funnel
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mComplex Funnel Scenarios[2m > [22m[2mshould compare cohort performance across different time periods
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mPerformance and Optimization[2m > [22m[2mshould handle large dataset efficiently
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/analytics/funnel-analysis.service.spec.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 80[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts[2m > [22m[2mFunnelAnalysisService[2m > [22m[2mPerformance and Optimization[2m > [22m[2mshould batch process funnel stages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/funnel-analysis.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould analyze behavior patterns from BehaviorLog data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould handle empty behavior log gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould prioritize recent behavior (last 50 logs)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mUser Behavior Analysis[2m > [22m[2mshould analyze mixed behavior patterns accurately
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as HUNTER for dominant risk-taking behavior (>5 events)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as SAVER for dominant commitment behavior (>5 events)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as OBSERVER when risk-taking events â‰¤5
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as OBSERVER when saving events â‰¤5
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as OBSERVER when behaviors are balanced
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould handle edge case: exactly 5 risk-taking events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Classification Logic[2m > [22m[2mshould classify as HUNTER when exactly 6 risk-taking events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould identify HUNTER profile: high risk tolerance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould identify SAVER profile: commitment-focused
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould identify OBSERVER profile: passive engagement
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould profile based on event frequency distribution
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPsychological Profiling[2m > [22m[2mshould analyze behavioral consistency over time
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould process various event types correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould handle malformed log data gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould process logs with complete metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould handle database query errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mMock BehaviorLog Data Handling[2m > [22m[2mshould respect the 50-log limit
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould recommend HUNTER persona for aggressive investors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould recommend SAVER persona for conservative users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould recommend OBSERVER persona for new users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould validate persona transitions over time
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould handle persona ambiguity with default to OBSERVER
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPersona Recommendations Validation[2m > [22m[2mshould provide consistent recommendations for similar behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle single behavior log entry
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle exactly threshold behaviors (boundary)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle maximum logs (50 entries)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould handle mixed event types with unknown events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mEdge Cases & Boundary Conditions[2m > [22m[2mshould return consistent results for multiple calls
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPerformance & Data Quality[2m > [22m[2mshould handle large datasets efficiently
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/ai/persona-analysis.service.spec.ts [2m([22m[2m34 tests[22m[2m)[22m[90m 199[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts[2m > [22m[2mPersonaAnalysisService (via AnalyticsService)[2m > [22m[2mPerformance & Data Quality[2m > [22m[2mshould validate data integrity of behavior logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/persona-analysis.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould generate GAIN-framed message with positive outcome emphasis
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould generate LOSS-framed message with loss aversion emphasis
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould use GAIN framing for opportunity contexts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mGain vs Loss Framing[2m > [22m[2mshould use LOSS framing for risk scenarios
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to LOSS framing for streak contexts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to LOSS framing for risk contexts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to GAIN framing for opportunity contexts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to LOSS for SAVER persona (risk-averse)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould default to GAIN for HUNTER persona in neutral contexts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mDefault Effect Logic[2m > [22m[2mshould apply DEFAULT framing and select based on context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Vietnamese framed message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate English framed message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould generate Chinese framed message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould fallback to Vietnamese if locale is invalid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould get all localized templates for a context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mLocalization (vi/en/zh)[2m > [22m[2mshould handle parameter interpolation in all locales
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould correctly interpolate amount parameter
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould correctly interpolate days parameter
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould correctly interpolate count parameter
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mMessage Template Mocking[2m > [22m[2mshould handle multiple parameters in template
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould assign variant from A/B test when experimentId is provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould use original framing if no A/B test assignment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould work without experimentId (no A/B testing)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould track variant assignment for analytics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mA/B Testing Integration[2m > [22m[2mshould handle A/B test error gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle missing parameters gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle empty locale with fallback
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould return valid message key when translation not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould handle undefined userProfile in getDefaultFraming
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould handle null params in generateFramedMessage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould correctly identify multiple loss context keywords
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould generate consistent messages for same inputs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts[2m > [22m[2mFramingService - Message Framing with Nudge Theory[2m > [22m[2mCoverage Edge Cases (85%+ Target)[2m > [22m[2mshould handle concurrent framing requests
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/framing.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/modules/nudge/framing.service.spec.ts [2m([22m[2m34 tests[22m[2m)[22m[90m 183[2mms[22m[39m
 [31mâ¯[39m apps/api/src/modules/nudge/personalization.service.spec.ts [2m([22m[2m39 tests[22m[2m | [22m[31m39 failed[39m[2m)[22m[90m 44[2mms[22m[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould deliver SOCIAL_PROOF nudge emphasizing competition[90m 2[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould maintain high engagement for HUNTER persona[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould use competitive language for HUNTER[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould deliver LOSS_AVERSION nudge for high-risk scenarios[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould prioritize GOAL_GRADIENT for budgeting context[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould emphasize security and caution for SAVER[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould calculate progress correctly for SAVER budgeting[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould deliver default SOCIAL_PROOF nudge[90m 3[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould use neutral language for OBSERVER[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould provide informative mapping for OBSERVER budgeting[90m 2[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould adapt message based on risk level threshold[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould calculate real-world value mapping correctly[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould override persona logic when risk is critically high[90m 1[2mms[22m[31m[39m
[31m     â†’ expected 'SOCIAL_PROOF' to be 'LOSS_AVERSION' // Object.is equality[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould maintain persona preference when risk is moderate[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle INVESTMENT_DECISION context[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle BUDGETING context[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle STREAK_WARNING context[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle SOCIAL_PROOF_REALTIME context[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould return null for unknown context[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for streak-critical situations[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for HUNTER investment decisions[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for SAVER loss aversion[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize MEDIUM for default social proof[90m 2[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize LOW for OBSERVER budgeting nudges[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould fetch realtime social proof data[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould query behavior logs from last 24 hours[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould generate realtime social nudge when users are active[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould return null when no active users in last 24h[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Vietnamese translations[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide English translations[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Chinese translations[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing user gracefully[90m 2[2mms[22m[31m[39m
[31m     â†’ promise resolved "{ type: 'SOCIAL_PROOF', â€¦(2) }" instead of rejecting[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle zero amount in budgeting[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle very large amounts in budgeting[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing data object[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle undefined risk level[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for HUNTER[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for SAVER[90m 1[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[31m   [31mÃ—[31m NudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould adapt dynamically to changing user behavior[90m 2[2mms[22m[31m[39m
[31m     â†’ jest is not defined[39m
[90mstdout[2m | apps/api/src/modules/nudge/personalization.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/modules/nudge/nudge-scheduler.service.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould return cached response on cache hit for GENERAL_FAQ
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould make AI call on cache miss for GENERAL_FAQ
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould skip cache for PERSONALIZED_ADVICE queries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould generate consistent cache keys for identical prompts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Hit/Miss Logic[2m > [22m[2mshould generate different cache keys for different prompts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mTTL Expiration[2m > [22m[2mshould set cache with 24-hour TTL for FAQ responses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mTTL Expiration[2m > [22m[2mshould handle expired cache gracefully (cache miss scenario)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Invalidation[2m > [22m[2mshould allow manual cache deletion via cache manager
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Invalidation[2m > [22m[2mshould handle cache reset operation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mCache Invalidation[2m > [22m[2mshould re-cache response after invalidation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould enforce rate limit (20 requests per minute)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould allow requests under rate limit
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould enforce monthly token budget (50,000 tokens)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould calculate token usage from behavior logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mMemory Usage & Rate Limiting[2m > [22m[2mshould handle missing tokensUsed in payload gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mIntent Classification (Cache Eligibility)[2m > [22m[2mshould classify FAQ queries correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mIntent Classification (Cache Eligibility)[2m > [22m[2mshould classify personalized queries correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mIntent Classification (Cache Eligibility)[2m > [22m[2mshould be case-insensitive for intent classification
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle thread not found error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould save both user and assistant messages when cache hit occurs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould handle cache manager errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22m[2mAiService - Cache Layer[2m > [22m[2mEdge Cases & Error Handling[2m > [22m[2mshould track token usage in behavior logs after AI call
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/ai-cache.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/modules/ai/ai-cache.service.spec.ts [2m([22m[2m22 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 435[2mms[22m[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould return cached response on cache hit for GENERAL_FAQ[90m 21[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould make AI call on cache miss for GENERAL_FAQ[90m 20[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould skip cache for PERSONALIZED_ADVICE queries[90m 28[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mTTL Expiration[2m > [22mshould set cache with 24-hour TTL for FAQ responses[90m 27[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mTTL Expiration[2m > [22mshould handle expired cache gracefully (cache miss scenario)[90m 17[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mCache Invalidation[2m > [22mshould re-cache response after invalidation[90m 17[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mEdge Cases & Error Handling[2m > [22mshould save both user and assistant messages when cache hit occurs[90m 17[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m   [31mÃ—[31m AiService - Cache Layer[2m > [22mEdge Cases & Error Handling[2m > [22mshould track token usage in behavior logs after AI call[90m 18[2mms[22m[31m[39m
[31m     â†’ this.prisma.$transaction is not a function[39m
[31m[Nest] 8600  - [39m12/22/2025, 12:47:37 AM [31m  ERROR[39m [38;5;3m[NudgeListener] [39m[31mFailed to deduct points for user user-5: Insufficient points[39m
[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete full streak warning flow: trigger â†’ nudge â†’ log
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete investment decision flow: request â†’ persona analysis â†’ nudge generation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete budgeting flow with SAVER persona: context â†’ persona â†’ mapping nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mEnd-to-End Nudge Flows[2m > [22m[2mshould complete social proof flow with realtime data aggregation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould process points.earned event â†’ generate nudge â†’ log behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould handle nudge.request event â†’ generate personalized nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould handle points.deduct event â†’ call gamification service
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mTrigger â†’ Reward â†’ Notification Pipeline[2m > [22m[2mshould handle failed point deduction gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mCross-Service Integration[2m > [22m[2mshould integrate with Analytics service for persona-driven nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mCross-Service Integration[2m > [22m[2mshould integrate with Prisma for streak data retrieval and logging
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mCross-Service Integration[2m > [22m[2mshould integrate with Gamification service for point adjustments
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMock Dependencies Validation[2m > [22m[2mshould mock PrismaService correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMock Dependencies Validation[2m > [22m[2mshould mock AnalyticsService correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMock Dependencies Validation[2m > [22m[2mshould mock GamificationService correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle user not found in database
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle invalid nudge context gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle failed behavior logging without crashing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould skip nudge generation if simulation flag is false
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle high-risk investment with SAVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mError Handling and Edge Cases[2m > [22m[2mshould handle empty streak list without errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMulti-Language Support[2m > [22m[2mshould return nudges with all three language variants
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mMulti-Language Support[2m > [22m[2mshould provide localized budgeting nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Social Proof tactic for HUNTER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Loss Aversion tactic for high-risk scenarios
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Goal Gradient tactic for streak warnings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mBehavioral Psychology Tactics[2m > [22m[2mshould apply Salience tactic with mapping for budgeting
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mRealtime Social Proof Integration[2m > [22m[2mshould aggregate activity counts for social proof nudge
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/nudge/nudge.integration.spec.ts [2m([22m[2m28 tests[22m[2m)[22m[90m 31[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts[2m > [22m[2mNudge System Integration Tests[2m > [22m[2mRealtime Social Proof Integration[2m > [22m[2mshould return null if no active users found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Definition[2m > [22m[2mshould define a new segment with criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Definition[2m > [22m[2mshould define segment with behavior type criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Definition[2m > [22m[2mshould define segment with locale criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould update segment with matching users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould return null when updating non-existent segment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter users by age range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter users by completed lessons minimum
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by LOW engagement level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by MEDIUM engagement level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by HIGH engagement level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by HUNTER behavior type
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by SAVER behavior type
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by OBSERVER behavior type
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mDynamic Segment Updates[2m > [22m[2mshould filter by locale criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Targeting[2m > [22m[2mshould target segment with message
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Targeting[2m > [22m[2mshould return false when targeting non-existent segment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Targeting[2m > [22m[2mshould return false when targeting empty segment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould return user demographics with all fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould classify user as SAVER based on behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould classify user as OBSERVER when no strong behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould return null when user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould return null when user has no date of birth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mUser Demographics[2m > [22m[2mshould default to "vi" locale when user has no preferred language
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould retrieve segment by ID
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould return null for non-existent segment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould get all segments
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould delete segment successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mSegment Retrieval & Management[2m > [22m[2mshould return false when deleting non-existent segment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mComplex Multi-Criteria Filtering[2m > [22m[2mshould apply multiple criteria filters together
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mComplex Multi-Criteria Filtering[2m > [22m[2mshould handle empty result when no users match all criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mAge Calculation Edge Cases[2m > [22m[2mshould calculate age correctly for birthday today
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22m[2mUserSegmentationService[2m > [22m[2mAge Calculation Edge Cases[2m > [22m[2mshould calculate age correctly for birthday tomorrow
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/user-segmentation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/modules/analytics/user-segmentation.service.spec.ts [2m([22m[2m32 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 562[2mms[22m[39m
[31m   [31mÃ—[31m UserSegmentationService[2m > [22mComplex Multi-Criteria Filtering[2m > [22mshould handle empty result when no users match all criteria[90m 22[2mms[22m[31m[39m
[31m     â†’ activityCounts is not iterable[39m
[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould track click coordinates with all parameters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould track click without elementId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould handle anonymous users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackClickCoordinate[2m > [22m[2mshould track negative coordinates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackScrollDepth[2m > [22m[2mshould track scroll depth with percentage calculation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackScrollDepth[2m > [22m[2mshould handle 100% scroll depth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mtrackScrollDepth[2m > [22m[2mshould handle zero scroll depth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould generate heatmap grid from click data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould normalize intensity to 0-1 range
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould handle empty click data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould skip invalid coordinates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould use custom grid size
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgenerateHeatmap[2m > [22m[2mshould aggregate clicks in same grid cell
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould calculate average and max scroll depth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould handle no scroll events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould skip events without scrollPercentage
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeScrollDepth[2m > [22m[2mshould find maximum scroll depth correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetClickPatterns[2m > [22m[2mshould retrieve user click patterns
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetClickPatterns[2m > [22m[2mshould filter out invalid coordinates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetClickPatterns[2m > [22m[2mshould respect limit parameter
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetHotspots[2m > [22m[2mshould filter cells by intensity threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetHotspots[2m > [22m[2mshould return empty array if no hotspots meet threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2mgetHotspots[2m > [22m[2mshould use default threshold of 0.7
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould calculate comprehensive engagement metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould handle user with no activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould limit most visited pages to top 5
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould aggregate session durations correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22m[2mHeatmapService[2m > [22m[2manalyzeUserEngagement[2m > [22m[2mshould sort pages by visit count
[22m[39mðŸ§¹ Cleaning up after test...

 [31mâ¯[39m apps/api/src/modules/analytics/heatmap.service.spec.ts [2m([22m[2m28 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 500[2mms[22m[39m
[31m   [31mÃ—[31m HeatmapService[2m > [22manalyzeScrollDepth[2m > [22mshould skip events without scrollPercentage[90m 20[2mms[22m[31m[39m
[31m     â†’ expected 32.5 to be 65 // Object.is equality[39m
[31m   [31mÃ—[31m HeatmapService[2m > [22manalyzeUserEngagement[2m > [22mshould calculate comprehensive engagement metrics[90m 19[2mms[22m[31m[39m
[31m     â†’ expected { totalClicks: 50, â€¦(3) } to deeply equal { totalClicks: 50, â€¦(3) }[39m
[90mstdout[2m | apps/api/src/modules/analytics/heatmap.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mgenerateTokens[2m > [22m[2mshould generate tokens and save to DB
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mvalidateUser[2m > [22m[2mshould return user without password if valid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mvalidateUser[2m > [22m[2mshould return null if password invalid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mvalidateUser[2m > [22m[2mshould return null if user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mlogin[2m > [22m[2mshould throw UnauthorizedException if validation fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mlogin[2m > [22m[2mshould return access and refresh tokens on success
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mrefreshToken[2m > [22m[2mshould refresh tokens correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mrefreshToken[2m > [22m[2mshould throw if token is expired
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mrefreshToken[2m > [22m[2mshould revoke all tokens if reused
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould create user and return tokens
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould throw ConflictException if email already exists
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould hash password with bcrypt before saving
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould handle Prisma P2002 error (duplicate email)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mregister[2m > [22m[2mshould generate default i18n name from email if name not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould handle concurrent login requests
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould handle refresh token near expiry
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould reject refresh token exactly at expiry boundary
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Rotation Edge Cases (S001)[2m > [22m[2mshould handle missing refresh token in database
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mPassword Reset Race Conditions (S001)[2m > [22m[2mshould handle empty or null password gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mPassword Reset Race Conditions (S001)[2m > [22m[2mshould handle concurrent password validation attempts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mPassword Reset Race Conditions (S001)[2m > [22m[2mshould prevent timing attacks on user lookup
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mLogin Error Handling (S001)[2m > [22m[2mshould handle JWT signing failure gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mLogin Error Handling (S001)[2m > [22m[2mshould handle database errors during token generation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Security Edge Cases (S001)[2m > [22m[2mshould generate unique refresh tokens for same user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Security Edge Cases (S001)[2m > [22m[2mshould hash refresh tokens before storage
[22m[39mðŸ§¹ Cleaning up after test...

 [31mâ¯[39m apps/api/src/auth/auth.service.spec.ts [2m([22m[2m27 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 810[2mms[22m[39m
[31m   [31mÃ—[31m AuthService[2m > [22mToken Rotation Edge Cases (S001)[2m > [22mshould reject refresh token exactly at expiry boundary[90m 3[2mms[22m[31m[39m
[31m     â†’ expected error to be instance of UnauthorizedException[39m
[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts[2m > [22m[2mAuthService[2m > [22m[2mToken Security Edge Cases (S001)[2m > [22m[2mshould revoke all user tokens on token reuse detection
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.service.spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return CRITICAL warning for high-value streak (>= 7 days) about to expire
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return HIGH priority for low-value streak (< 7 days) about to expire
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when streak is already expired (>24 hours)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when activity is too recent (<20 hours)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when user has no streak
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould return null when streak data does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateStreakLossWarning[2m > [22m[2mshould calculate hours remaining correctly at exact 20-hour mark
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould generate CRITICAL nudge when progress is 90%+
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould generate HIGH nudge when progress is 70-89%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould return null when progress is below 70%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould return null when progress is already 100%
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould handle edge case at exactly 70% threshold
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateAboutToLoseNudge[2m > [22m[2mshould handle multi-language goal names correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould generate commitment contract with penalty warning
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould format large amounts correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould return null when user does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould handle small amounts correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateCommitmentContract[2m > [22m[2mshould include all three language translations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould frame as LOSS with HIGH priority
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould frame as GAIN with MEDIUM priority
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould include inflation context in loss framing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould emphasize action in gain framing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mgenerateFramingNudge[2m > [22m[2mshould handle edge case with zero amount
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould process multiple users and return nudges for each
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould return empty arrays for users without warnings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould handle empty user list
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mcheckMultipleUsers[2m > [22m[2mshould process users independently even if one fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle future dates gracefully in streak calculation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle very large streak numbers
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle progress percentage edge cases
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle very small commitment amounts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mEdge Cases & Robustness[2m > [22m[2mshould handle very large commitment durations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mMessage Quality & Localization[2m > [22m[2mshould ensure all messages contain required emoji/icons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts[2m > [22m[2mLossAversionService (85%+ Coverage)[2m > [22m[2mMessage Quality & Localization[2m > [22m[2mshould ensure message consistency across all three languages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/loss-aversion.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/modules/nudge/loss-aversion.service.spec.ts [2m([22m[2m34 tests[22m[2m)[22m[33m 614[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould find users with streaks between 20-24 hours ago and send nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould not send nudges if no users match criteria
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould filter out frozen streaks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould filter out zero-streak users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould send nudges to multiple users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould include correct time boundaries (20-24 hours)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould log user streak data in nudge payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould use nudge-system as sessionId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mhandleStreakNudges[2m > [22m[2mshould use correct event path
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mTrigger Frequency Limits[2m > [22m[2mshould not send nudge to same user within 24 hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mTrigger Frequency Limits[2m > [22m[2mshould enforce max 3 nudges per day per user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mTrigger Frequency Limits[2m > [22m[2mshould allow nudge after 24 hours cooldown
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mUser Preference Overrides[2m > [22m[2mshould respect user opt-out from nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mUser Preference Overrides[2m > [22m[2mshould respect quiet hours preference
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mUser Preference Overrides[2m > [22m[2mshould send nudge outside quiet hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mThaler Pattern Validation[2m > [22m[2mshould apply loss aversion nudge for streak preservation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mThaler Pattern Validation[2m > [22m[2mshould use social proof for high streaks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mThaler Pattern Validation[2m > [22m[2mshould use framing for milestone streaks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mA/B Test Integration[2m > [22m[2mshould track nudge variant for A/B testing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mA/B Test Integration[2m > [22m[2mshould support different nudge message variants
[22m[39mðŸ§¹ Cleaning up after test...

 [31mâ¯[39m apps/api/src/modules/nudge/nudge.service.spec.ts [2m([22m[2m22 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[90m 19[2mms[22m[39m
[31m   [31mÃ—[31m NudgeService[2m > [22mhandleStreakNudges[2m > [22mshould filter out zero-streak users[90m 1[2mms[22m[31m[39m
[31m     â†’ usersToNudge is not iterable[39m
[31m   [31mÃ—[31m NudgeService[2m > [22mhandleStreakNudges[2m > [22mshould include correct time boundaries (20-24 hours)[90m 1[2mms[22m[31m[39m
[31m     â†’ usersToNudge is not iterable[39m
[31m   [31mÃ—[31m NudgeService[2m > [22mTrigger Frequency Limits[2m > [22mshould not send nudge to same user within 24 hours[90m 1[2mms[22m[31m[39m
[31m     â†’ expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T19:47:40.587Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [31mÃ—[31m NudgeService[2m > [22mTrigger Frequency Limits[2m > [22mshould enforce max 3 nudges per day per user[90m 1[2mms[22m[31m[39m
[31m     â†’ expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T19:47:40.588Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [31mÃ—[31m NudgeService[2m > [22mUser Preference Overrides[2m > [22mshould respect user opt-out from nudges[90m 3[2mms[22m[31m[39m
[31m     â†’ expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T19:47:40.592Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [31mÃ—[31m NudgeService[2m > [22mUser Preference Overrides[2m > [22mshould respect quiet hours preference[90m 1[2mms[22m[31m[39m
[31m     â†’ expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T19:47:40.593Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22m[2mNudgeService[2m > [22m[2mA/B Test Integration[2m > [22m[2mshould log A/B test metadata for analytics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould recommend LEVEL_UP for high score (>80)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould recommend REINFORCE for low score (<50)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould recommend STAY for medium score (50-80)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle edge case: score exactly 80
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle edge case: score exactly 50
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle missing score gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle score of 0
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mDifficulty Adjustment Algorithms[2m > [22m[2madjustLearningPath[2m > [22m[2mshould handle perfect score (100)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mUser Success Rate Tracking[2m > [22m[2mshould log behavior for performance tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mUser Success Rate Tracking[2m > [22m[2mshould track lesson completion metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mUser Success Rate Tracking[2m > [22m[2mshould maintain consistent session tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould optimize for Flow State with quick high-score completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould detect struggle with long time + low score
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould maintain engagement with moderate performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mFlow State Optimization[2m > [22m[2mshould handle zero time spent edge case
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould handle beginner user progression
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould handle advanced user performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould handle user without investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mMock Performance Data Scenarios[2m > [22m[2mshould process multiple rapid adjustments
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle negative score gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle score over 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould return correct response structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle very large timeSpent values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle different user IDs correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mEdge Cases and Error Handling[2m > [22m[2mshould handle different lesson IDs correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mIntegration with User Profile[2m > [22m[2mshould fetch user with investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22m[2mAdaptiveDifficultyService[2m > [22m[2mIntegration with User Profile[2m > [22m[2mshould work with users having different risk tolerances
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts [2m([22m[2m27 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 532[2mms[22m[39m
[31m   [31mÃ—[31m AdaptiveDifficultyService[2m > [22mDifficulty Adjustment Algorithms[2m > [22madjustLearningPath[2m > [22mshould handle score of 0[90m 21[2mms[22m[31m[39m
[31m     â†’ expected 'STAY' to be 'REINFORCE' // Object.is equality[39m
[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould create a new thread with title only
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould create a new thread with title and module
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould handle service errors when creating thread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads - createThread[2m > [22m[2mshould require authentication (JwtAuthGuard)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads - getThreads[2m > [22m[2mshould return all threads for authenticated user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads - getThreads[2m > [22m[2mshould return empty array when user has no threads
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads - getThreads[2m > [22m[2mshould handle service errors when fetching threads
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould return all messages for a thread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould return empty array for thread with no messages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould handle non-existent thread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mGET /ai/threads/:id/messages - getMessages[2m > [22m[2mshould handle service errors when fetching messages
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould generate AI response for user prompt
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle empty prompt
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle rate limit exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle monthly budget exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle non-existent thread in chat
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle unauthorized access to thread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mPOST /ai/threads/:id/chat - chat[2m > [22m[2mshould handle AI service errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mInput Validation[2m > [22m[2mshould validate title is required for createThread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mInput Validation[2m > [22m[2mshould validate prompt is required for chat
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mInput Validation[2m > [22m[2mshould handle invalid threadId format
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect createThread with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect getThreads with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect getMessages with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mAuthentication Guards[2m > [22m[2mshould protect chat with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mError Response Handling[2m > [22m[2mshould propagate service exceptions to client
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mError Response Handling[2m > [22m[2mshould handle unexpected errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long thread titles
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long prompts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in title
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/ai/ai.controller.spec.ts [2m([22m[2m32 tests[22m[2m)[22m[90m 51[2mms[22m[39m
[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in prompt
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/ai/ai.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mBasic Recommendation[2m > [22m[2mshould return personalized recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mBasic Recommendation[2m > [22m[2mshould return fallback recommendations if AI fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersona-Based Filtering[2m > [22m[2mshould recommend risk-focused courses for HUNTER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersona-Based Filtering[2m > [22m[2mshould recommend savings courses for SAVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersona-Based Filtering[2m > [22m[2mshould recommend diverse courses for OBSERVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mContent Freshness[2m > [22m[2mshould filter out completed courses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mContent Freshness[2m > [22m[2mshould prioritize recently published courses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mCache Invalidation[2m > [22m[2mshould bypass cache when user completes new lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mCache Invalidation[2m > [22m[2mshould refresh recommendations when persona changes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersonalization Accuracy[2m > [22m[2mshould match recommendations to user learning habits
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersonalization Accuracy[2m > [22m[2mshould validate AI recommendation output structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22m[2mRecommendationService[2m > [22m[2mPersonalization Accuracy[2m > [22m[2mshould apply nudge strategies correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/modules/recommendations/recommendation.service.spec.ts [2m([22m[2m12 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 267[2mms[22m[39m
[31m   [31mÃ—[31m RecommendationService[2m > [22mPersona-Based Filtering[2m > [22mshould recommend risk-focused courses for HUNTER persona[90m 19[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called with arguments: [ StringContaining "HUNTER" ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   StringContaining "HUNTER",[90m
[31m+   "[90m
[31m+       System: You are an AI Financial Advisor for V-EdFinance.[90m
[31m+       User Profile: {\"riskTolerance\":\"HIGH\"}[90m
[31m+       Learning Habits: {\"peakLearningHour\":10}[90m
[31m+       Available Courses: [{\"id\":\"c1\",\"title\":{\"vi\":\"Crypto Trading\"}}][90m
[31m+       [90m
[31m+       Task: Recommend the top 2 courses for this user. [90m
[31m+       For each recommendation, provide a reason based on NUDGE theory (e.g., Social Proof, Goal Gradient).[90m
[31m+       [90m
[31m+       Format: JSON array of { \"courseId\": string, \"reason\": { \"vi\": string, \"en\": string, \"zh\": string }, \"strategy\": string }[90m
[31m+     ",[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[31m   [31mÃ—[31m RecommendationService[2m > [22mPersona-Based Filtering[2m > [22mshould recommend savings courses for SAVER persona[90m 22[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called with arguments: [ StringContaining "SAVER" ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   StringContaining "SAVER",[90m
[31m+   "[90m
[31m+       System: You are an AI Financial Advisor for V-EdFinance.[90m
[31m+       User Profile: {\"riskTolerance\":\"LOW\"}[90m
[31m+       Learning Habits: {}[90m
[31m+       Available Courses: [{\"id\":\"c2\",\"title\":{\"vi\":\"Savings Strategies\"}}][90m
[31m+       [90m
[31m+       Task: Recommend the top 2 courses for this user. [90m
[31m+       For each recommendation, provide a reason based on NUDGE theory (e.g., Social Proof, Goal Gradient).[90m
[31m+       [90m
[31m+       Format: JSON array of { \"courseId\": string, \"reason\": { \"vi\": string, \"en\": string, \"zh\": string }, \"strategy\": string }[90m
[31m+     ",[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mcreateCourse[2m > [22m[2mshould create a new course successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mcreateCourse[2m > [22m[2mshould validate required fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould return all courses with default pagination
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould apply pagination parameters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould filter by level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindAll[2m > [22m[2mshould convert string params to numbers
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindOne[2m > [22m[2mshould return a single course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindOne[2m > [22m[2mshould throw NotFoundException for non-existent course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindLesson[2m > [22m[2mshould return a single lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mfindLesson[2m > [22m[2mshould throw NotFoundException for non-existent lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateCourse[2m > [22m[2mshould update course successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateCourse[2m > [22m[2mshould handle partial updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mremoveCourse[2m > [22m[2mshould delete course successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mremoveCourse[2m > [22m[2mshould throw NotFoundException for non-existent course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mcreateLesson[2m > [22m[2mshould create a new lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateLesson[2m > [22m[2mshould update lesson successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mremoveLesson[2m > [22m[2mshould delete lesson successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateProgress[2m > [22m[2mshould update user progress successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateProgress[2m > [22m[2mshould handle IN_PROGRESS status
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mupdateProgress[2m > [22m[2mshould validate duration is non-negative
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mgetMentorAdvice[2m > [22m[2mshould get AI mentor advice for course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mgetMentorAdvice[2m > [22m[2mshould handle AI service errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould require ADMIN or TEACHER role for createCourse
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould require ADMIN or TEACHER role for updateCourse
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould require only ADMIN role for removeCourse
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts[2m > [22m[2mCoursesController[2m > [22m[2mRole-Based Access Control[2m > [22m[2mshould not require specific roles for public endpoints
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/courses/courses.controller.spec.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 653[2mms[22m[39m
[90mstdout[2m | apps/api/src/courses/courses.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mcreateCourse[2m > [22m[2mshould create a course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mfindOneCourse[2m > [22m[2mshould return course with lessons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mfindOneCourse[2m > [22m[2mshould throw NotFoundException if course not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mupdateProgress[2m > [22m[2mshould upsert progress and reward points for first completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mupdateProgress[2m > [22m[2mshould not reward points if already completed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mcreateLesson[2m > [22m[2mshould determine order automatically if not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mcreateLesson[2m > [22m[2mshould start with order 1 if no lessons exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mupdateLesson[2m > [22m[2mshould update lesson data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mremoveLesson[2m > [22m[2mshould delete lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mEnrollment Constraints (S003)[2m > [22m[2mshould handle getUserProgress for empty course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mEnrollment Constraints (S003)[2m > [22m[2mshould include lesson details in user progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould handle progress update with zero duration
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould increment duration for existing progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould not reward points for re-completing same lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mProgress Calculation Edge Cases (S003)[2m > [22m[2mshould set completedAt timestamp on first completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mLesson Ordering Logic (S003)[2m > [22m[2mshould handle manual order override
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mLesson Ordering Logic (S003)[2m > [22m[2mshould auto-assign order for empty course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mLesson Ordering Logic (S003)[2m > [22m[2mshould respect existing lesson order sequence
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCourse Query Pagination (S003)[2m > [22m[2mshould enforce max limit of 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCourse Query Pagination (S003)[2m > [22m[2mshould enforce min page of 1
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCourse Query Pagination (S003)[2m > [22m[2mshould filter by published and level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCRUD Error Handling (S003)[2m > [22m[2mshould throw NotFoundException for invalid lesson ID
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCRUD Error Handling (S003)[2m > [22m[2mshould delete course successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts[2m > [22m[2mCoursesService (Pure Unit Test)[2m > [22m[2mCRUD Error Handling (S003)[2m > [22m[2mshould update course with partial data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/courses/courses.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/courses/courses.service.spec.ts [2m([22m[2m24 tests[22m[2m)[22m[33m 560[2mms[22m[39m
[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log lesson completion event with points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log achievement unlocked event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log streak milestone event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould handle missing userId gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould validate eventType is required
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mlog - XP Event Logging[2m > [22m[2mshould log multiple rapid events without collision
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyHistory - Behavior Analytics[2m > [22m[2mshould return user behavior history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyHistory - Behavior Analytics[2m > [22m[2mshould return empty array for user with no history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyHistory - Behavior Analytics[2m > [22m[2mshould throw UnauthorizedException for missing auth
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyStreak - Gamification Streak Tracking[2m > [22m[2mshould return current streak (placeholder)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mgetMyStreak - Gamification Streak Tracking[2m > [22m[2mshould work without errors for new users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect log endpoint with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect getMyHistory with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect getMyStreak with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGamification Integration Tests[2m > [22m[2mshould trigger XP calculation on lesson completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGamification Integration Tests[2m > [22m[2mshould track badge awarding event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mGamification Integration Tests[2m > [22m[2mshould log leaderboard position change
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mError Handling[2m > [22m[2mshould propagate service errors
[22m[39mðŸ§¹ Cleaning up after test...

 [31mâ¯[39m apps/api/src/behavior/behavior.controller.spec.ts [2m([22m[2m20 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 727[2mms[22m[39m
[31m   [31mÃ—[31m BehaviorController (Gamification)[2m > [22mgetMyHistory - Behavior Analytics[2m > [22mshould throw UnauthorizedException for missing auth[90m 48[2mms[22m[31m[39m
[31m     â†’ promise resolved "[]" instead of rejecting[39m
[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts[2m > [22m[2mBehaviorController (Gamification)[2m > [22m[2mError Handling[2m > [22m[2mshould handle getUserBehaviors service errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mlogEvent[2m > [22m[2mshould increment user points and log behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mlogEvent[2m > [22m[2mshould use simulation system ID when metadata has isSimulation true
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould deduct points if user has enough
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould throw error if user has insufficient points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould throw error if user does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mdeductPoints[2m > [22m[2mshould log deduction with correct session ID
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mPoint calculation with streak multipliers (edge cases)[2m > [22m[2mshould handle zero points correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mPoint calculation with streak multipliers (edge cases)[2m > [22m[2mshould handle large point values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mPoint calculation with streak multipliers (edge cases)[2m > [22m[2mshould include custom metadata in payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mXP Decay Logic (S004)[2m > [22m[2mshould handle zero-point events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mXP Decay Logic (S004)[2m > [22m[2mshould handle negative point values gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mXP Decay Logic (S004)[2m > [22m[2mshould track point decay in metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mAchievement Unlock Race Conditions (S004)[2m > [22m[2mshould handle concurrent point updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mAchievement Unlock Race Conditions (S004)[2m > [22m[2mshould emit event for each point gain
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mLeaderboard Ranking Updates (S004)[2m > [22m[2mshould log events with unique event types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mLeaderboard Ranking Updates (S004)[2m > [22m[2mshould handle metadata for ranking changes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mStreak Recovery (S004)[2m > [22m[2mshould log streak recovery events
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mDeduction Edge Cases (S004)[2m > [22m[2mshould handle deduction when points exactly match
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/common/gamification.service.spec.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 440[2mms[22m[39m
[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts[2m > [22m[2mGamificationService (Pure Unit Test)[2m > [22m[2mDeduction Edge Cases (S004)[2m > [22m[2mshould emit deduction event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mcreateCourse[2m > [22m[2mshould create course with localized JSONB content (vi/en/zh)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mcreateCourse[2m > [22m[2mshould validate JSONB structure via ValidationService
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould return paginated courses with default values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould filter by published status
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould filter by level (BEGINNER, INTERMEDIATE, ADVANCED)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould enforce max limit of 100
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindAllCourses[2m > [22m[2mshould handle page boundaries correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneCourse[2m > [22m[2mshould return course with published lessons ordered by order field
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneCourse[2m > [22m[2mshould throw NotFoundException if course not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateCourse[2m > [22m[2mshould update course and preserve localization structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateCourse[2m > [22m[2mshould allow partial updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mremoveCourse[2m > [22m[2mshould delete course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould update progress and award points on first completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould not award points if already completed (idempotent)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould increment durationSpent on existing progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mupdateProgress[2m > [22m[2mshould set completedAt timestamp on first completion only
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mgetUserProgress[2m > [22m[2mshould return all progress for a user in a specific course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneLesson[2m > [22m[2mshould return lesson by id
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/test/unit/courses/courses.service.spec.ts [2m([22m[2m19 tests[22m[2m)[22m[90m 13[2mms[22m[39m
[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts[2m > [22m[2mCoursesService[2m > [22m[2mfindOneLesson[2m > [22m[2mshould throw NotFoundException if lesson not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/courses.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/test/integration/security-audit-trail.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
 [31mâ¯[39m apps/api/test/integration/disaster-recovery.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mGET /simulation/portfolio[2m > [22m[2mshould return user simulation portfolio
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mGET /simulation/portfolio[2m > [22m[2mshould handle empty portfolio
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/trade[2m > [22m[2mshould execute buy trade successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/trade[2m > [22m[2mshould execute sell trade successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/trade[2m > [22m[2mshould validate insufficient funds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/start[2m > [22m[2mshould start a new life scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/start[2m > [22m[2mshould generate AI-powered scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/continue[2m > [22m[2mshould process user choice and continue scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/life/continue[2m > [22m[2mshould handle scenario completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/budget/process[2m > [22m[2mshould process budget allocation decision
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/stress-test[2m > [22m[2mshould run financial stress test
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/stress-test[2m > [22m[2mshould test multiple economic scenarios
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/impact-analysis[2m > [22m[2mshould calculate long-term impact with default years
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/impact-analysis[2m > [22m[2mshould calculate impact for custom time horizon
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/commitment/create[2m > [22m[2mshould create financial commitment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/commitment/create[2m > [22m[2mshould enforce loss aversion logic
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/simulation/simulation.controller.spec.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 17[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts[2m > [22m[2mSimulationController[2m > [22m[2mPOST /simulation/commitment/withdraw[2m > [22m[2mshould withdraw commitment with penalty
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[31m[Nest] 8600  - [39m12/22/2025, 12:47:45 AM [31m  ERROR[39m [38;5;3m[AnalyticsService] [39m[31mLog aggregation failed[39m
[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleSystemHealthCheck[2m > [22m[2mshould log health check and warn on high error rates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserLearningHabits[2m > [22m[2mshould return habits based on logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserLearningHabits[2m > [22m[2mshould return null if no logs found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould classify as HUNTER for risk-taking behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould classify as SAVER for commitment-focused behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould aggregate logs from yesterday by user and eventType
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould handle empty log set gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould delete logs older than 30 days
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleLogAggregation[2m > [22m[2mshould handle aggregation errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetGlobalSystemStats[2m > [22m[2mshould return aggregated system statistics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetGlobalSystemStats[2m > [22m[2mshould handle null points sum gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mDate Range Validation[2m > [22m[2mshould correctly calculate 1-hour time window for health check
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mDate Range Validation[2m > [22m[2mshould handle date boundary edge cases in aggregation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mReal-Time Metrics Updates[2m > [22m[2mshould track error rate spikes in real-time
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mReal-Time Metrics Updates[2m > [22m[2mshould update health metrics every hour
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mBehavior Log Archiving[2m > [22m[2mshould archive logs in batches based on age threshold
[22m[39mðŸ§¹ Cleaning up after test...

 [31mâ¯[39m apps/api/src/modules/analytics/analytics.service.spec.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 463[2mms[22m[39m
[31m   [31mÃ—[31m AnalyticsService[2m > [22mhandleLogAggregation[2m > [22mshould handle empty log set gracefully[90m 21[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called at least once[39m
[31m   [31mÃ—[31m AnalyticsService[2m > [22mhandleLogAggregation[2m > [22mshould delete logs older than 30 days[90m 44[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading '0')[39m
[31m   [31mÃ—[31m AnalyticsService[2m > [22mBehavior Log Archiving[2m > [22mshould archive logs in batches based on age threshold[90m 27[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m AnalyticsService[2m > [22mBehavior Log Archiving[2m > [22mshould preserve recent logs during archiving[90m 22[2mms[22m[31m[39m
[31m     â†’ Cannot read properties of undefined (reading '0')[39m
[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mBehavior Log Archiving[2m > [22m[2mshould preserve recent logs during archiving
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

Error: DB Error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\analytics\analytics.service.spec.ts:149:57
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[90mstdout[2m | apps/api/test/simulation-ai.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould start simulation and generate AI scenario
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould continue simulation, make decision and calculate impact
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould verify market simulation trade updates portfolio
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/simulation-ai.integration.spec.ts[2m > [22m[2mFinancial Simulation AI Integration[2m > [22m[2mFull Simulation Flow[2m > [22m[2mshould validate simulation history logs via behavior tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/simulation-ai.integration.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m apps/api/test/simulation-ai.integration.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 265[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mgetFeed[2m > [22m[2mshould return social feed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcreatePost[2m > [22m[2mshould create a new post
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mgetRecommendations[2m > [22m[2mshould return group recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcreateGroup[2m > [22m[2mshould create a new group
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mjoinGroup[2m > [22m[2mshould join a group
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mgetGroupDetails[2m > [22m[2mshould return group details
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcreateChallenge[2m > [22m[2mshould create a group challenge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mError Handling[2m > [22m[2mshould propagate errors from social service
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mlikePost[2m > [22m[2mshould like a post successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mlikePost[2m > [22m[2mshould handle duplicate likes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcommentOnPost[2m > [22m[2mshould add comment to post successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mcommentOnPost[2m > [22m[2mshould validate empty content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mWebSocket Integration (Mocked)[2m > [22m[2mshould handle real-time feed updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mWebSocket Integration (Mocked)[2m > [22m[2mshould support pagination for feed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mGroup Challenge Tests[2m > [22m[2mshould create challenge with all required fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mGroup Challenge Tests[2m > [22m[2mshould validate challenge target is positive
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts[2m > [22m[2mSocialController[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect all endpoints with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/modules/social/social.controller.spec.ts [2m([22m[2m18 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 374[2mms[22m[39m
[31m   [31mÃ—[31m SocialController[2m > [22mGuard Protection[2m > [22mshould protect all endpoints with JwtAuthGuard[90m 18[2mms[22m[31m[39m
[31m     â†’ expected undefined to be defined[39m
 [31mâ¯[39m apps/api/test/integration/multi-device-sync.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mPOST /nudge/check[2m > [22m[2mshould trigger nudge check with context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mPOST /nudge/check[2m > [22m[2mshould use default context and data when not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mPOST /nudge/check[2m > [22m[2mshould generate loss aversion nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould return multiple dashboard nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould filter out null nudges
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould generate streak warning nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/dashboard[2m > [22m[2mshould generate social proof nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould get realtime social proof for course enrollment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould get social proof for lesson completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould get social proof for commitment creation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould handle zero activity gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould include user demographics in social proof
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould return percentage for social proof
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould show time-based scarcity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould display user testimonials count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould show trending badge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould include peer comparison
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould validate commitment contract nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould show framing effect
[22m[39mðŸ§¹ Cleaning up after test...

 [31mâ¯[39m apps/api/src/modules/nudge/nudge.controller.spec.ts [2m([22m[2m21 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 20[2mms[22m[39m
[31m   [31mÃ—[31m NudgeController[2m > [22mGET /nudge/dashboard[2m > [22mshould return multiple dashboard nudges[90m 1[2mms[22m[31m[39m
[31m     â†’ expected "spy" to be called 2 times, but got 5 times[39m
[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22m[2mNudgeController[2m > [22m[2mGET /nudge/social-proof[2m > [22m[2mshould integrate with investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould update item and calculate progress correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould reward when 100% completed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould not reward if already 100% completed before
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould throw NotFoundException for non-existent checklist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould throw NotFoundException for wrong user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould mark item as incomplete and recalculate progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mupdateItem[2m > [22m[2mshould set completedAt timestamp when completing item
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mcreate[2m > [22m[2mshould create a new checklist with 0 progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mfindAll[2m > [22m[2mshould return all checklists ordered by updatedAt desc
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mfindAll[2m > [22m[2mshould return empty array if no checklists exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mProgress calculation[2m > [22m[2mshould calculate 0% for all incomplete items
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts[2m > [22m[2mChecklistsService[2m > [22m[2mProgress calculation[2m > [22m[2mshould round progress correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/checklists/checklists.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/checklists/checklists.service.spec.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 267[2mms[22m[39m
[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould return user profile successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould throw NotFoundException when user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould throw UnauthorizedException when userId is missing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetProfile[2m > [22m[2mshould handle service errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetInvestmentProfile[2m > [22m[2mshould return investment profile successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetInvestmentProfile[2m > [22m[2mshould handle user without investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetInvestmentProfile[2m > [22m[2mshould throw NotFoundException for non-existent user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould update investment profile successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould handle partial updates
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould validate investment goals array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mupdateInvestmentProfile[2m > [22m[2mshould throw NotFoundException for non-existent user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould return dashboard statistics successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould return empty stats for new user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mGuard Protection[2m > [22m[2mshould protect all endpoints with JwtAuthGuard
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mGuard Protection[2m > [22m[2mshould require authentication for investment profile endpoints
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts[2m > [22m[2mUsersController[2m > [22m[2mGuard Protection[2m > [22m[2mshould require authentication for dashboard stats
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/users/users.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/users/users.controller.spec.ts [2m([22m[2m18 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 387[2mms[22m[39m
[31m   [31mÃ—[31m UsersController[2m > [22mgetProfile[2m > [22mshould throw UnauthorizedException when userId is missing[90m 19[2mms[22m[31m[39m
[31m     â†’ expected error to be instance of UnauthorizedException[39m
[31m   [31mÃ—[31m UsersController[2m > [22mupdateInvestmentProfile[2m > [22mshould handle partial updates[90m 20[2mms[22m[31m[39m
[31m     â†’ mockInvestmentProfile is not defined[39m
[90mstdout[2m | apps/api/src/common/health.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould return ok status
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould return timestamp
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould return uptime
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould respond quickly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /health[2m > [22m[2mshould handle concurrent health checks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould return ready status when DB is connected
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould execute DB connectivity check
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould return not ready when DB is disconnected
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould handle DB timeout
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /ready[2m > [22m[2mshould retry on transient failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return user count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return course count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return behavior log count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould return timestamp
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould fetch all metrics in parallel
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould handle zero counts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mGET /metrics[2m > [22m[2mshould handle large counts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mDB Connectivity[2m > [22m[2mshould verify Prisma connection
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mDB Connectivity[2m > [22m[2mshould handle connection pool exhaustion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mDB Connectivity[2m > [22m[2mshould handle SSL connection errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mService Status[2m > [22m[2mshould indicate healthy service
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mService Status[2m > [22m[2mshould detect degraded performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mService Status[2m > [22m[2mshould handle service unavailability
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mError Handling[2m > [22m[2mshould handle metrics query failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mError Handling[2m > [22m[2mshould handle partial metric failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mError Handling[2m > [22m[2mshould not leak DB errors to client
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle uptime overflow
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle timezone differences
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/common/health.controller.spec.ts [2m([22m[2m30 tests[22m[2m)[22m[90m 238[2mms[22m[39m
[90mstdout[2m | apps/api/src/common/health.controller.spec.ts[2m > [22m[2mHealthController (C015)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle rapid successive checks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/health.controller.spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m apps/api/src/users/users.service.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould upload file successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould generate unique key with timestamp
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould preserve original filename in key
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould return public URL
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould handle PNG files
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mPOST /storage/upload[2m > [22m[2mshould handle PDF files
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould accept files under 5MB
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould accept files exactly at 5MB limit
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould handle empty files
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mFile Size Limits[2m > [22m[2mshould handle large buffer efficiently
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept image/jpeg
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept image/png
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept application/pdf
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould accept video/mp4
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mMIME Type Validation[2m > [22m[2mshould handle unknown MIME types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mSpecial Characters in Filename[2m > [22m[2mshould handle spaces in filename
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mSpecial Characters in Filename[2m > [22m[2mshould handle unicode characters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mSpecial Characters in Filename[2m > [22m[2mshould handle special characters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mError Handling[2m > [22m[2mshould handle upload failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mError Handling[2m > [22m[2mshould handle storage service unavailability
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mError Handling[2m > [22m[2mshould handle network timeout
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mConcurrent Uploads[2m > [22m[2mshould handle multiple concurrent uploads
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mConcurrent Uploads[2m > [22m[2mshould generate unique keys for concurrent uploads
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long filenames
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle files with no extension
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle files with multiple dots
[22m[39mðŸ§¹ Cleaning up after test...

 [31mâ¯[39m apps/api/src/storage/storage.controller.spec.ts [2m([22m[2m28 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[90m 28[2mms[22m[39m
[31m   [31mÃ—[31m StorageController (C013)[2m > [22mConcurrent Uploads[2m > [22mshould generate unique keys for concurrent uploads[90m 3[2mms[22m[31m[39m
[31m     â†’ expected 'uploads/1766339268223-same.jpg' not to be 'uploads/1766339268223-same.jpg' // Object.is equality[39m
[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts[2m > [22m[2mStorageController (C013)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle different file encodings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/my-habits[2m > [22m[2mshould return user learning habits
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/my-habits[2m > [22m[2mshould handle user with no learning history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/my-habits[2m > [22m[2mshould aggregate multi-day data correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/predictive/future[2m > [22m[2mshould simulate user financial future
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/predictive/future[2m > [22m[2mshould handle user with minimal financial data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/predictive/future[2m > [22m[2mshould project multiple time horizons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould return personalized mentor advice
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould use default module and lesson when not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould respect user locale preference
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mPOST /analytics/mentor/chat[2m > [22m[2mshould handle Chinese locale
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/system-stats (ADMIN)[2m > [22m[2mshould return global system statistics for admin
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/analytics/analytics.controller.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 13[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/system-stats (ADMIN)[2m > [22m[2mshould include platform-wide metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts[2m > [22m[2mAnalyticsController[2m > [22m[2mGET /analytics/system-stats (ADMIN)[2m > [22m[2mshould aggregate user behavior metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/analytics.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mEnd-to-end Social Flow[2m > [22m[2mshould handle full cycle: join group -> welcome post -> leaderboard nudge -> notification
[22m[39m[Push Notification] to u2: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch user1 200 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 200 points behind user1. Finish one more lesson to overtake!","zh":"ä½ åªè½åŽ user1 200 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mEnd-to-end Social Flow[2m > [22m[2mshould synchronize WebSocket broadcasts with REST API actions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mEnd-to-end Social Flow[2m > [22m[2mshould handle challenge progression and cross-service rewards
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/social/social.integration.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 269[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/social/social.integration.spec.ts[2m > [22m[2mSocial Integration[2m > [22m[2mWebSocket + Service Interactions[2m > [22m[2mshould handle group streak updates and conditional nudging
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignIn[2m > [22m[2mshould call authService.login
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignIn[2m > [22m[2mshould return access_token, refresh_token, and user object
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mValidation (Integration)[2m > [22m[2mshould fail if email is invalid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mValidation (Integration)[2m > [22m[2mshould fail if password is too short in RegisterDto
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignUp[2m > [22m[2mshould call authService.register
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2msignUp[2m > [22m[2mshould return tokens and user on successful registration
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mrefresh[2m > [22m[2mshould call authService.refreshToken
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mrefresh[2m > [22m[2mshould return new tokens on successful refresh
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mGuards[2m > [22m[2mshould have JwtAuthGuard on profile-related endpoints in UsersController
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Expired Tokens[2m > [22m[2mshould reject expired refresh token
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Expired Tokens[2m > [22m[2mshould handle missing refresh token
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Password Reset Flow[2m > [22m[2mshould reject login with invalid credentials
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Password Reset Flow[2m > [22m[2mshould reject login with non-existent email
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: JWT Refresh Race Conditions[2m > [22m[2mshould handle token reuse detection
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: JWT Refresh Race Conditions[2m > [22m[2mshould generate new tokens on valid refresh
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/auth/auth.controller.spec.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 36[2mms[22m[39m
[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts[2m > [22m[2mAuthController[2m > [22m[2mEdge Cases: Registration Conflicts[2m > [22m[2mshould reject duplicate email registration
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/auth.controller.spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mshould analyze behavior and sync profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mRisk score calculation[2m > [22m[2mshould calculate risk score from high-risk behavior logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mRisk score calculation[2m > [22m[2mshould calculate risk score from conservative behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mKnowledge level assessment[2m > [22m[2mshould set knowledge to BEGINNER for new user with few lessons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mKnowledge level assessment[2m > [22m[2mshould assess knowledge from completed lessons count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould sync profile with JSONB investment philosophy
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould create new profile if none exists
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould update existing profile with new analysis
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/investment-profile.service.spec.ts[2m > [22m[2mInvestmentProfileService (Pure Unit Test)[2m > [22m[2mProfile sync from behavior patterns[2m > [22m[2mshould include locale in AI prompt
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/investment-profile.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/behavior/investment-profile.service.spec.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 286[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould run full diagnostics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould return database check status
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould return AI service check
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/run[2m > [22m[2mshould return WebSocket connection count
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/metrics[2m > [22m[2mshould return Prometheus metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/metrics[2m > [22m[2mshould return metrics in Prometheus format
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/metrics[2m > [22m[2mshould expose throughput metrics
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/verify-integrity[2m > [22m[2mshould verify system integrity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/verify-integrity[2m > [22m[2mshould check database integrity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mGET /debug/verify-integrity[2m > [22m[2mshould validate schema consistency
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/simulate[2m > [22m[2mshould simulate user flow
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/simulate[2m > [22m[2mshould handle invalid userId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/simulate[2m > [22m[2mshould handle empty userId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/mock-behaviors[2m > [22m[2mshould generate mock behavioral data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/mock-behaviors[2m > [22m[2mshould use default count if not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/mock-behaviors[2m > [22m[2mshould handle large counts
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould run AI stress test with LOW complexity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould run AI stress test with MEDIUM complexity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould run AI stress test with HIGH complexity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mPOST /debug/stress-test/ai[2m > [22m[2mshould handle stress test failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mHealth Checks[2m > [22m[2mshould verify all critical services
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mHealth Checks[2m > [22m[2mshould report unhealthy status on failures
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle concurrent diagnostic requests
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle service unavailability
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/debug/diagnostic.controller.spec.ts [2m([22m[2m26 tests[22m[2m)[22m[90m 27[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts[2m > [22m[2mDiagnosticController (C012)[2m > [22m[2mEdge Cases[2m > [22m[2mshould validate stress test complexity values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/social-ws.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mConnect WS â†’ Identify â†’ Broadcast â†’ Check via REST
[22m[39mClient connected: cPXL2yUIOQbm7Lj1AAAC
Client connected: ThallWQQb0iwcqvVAAAD

[90mstdout[2m | apps/api/test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mConnect WS â†’ Identify â†’ Broadcast â†’ Check via REST
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mJoin group â†’ Post achievement â†’ Friends notified (WS)
[22m[39mClient disconnected: cPXL2yUIOQbm7Lj1AAAC
Client disconnected: ThallWQQb0iwcqvVAAAD

[90mstdout[2m | apps/api/test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mJoin group â†’ Post achievement â†’ Friends notified (WS)
[22m[39mClient connected: HB6C526k5rGpjpK_AAAF

[90mstdout[2m | apps/api/test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mJoin group â†’ Post achievement â†’ Friends notified (WS)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mLeaderboard update via aggregation (Community Stats)
[22m[39mClient disconnected: HB6C526k5rGpjpK_AAAF

[90mstdout[2m | apps/api/test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mLeaderboard update via aggregation (Community Stats)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration[2m > [22m[2mTest concurrent WebSocket connections
[22m[39mClient connected: a3rJ7MDkehxMpBTLAAAL
Client connected: lV7-scLlZFMIi_CSAAAM
Client connected: FY85ZmhLuJUFcz5eAAAN
Client connected: S6MQkEP0mx6uZVLkAAAO
Client connected: DGrCTAlLNdIJkBs2AAAP
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/social-ws.integration.spec.ts[2m > [22m[2mSocial WebSocket Integration
[22m[39mClient disconnected: a3rJ7MDkehxMpBTLAAAL
Client disconnected: lV7-scLlZFMIi_CSAAAM
Client disconnected: FY85ZmhLuJUFcz5eAAAN
Client disconnected: S6MQkEP0mx6uZVLkAAAO
Client disconnected: DGrCTAlLNdIJkBs2AAAP

[90mstdout[2m | apps/api/test/social-ws.integration.spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m apps/api/test/social-ws.integration.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 460[2mms[22m[39m
[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate correct BEHAVIOR_LOG_PAYLOAD
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate minimal BEHAVIOR_LOG_PAYLOAD
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate correct I18N_TEXT with all locales
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject I18N_TEXT missing required locale
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate USER_METADATA with optional fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject USER_METADATA with invalid URL
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SOCIAL_POST_CONTENT
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SIMULATION_EVENT with nested options
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject SIMULATION_EVENT with missing required fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate INVESTMENT_PHILOSOPHY
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould reject INVESTMENT_PHILOSOPHY with invalid enum
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate FINANCIAL_GOALS array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate CHECKLIST_ITEMS
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate PORTFOLIO_ASSETS with mixed types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SIMULATION_STATUS with optional fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate COURSE_RECOMMENDATION with i18n reason
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate CHAT_MESSAGE_METADATA
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould throw error for validation failure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould throw error for undefined schema key
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate empty BEHAVIOR_LOG_PAYLOAD as valid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould validate SIMULATION_DECISIONS with multiple decision types
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts[2m > [22m[2mValidationService[2m > [22m[2mvalidate[2m > [22m[2mshould handle passthrough fields in INVESTMENT_PHILOSOPHY
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/common/validation.service.spec.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 605[2mms[22m[39m
[90mstdout[2m | apps/api/test/gamification-nudge.e2e-spec.ts[2m > [22m[2mGamification & Nudge System (Integration)[2m > [22m[2mUser Inactivity & Streak Nudge[2m > [22m[2mshould trigger a nudge when user is inactive for 20-24 hours
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/gamification-nudge.e2e-spec.ts[2m > [22m[2mGamification & Nudge System (Integration)[2m > [22m[2mUser Inactivity & Streak Nudge[2m > [22m[2mshould preserve streak logic via LossAversionService
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/gamification-nudge.e2e-spec.ts[2m > [22m[2mGamification & Nudge System (Integration)[2m > [22m[2mSocial Proof Nudge Generation[2m > [22m[2mshould generate social proof based on cohort behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/gamification-nudge.e2e-spec.ts[2m > [22m[2mGamification & Nudge System (Integration)[2m > [22m[2mSocial Proof Nudge Generation[2m > [22m[2mshould verify realtime activity social proof
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/gamification-nudge.e2e-spec.ts[2m > [22m[2mGamification & Nudge System (Integration)[2m > [22m[2mVariable Rewards & Adaptive Adjustment[2m > [22m[2mshould simulate reward distribution/adjustment based on performance
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/test/gamification-nudge.e2e-spec.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 11[2mms[22m[39m
[90mstdout[2m | apps/api/test/gamification-nudge.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould return personalized course recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould integrate with user investment profile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould recommend based on learning progress
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould recommend based on similar user behavior
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould handle new users with minimal data
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould return empty array if no suitable recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould limit number of recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould consider user locale for recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould include AI-generated recommendations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould refresh recommendations based on recent activity
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould handle service errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould include diversity in recommendations
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/recommendations/recommendation.controller.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 18[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts[2m > [22m[2mRecommendationController[2m > [22m[2mGET /recommendations/personalized[2m > [22m[2mshould prioritize high-match scores
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/recommendations/recommendation.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/test/integration/recommendation-refresh.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleInit[2m > [22m[2mshould connect to database on module init
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleInit[2m > [22m[2mshould handle connection failure gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleInit[2m > [22m[2mshould not throw error when database is unavailable
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleDestroy[2m > [22m[2mshould disconnect from database on module destroy
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2monModuleDestroy[2m > [22m[2mshould handle disconnection errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mtransaction handling[2m > [22m[2mshould support Prisma transactions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mtransaction handling[2m > [22m[2mshould rollback transaction on error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mtransaction handling[2m > [22m[2mshould support sequential operations in transaction
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2merror handling[2m > [22m[2mshould handle unique constraint violation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2merror handling[2m > [22m[2mshould handle foreign key constraint violation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2merror handling[2m > [22m[2mshould handle record not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mconnection lifecycle[2m > [22m[2mshould allow reconnection after disconnect
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mconnection lifecycle[2m > [22m[2mshould be singleton across module
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support findMany queries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support findUnique queries
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support create operations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support update operations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts[2m > [22m[2mPrismaService[2m > [22m[2mquery operations[2m > [22m[2mshould support delete operations
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/prisma/prisma.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/prisma/prisma.service.spec.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 591[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould adjust learning path after lesson completion
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould handle lesson completion without score
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould increase difficulty for high-performing users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould decrease difficulty for struggling users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould maintain flow state for optimal performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould recommend break after extended session
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould suggest review for spaced repetition
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould track time efficiency
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould integrate with investment profile risk assessment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould suggest parallel learning paths
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould validate JSONB lesson metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould calculate adaptive difficulty based on success rate
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/adaptive/adaptive.controller.spec.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 13[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts[2m > [22m[2mAdaptiveController[2m > [22m[2mPOST /adaptive/complete-lesson[2m > [22m[2mshould provide AI-generated personalized feedback
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/test/integration/ai-course-flow.e2e-spec.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[90m 8[2mms[22m[39m
[90mstdout[2m | apps/api/test/integration/ai-course-flow.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[31m[Nest] 8600  - [39m12/22/2025, 12:47:52 AM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39m[31mFailed to load system settings (Reference Error expected if DB not running)[39m
[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2monModuleInit[2m > [22m[2mshould load config on module init in production
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2monModuleInit[2m > [22m[2mshould skip loading config in test environment
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2monModuleInit[2m > [22m[2mshould skip loading config when VITEST is set
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould load settings from database
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould cache loaded settings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould handle database errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mloadConfig[2m > [22m[2mshould log error when database fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould retrieve cached config value
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould return default value when key not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould return empty string when no default provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mget[2m > [22m[2mshould handle multiple sequential gets
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mConfig Updates[2m > [22m[2mshould reflect new values after reload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mConfig Updates[2m > [22m[2mshould handle empty settings array
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle settings with special characters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle settings with empty values
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/config/dynamic-config.service.spec.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 72[2mms[22m[39m
[31m[Nest] 8600  - [39m12/22/2025, 12:47:52 AM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39mError: Database connection failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\[39mapps\api\src\config\dynamic-config.service.spec.ts:98:17
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7[90m)[39m
    at runTest [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runFiles [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5[90m)[39m
    at startTests [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3[90m)[39m
[31m[Nest] 8600  - [39m12/22/2025, 12:47:52 AM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39m[31mFailed to load system settings (Reference Error expected if DB not running)[39m
[31m[Nest] 8600  - [39m12/22/2025, 12:47:52 AM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39mError: Database error
    at [90mC:\Users\luaho\Demo project\v-edfinance\[39mapps\api\src\config\dynamic-config.service.spec.ts:107:17
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7[90m)[39m
    at runTest [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runFiles [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5[90m)[39m
    at startTests [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3[90m)[39m
[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts[2m > [22m[2mDynamicConfigService[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long setting values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/config/dynamic-config.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould upload file successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould download file successfully
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:47:52 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to download file: missing.txt[39m
[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould throw error when downloading non-existent file
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:47:52 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: File not found: missing.txt
    at UnstorageService.downloadFile [90m(C:\Users\luaho\Demo project\v-edfinance\[39mapps\api\src\storage\unstorage.service.ts:118:15[90m)[39m
[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould delete file successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould check file existence
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:47:52 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to check file existence: test.txt[39m
[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mFile Operations[2m > [22m[2mshould return false when file existence check fails
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:47:52 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Storage error
    at [90mC:\Users\luaho\Demo project\v-edfinance\[39mapps\api\src\storage\unstorage.service.spec.ts:95:51
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7[90m)[39m
    at runTest [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runFiles [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5[90m)[39m
    at startTests [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3[90m)[39m
[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mList Operations[2m > [22m[2mshould list files with prefix
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mList Operations[2m > [22m[2mshould list all files when no prefix provided
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:47:52 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to list files with prefix: test/[39m
[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mList Operations[2m > [22m[2mshould throw error when listing fails
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:47:52 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: List error
    at [90mC:\Users\luaho\Demo project\v-edfinance\[39mapps\api\src\storage\unstorage.service.spec.ts:121:51
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7[90m)[39m
    at runTest [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runFiles [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5[90m)[39m
    at startTests [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3[90m)[39m
[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPublic URL Generation[2m > [22m[2mshould generate public URL for fs driver
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPublic URL Generation[2m > [22m[2mshould generate public URL for gcs driver
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPublic URL Generation[2m > [22m[2mshould generate public URL for r2 driver
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPresigned URLs[2m > [22m[2mshould return presigned upload URL placeholder
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mPresigned URLs[2m > [22m[2mshould use default expiration time
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:47:53 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to upload file: test.txt[39m
[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle upload failure
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:47:53 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Upload failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\[39mapps\api\src\storage\unstorage.service.spec.ts:181:54
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7[90m)[39m
    at runTest [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runFiles [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5[90m)[39m
    at startTests [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3[90m)[39m
[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle download failure
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:47:53 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to download file: test.txt[39m
[31m[Nest] 8600  - [39m12/22/2025, 12:47:53 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Download failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\[39mapps\api\src\storage\unstorage.service.spec.ts:189:54
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7[90m)[39m
    at runTest [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runFiles [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5[90m)[39m
    at startTests [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3[90m)[39m
[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle delete failure
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:47:53 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39m[31mFailed to delete file: test.txt[39m
[31m[Nest] 8600  - [39m12/22/2025, 12:47:53 AM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Delete failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\[39mapps\api\src\storage\unstorage.service.spec.ts:195:54
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7[90m)[39m
    at runTest [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runFiles [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5[90m)[39m
    at startTests [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3[90m)[39m
[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mDriver Initialization[2m > [22m[2mshould initialize with fs driver by default
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/storage/unstorage.service.spec.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 533[2mms[22m[39m
[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts[2m > [22m[2mUnstorageService[2m > [22m[2mDriver Initialization[2m > [22m[2mshould throw error for unsupported driver
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/unstorage.service.spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m apps/api/test/integration/admin-dashboard.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould initialize streak if it does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould increment streak if last activity was yesterday
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould reward points for 7-day milestone
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould use freeze if streak is broken but freezes are available
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould reset streak if broken and no freezes remaining
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould not update if user already active today
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould update longest streak when current exceeds it
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould unfreeze streak when user becomes active
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mupdateStreak[2m > [22m[2mshould reward for multiple of 7 days (14, 21, etc)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mgetStreak[2m > [22m[2mshould return user streak
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts[2m > [22m[2mStreakService[2m > [22m[2mgetStreak[2m > [22m[2mshould return null if streak does not exist
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/streak.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/behavior/streak.service.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 287[2mms[22m[39m
 [31mâ¯[39m apps/api/test/integration/user-lifecycle.integration.spec.ts [2m([22m[2m0 test[22m[2m)[22m
[90mstdout[2m | apps/api/test/integration/behavior-flow.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/test/integration/behavior-flow.e2e-spec.ts[2m > [22m[2mBehavior & Gamification Integration (e2e)[2m > [22m[2mBehavior Tracking[2m > [22m[2mshould log a user behavior event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/integration/behavior-flow.e2e-spec.ts[2m > [22m[2mBehavior & Gamification Integration (e2e)[2m > [22m[2mBehavior Tracking[2m > [22m[2mshould retrieve behavior logs for user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/integration/behavior-flow.e2e-spec.ts[2m > [22m[2mBehavior & Gamification Integration (e2e)[2m > [22m[2mGamification & Streaks[2m > [22m[2mshould get current streak
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/integration/behavior-flow.e2e-spec.ts[2m > [22m[2mBehavior & Gamification Integration (e2e)[2m > [22m[2mGamification & Streaks[2m > [22m[2mshould trigger a nudge check (social proof)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/integration/behavior-flow.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m apps/api/test/integration/behavior-flow.e2e-spec.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[90m 41[2mms[22m[39m
[31m   [31mÃ—[31m Behavior & Gamification Integration (e2e)[2m > [22mBehavior Tracking[2m > [22mshould retrieve behavior logs for user[90m 4[2mms[22m[31m[39m
[31m     â†’ expected 0 to be greater than 0[39m
[31m   [31mÃ—[31m Behavior & Gamification Integration (e2e)[2m > [22mGamification & Streaks[2m > [22mshould trigger a nudge check (social proof)[90m 6[2mms[22m[31m[39m
[31m     â†’ expected {} to have property "type"[39m
[90mstdout[2m | apps/api/src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mChallenge Creation & Invitation[2m > [22m[2mshould create a challenge and post an announcement from the leader
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mChallenge Creation & Invitation[2m > [22m[2mshould fallback to system user if no leader is found for announcement
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mProgress Tracking & Winner Determination[2m > [22m[2mshould reward all members and delete challenge when target is reached
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mProgress Tracking & Winner Determination[2m > [22m[2mshould fail and delete challenge if expired without reaching target
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mProgress Tracking & Winner Determination[2m > [22m[2mshould do nothing if challenge is neither reached nor expired
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mCompetitive P2P Nudges[2m > [22m[2mshould send push notification to trailing user when someone is leading
[22m[39m[Push Notification] to follower: {"vi":"Cá»‘ lÃªn!","en":"Keep going!","zh":"åŠ æ²¹ï¼"} - {"vi":"Báº¡n chá»‰ cÃ¡ch leader 50 Ä‘iá»ƒm. Há»c thÃªm 1 bÃ i Ä‘á»ƒ vÆ°á»£t qua nÃ o!","en":"You are only 50 points behind leader. Finish one more lesson to overtake!","zh":"ä½ åªè½åŽ leader 50 åˆ†ã€‚å†å­¦ä¸€è¯¾å°±èƒ½è¶…è¿‡äº†ï¼"}
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/challenges.service.spec.ts[2m > [22m[2mSocialService - P2P Challenges[2m > [22m[2mCompetitive P2P Nudges[2m > [22m[2mshould return null if there are fewer than 2 members
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/challenges.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/modules/social/challenges.service.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 180[2mms[22m[39m
[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould create VIDEO lesson with localized content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould create READING lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould create QUIZ lesson
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould auto-assign order if not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould set order to 1 for first lesson in course
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mcreateLesson[2m > [22m[2mshould respect explicitly provided order
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mupdateLesson[2m > [22m[2mshould update lesson content preserving localization
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mupdateLesson[2m > [22m[2mshould allow reordering lessons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mupdateLesson[2m > [22m[2mshould allow changing lesson type
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mremoveLesson[2m > [22m[2mshould delete lesson
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/test/unit/courses/lessons.service.spec.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 6[2mms[22m[39m
[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts[2m > [22m[2mLessons CRUD[2m > [22m[2mlesson ordering[2m > [22m[2mshould maintain sequential order for multiple lessons
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/courses/lessons.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/course-progress.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[31m[Nest] 8600  - [39m12/22/2025, 12:47:58 AM [31m  ERROR[39m [38;5;3m[AiService] [39m[31mGEMINI_API_KEY is not defined in environment variables[39m
[90mstdout[2m | apps/api/test/course-progress.integration.spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m apps/api/test/course-progress.integration.spec.ts [2m([22m[2m6 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[33m 12273[2mms[22m[39m
[90mstdout[2m | apps/api/test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mPipeline: Actions -> BehaviorLog -> Daily Report -> Export CSV[2m > [22m[2mshould complete the full analytics pipeline
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mConversion Funnel: Register -> First Simulation[2m > [22m[2mshould calculate funnel conversion rates correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mReal-time Metrics: Prometheus/WS Updates[2m > [22m[2mshould update Prometheus gauges and emit via WebSocket
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/analytics-reporting.integration.spec.ts[2m > [22m[2mAnalytics Reporting Integration[2m > [22m[2mSegment-based Filtering[2m > [22m[2mshould filter users by behavior segment
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/test/analytics-reporting.integration.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 168[2mms[22m[39m
[90mstdout[2m | apps/api/test/analytics-reporting.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetCommunityImpact[2m > [22m[2mshould calculate total community impact correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetCommunityImpact[2m > [22m[2mshould return 0 impact points if aggregate returns null
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetUsersOnline[2m > [22m[2mshould aggregate users online based on recent behavior logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mgetRecentGlobalAchievements[2m > [22m[2mshould fetch recent global achievements
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mtriggerRealtimeUpdate[2m > [22m[2mshould fetch all stats and emit to gateway
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/community-stats.service.spec.ts[2m > [22m[2mCommunityStatsService[2m > [22m[2mHigh-concurrency data updates (Mock)[2m > [22m[2mshould handle multiple simultaneous update requests
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/community-stats.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/modules/social/community-stats.service.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 210[2mms[22m[39m
[90mstdout[2m | apps/api/src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mshould log an event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mshould fetch user behaviors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mEvent aggregation by session[2m > [22m[2mshould log events with same session ID
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mJSONB payload handling[2m > [22m[2mshould store complex nested JSONB payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mJSONB payload handling[2m > [22m[2mshould handle JSONB deviceInfo
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mHigh-volume event streams[2m > [22m[2mshould handle 100+ events without error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mHigh-volume event streams[2m > [22m[2mshould handle rapid sequential logging
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mPrivacy filtering[2m > [22m[2mshould allow undefined userId for anonymous tracking
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mPrivacy filtering[2m > [22m[2mshould set default actionCategory to GENERAL if not provided
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/behavior/behavior.service.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 316[2mms[22m[39m
[90mstdout[2m | apps/api/src/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mPrivacy filtering[2m > [22m[2mshould set default duration to 0 if not provided
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/behavior/behavior.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mVirtual Portfolio[2m > [22m[2mshould create portfolio if not exists
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mVirtual Portfolio[2m > [22m[2mshould process trade BUY correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mVirtual Portfolio[2m > [22m[2mshould throw error for insufficient balance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mBudget Decision[2m > [22m[2mshould provide feedback for 50/30/20 rule
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mBudget Decision[2m > [22m[2mshould warn for high wants
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mStress Test[2m > [22m[2mshould calculate survival months and emit nudge
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mCommitment Devices[2m > [22m[2mshould create a commitment and lock funds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mCommitment Devices[2m > [22m[2mshould penalize early withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mCommitment Devices[2m > [22m[2mshould return full amount for on-time withdrawal
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/simulation/simulation.service.spec.ts[2m > [22m[2mSimulationService (Pure Unit Test)[2m > [22m[2mLong Term Impact[2m > [22m[2mshould calculate future value and emit nudge
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/simulation/simulation.service.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 261[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/simulation/simulation.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould send push notification via SocialService
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould broadcast notification via WebSocket
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould handle notification with empty body
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould handle notification errors gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2msendNotification[2m > [22m[2mshould send notifications to multiple users
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mWebSocket broadcast validation[2m > [22m[2mshould validate WebSocket room targeting
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mWebSocket broadcast validation[2m > [22m[2mshould handle WebSocket disconnection gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mWebSocket broadcast validation[2m > [22m[2mshould broadcast to group via gateway
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mgetNotifications[2m > [22m[2mshould return empty array for user with no notifications
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mgetNotifications[2m > [22m[2mshould handle invalid userId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mmarkAsRead[2m > [22m[2mshould mark notification as read
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mmarkAsRead[2m > [22m[2mshould handle invalid notification ID
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/social/notification.controller.spec.ts [2m([22m[2m16 tests[22m[2m)[22m[90m 6[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle special characters in notification content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long notification bodies
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts[2m > [22m[2mNotificationController (C011)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle concurrent notifications
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/notification.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould call next function
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould register finish event listener
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log request method and URL
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log status code
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log response time in milliseconds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log user agent
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/common/logger-middleware.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 3[2mms[22m[39m
[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log IP address
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould handle missing user agent
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould log content length
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould handle 404 status codes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts[2m > [22m[2mLoggerMiddleware (C020)[2m > [22m[2muse[2m > [22m[2mshould handle 500 status codes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/logger-middleware.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage persistence[2m > [22m[2mshould save a message and update thread timestamp
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mchat history retrieval[2m > [22m[2mshould retrieve messages for a thread
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mchat history retrieval[2m > [22m[2mshould return empty list if no messages found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mgroup chat creation[2m > [22m[2mshould create a new group with the creator as leader
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask emails in content
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask names and addresses
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask content before saving
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mmessage encryption/masking[2m > [22m[2mshould mask content when retrieving history
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mthread management[2m > [22m[2mshould create a thread
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/social/chat.service.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 301[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/social/chat.service.spec.ts[2m > [22m[2mChatService[2m > [22m[2mthread management[2m > [22m[2mshould get user threads
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/chat.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/massive-stress.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/test/massive-stress.e2e-spec.ts[2m > [22m[2mMassive Persona Stress Test (1000+ Actions Simulation)
[22m[39mðŸ‘¥ Setting up 50 users...

 [31mâ¯[39m apps/api/test/massive-stress.e2e-spec.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 9143[2mms[22m[39m
[90mstdout[2m | apps/api/test/massive-stress.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/common/i18n.service.spec.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 7[2mms[22m[39m
[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return Vietnamese translation by default
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return English translation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return Chinese translation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould replace parameters correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return the key if translation is not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould replace multiple parameters in all locales
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould handle complex parameter replacement
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould fallback to Vietnamese when locale not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould handle nested key lookups
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould return key if intermediate path is invalid
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould handle empty parameters object
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mtranslate[2m > [22m[2mshould convert non-string parameter values to strings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return field for specific locale
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould fallback to vi if locale not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return empty string if field is null
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould extract Vietnamese field from JSONB
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould extract Chinese field from JSONB
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould fallback to en if vi is missing
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould handle plain string as-is
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return empty string if field is undefined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould return empty string if field is empty object
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts[2m > [22m[2mI18nService[2m > [22m[2mgetLocalizedField[2m > [22m[2mshould prioritize requested locale over fallbacks
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/i18n.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-A8A4E5498F] POST /test-endpoint 400 - {"errorId":"ERR-A8A4E5498F","statusCode":400,"timestamp":"2025-12-21T17:48:18.085Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould generate unique ErrorId for each exception
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould return 500 for non-HTTP exceptions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould return correct status for HttpException
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould include timestamp in error response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould include request path in error response
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould provide login suggestion for 401 errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould provide contact support suggestion for other errors
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould handle complex HttpException message objects
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould log errors with stack trace for 400+ status codes
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mcatch[2m > [22m[2mshould handle string message from HttpException
[22m[39mðŸ§¹ Cleaning up after test...

HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:39:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-505504E08C] POST /test-endpoint 500 - {"errorId":"ERR-505504E08C","statusCode":500,"timestamp":"2025-12-21T17:48:18.086Z","path":"/test-endpoint","message":"Internal server error","suggestion":"Please contact support with Error ID"}[39m
Error: Unexpected error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:49:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-088CB0EEB7] POST /test-endpoint 404 - {"errorId":"ERR-088CB0EEB7","statusCode":404,"timestamp":"2025-12-21T17:48:18.086Z","path":"/test-endpoint","message":"Not found","suggestion":"Please contact support with Error ID"}[39m
HttpException: Not found
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:57:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-9EF189BA9E] POST /test-endpoint 400 - {"errorId":"ERR-9EF189BA9E","statusCode":400,"timestamp":"2025-12-21T17:48:18.087Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:65:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-56A04996AD] POST /test-endpoint 400 - {"errorId":"ERR-56A04996AD","statusCode":400,"timestamp":"2025-12-21T17:48:18.087Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:75:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-7D419C1D37] POST /test-endpoint 401 - {"errorId":"ERR-7D419C1D37","statusCode":401,"timestamp":"2025-12-21T17:48:18.087Z","path":"/test-endpoint","message":"Unauthorized","suggestion":"Please login again"}[39m
HttpException: Unauthorized
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:84:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-C8F4F80E5B] POST /test-endpoint 500 - {"errorId":"ERR-C8F4F80E5B","statusCode":500,"timestamp":"2025-12-21T17:48:18.088Z","path":"/test-endpoint","message":"Server error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Server error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:93:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-7EED7B3CC6] POST /test-endpoint 400 - {"errorId":"ERR-7EED7B3CC6","statusCode":400,"timestamp":"2025-12-21T17:48:18.088Z","path":"/test-endpoint","message":"Validation failed","suggestion":"Please contact support with Error ID"}[39m
HttpException: Validation failed
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:102:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-EBFE222E24] POST /test-endpoint 500 - {"errorId":"ERR-EBFE222E24","statusCode":500,"timestamp":"2025-12-21T17:48:18.089Z","path":"/test-endpoint","message":"Server error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Server error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:115:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-390FCF663E] POST /test-endpoint 400 - {"errorId":"ERR-390FCF663E","statusCode":400,"timestamp":"2025-12-21T17:48:18.089Z","path":"/test-endpoint","message":"Simple error message","suggestion":"Please contact support with Error ID"}[39m
HttpException: Simple error message
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:127:25
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-46BE00A7F4] POST /test-endpoint 400 - {"errorId":"ERR-46BE00A7F4","statusCode":400,"timestamp":"2025-12-21T17:48:18.089Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-0D4045B968] POST /test-endpoint 400 - {"errorId":"ERR-0D4045B968","statusCode":400,"timestamp":"2025-12-21T17:48:18.090Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-DEED0AA82A] POST /test-endpoint 400 - {"errorId":"ERR-DEED0AA82A","statusCode":400,"timestamp":"2025-12-21T17:48:18.090Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-80F48C271A] POST /test-endpoint 400 - {"errorId":"ERR-80F48C271A","statusCode":400,"timestamp":"2025-12-21T17:48:18.090Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-5BE0DAEEB3] POST /test-endpoint 400 - {"errorId":"ERR-5BE0DAEEB3","statusCode":400,"timestamp":"2025-12-21T17:48:18.090Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-9906856BF1] POST /test-endpoint 400 - {"errorId":"ERR-9906856BF1","statusCode":400,"timestamp":"2025-12-21T17:48:18.090Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-9210F27582] POST /test-endpoint 400 - {"errorId":"ERR-9210F27582","statusCode":400,"timestamp":"2025-12-21T17:48:18.090Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-8C814B0BCB] POST /test-endpoint 400 - {"errorId":"ERR-8C814B0BCB","statusCode":400,"timestamp":"2025-12-21T17:48:18.090Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-BDDF1DC1A5] POST /test-endpoint 400 - {"errorId":"ERR-BDDF1DC1A5","statusCode":400,"timestamp":"2025-12-21T17:48:18.091Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
[31m[Nest] 8600  - [39m12/22/2025, 12:48:18 AM [31m  ERROR[39m [38;5;3m[HttpException] [39m[31m[ERR-DC01301F81] POST /test-endpoint 400 - {"errorId":"ERR-DC01301F81","statusCode":400,"timestamp":"2025-12-21T17:48:18.091Z","path":"/test-endpoint","message":"Test error","suggestion":"Please contact support with Error ID"}[39m
HttpException: Test error
    at C:\Users\luaho\Demo project\v-edfinance\apps\api\src\common\filters\all-exceptions.filter.spec.ts:141:27
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:146:14
    at file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (file:///C:/Users/luaho/Demo%20project/v-edfinance/node_modules/.pnpm/@vitest+runner@2.1.9/node_modules/@vitest/runner/dist/index.js:1271:3)
 [32mâœ“[39m apps/api/src/common/filters/all-exceptions.filter.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 7[2mms[22m[39m
[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts[2m > [22m[2mAllExceptionsFilter (C019)[2m > [22m[2mErrorId Generation[2m > [22m[2mshould generate unique ErrorIds for concurrent exceptions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/filters/all-exceptions.filter.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/auth-profile.integration.spec.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [31mâ¯[39m apps/api/test/auth-profile.integration.spec.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[90m 2[2mms[22m[39m
[90mstdout[2m | apps/api/test/auth-profile.integration.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mcheckUserAIUsage[2m > [22m[2mshould throw ForbiddenException if rate limit is exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mcheckUserAIUsage[2m > [22m[2mshould throw ForbiddenException if monthly budget is exceeded
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mcheckUserAIUsage[2m > [22m[2mshould return total tokens used if within limits
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mmaskPII[2m > [22m[2mshould mask email and sensitive fields
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mgenerateResponse[2m > [22m[2mshould return cached response for FAQ if available
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/test/unit/ai/ai.service.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 4[2mms[22m[39m
[90mstdout[2m | apps/api/test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mgenerateResponse[2m > [22m[2mshould generate new response and cache it for FAQ
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/ai/ai.service.spec.ts[2m > [22m[2mAiService[2m > [22m[2mparseActionCards[2m > [22m[2mshould extract action card metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/ai/ai.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/persona-simulation.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

 [31mâ¯[39m apps/api/test/persona-simulation.e2e-spec.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 8122[2mms[22m[39m
[90mstdout[2m | apps/api/test/persona-simulation.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould validate and transform valid DTO
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould reject invalid email format
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould reject password shorter than 6 characters
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mtransform[2m > [22m[2mshould strip non-whitelisted properties
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mJSONB Schema Validation Integration[2m > [22m[2mshould validate JSONB structure with I18n format
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mJSONB Schema Validation Integration[2m > [22m[2mshould reject malformed JSONB structure
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mCustom Validators[2m > [22m[2mshould validate nested objects
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mCustom Validators[2m > [22m[2mshould handle array validation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle null values
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle undefined values
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/common/validation-pipe.spec.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 11[2mms[22m[39m
[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts[2m > [22m[2mValidationPipe (C018)[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty strings
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/validation-pipe.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mFeed Generation & Pagination[2m > [22m[2mshould fetch feed with pagination (limit and offset)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mFeed Generation & Pagination[2m > [22m[2mshould include friends activities in the feed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mLike & Comment Functionality[2m > [22m[2mshould increment likesCount when liking a post
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mLike & Comment Functionality[2m > [22m[2mshould create a behavior log when commenting on a post
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/activity-feed.service.spec.ts[2m > [22m[2mActivityFeedService (SocialService)[2m > [22m[2mMulti-user Activity Mocking[2m > [22m[2mshould handle feed from multiple users across different groups
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/activity-feed.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/modules/social/activity-feed.service.spec.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 134[2mms[22m[39m
[31m[Nest] 8600  - [39m12/22/2025, 12:48:26 AM [31m  ERROR[39m [38;5;3m[StorageService] [39m[31mError uploading to R2[39m
[90mstdout[2m | apps/api/src/storage/storage.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2muploadFile[2m > [22m[2mshould upload file successfully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2muploadFile[2m > [22m[2mshould throw error if upload fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mgetPresignedUrl[2m > [22m[2mshould generate a GET presigned URL
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mgetPresignedUrl[2m > [22m[2mshould generate a PUT presigned URL
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mgetSignedUrl[2m > [22m[2mshould return a presigned GET URL
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:48:26 AM [31m  ERROR[39m [38;5;3m[StorageService] [39mError: Upload failed
    at [90mC:\Users\luaho\Demo project\v-edfinance\[39mapps\api\src\storage\storage.service.spec.ts:66:53
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:146:14
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:11
    at runWithTimeout [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:39:7[90m)[39m
    at runTest [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:17[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runFiles [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5[90m)[39m
    at startTests [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3[90m)[39m
[90mstdout[2m | apps/api/src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mError Handling[2m > [22m[2mshould handle presigned URL generation failure
[22m[39mðŸ§¹ Cleaning up after test...

[31m[Nest] 8600  - [39m12/22/2025, 12:48:27 AM [31m  ERROR[39m [38;5;3m[StorageService] [39m[31mError generating presigned GET URL[39m
[31m[Nest] 8600  - [39m12/22/2025, 12:48:27 AM [31m  ERROR[39m [38;5;3m[StorageService] [39mError: Presigner error
    at [90mC:\Users\luaho\Demo project\v-edfinance\[39mapps\api\src\storage\storage.service.spec.ts:97:59
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:533:5
    at runTest [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1056:11[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runSuite [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1205:15[90m)[39m
    at runFiles [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1262:5[90m)[39m
    at startTests [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@2.1.9/node_modules/[4m@vitest/runner[24m/dist/index.js:1271:3[90m)[39m
    at [90mfile:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/vitest@2.1.9_@types+node@25.0.3_@vitest+ui@2.1.9_lightningcss@1.30.2_msw@2.12.4_@types+node@2_ebmugipt3toifped36nskz2rti/node_modules/[4mvitest[24m/dist/chunks/runBaseTests.3qpJUEJM.js:126:11
    at withEnv [90m(file:///C:/Users/luaho/Demo%20project/v-edfinance/[39mnode_modules/[4m.pnpm[24m/vitest@2.1.9_@types+node@25.0.3_@vitest+ui@2.1.9_lightningcss@1.30.2_msw@2.12.4_@types+node@2_ebmugipt3toifped36nskz2rti/node_modules/[4mvitest[24m/dist/chunks/runBaseTests.3qpJUEJM.js:90:5[90m)[39m
[90mstdout[2m | apps/api/src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mError Handling[2m > [22m[2mshould use custom expiration time for presigned URLs
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/storage/storage.service.spec.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 240[2mms[22m[39m
[90mstdout[2m | apps/api/src/storage/storage.service.spec.ts[2m > [22m[2mStorageService[2m > [22m[2mConfiguration Fallback[2m > [22m[2mshould fall back to environment variables if ConfigService unavailable
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/storage/storage.service.spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/multi-market-stress.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/test/multi-market-stress.e2e-spec.ts[2m > [22m[2mMulti-Market Market Stress Test (VI/EN/ZH Localized Content)
[22m[39mðŸ‘¥ Setting up 60 users across vi, en, zh...

 [31mâ¯[39m apps/api/test/multi-market-stress.e2e-spec.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 8116[2mms[22m[39m
[90mstdout[2m | apps/api/test/multi-market-stress.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleConnection[2m > [22m[2mshould emit connection_established event
[22m[39mClient connected: socket-id
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleDisconnect[2m > [22m[2mshould clean up connectedClients and emit user_offline if client was identified
[22m[39mClient disconnected: socket-id
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleDisconnect[2m > [22m[2mshould do nothing if client was not identified
[22m[39mClient disconnected: socket-id
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleIdentify[2m > [22m[2mshould map userId to socketId and join user room
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleIdentify[2m > [22m[2mshould force disconnect previous connection if same userId connects again
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mhandleJoinGroup[2m > [22m[2mshould join group room
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mBroadcasting methods[2m > [22m[2msendToUser should emit to user room
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mBroadcasting methods[2m > [22m[2mbroadcastToGroup should emit to group room
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/social/social.gateway.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 264[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/social/social.gateway.spec.ts[2m > [22m[2mSocialGateway[2m > [22m[2mBroadcasting methods[2m > [22m[2mbroadcastNewPost should emit to all
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/social.gateway.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when no roles required
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has required role (STUDENT)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has required role (TEACHER)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has required role (ADMIN)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould allow access when user has one of multiple required roles
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould deny access when user lacks required role
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould deny access when user has no role
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould handle multiple required roles (deny if none match)
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/auth/roles.guard.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 10[2mms[22m[39m
[90mstdout[2m | apps/api/src/auth/roles.guard.spec.ts[2m > [22m[2mRolesGuard[2m > [22m[2mcanActivate[2m > [22m[2mshould extract roles from handler and class metadata
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/roles.guard.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mshould return null for unknown context
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mINVESTMENT_DECISION[2m > [22m[2mshould return SOCIAL_PROOF nudge for HUNTER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mINVESTMENT_DECISION[2m > [22m[2mshould return LOSS_AVERSION nudge for high risk level
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mBUDGETING[2m > [22m[2mshould return GOAL_GRADIENT for SAVER persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mBUDGETING[2m > [22m[2mshould return SALIENCE nudge showing equivalent coffee cups
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mSTREAK_WARNING[2m > [22m[2mshould return GOAL_GRADIENT for streak warning
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/nudge/nudge-engine.service.spec.ts [2m([22m[2m8 tests[22m[2m)[22m[90m 205[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/nudge/nudge-engine.service.spec.ts[2m > [22m[2mNudgeEngineService (Pure Unit Test)[2m > [22m[2mgenerateNudge[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle missing user profile gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/nudge/nudge-engine.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/integration/auth-flow.e2e-spec.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
ðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/test/integration/auth-flow.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m apps/api/test/integration/auth-flow.e2e-spec.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 12242[2mms[22m[39m
[90mstdout[2m | apps/api/src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mshould extend AuthGuard with jwt strategy
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould call super.canActivate
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject missing authorization header
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject malformed authorization header
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject expired JWT token
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mcanActivate[2m > [22m[2mshould reject invalid JWT signature
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mhandleRequest[2m > [22m[2mshould throw UnauthorizedException on error
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mhandleRequest[2m > [22m[2mshould throw UnauthorizedException when user is null
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt-auth.guard.spec.ts[2m > [22m[2mJwtAuthGuard (C017)[2m > [22m[2mhandleRequest[2m > [22m[2mshould return user when authentication succeeds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt-auth.guard.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/auth/jwt-auth.guard.spec.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 5[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/analytics/mentor.service.spec.ts[2m > [22m[2mMentorService (Phase 7 Integration Test)[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/mentor.service.spec.ts[2m > [22m[2mMentorService (Phase 7 Integration Test)[2m > [22m[2mshould select STRICT_COACH persona for a HUNTER user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/mentor.service.spec.ts[2m > [22m[2mMentorService (Phase 7 Integration Test)[2m > [22m[2mshould trigger variable reward logic (random chance)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/mentor.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/modules/analytics/mentor.service.spec.ts [2m([22m[2m3 tests[22m[2m)[22m[90m 94[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mFriend Requests[2m > [22m[2mshould send a friend request
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mFriend Requests[2m > [22m[2mshould accept a friend request
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mFriend Requests[2m > [22m[2mshould reject a friend request
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mBlocking[2m > [22m[2mshould block a user
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mBlocking[2m > [22m[2mshould unblock a user
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/social/friends.service.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 174[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/social/friends.service.spec.ts[2m > [22m[2mSocialService - Friends System[2m > [22m[2mActivity Feed[2m > [22m[2mshould get friend activity feed
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/friends.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetTopUsers[2m > [22m[2mshould return top users with formatted names
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetGlobalRanking[2m > [22m[2mshould return correct rank and percentile
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetGlobalRanking[2m > [22m[2mshould throw error if user not found
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetPeriodicLeaderboard[2m > [22m[2mshould aggregate scores for daily period
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetPeriodicLeaderboard[2m > [22m[2mshould work for weekly period
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/leaderboard/leaderboard.service.spec.ts[2m > [22m[2mLeaderboardService[2m > [22m[2mgetPeriodicLeaderboard[2m > [22m[2mshould work for monthly period
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/leaderboard/leaderboard.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/modules/leaderboard/leaderboard.service.spec.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 196[2mms[22m[39m
 [31mâ¯[39m apps/api/test/system-resilience.e2e-spec.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[90m 18[2mms[22m[39m
[90mstdout[2m | apps/api/test/system-resilience.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould calculate HIGH churn risk when activity gap is large
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould calculate LOW churn risk when activity gap is small
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould return LOW risk if not enough logs
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/analytics/predictive.service.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 156[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/analytics/predictive.service.spec.ts[2m > [22m[2mPredictiveService (Plan 1 - Unit Test)[2m > [22m[2mshould include persona context in financial simulation
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/predictive.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mgenerateAchievementShareLink[2m > [22m[2mshould generate a base64 encoded share link and track the event
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mgetSocialMetaTags[2m > [22m[2mshould generate localized meta tags for an achievement
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mgetSocialMetaTags[2m > [22m[2mshould return default tags if achievement is not found
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/social/sharing.service.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 334[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/social/sharing.service.spec.ts[2m > [22m[2mSharingService[2m > [22m[2mtrackViralLoop[2m > [22m[2mshould log a visit event for the viral loop
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/social/sharing.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mðŸš€ Äang khá»Ÿi táº¡o 500 káº¿t ná»‘i trÃªn port 53512...

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: mPzw0t2hFrdcmgeRAABC
Client connected: UW40ERC0vawYduFIAABD
Client connected: 9RmTxSFFt8p_T5HgAABE
Client connected: cvsoZmoALxFii0Z6AABF
Client connected: md1kcQvYWDVfpT-rAABG
Client connected: S_kewOCHWisQs21OAABH
Client connected: cc-Ov-KAFSvBBSSoAABI
Client connected: Hjl-CR6iJevoqT3mAABJ
Client connected: NzzeFdS7Fo1uJ8XsAABK
Client connected: Enhcq69koq79ZrAJAABL
Client connected: XTRPZNzHPiLjP7UiAABM
Client connected: fX-n8MRW-b1qHmjFAABN
Client connected: VmOmk4N7332KAz8xAABO
Client connected: PbDdnNgSPbyQ3AhgAABP
Client connected: RIJt_DIvIFWLpUjSAABQ
Client connected: qmhDByTkGjJUNdbCAABR
Client connected: kyOKramQLAN3FBClAABS
Client connected: N0T8Qc5F3tfwcq0JAABT
Client connected: cJy0EBl7C-KiY-rXAABU
Client connected: snwHCA5qXarhnXSsAABV
Client connected: OiO37wibFiGc-zGAAABW
Client connected: w8Bd44veDDr2S5hDAABX
Client connected: by8jybgUNdcaW6dZAABY
Client connected: ao8Yz5H16RlJM0OcAABZ
Client connected: df-cL4cF3yrJ-PL3AABa
Client connected: AAXsakbgJ39TWtTvAABb
Client connected: h48VBDd44HLgQlEGAABc
Client connected: mhx6PrALf7WXc7BEAABd
Client connected: YbH4YB5mfe2jQisJAABe
Client connected: 66kNV0OgH_gqGZLTAABf
Client connected: FpsX7USXIqRpY_utAABg
Client connected: lY89qSYJXHK2vjEfAABh
Client connected: DBQLppCIgJBIm34nAABi
Client connected: dIqwgcSZYMhKyHMjAABj
Client connected: hENxPJ6KPewElE24AABk
Client connected: DcRxj1woQ0wNcfF4AABl
Client connected: cU7We0OUxenz43GWAABm
Client connected: W8GSg6piNuI4EbLpAABn
Client connected: 6FtYmyOz_qD6kxpVAABo
Client connected: yfJ7xdONw5npzjBfAABp
Client connected: AnE4AIEje_BaR-1JAABq
Client connected: Ck9XDUn6i3VoQRtzAABr
Client connected: ZiN8RjLNe95w2AumAABs
Client connected: 4ge-5ZM_jLFbtVFwAABt
Client connected: nbb7mw2Ck_PnnXLfAABu
Client connected: iJEvh35Be6uhnf8DAABv
Client connected: havaeeTHq3UtIZwGAABw
Client connected: ZGslD31SrdEsudytAABx
Client connected: aRglWZF3KAWT-iq6AABy
Client connected: HNn7tF5iJ_MMl54bAABz

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: xMgvyYXoE6yxyO2xAACm
Client connected: aOBNG3Whh1nfYB0FAACn
Client connected: yDoi26-TPOAJafSvAACo
Client connected: -RbdWF7pLwzH80YOAACp
Client connected: iOc1kFdKjc8xhgmhAACq
Client connected: PRFb9AFF-gpt9CM2AACr
Client connected: xMY-1OSPhyh7IRmmAACs
Client connected: QLaI882LJvY1305cAACt
Client connected: BCKDvEhVOZ-lfRDeAACu
Client connected: ScVbofO15WZY6WIjAACv
Client connected: 5sQ28MROw4ugmbbGAACw
Client connected: EHpQJ_iCidmnUIIgAACx
Client connected: Ho_fQy62UTD-WiP9AACy
Client connected: fvGtf0a2eFn0cDmEAACz
Client connected: 0z6IucSWgHPYSZkSAAC0
Client connected: FDA585bCL3p2-1ZIAAC1
Client connected: dIlAI26xD5bpA6OSAAC2
Client connected: ycYsYliV7fkCB4IxAAC3
Client connected: 2wcbE0m1BM8R4VR1AAC4
Client connected: sh_O1rQbKFFhCKcoAAC5
Client connected: rCPtPCaB0dgIZOSZAAC6
Client connected: 8e-HzDthtFA71qsPAAC7
Client connected: eKkYBq6cZFwvgomMAAC8
Client connected: SsoNqonrjRghSj19AAC9
Client connected: QuDWDRvAAp6yRcbMAAC-
Client connected: 1u08iNKQ5kVUSGy5AAC_
Client connected: N38O4axlzHqho2muAADA
Client connected: uR5l8aQpbtLLELVUAADB
Client connected: iLj86UpesnkZ2yv4AADC
Client connected: zOvNYVWuQkJycHWtAADD
Client connected: fyrTuIMQ9SXVb1GLAADE
Client connected: cPX_izc0wvG7XNrGAADF
Client connected: WZ6DLl5EcK1xmxURAADG
Client connected: iQg40IqGDUCVfSGrAADH
Client connected: tbIkaEEkU-v9ylzhAADI
Client connected: hPQR4ePvCI_upmz0AADJ
Client connected: inhJxjuZ2UU8ecEpAADK
Client connected: PK6bHr4aaye3AmACAADL
Client connected: 8Po5vKWKQEwWXALGAADM
Client connected: rSwdt1r3cOqE2JyUAADN
Client connected: JLJs1BEqd-v82NZUAADO
Client connected: 7J4ya4R2rv_79hJcAADP
Client connected: PdyPvmqJBIRD2sX0AADQ
Client connected: 2W9rZQ4xGLotnsMdAADR
Client connected: bwKb0Yl9aF-M5PvLAADS
Client connected: Eoobc2e_H9ng03VQAADT
Client connected: mxdJWvFNbrBDVjutAADU
Client connected: 9A_soXDGpKP7IvFvAADV
Client connected: 82ax49fe0Hga5ToGAADW
Client connected: GC2d3PD2u1euUQsdAADX

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: N6iiXvgXe0d4MFguAAEK
Client connected: gIYzN1x4WiVRuuDRAAEL
Client connected: uxdwv-I1TW5k4PIgAAEM
Client connected: WlGxl_fn0l5SYcx6AAEN
Client connected: -z6IEH1ehX0y0E61AAEO
Client connected: OAPSlG7L4HXyGZH2AAEP
Client connected: Nfa4-5xuJGAyeCQJAAEQ
Client connected: sT214wUa7nwQgb9yAAER
Client connected: kiBjqmfuZVloI3wDAAES
Client connected: w0oOdLHD84yC-I7yAAET
Client connected: iXce5nVE77_d-4O2AAEU
Client connected: BuwtkWSyDWMVQZv2AAEV
Client connected: zDCeyygnIXGFPG9hAAEW
Client connected: 1q2iHa5HN-Zq6qBUAAEX
Client connected: _eGCj2vIxWJLUrP8AAEY
Client connected: RLXxNjBY9BBEav5RAAEZ
Client connected: uabxHWL0ndEST-51AAEa
Client connected: dmKurLdn6Zu4xJidAAEb
Client connected: ERVKYfCBn1WouHjpAAEc
Client connected: rzxNmhINUhf6aWH0AAEd
Client connected: enJsG5e9KImZvIHPAAEe
Client connected: RPzISCby0KWeZw29AAEf
Client connected: vc8recx0cDNZ-bJyAAEg
Client connected: DYWl39XnlXZr-8FvAAEh
Client connected: V2AhsdBiQa1qqSODAAEi
Client connected: pIQj4b1bxykFE_PvAAEj
Client connected: xJxhDAv2nsfavdsKAAEk
Client connected: l0FX8W13_WqYGhDyAAEl
Client connected: lQpHDaul2oV2kwGnAAEm
Client connected: D21LbMe_HVqpUY1NAAEn
Client connected: uil3bVXXSbZG0BgXAAEo
Client connected: 6J0ZfpLwWEZ7acvyAAEp
Client connected: sz90cySZx4Ki9bNjAAEq
Client connected: C5LxMzhWolTfBhXtAAEr
Client connected: DeJzSTUyOjwXmoZ3AAEs
Client connected: tmKP_Ue3OcFd5VMOAAEt
Client connected: 0CKaxxDCc9nYgv9tAAEu
Client connected: NeQW7E9q-e_FSu5rAAEv
Client connected: 3Vk0S0BrhDEB7J4QAAEw
Client connected: RfmnGsBLjULGSjOlAAEx
Client connected: 4Kt9nwyt7Uq9awxRAAEy
Client connected: pPAcaWX_ULHJbGGyAAEz
Client connected: hgx--vOKwFdMsDZWAAE0
Client connected: nimsSON2ys9NzogzAAE1
Client connected: p6WPsdojnAj-QSjCAAE2
Client connected: a2F9bqqmjKdmGNmrAAE3
Client connected: HOzJtWMocmaRhTg7AAE4
Client connected: E3J9U29AnY5MOp4RAAE5
Client connected: LaMgH495Hiyb4ha9AAE6
Client connected: 2xf55Y9x3CYAf0VnAAE7

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: UtQltLYAHxN6cL97AAFu
Client connected: ADESy6XrNvE4xDm7AAFv
Client connected: fKLX0qYCohMBNTtdAAFw
Client connected: ghpxX1aeC8BMT6O3AAFx
Client connected: J109iAGzIQh3g4rlAAFy
Client connected: jPsjbidx6NRNdYvqAAFz
Client connected: pxWx_-Ky4vB6EbpWAAF0
Client connected: _R8ZorA48TuV3gfQAAF1
Client connected: EMvOvmGZ4QrZkKEbAAF2
Client connected: q7EtDN65_t1EgZ4BAAF3
Client connected: HAXkjByYV4C8p0cJAAF4
Client connected: zfAkJf3BrWYXDVA7AAF5
Client connected: hUOpzkXzJBJFZJQaAAF6
Client connected: fZBM_VfSPuCljotQAAF7
Client connected: MS02oX0Z5IaNSkspAAF8
Client connected: -g_2D8bZAIxx3WPLAAF9
Client connected: z1V9wFDxAe3HdN4LAAF-
Client connected: 9fd_G0tER0VjBxisAAF_
Client connected: SPIWf1sPhAQ-K9jbAAGA
Client connected: JuwJH2mA3hyTp991AAGB
Client connected: AzH04t4RgFT8uyNzAAGC
Client connected: WvfgXZKKFPN0SpTcAAGD
Client connected: ROeFxvYTRjMA9qpLAAGE
Client connected: UT7rYI0hElRUt1teAAGF
Client connected: Pse98AuxSdnHsYd4AAGG
Client connected: zHqxGgCBPkiwtWeGAAGH
Client connected: E9LrXk-i8dq-kVchAAGI
Client connected: xF9xvxIT152Yptq_AAGJ
Client connected: 7SOsdQW2tP1w3OJRAAGK
Client connected: mmQpLOJhf-6xjqZfAAGL
Client connected: d-K9YsMYTm9EIDhuAAGM
Client connected: 9TunWeF_FstN7fM7AAGN
Client connected: EG6bxNcp4i4PgGytAAGO
Client connected: h7LlOCaGCdS-AXEZAAGP
Client connected: StQ3ZL6Msbev3jKNAAGQ
Client connected: DhGWsfkn6tzPz7MSAAGR
Client connected: Y_4X56bj0rj1YLa-AAGS
Client connected: RVEF0GarvCf8XXcEAAGT
Client connected: bd-Su0XRQHulm62dAAGU
Client connected: 99R7GiQF8m3G2RQmAAGV
Client connected: 6ZlDCdQ9WvThOWJjAAGW
Client connected: TZ2AvDKUwHJqDcg2AAGX
Client connected: WYpDNDLfDK5RvbihAAGY
Client connected: WhtyAyBCYjZ9hcF0AAGZ
Client connected: xEnHBpFpX_MAhkBNAAGa
Client connected: BgGrj7wMDoSifSIKAAGb
Client connected: afbrvKT59_3Mf1FXAAGc
Client connected: v6v4Mjo8cNNrhWKXAAGd
Client connected: QgwaOgTyjeJeLxDuAAGe
Client connected: ovKSqFLLo1n8piQLAAGf

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: hgqD4qIKo5AVmDxvAAHS
Client connected: rD1UrZf7A-oNkOQ2AAHT
Client connected: vRZU5HOlW9PntZNkAAHU
Client connected: h3rioWk9fU5HfWf_AAHV
Client connected: c27VudRuipQIICjAAAHW
Client connected: _qFJzxoVLaIcfOEAAAHX
Client connected: L_9SGls8mUuSlu1HAAHY
Client connected: 3VXs_f50ks66Gp8eAAHZ
Client connected: t8encvUlCzgPJn_vAAHa
Client connected: cUyKv4Wgwck6fSyKAAHb
Client connected: S_vxUBrvluDsriL6AAHc
Client connected: Bzw4pmrIPoBtw88pAAHd
Client connected: 5peJbQdsKpzRyMqGAAHe
Client connected: 3LRdL60Jx7sNFuiZAAHf
Client connected: YkFlQGWwrnkrm1gxAAHg
Client connected: A4tKQdQXHgwHyuQtAAHh
Client connected: NWwpuf0Cl_-1hw6HAAHi
Client connected: BeomkQtUJeAYDhY6AAHj
Client connected: AHUqI0wngS9YM5pmAAHk
Client connected: GwFLzJQDxkqcjl4-AAHl
Client connected: pNsSysXNTjHZXu3FAAHm
Client connected: hDahMQndtEMB9GplAAHn
Client connected: 4GXVZ4BezxCNdSsfAAHo
Client connected: qoiod7YsnT7SLf0YAAHp
Client connected: c2QKCx5EqQ97AZ7qAAHq
Client connected: 4C7l1mFEPQ2Yw0uFAAHr
Client connected: chVlYGWWbHv15sDTAAHs
Client connected: gQtNNOjN_cxWE-hAAAHt
Client connected: 6H7HY6hfwE7o62y1AAHu
Client connected: yPxcihCw9AfKFFdhAAHv
Client connected: o8gf_0iOWPuSIpbMAAHw
Client connected: Owyycp04_z6pqZooAAHx
Client connected: jUAOAZZBa4gu1K7NAAHy
Client connected: 6AK-DVTNVzVa6tOaAAHz
Client connected: nOewG4jUTxBuWPwaAAH0
Client connected: 8yavIY6-5_mRIKQrAAH1
Client connected: WLOoSI3bjltQPfNRAAH2
Client connected: _eoKWfVXoO7EKyFGAAH3
Client connected: uozok8xUWgP0XwepAAH4
Client connected: BUJGFoR_gh8QTd-fAAH5
Client connected: mPT6y5x7W3yk24mgAAH6
Client connected: NRX00Thb6Y_4DLpZAAH7
Client connected: zXMWpKcVwCKpOP6KAAH8
Client connected: GoanQA2nV_RHLYTFAAH9
Client connected: AT0kvCgaQNO05daQAAH-
Client connected: y8jhHWdc1CYz05TDAAH_
Client connected: XA3Qz5rRXLn_1IrMAAIA
Client connected: wKkojmgHQPH-CUXfAAIB
Client connected: qTv5npZ8o7Z-QaRgAAIC
Client connected: D2vJHgEI1FTmsomnAAID

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: 7h2KpEo9nTd26QoXAAI2
Client connected: 2H0mdN07yaVpVWhUAAI3
Client connected: bR4-tjV4ESxMFFiGAAI4
Client connected: zJGGxnkB5UBBuzY7AAI5
Client connected: IigrnFZ5W5mbFAohAAI6
Client connected: SoBQZU7lRioPhuGhAAI7
Client connected: K9UFxxNoPkKtSSL8AAI8
Client connected: bDDvdWV41duw3wHEAAI9
Client connected: IQOVwGEspKTrMf0MAAI-
Client connected: UModZYfTFDMMcOTKAAI_
Client connected: LZiQkYnxtIu58MPYAAJA
Client connected: Bp1fP9RZ_n_fnhQlAAJB
Client connected: -AViHelEYDMo9xE5AAJC
Client connected: OwKDCmjLQ2mlrNBeAAJD
Client connected: E4S7AT_mGa_JXtraAAJE
Client connected: LdIaVi1vLsyMPtMIAAJF
Client connected: Wo6OIQM_WYrodsCKAAJG
Client connected: SIfk_szBKBIRarx2AAJH
Client connected: K8x8dU1WG41MIA92AAJI
Client connected: uSWk_PtTyn5xc35JAAJJ
Client connected: RajGoCwZdTTcMzqqAAJK
Client connected: NJjng0mi1qZjUgcoAAJL
Client connected: tbvzU3386RrJRD68AAJM
Client connected: k5uQJZMTW1OZG7C0AAJN
Client connected: m5Jsh9BTPvNGdRNwAAJO
Client connected: 3xO6i1Vaewfbf2s4AAJP
Client connected: V655-nTOfzuG8qi5AAJQ
Client connected: 2P3yjaQWBLSB1UxqAAJR
Client connected: sE3zq3QKx-SqGT44AAJS
Client connected: 2x1yw3rmLxPt02BhAAJT
Client connected: Nw6CzJ6vzS3dHSSQAAJU
Client connected: Dq5ODSRBb21op0gLAAJV
Client connected: b2YDXly6m6akK6dUAAJW
Client connected: s6oppidoZ7LxK1WBAAJX
Client connected: ZZU0bBzNUBUSVU8QAAJY
Client connected: YXWMgiNL3-weFKp4AAJZ
Client connected: VZ3ASw0KTJaZA9yBAAJa
Client connected: XnE66g8B9IN1wkqkAAJb
Client connected: 6ouk3_uaF0LbvWIlAAJc
Client connected: 9-URCyXc9s0Qh-0TAAJd
Client connected: BGczjhgD_th96IqTAAJe
Client connected: x5_j-nlNJ3S1z6w_AAJf
Client connected: vQQAp4A9oaOEs2LKAAJg
Client connected: zi2qKdbnKsA4EsG6AAJh
Client connected: F17hmYPfHZ6t_0gkAAJi
Client connected: 2eCchEiUSDzbXQ1fAAJj
Client connected: OPw-K4RTn1fgHHIIAAJk
Client connected: SQbaWDPy31G3nYOXAAJl
Client connected: VTkkJ0gIggBirjTFAAJm
Client connected: Orw63R9QlsPsrrufAAJn

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: qqpvw9X11lNEx8RgAAKa
Client connected: _I_WOeQj4B4qf2OsAAKb
Client connected: U_hXuvAqEcxKxsZaAAKc
Client connected: xuhQYOqJ13-QRNKtAAKd
Client connected: 5GYxWigHhDOcTQfOAAKe
Client connected: LIQR3dXqZMxpY2lNAAKf
Client connected: sCS6T1CKc3a-YjcrAAKg
Client connected: 081FEKjRLotcpiLEAAKh
Client connected: o7Lf1DCUMo7-7OSRAAKi
Client connected: cB9t0T9-LicZgsSNAAKj
Client connected: HODsSgaEXCCbsHUEAAKk
Client connected: yCDFng3Pj_-adsYEAAKl
Client connected: Bpr6dZ-a60nLejDXAAKm
Client connected: 5224MO5ZSYOkYz8KAAKn
Client connected: t-erH7Tt-CNfk-_lAAKo
Client connected: ZZlOEB07xyFf8ipkAAKp
Client connected: PyMcqC2ujW-jEMueAAKq
Client connected: zg_UVXBa6dq8VrvHAAKr
Client connected: coGCMz7-iEKLpewkAAKs
Client connected: s52_R88fLtANoXL4AAKt
Client connected: 96PlQ4se0NcXZIVSAAKu
Client connected: h5EkBG2mQ9f00L9BAAKv
Client connected: dAU4jZc5JvUPnpskAAKw
Client connected: aYa8wO02odlPUX3sAAKx
Client connected: _oAfCgFGgEZAkroUAAKy
Client connected: HrfmOGYAbJOSYkNYAAKz
Client connected: XsKpkqRwhA-vF74iAAK0
Client connected: z-QqbigAes6RI6MEAAK1
Client connected: Ne5lWV8uRe-sDXabAAK2
Client connected: OXOXFLgdKoiva1_tAAK3
Client connected: woUNoEvGYnj-gPKOAAK4
Client connected: BAJQdo1g3ptfeqpvAAK5
Client connected: hwPTg4TAqZiJ1347AAK6
Client connected: ftcKzCFoJfiAk_TlAAK7
Client connected: eQR9ebmDHnWUncC0AAK8
Client connected: twU1vbFbUlDNtcbfAAK9
Client connected: DZ6RvYg0DJ9lo90HAAK-
Client connected: p7782DMVCdgZxGGoAAK_
Client connected: vAXHwl3zwl3wNAAqAALA
Client connected: _1okW093byxXpsJWAALB
Client connected: x_lALjeORl4yw6eiAALC
Client connected: uk4H8U4R4sgCTqEGAALD
Client connected: Cv6ufK6U1NfxqrROAALE
Client connected: iUP5MXrNL8clLp7SAALF
Client connected: L8C--Pmbk0a6-btuAALG
Client connected: cg5k7RbfULpEcdB0AALH
Client connected: SHxZVqqvh4rB8RpoAALI
Client connected: mOsJ85_SiCG6YVABAALJ
Client connected: 4GHjHKdCslbKgs82AALK
Client connected: -eMsJQsmfkxudyOmAALL

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: 2OiW7ycLPWledwArAAL-
Client connected: m56xeHADw3tWo1S5AAL_
Client connected: G8m4bkFO_-MqVeNDAAMA
Client connected: 4o6G6LTjIywmdSCmAAMB
Client connected: 8Nv0Lcru7LgtFXvPAAMC
Client connected: SdZqfTbV-gac3XW_AAMD
Client connected: EeyEBMa3wd9oMwbmAAME
Client connected: Tgdrpa20W9JCeAhyAAMF
Client connected: -e93rIrPSexbVNsAAAMG
Client connected: uCLY-nnSzcNoiceqAAMH
Client connected: CoKQ3MeYMe3o7D0pAAMI
Client connected: HCi_rPtHlH27DoaHAAMJ
Client connected: jeTQCeJnmVHr-G-TAAMK
Client connected: WXLEPRH5JIHrH_KDAAML
Client connected: iBNjHaoyme2J5jnvAAMM
Client connected: 8YJ00aJR2gW44W2NAAMN
Client connected: PFYjpjQ6sE-N2KscAAMO
Client connected: 5wbO9pXG96nE3jTAAAMP
Client connected: yUyCgqzmvjW0tnZQAAMQ
Client connected: fgpmmt5J_aVeefaoAAMR
Client connected: aAhqzeJrI6t9ev1VAAMS
Client connected: fC9BdZBZZ4fkeLmmAAMT
Client connected: JeVLku5ZgiD0VkWLAAMU
Client connected: qQKJ3lETlcX5Jm_ZAAMV
Client connected: 3peTmk82CmnjEDBEAAMW
Client connected: UJU566GhZk19njnPAAMX
Client connected: iE8xQZ8ImUc7wGV3AAMY
Client connected: _5CVdaj2Wn6eFmyeAAMZ
Client connected: Nf0MRpxGwE02FZ64AAMa
Client connected: q1xKohMcjdJWe3AQAAMb
Client connected: bMfjZauJFugBAWUVAAMc
Client connected: pZrv6E2Ynuy04oG7AAMd
Client connected: durSq5BGkmcW371oAAMe
Client connected: jkpZb4elUWl6_MNXAAMf
Client connected: b217VZ0ep_TXzDi5AAMg
Client connected: 8DoblqwYr0lun1biAAMh
Client connected: Tr-IExyvVchn_pmaAAMi
Client connected: 31WY2LoMOFJrKHu0AAMj
Client connected: jllDKKhDAy8qMWprAAMk
Client connected: ufFIsbf6PW7jo-dtAAMl
Client connected: rynUztWSRtEHNCcyAAMm
Client connected: UOshv4Ss7cYJF8EyAAMn
Client connected: ev5HGgCYOioWglspAAMo
Client connected: cKNt3ImcuJUKbY27AAMp
Client connected: 8XSxw3QjyKN_nw8nAAMq
Client connected: Bpc186-ZM1sF_f0pAAMr
Client connected: o5kh-bwt_Ra2r7ZnAAMs
Client connected: pACEMHsQowe11s3hAAMt
Client connected: OWhDWu7zuq0XSp2eAAMu
Client connected: rW3tCGmtyW4bdW4BAAMv

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: sTmwne8ke7kt1o69AANi
Client connected: NxIjeGY77fVuU8eWAANj
Client connected: N1IKfmpQVCAgaB5-AANk
Client connected: 1mxVVOKzQYlDPDDVAANl
Client connected: 6DsBXRX4JXWBTU8rAANm
Client connected: jpz-hJr1N8vMNCY8AANn
Client connected: wucQerovsGh1kzeoAANo
Client connected: FaKgG8laALDBW8tJAANp
Client connected: RK-ddV3WIubbd9R8AANq
Client connected: 3cDFXTndIF_PaGUxAANr
Client connected: qEZTCikYiepd6vOZAANs
Client connected: AQ1QIUATc6dv3PVHAANt
Client connected: VcACo2CZkWZ9xmJ1AANu
Client connected: iB2XYl20e-PZr-CMAANv
Client connected: 3x35wctPvhjQbcWlAANw
Client connected: 9PcZfaN0K7gJuJB3AANx
Client connected: VtnoZSOh9SfxA3MaAANy
Client connected: 1nsxwOLWFlYGK7slAANz
Client connected: XE2IsUXGuW6kQsXBAAN0
Client connected: w0VikPuYe-Z7JV8iAAN1
Client connected: emY8-e6jSCeRCjwTAAN2
Client connected: p91anp9Oufv2XdURAAN3
Client connected: o9gc_Yex5qg6QOnjAAN4
Client connected: CDKFjSK9uVkioh0gAAN5
Client connected: ske3CXcm0uoCxDKTAAN6
Client connected: plkmE81Bc7SBZF0pAAN7
Client connected: uwepMGPEBK9RE4faAAN8
Client connected: BE_rBhr_Xnh0i6YHAAN9
Client connected: ff5-EddQCqc20QPoAAN-
Client connected: z0Tx3EyZlCVeIVQaAAN_
Client connected: STEGtz_mM7Uo4JENAAOA
Client connected: 4ACBaKf_Khu2QSxvAAOB
Client connected: qcMAuQUTCjgyyAFvAAOC
Client connected: APj9Z1jjPHIbrmLhAAOD
Client connected: XNAj0aFjmVUjpN04AAOE
Client connected: NS-rOA8jFhJMare-AAOF
Client connected: WS2ofUMGPJtBK7jKAAOG
Client connected: QX7dJyij3fDX9vEWAAOH
Client connected: RsOiBo38iIxRsWRWAAOI
Client connected: UDlEE-1AfJCvbXheAAOJ
Client connected: MsWLcYyLcH_3xjBjAAOK
Client connected: PoycQJNWVIOyfbleAAOL
Client connected: Ee3QNVICGcUazVBYAAOM
Client connected: hJ0DS_CCy9u7b5t1AAON
Client connected: 3dO39Ku5NPT3gOXiAAOO
Client connected: 5AZs5JLeiozX3xtAAAOP
Client connected: N6YBFppVWGSrJm_cAAOQ
Client connected: xEoVHMZbia46_JHxAAOR
Client connected: SWctRSnRH55cf_ZXAAOS
Client connected: Y08FL-EUdC2deewvAAOT

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)[2m > [22m[2mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i
[22m[39mClient connected: evrvJdXndWOJaz5BAAPG
Client connected: bnzed805i1wRPbq9AAPH
Client connected: 72lDxvgZ4TqWycdMAAPI
Client connected: xbFtGjFeaT94kVwpAAPJ
Client connected: r9fGrFETeEgeUuvbAAPK
Client connected: fVG0DeNLa7rKknCrAAPL
Client connected: oBayWxhweUJ-CLhxAAPM
Client connected: T9jaNVC_5af86AgjAAPN
Client connected: wV8KuFMAF8w0DtQGAAPO
Client connected: ijpHw-njQFR9VE_pAAPP
Client connected: PRb316UJI-epc59wAAPQ
Client connected: CA_bQpZawkIo64gGAAPR
Client connected: -Qo35aY2K8SVvX0fAAPS
Client connected: QqdSDx7xyUksxocFAAPT
Client connected: VkBoEGobVz7tifo_AAPU
Client connected: C73VA7PxtJe8zKYJAAPV
Client connected: 5O5zQFXlrvSus6zgAAPW
Client connected: _eU-nhdXmOaYhfw2AAPX
Client connected: dqE0owfGExWaa74NAAPY
Client connected: M_U7Expf-o8KGaRMAAPZ
Client connected: XH4CZmerVQAOmVauAAPa
Client connected: lkHSk0LuDYwf6igQAAPb
Client connected: mm37b8MikX1EEJs-AAPc
Client connected: gSn9Gle0Jl2v-tXmAAPd
Client connected: tQ5GzVunztwTR4D_AAPe
Client connected: V7hC4kq8X0c6RkR7AAPf
Client connected: Y1QxPPbr1Cm08_DkAAPg
Client connected: 6Bk95BvTzx30GNklAAPh
Client connected: vjN4CJGUJmOtP_s1AAPi
Client connected: ut0FkyQf9PggJmr-AAPj
Client connected: 3A2rofhO9Ox5g5wlAAPk
Client connected: 39XuYfYSFbQt2eNdAAPl
Client connected: PzqCjghKu0K3dKttAAPm
Client connected: q7-bVE3eIvJWZg1HAAPn
Client connected: CDPi6gBY9JZpX8GQAAPo
Client connected: 0acQk_T3owkYof9AAAPp
Client connected: dlf0-l984TNu2xRxAAPq
Client connected: PFDRFZaeoSsoLg0WAAPr
Client connected: q5HJR9GKMIyC3f8NAAPs
Client connected: 3Tw2B4NNfPGpR1n8AAPt
Client connected: -lbT032b5aC0d_tPAAPu
Client connected: B4txz569bE8VNuUhAAPv
Client connected: _7kVJFSIGu50PHV1AAPw
Client connected: rZIWMU033MrhNXiGAAPx
Client connected: 84K9Hn3lJ4uOc1uPAAPy
Client connected: v5ii9NnLc6rkgUUNAAPz
Client connected: naxPX1krFwNS8NaLAAP0
Client connected: kmE4o73ePtBqhIlTAAP1
Client connected: TTEU5CLwen068UIDAAP2
Client connected: K4BfLHI9kcbJnsFFAAP3
âœ… ÄÃ£ káº¿t ná»‘i 500 clients.
ðŸ“¢ Testing Broadcast latency...
â±ï¸ Broadcast duration: 14ms
ðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts[2m > [22m[2mSocial Stress Test (1000+ Connections Simulation)
[22m[39mClient disconnected: mPzw0t2hFrdcmgeRAABC
Client disconnected: UW40ERC0vawYduFIAABD
Client disconnected: 9RmTxSFFt8p_T5HgAABE
Client disconnected: cvsoZmoALxFii0Z6AABF
Client disconnected: md1kcQvYWDVfpT-rAABG
Client disconnected: S_kewOCHWisQs21OAABH
Client disconnected: cc-Ov-KAFSvBBSSoAABI
Client disconnected: Hjl-CR6iJevoqT3mAABJ
Client disconnected: NzzeFdS7Fo1uJ8XsAABK
Client disconnected: Enhcq69koq79ZrAJAABL
Client disconnected: XTRPZNzHPiLjP7UiAABM
Client disconnected: fX-n8MRW-b1qHmjFAABN
Client disconnected: VmOmk4N7332KAz8xAABO
Client disconnected: PbDdnNgSPbyQ3AhgAABP
Client disconnected: RIJt_DIvIFWLpUjSAABQ
Client disconnected: qmhDByTkGjJUNdbCAABR
Client disconnected: kyOKramQLAN3FBClAABS
Client disconnected: N0T8Qc5F3tfwcq0JAABT
Client disconnected: cJy0EBl7C-KiY-rXAABU
Client disconnected: snwHCA5qXarhnXSsAABV
Client disconnected: OiO37wibFiGc-zGAAABW
Client disconnected: w8Bd44veDDr2S5hDAABX
Client disconnected: by8jybgUNdcaW6dZAABY
Client disconnected: ao8Yz5H16RlJM0OcAABZ
Client disconnected: df-cL4cF3yrJ-PL3AABa
Client disconnected: AAXsakbgJ39TWtTvAABb
Client disconnected: h48VBDd44HLgQlEGAABc
Client disconnected: mhx6PrALf7WXc7BEAABd
Client disconnected: YbH4YB5mfe2jQisJAABe
Client disconnected: 66kNV0OgH_gqGZLTAABf
Client disconnected: FpsX7USXIqRpY_utAABg
Client disconnected: lY89qSYJXHK2vjEfAABh
Client disconnected: DBQLppCIgJBIm34nAABi
Client disconnected: dIqwgcSZYMhKyHMjAABj
Client disconnected: hENxPJ6KPewElE24AABk
Client disconnected: DcRxj1woQ0wNcfF4AABl
Client disconnected: cU7We0OUxenz43GWAABm
Client disconnected: W8GSg6piNuI4EbLpAABn
Client disconnected: 6FtYmyOz_qD6kxpVAABo
Client disconnected: yfJ7xdONw5npzjBfAABp
Client disconnected: AnE4AIEje_BaR-1JAABq
Client disconnected: Ck9XDUn6i3VoQRtzAABr
Client disconnected: ZiN8RjLNe95w2AumAABs
Client disconnected: 4ge-5ZM_jLFbtVFwAABt
Client disconnected: nbb7mw2Ck_PnnXLfAABu
Client disconnected: iJEvh35Be6uhnf8DAABv
Client disconnected: havaeeTHq3UtIZwGAABw
Client disconnected: ZGslD31SrdEsudytAABx
Client disconnected: aRglWZF3KAWT-iq6AABy
Client disconnected: HNn7tF5iJ_MMl54bAABz
Client disconnected: xMgvyYXoE6yxyO2xAACm
Client disconnected: aOBNG3Whh1nfYB0FAACn
Client disconnected: yDoi26-TPOAJafSvAACo
Client disconnected: -RbdWF7pLwzH80YOAACp
Client disconnected: iOc1kFdKjc8xhgmhAACq
Client disconnected: PRFb9AFF-gpt9CM2AACr
Client disconnected: xMY-1OSPhyh7IRmmAACs
Client disconnected: QLaI882LJvY1305cAACt
Client disconnected: BCKDvEhVOZ-lfRDeAACu
Client disconnected: ScVbofO15WZY6WIjAACv
Client disconnected: 5sQ28MROw4ugmbbGAACw
Client disconnected: EHpQJ_iCidmnUIIgAACx
Client disconnected: Ho_fQy62UTD-WiP9AACy
Client disconnected: fvGtf0a2eFn0cDmEAACz
Client disconnected: 0z6IucSWgHPYSZkSAAC0
Client disconnected: FDA585bCL3p2-1ZIAAC1
Client disconnected: dIlAI26xD5bpA6OSAAC2
Client disconnected: ycYsYliV7fkCB4IxAAC3
Client disconnected: 2wcbE0m1BM8R4VR1AAC4
Client disconnected: sh_O1rQbKFFhCKcoAAC5
Client disconnected: rCPtPCaB0dgIZOSZAAC6
Client disconnected: 8e-HzDthtFA71qsPAAC7
Client disconnected: eKkYBq6cZFwvgomMAAC8
Client disconnected: SsoNqonrjRghSj19AAC9
Client disconnected: QuDWDRvAAp6yRcbMAAC-
Client disconnected: 1u08iNKQ5kVUSGy5AAC_
Client disconnected: N38O4axlzHqho2muAADA
Client disconnected: uR5l8aQpbtLLELVUAADB
Client disconnected: iLj86UpesnkZ2yv4AADC
Client disconnected: zOvNYVWuQkJycHWtAADD
Client disconnected: fyrTuIMQ9SXVb1GLAADE
Client disconnected: cPX_izc0wvG7XNrGAADF
Client disconnected: WZ6DLl5EcK1xmxURAADG
Client disconnected: iQg40IqGDUCVfSGrAADH
Client disconnected: tbIkaEEkU-v9ylzhAADI
Client disconnected: hPQR4ePvCI_upmz0AADJ
Client disconnected: inhJxjuZ2UU8ecEpAADK
Client disconnected: PK6bHr4aaye3AmACAADL
Client disconnected: 8Po5vKWKQEwWXALGAADM
Client disconnected: rSwdt1r3cOqE2JyUAADN
Client disconnected: JLJs1BEqd-v82NZUAADO
Client disconnected: 7J4ya4R2rv_79hJcAADP
Client disconnected: PdyPvmqJBIRD2sX0AADQ
Client disconnected: 2W9rZQ4xGLotnsMdAADR
Client disconnected: bwKb0Yl9aF-M5PvLAADS
Client disconnected: Eoobc2e_H9ng03VQAADT
Client disconnected: mxdJWvFNbrBDVjutAADU
Client disconnected: 9A_soXDGpKP7IvFvAADV
Client disconnected: 82ax49fe0Hga5ToGAADW
Client disconnected: GC2d3PD2u1euUQsdAADX
Client disconnected: N6iiXvgXe0d4MFguAAEK
Client disconnected: gIYzN1x4WiVRuuDRAAEL
Client disconnected: uxdwv-I1TW5k4PIgAAEM
Client disconnected: WlGxl_fn0l5SYcx6AAEN
Client disconnected: -z6IEH1ehX0y0E61AAEO
Client disconnected: OAPSlG7L4HXyGZH2AAEP
Client disconnected: Nfa4-5xuJGAyeCQJAAEQ
Client disconnected: sT214wUa7nwQgb9yAAER
Client disconnected: kiBjqmfuZVloI3wDAAES
Client disconnected: w0oOdLHD84yC-I7yAAET
Client disconnected: iXce5nVE77_d-4O2AAEU
Client disconnected: BuwtkWSyDWMVQZv2AAEV
Client disconnected: zDCeyygnIXGFPG9hAAEW
Client disconnected: 1q2iHa5HN-Zq6qBUAAEX
Client disconnected: _eGCj2vIxWJLUrP8AAEY
Client disconnected: RLXxNjBY9BBEav5RAAEZ
Client disconnected: uabxHWL0ndEST-51AAEa
Client disconnected: dmKurLdn6Zu4xJidAAEb
Client disconnected: ERVKYfCBn1WouHjpAAEc
Client disconnected: rzxNmhINUhf6aWH0AAEd
Client disconnected: enJsG5e9KImZvIHPAAEe
Client disconnected: RPzISCby0KWeZw29AAEf
Client disconnected: vc8recx0cDNZ-bJyAAEg
Client disconnected: DYWl39XnlXZr-8FvAAEh
Client disconnected: V2AhsdBiQa1qqSODAAEi
Client disconnected: pIQj4b1bxykFE_PvAAEj
Client disconnected: xJxhDAv2nsfavdsKAAEk
Client disconnected: l0FX8W13_WqYGhDyAAEl
Client disconnected: lQpHDaul2oV2kwGnAAEm
Client disconnected: D21LbMe_HVqpUY1NAAEn
Client disconnected: uil3bVXXSbZG0BgXAAEo
Client disconnected: 6J0ZfpLwWEZ7acvyAAEp
Client disconnected: sz90cySZx4Ki9bNjAAEq
Client disconnected: C5LxMzhWolTfBhXtAAEr
Client disconnected: DeJzSTUyOjwXmoZ3AAEs
Client disconnected: tmKP_Ue3OcFd5VMOAAEt
Client disconnected: 0CKaxxDCc9nYgv9tAAEu
Client disconnected: NeQW7E9q-e_FSu5rAAEv
Client disconnected: 3Vk0S0BrhDEB7J4QAAEw
Client disconnected: RfmnGsBLjULGSjOlAAEx
Client disconnected: 4Kt9nwyt7Uq9awxRAAEy
Client disconnected: pPAcaWX_ULHJbGGyAAEz
Client disconnected: hgx--vOKwFdMsDZWAAE0
Client disconnected: nimsSON2ys9NzogzAAE1
Client disconnected: p6WPsdojnAj-QSjCAAE2
Client disconnected: a2F9bqqmjKdmGNmrAAE3
Client disconnected: HOzJtWMocmaRhTg7AAE4
Client disconnected: E3J9U29AnY5MOp4RAAE5
Client disconnected: LaMgH495Hiyb4ha9AAE6
Client disconnected: 2xf55Y9x3CYAf0VnAAE7
Client disconnected: UtQltLYAHxN6cL97AAFu
Client disconnected: ADESy6XrNvE4xDm7AAFv
Client disconnected: fKLX0qYCohMBNTtdAAFw
Client disconnected: ghpxX1aeC8BMT6O3AAFx
Client disconnected: J109iAGzIQh3g4rlAAFy
Client disconnected: jPsjbidx6NRNdYvqAAFz
Client disconnected: pxWx_-Ky4vB6EbpWAAF0
Client disconnected: _R8ZorA48TuV3gfQAAF1
Client disconnected: EMvOvmGZ4QrZkKEbAAF2
Client disconnected: q7EtDN65_t1EgZ4BAAF3
Client disconnected: HAXkjByYV4C8p0cJAAF4
Client disconnected: zfAkJf3BrWYXDVA7AAF5
Client disconnected: hUOpzkXzJBJFZJQaAAF6
Client disconnected: fZBM_VfSPuCljotQAAF7
Client disconnected: MS02oX0Z5IaNSkspAAF8
Client disconnected: -g_2D8bZAIxx3WPLAAF9
Client disconnected: z1V9wFDxAe3HdN4LAAF-
Client disconnected: 9fd_G0tER0VjBxisAAF_
Client disconnected: SPIWf1sPhAQ-K9jbAAGA
Client disconnected: JuwJH2mA3hyTp991AAGB
Client disconnected: AzH04t4RgFT8uyNzAAGC
Client disconnected: WvfgXZKKFPN0SpTcAAGD
Client disconnected: ROeFxvYTRjMA9qpLAAGE
Client disconnected: UT7rYI0hElRUt1teAAGF
Client disconnected: Pse98AuxSdnHsYd4AAGG
Client disconnected: zHqxGgCBPkiwtWeGAAGH
Client disconnected: E9LrXk-i8dq-kVchAAGI
Client disconnected: xF9xvxIT152Yptq_AAGJ
Client disconnected: 7SOsdQW2tP1w3OJRAAGK
Client disconnected: mmQpLOJhf-6xjqZfAAGL
Client disconnected: d-K9YsMYTm9EIDhuAAGM
Client disconnected: 9TunWeF_FstN7fM7AAGN
Client disconnected: EG6bxNcp4i4PgGytAAGO
Client disconnected: h7LlOCaGCdS-AXEZAAGP
Client disconnected: StQ3ZL6Msbev3jKNAAGQ
Client disconnected: DhGWsfkn6tzPz7MSAAGR
Client disconnected: Y_4X56bj0rj1YLa-AAGS
Client disconnected: RVEF0GarvCf8XXcEAAGT
Client disconnected: bd-Su0XRQHulm62dAAGU
Client disconnected: 99R7GiQF8m3G2RQmAAGV
Client disconnected: 6ZlDCdQ9WvThOWJjAAGW
Client disconnected: TZ2AvDKUwHJqDcg2AAGX
Client disconnected: WYpDNDLfDK5RvbihAAGY
Client disconnected: WhtyAyBCYjZ9hcF0AAGZ
Client disconnected: xEnHBpFpX_MAhkBNAAGa
Client disconnected: BgGrj7wMDoSifSIKAAGb
Client disconnected: afbrvKT59_3Mf1FXAAGc
Client disconnected: v6v4Mjo8cNNrhWKXAAGd
Client disconnected: QgwaOgTyjeJeLxDuAAGe
Client disconnected: ovKSqFLLo1n8piQLAAGf
Client disconnected: hgqD4qIKo5AVmDxvAAHS
Client disconnected: rD1UrZf7A-oNkOQ2AAHT
Client disconnected: vRZU5HOlW9PntZNkAAHU
Client disconnected: h3rioWk9fU5HfWf_AAHV
Client disconnected: c27VudRuipQIICjAAAHW
Client disconnected: _qFJzxoVLaIcfOEAAAHX
Client disconnected: L_9SGls8mUuSlu1HAAHY
Client disconnected: 3VXs_f50ks66Gp8eAAHZ
Client disconnected: t8encvUlCzgPJn_vAAHa
Client disconnected: cUyKv4Wgwck6fSyKAAHb
Client disconnected: S_vxUBrvluDsriL6AAHc
Client disconnected: Bzw4pmrIPoBtw88pAAHd
Client disconnected: 5peJbQdsKpzRyMqGAAHe
Client disconnected: 3LRdL60Jx7sNFuiZAAHf
Client disconnected: YkFlQGWwrnkrm1gxAAHg
Client disconnected: A4tKQdQXHgwHyuQtAAHh
Client disconnected: NWwpuf0Cl_-1hw6HAAHi
Client disconnected: BeomkQtUJeAYDhY6AAHj
Client disconnected: AHUqI0wngS9YM5pmAAHk
Client disconnected: GwFLzJQDxkqcjl4-AAHl
Client disconnected: pNsSysXNTjHZXu3FAAHm
Client disconnected: hDahMQndtEMB9GplAAHn
Client disconnected: 4GXVZ4BezxCNdSsfAAHo
Client disconnected: qoiod7YsnT7SLf0YAAHp
Client disconnected: c2QKCx5EqQ97AZ7qAAHq
Client disconnected: 4C7l1mFEPQ2Yw0uFAAHr
Client disconnected: chVlYGWWbHv15sDTAAHs
Client disconnected: gQtNNOjN_cxWE-hAAAHt
Client disconnected: 6H7HY6hfwE7o62y1AAHu
Client disconnected: yPxcihCw9AfKFFdhAAHv
Client disconnected: o8gf_0iOWPuSIpbMAAHw
Client disconnected: Owyycp04_z6pqZooAAHx
Client disconnected: jUAOAZZBa4gu1K7NAAHy
Client disconnected: 6AK-DVTNVzVa6tOaAAHz
Client disconnected: nOewG4jUTxBuWPwaAAH0
Client disconnected: 8yavIY6-5_mRIKQrAAH1
Client disconnected: WLOoSI3bjltQPfNRAAH2
Client disconnected: _eoKWfVXoO7EKyFGAAH3
Client disconnected: uozok8xUWgP0XwepAAH4
Client disconnected: BUJGFoR_gh8QTd-fAAH5
Client disconnected: mPT6y5x7W3yk24mgAAH6
Client disconnected: NRX00Thb6Y_4DLpZAAH7
Client disconnected: zXMWpKcVwCKpOP6KAAH8
Client disconnected: GoanQA2nV_RHLYTFAAH9
Client disconnected: AT0kvCgaQNO05daQAAH-
Client disconnected: y8jhHWdc1CYz05TDAAH_
Client disconnected: XA3Qz5rRXLn_1IrMAAIA
Client disconnected: wKkojmgHQPH-CUXfAAIB
Client disconnected: qTv5npZ8o7Z-QaRgAAIC
Client disconnected: D2vJHgEI1FTmsomnAAID
Client disconnected: 7h2KpEo9nTd26QoXAAI2
Client disconnected: 2H0mdN07yaVpVWhUAAI3
Client disconnected: bR4-tjV4ESxMFFiGAAI4
Client disconnected: zJGGxnkB5UBBuzY7AAI5
Client disconnected: IigrnFZ5W5mbFAohAAI6
Client disconnected: SoBQZU7lRioPhuGhAAI7
Client disconnected: K9UFxxNoPkKtSSL8AAI8
Client disconnected: bDDvdWV41duw3wHEAAI9
Client disconnected: IQOVwGEspKTrMf0MAAI-
Client disconnected: UModZYfTFDMMcOTKAAI_
Client disconnected: LZiQkYnxtIu58MPYAAJA
Client disconnected: Bp1fP9RZ_n_fnhQlAAJB
Client disconnected: -AViHelEYDMo9xE5AAJC
Client disconnected: OwKDCmjLQ2mlrNBeAAJD
Client disconnected: E4S7AT_mGa_JXtraAAJE
Client disconnected: LdIaVi1vLsyMPtMIAAJF
Client disconnected: Wo6OIQM_WYrodsCKAAJG
Client disconnected: SIfk_szBKBIRarx2AAJH
Client disconnected: K8x8dU1WG41MIA92AAJI
Client disconnected: uSWk_PtTyn5xc35JAAJJ
Client disconnected: RajGoCwZdTTcMzqqAAJK
Client disconnected: NJjng0mi1qZjUgcoAAJL
Client disconnected: tbvzU3386RrJRD68AAJM
Client disconnected: k5uQJZMTW1OZG7C0AAJN
Client disconnected: m5Jsh9BTPvNGdRNwAAJO
Client disconnected: 3xO6i1Vaewfbf2s4AAJP
Client disconnected: V655-nTOfzuG8qi5AAJQ
Client disconnected: 2P3yjaQWBLSB1UxqAAJR
Client disconnected: sE3zq3QKx-SqGT44AAJS
Client disconnected: 2x1yw3rmLxPt02BhAAJT
Client disconnected: Nw6CzJ6vzS3dHSSQAAJU
Client disconnected: Dq5ODSRBb21op0gLAAJV
Client disconnected: b2YDXly6m6akK6dUAAJW
Client disconnected: s6oppidoZ7LxK1WBAAJX
Client disconnected: ZZU0bBzNUBUSVU8QAAJY
Client disconnected: YXWMgiNL3-weFKp4AAJZ
Client disconnected: VZ3ASw0KTJaZA9yBAAJa
Client disconnected: XnE66g8B9IN1wkqkAAJb
Client disconnected: 6ouk3_uaF0LbvWIlAAJc
Client disconnected: 9-URCyXc9s0Qh-0TAAJd
Client disconnected: BGczjhgD_th96IqTAAJe
Client disconnected: x5_j-nlNJ3S1z6w_AAJf
Client disconnected: vQQAp4A9oaOEs2LKAAJg
Client disconnected: zi2qKdbnKsA4EsG6AAJh
Client disconnected: F17hmYPfHZ6t_0gkAAJi
Client disconnected: 2eCchEiUSDzbXQ1fAAJj
Client disconnected: OPw-K4RTn1fgHHIIAAJk
Client disconnected: SQbaWDPy31G3nYOXAAJl
Client disconnected: VTkkJ0gIggBirjTFAAJm
Client disconnected: Orw63R9QlsPsrrufAAJn
Client disconnected: qqpvw9X11lNEx8RgAAKa
Client disconnected: _I_WOeQj4B4qf2OsAAKb
Client disconnected: U_hXuvAqEcxKxsZaAAKc
Client disconnected: xuhQYOqJ13-QRNKtAAKd
Client disconnected: 5GYxWigHhDOcTQfOAAKe
Client disconnected: LIQR3dXqZMxpY2lNAAKf
Client disconnected: sCS6T1CKc3a-YjcrAAKg
Client disconnected: 081FEKjRLotcpiLEAAKh
Client disconnected: o7Lf1DCUMo7-7OSRAAKi
Client disconnected: cB9t0T9-LicZgsSNAAKj
Client disconnected: HODsSgaEXCCbsHUEAAKk
Client disconnected: yCDFng3Pj_-adsYEAAKl
Client disconnected: Bpr6dZ-a60nLejDXAAKm
Client disconnected: 5224MO5ZSYOkYz8KAAKn
Client disconnected: t-erH7Tt-CNfk-_lAAKo
Client disconnected: ZZlOEB07xyFf8ipkAAKp
Client disconnected: PyMcqC2ujW-jEMueAAKq
Client disconnected: zg_UVXBa6dq8VrvHAAKr
Client disconnected: coGCMz7-iEKLpewkAAKs
Client disconnected: s52_R88fLtANoXL4AAKt
Client disconnected: 96PlQ4se0NcXZIVSAAKu
Client disconnected: h5EkBG2mQ9f00L9BAAKv
Client disconnected: dAU4jZc5JvUPnpskAAKw
Client disconnected: aYa8wO02odlPUX3sAAKx
Client disconnected: _oAfCgFGgEZAkroUAAKy
Client disconnected: HrfmOGYAbJOSYkNYAAKz
Client disconnected: XsKpkqRwhA-vF74iAAK0
Client disconnected: z-QqbigAes6RI6MEAAK1
Client disconnected: Ne5lWV8uRe-sDXabAAK2
Client disconnected: OXOXFLgdKoiva1_tAAK3
Client disconnected: woUNoEvGYnj-gPKOAAK4
Client disconnected: BAJQdo1g3ptfeqpvAAK5
Client disconnected: hwPTg4TAqZiJ1347AAK6
Client disconnected: ftcKzCFoJfiAk_TlAAK7
Client disconnected: eQR9ebmDHnWUncC0AAK8
Client disconnected: twU1vbFbUlDNtcbfAAK9
Client disconnected: DZ6RvYg0DJ9lo90HAAK-
Client disconnected: p7782DMVCdgZxGGoAAK_
Client disconnected: vAXHwl3zwl3wNAAqAALA
Client disconnected: _1okW093byxXpsJWAALB
Client disconnected: x_lALjeORl4yw6eiAALC
Client disconnected: uk4H8U4R4sgCTqEGAALD
Client disconnected: Cv6ufK6U1NfxqrROAALE
Client disconnected: iUP5MXrNL8clLp7SAALF
Client disconnected: L8C--Pmbk0a6-btuAALG
Client disconnected: cg5k7RbfULpEcdB0AALH
Client disconnected: SHxZVqqvh4rB8RpoAALI
Client disconnected: mOsJ85_SiCG6YVABAALJ
Client disconnected: 4GHjHKdCslbKgs82AALK
Client disconnected: -eMsJQsmfkxudyOmAALL
Client disconnected: 2OiW7ycLPWledwArAAL-
Client disconnected: m56xeHADw3tWo1S5AAL_
Client disconnected: G8m4bkFO_-MqVeNDAAMA
Client disconnected: 4o6G6LTjIywmdSCmAAMB
Client disconnected: 8Nv0Lcru7LgtFXvPAAMC
Client disconnected: SdZqfTbV-gac3XW_AAMD
Client disconnected: EeyEBMa3wd9oMwbmAAME
Client disconnected: Tgdrpa20W9JCeAhyAAMF
Client disconnected: -e93rIrPSexbVNsAAAMG
Client disconnected: uCLY-nnSzcNoiceqAAMH
Client disconnected: CoKQ3MeYMe3o7D0pAAMI
Client disconnected: HCi_rPtHlH27DoaHAAMJ
Client disconnected: jeTQCeJnmVHr-G-TAAMK
Client disconnected: WXLEPRH5JIHrH_KDAAML
Client disconnected: iBNjHaoyme2J5jnvAAMM
Client disconnected: 8YJ00aJR2gW44W2NAAMN
Client disconnected: PFYjpjQ6sE-N2KscAAMO
Client disconnected: 5wbO9pXG96nE3jTAAAMP
Client disconnected: yUyCgqzmvjW0tnZQAAMQ
Client disconnected: fgpmmt5J_aVeefaoAAMR
Client disconnected: aAhqzeJrI6t9ev1VAAMS
Client disconnected: fC9BdZBZZ4fkeLmmAAMT
Client disconnected: JeVLku5ZgiD0VkWLAAMU
Client disconnected: qQKJ3lETlcX5Jm_ZAAMV
Client disconnected: 3peTmk82CmnjEDBEAAMW
Client disconnected: UJU566GhZk19njnPAAMX
Client disconnected: iE8xQZ8ImUc7wGV3AAMY
Client disconnected: _5CVdaj2Wn6eFmyeAAMZ
Client disconnected: Nf0MRpxGwE02FZ64AAMa
Client disconnected: q1xKohMcjdJWe3AQAAMb
Client disconnected: bMfjZauJFugBAWUVAAMc
Client disconnected: pZrv6E2Ynuy04oG7AAMd
Client disconnected: durSq5BGkmcW371oAAMe
Client disconnected: jkpZb4elUWl6_MNXAAMf
Client disconnected: b217VZ0ep_TXzDi5AAMg
Client disconnected: 8DoblqwYr0lun1biAAMh
Client disconnected: Tr-IExyvVchn_pmaAAMi
Client disconnected: 31WY2LoMOFJrKHu0AAMj
Client disconnected: jllDKKhDAy8qMWprAAMk
Client disconnected: ufFIsbf6PW7jo-dtAAMl
Client disconnected: rynUztWSRtEHNCcyAAMm
Client disconnected: UOshv4Ss7cYJF8EyAAMn
Client disconnected: ev5HGgCYOioWglspAAMo
Client disconnected: cKNt3ImcuJUKbY27AAMp
Client disconnected: 8XSxw3QjyKN_nw8nAAMq
Client disconnected: Bpc186-ZM1sF_f0pAAMr
Client disconnected: o5kh-bwt_Ra2r7ZnAAMs
Client disconnected: pACEMHsQowe11s3hAAMt
Client disconnected: OWhDWu7zuq0XSp2eAAMu
Client disconnected: rW3tCGmtyW4bdW4BAAMv
Client disconnected: sTmwne8ke7kt1o69AANi
Client disconnected: NxIjeGY77fVuU8eWAANj
Client disconnected: N1IKfmpQVCAgaB5-AANk
Client disconnected: 1mxVVOKzQYlDPDDVAANl
Client disconnected: 6DsBXRX4JXWBTU8rAANm
Client disconnected: jpz-hJr1N8vMNCY8AANn
Client disconnected: wucQerovsGh1kzeoAANo
Client disconnected: FaKgG8laALDBW8tJAANp
Client disconnected: RK-ddV3WIubbd9R8AANq
Client disconnected: 3cDFXTndIF_PaGUxAANr
Client disconnected: qEZTCikYiepd6vOZAANs
Client disconnected: AQ1QIUATc6dv3PVHAANt
Client disconnected: VcACo2CZkWZ9xmJ1AANu
Client disconnected: iB2XYl20e-PZr-CMAANv
Client disconnected: 3x35wctPvhjQbcWlAANw
Client disconnected: 9PcZfaN0K7gJuJB3AANx
Client disconnected: VtnoZSOh9SfxA3MaAANy
Client disconnected: 1nsxwOLWFlYGK7slAANz
Client disconnected: XE2IsUXGuW6kQsXBAAN0
Client disconnected: w0VikPuYe-Z7JV8iAAN1
Client disconnected: emY8-e6jSCeRCjwTAAN2
Client disconnected: p91anp9Oufv2XdURAAN3
Client disconnected: o9gc_Yex5qg6QOnjAAN4
Client disconnected: CDKFjSK9uVkioh0gAAN5
Client disconnected: ske3CXcm0uoCxDKTAAN6
Client disconnected: plkmE81Bc7SBZF0pAAN7
Client disconnected: uwepMGPEBK9RE4faAAN8
Client disconnected: BE_rBhr_Xnh0i6YHAAN9
Client disconnected: ff5-EddQCqc20QPoAAN-
Client disconnected: z0Tx3EyZlCVeIVQaAAN_
Client disconnected: STEGtz_mM7Uo4JENAAOA
Client disconnected: 4ACBaKf_Khu2QSxvAAOB
Client disconnected: qcMAuQUTCjgyyAFvAAOC
Client disconnected: APj9Z1jjPHIbrmLhAAOD
Client disconnected: XNAj0aFjmVUjpN04AAOE
Client disconnected: NS-rOA8jFhJMare-AAOF
Client disconnected: WS2ofUMGPJtBK7jKAAOG
Client disconnected: QX7dJyij3fDX9vEWAAOH
Client disconnected: RsOiBo38iIxRsWRWAAOI
Client disconnected: UDlEE-1AfJCvbXheAAOJ
Client disconnected: MsWLcYyLcH_3xjBjAAOK
Client disconnected: PoycQJNWVIOyfbleAAOL
Client disconnected: Ee3QNVICGcUazVBYAAOM
Client disconnected: hJ0DS_CCy9u7b5t1AAON
Client disconnected: 3dO39Ku5NPT3gOXiAAOO
Client disconnected: 5AZs5JLeiozX3xtAAAOP
Client disconnected: N6YBFppVWGSrJm_cAAOQ
Client disconnected: xEoVHMZbia46_JHxAAOR
Client disconnected: SWctRSnRH55cf_ZXAAOS
Client disconnected: Y08FL-EUdC2deewvAAOT
Client disconnected: evrvJdXndWOJaz5BAAPG
Client disconnected: bnzed805i1wRPbq9AAPH
Client disconnected: 72lDxvgZ4TqWycdMAAPI
Client disconnected: xbFtGjFeaT94kVwpAAPJ
Client disconnected: r9fGrFETeEgeUuvbAAPK
Client disconnected: fVG0DeNLa7rKknCrAAPL
Client disconnected: oBayWxhweUJ-CLhxAAPM
Client disconnected: T9jaNVC_5af86AgjAAPN
Client disconnected: wV8KuFMAF8w0DtQGAAPO
Client disconnected: ijpHw-njQFR9VE_pAAPP
Client disconnected: PRb316UJI-epc59wAAPQ
Client disconnected: CA_bQpZawkIo64gGAAPR
Client disconnected: -Qo35aY2K8SVvX0fAAPS
Client disconnected: QqdSDx7xyUksxocFAAPT
Client disconnected: VkBoEGobVz7tifo_AAPU
Client disconnected: C73VA7PxtJe8zKYJAAPV
Client disconnected: 5O5zQFXlrvSus6zgAAPW
Client disconnected: _eU-nhdXmOaYhfw2AAPX
Client disconnected: dqE0owfGExWaa74NAAPY
Client disconnected: M_U7Expf-o8KGaRMAAPZ
Client disconnected: XH4CZmerVQAOmVauAAPa
Client disconnected: lkHSk0LuDYwf6igQAAPb
Client disconnected: mm37b8MikX1EEJs-AAPc
Client disconnected: gSn9Gle0Jl2v-tXmAAPd
Client disconnected: tQ5GzVunztwTR4D_AAPe
Client disconnected: V7hC4kq8X0c6RkR7AAPf
Client disconnected: Y1QxPPbr1Cm08_DkAAPg
Client disconnected: 6Bk95BvTzx30GNklAAPh
Client disconnected: vjN4CJGUJmOtP_s1AAPi
Client disconnected: ut0FkyQf9PggJmr-AAPj
Client disconnected: 3A2rofhO9Ox5g5wlAAPk
Client disconnected: 39XuYfYSFbQt2eNdAAPl
Client disconnected: PzqCjghKu0K3dKttAAPm
Client disconnected: q7-bVE3eIvJWZg1HAAPn
Client disconnected: CDPi6gBY9JZpX8GQAAPo
Client disconnected: 0acQk_T3owkYof9AAAPp
Client disconnected: dlf0-l984TNu2xRxAAPq
Client disconnected: PFDRFZaeoSsoLg0WAAPr
Client disconnected: q5HJR9GKMIyC3f8NAAPs
Client disconnected: 3Tw2B4NNfPGpR1n8AAPt
Client disconnected: -lbT032b5aC0d_tPAAPu
Client disconnected: B4txz569bE8VNuUhAAPv
Client disconnected: _7kVJFSIGu50PHV1AAPw
Client disconnected: rZIWMU033MrhNXiGAAPx
Client disconnected: 84K9Hn3lJ4uOc1uPAAPy
Client disconnected: v5ii9NnLc6rkgUUNAAPz
Client disconnected: naxPX1krFwNS8NaLAAP0
Client disconnected: kmE4o73ePtBqhIlTAAP1
Client disconnected: TTEU5CLwen068UIDAAP2
Client disconnected: K4BfLHI9kcbJnsFFAAP3

[90mstdout[2m | apps/api/test/social-stress.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m apps/api/test/social-stress.e2e-spec.ts [2m([22m[2m1 test[22m[2m)[22m[33m 5922[2mms[22m[39m
   [33m[2mâœ“[22m[39m Social Stress Test (1000+ Connections Simulation)[2m > [22mNÃªn xá»­ lÃ½ thÃ nh cÃ´ng 500 káº¿t ná»‘i WebSocket Ä‘á»“ng thá»i [33m1620[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/analytics/simulation-bot.spec.ts[2m > [22m[2mBehavioral Simulation (Plan 2)[2m > [22m[2mSimulation: RUSH_USER should trigger STRICT_COACH persona
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/analytics/simulation-bot.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 94[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/analytics/simulation-bot.spec.ts[2m > [22m[2mBehavioral Simulation (Plan 2)[2m > [22m[2mSimulation: LAZY_USER should trigger SUPPORTIVE_BUDDY persona
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/analytics/simulation-bot.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculatePoints[2m > [22m[2mshould calculate base points with no streak
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculatePoints[2m > [22m[2mshould apply streak bonus correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculatePoints[2m > [22m[2mshould return 0 for unknown actions
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mprocessStreak[2m > [22m[2mshould increment streak if last active was yesterday
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mprocessStreak[2m > [22m[2mshould maintain streak if active today
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mprocessStreak[2m > [22m[2mshould reset streak if last active was before yesterday
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould start at level 1
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould reach level 2 at 100 points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould reach level 3 at 400 points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcalculateLevel[2m > [22m[2mshould handle negative points gracefully
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcheckBadges[2m > [22m[2mshould return BRONZE_LEARNER when crossing 100 points
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/common/gamification-pure.spec.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 3[2mms[22m[39m
[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcheckBadges[2m > [22m[2mshould not return badge if already earned
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts[2m > [22m[2mGamification Pure Functions[2m > [22m[2mcheckBadges[2m > [22m[2mshould return multiple badges if crossing multiple thresholds
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/common/gamification-pure.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mshould be defined
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould extract user from JWT payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould handle payload with different role
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould map sub to both id and userId
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mvalidate[2m > [22m[2mshould preserve email from payload
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mconstructor[2m > [22m[2mshould use JWT_SECRET from ConfigService
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/auth/jwt.strategy.spec.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 11[2mms[22m[39m
[90mstdout[2m | apps/api/src/auth/jwt.strategy.spec.ts[2m > [22m[2mJwtStrategy[2m > [22m[2mconstructor[2m > [22m[2mshould fallback to dev_secret if ConfigService fails
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/auth/jwt.strategy.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [31mâ¯[39m apps/api/test/example-usage.e2e-spec.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[90m 21[2mms[22m[39m
[90mstdout[2m | apps/api/test/example-usage.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleSystemHealthCheck[2m > [22m[2mshould run health check and log results
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mhandleSystemHealthCheck[2m > [22m[2mshould handle DB failure gracefully
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/test/unit/analytics/analytics.service.spec.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 2[2mms[22m[39m
[90mstdout[2m | apps/api/test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetGlobalSystemStats[2m > [22m[2mshould return global stats
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould return OBSERVER for no logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/analytics/analytics.service.spec.ts[2m > [22m[2mAnalyticsService[2m > [22m[2mgetUserPersona[2m > [22m[2mshould classify as HUNTER if high risk events predominate
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/analytics/analytics.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/behavioral-stress.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

 [31mâ¯[39m apps/api/test/behavioral-stress.e2e-spec.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 4074[2mms[22m[39m
[31m   [31mÃ—[31m PHÆ¯Æ NG ÃN 2: Behavioral Stress Test (E2B Inspired)[2m > [22mNÃªn giáº£ láº­p thÃ nh cÃ´ng 50 hÃ nh vi ngÆ°á»i dÃ¹ng mÃ  khÃ´ng cÃ³ lá»—i schema[33m 4074[2mms[22m[31m[39m
[31m     â†’ 
Invalid `prismaService.user.upsert()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\behavioral-stress.e2e-spec.ts:31:30

  28 
  29 // Äáº£m báº£o user tá»“n táº¡i Ä‘á»ƒ trÃ¡nh vi pháº¡m Foreign Key
  30 // LÆ°u Ã½: Field 'name' khÃ´ng cÃ³ trong User model, thay vÃ o Ä‘Ã³ lÃ  JSONB 'metadata'
â†’ 31 await prismaService.user.upsert(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90mstdout[2m | apps/api/test/behavioral-stress.e2e-spec.ts[2m > [22m[2mPHÆ¯Æ NG ÃN 2: Behavioral Stress Test (E2B Inspired)[2m > [22m[2mNÃªn giáº£ láº­p thÃ nh cÃ´ng 50 hÃ nh vi ngÆ°á»i dÃ¹ng mÃ  khÃ´ng cÃ³ lá»—i schema
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/behavioral-stress.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/app.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/test/app.e2e-spec.ts[2m > [22m[2mAppController (e2e)
[22m[39mðŸš€ Starting beforeAll...
ðŸ“¦ Module compiled
ðŸ—ï¸ App created
âœ… App initialized

[90mstdout[2m | apps/api/test/app.e2e-spec.ts[2m > [22m[2mAppController (e2e)[2m > [22m[2m/ (GET)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/app.e2e-spec.ts[2m > [22m[2mAppController (e2e)
[22m[39mðŸ§¹ Starting afterAll...
ðŸ›‘ App closed

[90mstdout[2m | apps/api/test/app.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [32mâœ“[39m apps/api/test/app.e2e-spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 11[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mbuyStreakFreeze[2m > [22m[2mshould successfully buy a streak freeze
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mbuyStreakFreeze[2m > [22m[2mshould throw BadRequestException if user has insufficient points
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mbuyStreakFreeze[2m > [22m[2mshould throw BadRequestException if user does not exist
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/store/store.service.spec.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 107[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/store/store.service.spec.ts[2m > [22m[2mStoreService[2m > [22m[2mgetStoreItems[2m > [22m[2mshould return list of store items
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/store/store.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/guards.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/test/guards.e2e-spec.ts[2m > [22m[2mGuards (Integration)[2m > [22m[2m/users/profile (GET) - should fail without token
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/test/guards.e2e-spec.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 13[2mms[22m[39m
[90mstdout[2m | apps/api/test/guards.e2e-spec.ts[2m > [22m[2mGuards (Integration)[2m > [22m[2m/users/profile (GET) - should succeed with valid token
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/guards.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.service.spec.ts[2m > [22m[2mDiagnosticService[2m > [22m[2mrunFullDiagnostics[2m > [22m[2mshould run all diagnostic checks
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/debug/diagnostic.service.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 52[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/debug/diagnostic.service.spec.ts[2m > [22m[2mDiagnosticService[2m > [22m[2mgenerateMockBehavioralData[2m > [22m[2mshould generate requested number of logs
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/debug/diagnostic.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/unit/common/gamification.service.spec.ts[2m > [22m[2mGamificationService[2m > [22m[2mlogEvent[2m > [22m[2mshould update user points and create log
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/common/gamification.service.spec.ts[2m > [22m[2mGamificationService[2m > [22m[2mdeductPoints[2m > [22m[2mshould throw error if insufficient points
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/test/unit/common/gamification.service.spec.ts [2m([22m[2m3 tests[22m[2m)[22m[90m 4[2mms[22m[39m
[90mstdout[2m | apps/api/test/unit/common/gamification.service.spec.ts[2m > [22m[2mGamificationService[2m > [22m[2mdeductPoints[2m > [22m[2mshould deduct points if sufficient
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/common/gamification.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/test/admin-integrity.e2e-spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...

[90mstdout[2m | apps/api/test/admin-integrity.e2e-spec.ts[2m > [22m[2mPHÆ¯Æ NG ÃN 3: Admin Integrity Audit[2m > [22m[2mHá»‡ thá»‘ng pháº£i vÆ°á»£t qua bÃ i kiá»ƒm tra tÃ­nh toÃ n váº¹n (Integrity Check)
[22m[39mðŸ” Äang thá»±c hiá»‡n Audit toÃ n bá»™ há»‡ thá»‘ng...

[90mstdout[2m | apps/api/test/admin-integrity.e2e-spec.ts[2m > [22m[2mPHÆ¯Æ NG ÃN 3: Admin Integrity Audit[2m > [22m[2mHá»‡ thá»‘ng pháº£i vÆ°á»£t qua bÃ i kiá»ƒm tra tÃ­nh toÃ n váº¹n (Integrity Check)
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/admin-integrity.e2e-spec.ts
[22m[39mâœ… Vitest teardown complete

 [31mâ¯[39m apps/api/test/admin-integrity.e2e-spec.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 16291[2mms[22m[39m
[31m   [31mÃ—[31m PHÆ¯Æ NG ÃN 3: Admin Integrity Audit[2m > [22mHá»‡ thá»‘ng pháº£i vÆ°á»£t qua bÃ i kiá»ƒm tra tÃ­nh toÃ n váº¹n (Integrity Check)[33m 16291[2mms[22m[31m[39m
[31m     â†’ 
Invalid `this.prisma.behaviorLog.count()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\debug\diagnostic.service.ts:94:31

  91 private async collectRealTimeMetrics() {
  92   const last10Min = new Date(Date.now() - 10 * 60 * 1000);
  93   const [behaviorCount, errorCount, nudgeCount] = await Promise.all([
â†’ 94     this.prisma.behaviorLog.count(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
 [32mâœ“[39m apps/api/test/unit/users/users.service.spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 1[2mms[22m[39m
[90mstdout[2m | apps/api/test/unit/users/users.service.spec.ts[2m > [22m[2mUsersService[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould calculate stats correctly
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/users/users.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.service.spec.ts[2m > [22m[2mAdaptiveService[2m > [22m[2mshould adjust level up for good performance
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.service.spec.ts[2m > [22m[2mAdaptiveService[2m > [22m[2mshould suggest reinforcement for poor performance
[22m[39mðŸ§¹ Cleaning up after test...

 [32mâœ“[39m apps/api/src/modules/adaptive/adaptive.service.spec.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 76[2mms[22m[39m
[90mstdout[2m | apps/api/src/modules/adaptive/adaptive.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/test/unit/behavior/behavior.service.spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 1[2mms[22m[39m
[90mstdout[2m | apps/api/test/unit/behavior/behavior.service.spec.ts[2m > [22m[2mBehaviorService[2m > [22m[2mlogEvent[2m > [22m[2mshould create a behavior log
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/test/unit/behavior/behavior.service.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete

 [32mâœ“[39m apps/api/src/app.controller.spec.ts [2m([22m[2m1 test[22m[2m)[22m[90m 0[2mms[22m[39m
[90mstdout[2m | apps/api/src/app.controller.spec.ts[2m > [22m[2mAppController[2m > [22m[2mroot[2m > [22m[2mshould return "Hello World!"
[22m[39mðŸ§¹ Cleaning up after test...

[90mstdout[2m | apps/api/src/app.controller.spec.ts
[22m[39mðŸ”§ Vitest setup: Starting MSW mock server...
âœ… Vitest teardown complete


[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1m[7m Failed Suites 18 [27m[22mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration
[31m[1mReferenceError[22m: PrismaModule is not defined[39m
[36m [2mâ¯[22m apps/api/test/auth-profile.integration.spec.ts:[2m41:9[22m[39m
    [90m 39| [39m      imports[33m:[39m [
    [90m 40| [39m        [33mConfigModule[39m[33m.[39m[34mforRoot[39m({ isGlobal[33m:[39m [35mtrue[39m })[33m,[39m
    [90m 41| [39m        [33mPrismaModule[39m[33m,[39m
    [90m   | [39m        [31m^[39m
    [90m 42| [39m        [33mUsersModule[39m[33m,[39m
    [90m 43| [39m        [33mAuthModule[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/course-progress.integration.spec.ts[2m > [22mCourse Learning Flow (Integration)
[31m[1m[7m FAIL [27m[22m[39m apps/api/test/course-progress.integration.spec.ts[2m > [22mCourse Learning Flow (Integration)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prisma.chatMessage.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\helpers\test-utils.ts:43:24

  40 export async function cleanupDatabase(): Promise<void> {
  41   await prisma.$transaction([
  42     // Delete child records first
â†’ 43     prisma.chatMessage.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/example-usage.e2e-spec.ts[2m > [22mExample: Test Helpers Usage (E2E)
[31m[1m[7m FAIL [27m[22m[39m apps/api/test/system-resilience.e2e-spec.ts[2m > [22mSystem Resilience (e2e)
[31m[1mError[22m: Unsupported storage driver: invalid-driver[39m
[36m [2mâ¯[22m UnstorageService.initializeStorage apps/api/src/storage/unstorage.service.ts:[2m86:15[22m[39m
    [90m 84| [39m
    [90m 85| [39m      [35mdefault[39m[33m:[39m
    [90m 86| [39m        [35mthrow[39m [35mnew[39m [33mError[39m([32m`Unsupported storage driver: [39m[36m${[39m[35mthis[39m[33m.[39mdriver[36m}[39m[32m`[39m)[33m;[39m
    [90m   | [39m              [31m^[39m
    [90m 87| [39m    }
    [90m 88| [39m
[90m [2mâ¯[22m new UnstorageService apps/api/src/storage/unstorage.service.ts:[2m22:10[22m[39m
[90m [2mâ¯[22m TestingInjector.instantiateClass node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m418:19[22m[39m
[90m [2mâ¯[22m callback node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m70:45[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveConstructorParams node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m170:24[22m[39m
[90m [2mâ¯[22m TestingInjector.loadInstance node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m75:13[22m[39m
[90m [2mâ¯[22m TestingInjector.loadProvider node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m103:9[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m56:13[22m[39m
[90m [2mâ¯[22m TestingInstanceLoader.createInstancesOfProviders node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m55:9[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/example-usage.e2e-spec.ts[2m > [22mExample: Test Helpers Usage (E2E)
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'close')[39m
[36m [2mâ¯[22m apps/api/test/example-usage.e2e-spec.ts:[2m41:15[22m[39m
    [90m 39| [39m
    [90m 40| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m 41| [39m    [35mawait[39m app[33m.[39m[34mclose[39m()[33m;[39m
    [90m   | [39m              [31m^[39m
    [90m 42| [39m    [35mawait[39m [34mdisconnectPrisma[39m()[33m;[39m
    [90m 43| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/massive-stress.e2e-spec.ts[2m > [22mMassive Persona Stress Test (1000+ Actions Simulation)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.user.upsert()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\massive-stress.e2e-spec.ts:46:32

  43 console.log(`ðŸ‘¥ Setting up ${USER_IDS.length} users...`);
  44 for (const id of USER_IDS) {
  45   const persona = Math.random() > 0.5 ? 'HUNTER' : 'SAVER';
â†’ 46   await prismaService.user.upsert(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m apps/api/test/massive-stress.e2e-spec.ts:[2m46:7[22m[39m
    [90m 44| [39m    [35mfor[39m ([35mconst[39m id [35mof[39m [33mUSER_IDS[39m) {
    [90m 45| [39m      [35mconst[39m persona [33m=[39m [33mMath[39m[33m.[39m[34mrandom[39m() [33m>[39m [34m0.5[39m [33m?[39m [32m'HUNTER'[39m [33m:[39m [32m'SAVER'[39m[33m;[39m
    [90m 46| [39m      [35mawait[39m prismaService[33m.[39muser[33m.[39m[34mupsert[39m({
    [90m   | [39m      [31m^[39m
    [90m 47| [39m        where[33m:[39m { id }[33m,[39m
    [90m 48| [39m        update[33m:[39m { points[33m:[39m [34m1000[39m }[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/massive-stress.e2e-spec.ts[2m > [22mMassive Persona Stress Test (1000+ Actions Simulation)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.behaviorLog.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\massive-stress.e2e-spec.ts:129:37

  126 // Small delay to allow pending DB operations to finish
  127 await new Promise((resolve) => setTimeout(resolve, 1000));
  128 
â†’ 129 await prismaService.behaviorLog.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m apps/api/test/massive-stress.e2e-spec.ts:[2m129:5[22m[39m
    [90m127| [39m    [35mawait[39m [35mnew[39m [33mPromise[39m((resolve) [33m=>[39m [34msetTimeout[39m(resolve[33m,[39m [34m1000[39m))[33m;[39m
    [90m128| [39m
    [90m129| [39m    [35mawait[39m prismaService[33m.[39mbehaviorLog[33m.[39m[34mdeleteMany[39m({
    [90m   | [39m    [31m^[39m
    [90m130| [39m      where[33m:[39m { userId[33m:[39m { [35min[39m[33m:[39m [33mUSER_IDS[39m } }[33m,[39m
    [90m131| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/multi-market-stress.e2e-spec.ts[2m > [22mMulti-Market Market Stress Test (VI/EN/ZH Localized Content)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.user.upsert()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\multi-market-stress.e2e-spec.ts:42:32

  39 console.log(`ðŸ‘¥ Setting up ${USER_IDS.length} users across ${LOCALES.join(', ')}...`);
  40 for (const id of USER_IDS) {
  41   const locale = id.split('-')[2];
â†’ 42   await prismaService.user.upsert(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m apps/api/test/multi-market-stress.e2e-spec.ts:[2m42:7[22m[39m
    [90m 40| [39m    [35mfor[39m ([35mconst[39m id [35mof[39m [33mUSER_IDS[39m) {
    [90m 41| [39m      [35mconst[39m locale [33m=[39m id[33m.[39m[34msplit[39m([32m'-'[39m)[[34m2[39m][33m;[39m
    [90m 42| [39m      [35mawait[39m prismaService[33m.[39muser[33m.[39m[34mupsert[39m({
    [90m   | [39m      [31m^[39m
    [90m 43| [39m        where[33m:[39m { id }[33m,[39m
    [90m 44| [39m        update[33m:[39m { points[33m:[39m [34m1000[39m }[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/multi-market-stress.e2e-spec.ts[2m > [22mMulti-Market Market Stress Test (VI/EN/ZH Localized Content)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.behaviorLog.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\multi-market-stress.e2e-spec.ts:116:37

  113 }, 60000);
  114 
  115 afterAll(async () => {
â†’ 116   await prismaService.behaviorLog.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m apps/api/test/multi-market-stress.e2e-spec.ts:[2m116:5[22m[39m
    [90m114| [39m
    [90m115| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m116| [39m    [35mawait[39m prismaService[33m.[39mbehaviorLog[33m.[39m[34mdeleteMany[39m({
    [90m   | [39m    [31m^[39m
    [90m117| [39m      where[33m:[39m { userId[33m:[39m { [35min[39m[33m:[39m [33mUSER_IDS[39m } }[33m,[39m
    [90m118| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/persona-simulation.e2e-spec.ts[2m > [22mDeep Persona Simulation (Whale vs Risk-Averse)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.user.upsert()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\persona-simulation.e2e-spec.ts:37:30

  34 eventEmitter.on('points.earned', (payload) => nudgeListener.handlePointsEarnedEvent(payload));
  35 
  36 // Setup personas
â†’ 37 await prismaService.user.upsert(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m apps/api/test/persona-simulation.e2e-spec.ts:[2m37:5[22m[39m
    [90m 35| [39m
    [90m 36| [39m    [90m// Setup personas[39m
    [90m 37| [39m    [35mawait[39m prismaService[33m.[39muser[33m.[39m[34mupsert[39m({
    [90m   | [39m    [31m^[39m
    [90m 38| [39m      where[33m:[39m { id[33m:[39m [33mWHALE_ID[39m }[33m,[39m
    [90m 39| [39m      update[33m:[39m { points[33m:[39m [34m10000[39m }[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/persona-simulation.e2e-spec.ts[2m > [22mDeep Persona Simulation (Whale vs Risk-Averse)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.behaviorLog.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\persona-simulation.e2e-spec.ts:137:37

  134 });
  135 
  136 afterAll(async () => {
â†’ 137   await prismaService.behaviorLog.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m apps/api/test/persona-simulation.e2e-spec.ts:[2m137:5[22m[39m
    [90m135| [39m
    [90m136| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m137| [39m    [35mawait[39m prismaService[33m.[39mbehaviorLog[33m.[39m[34mdeleteMany[39m({
    [90m   | [39m    [31m^[39m
    [90m138| [39m      where[33m:[39m { userId[33m:[39m { [35min[39m[33m:[39m [[33mWHALE_ID[39m[33m,[39m [33mSAVER_ID[39m] } }[33m,[39m
    [90m139| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/ai/ai.integration.spec.ts[2m > [22mAI Module - Integration Tests
[31m[1mError[22m: Nest can't resolve dependencies of the AiService (?, PrismaService, CACHE_MANAGER). Please make sure that the argument ConfigService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If ConfigService is a provider, is it part of the current RootTestModule?
- If ConfigService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing ConfigService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[90m [2mâ¯[22m TestingInjector.lookupComponentInParentModules node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m286:19[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveComponentWrapper node_modules/.pnpm/@nestjs+testing@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_r_5vf4xikaifpz6ermp5d5enz4yy/node_modules/@nestjs/testing/testing-injector.js:[2m19:45[22m[39m
[90m [2mâ¯[22m resolveParam node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m140:38[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveConstructorParams node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m169:27[22m[39m
[90m [2mâ¯[22m TestingInjector.loadInstance node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m75:13[22m[39m
[90m [2mâ¯[22m TestingInjector.loadProvider node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m103:9[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m56:13[22m[39m
[90m [2mâ¯[22m TestingInstanceLoader.createInstancesOfProviders node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m55:9[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/ai/ai.integration.spec.ts[2m > [22mAI Module - Integration Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'chatMessage')[39m
[36m [2mâ¯[22m apps/api/src/ai/ai.integration.spec.ts:[2m115:18[22m[39m
    [90m113| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m114| [39m    [90m// Cleanup[39m
    [90m115| [39m    [35mawait[39m prisma[33m.[39mchatMessage[33m.[39m[34mdeleteMany[39m()[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m116| [39m    [35mawait[39m prisma[33m.[39mchatThread[33m.[39m[34mdeleteMany[39m()[33m;[39m
    [90m117| [39m    [35mawait[39m prisma[33m.[39mbehaviorLog[33m.[39m[34mdeleteMany[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/users/users.service.spec.ts[2m [ apps/api/src/users/users.service.spec.ts ][22m
[31m[1mError[22m:   x await isn't allowed in non-async function
     ,-[C:/Users/luaho/Demo project/v-edfinance/apps/api/src/users/users.service.spec.ts:197:1]
 194 |       });
 195 | 
 196 |       describe('Password Management (S002)', () => {
 197 |       const bcrypt = await import('bcrypt');
     :                      ^^^^^
 198 | 
 199 |       it('should change password with valid old password', async () => {
 200 |       const oldHash = await bcrypt.hash('oldPassword', 10);
     `----


Caused by:
    Syntax Error[39m
  Plugin: [35mswc[39m
  File: [36mC:/Users/luaho/Demo project/v-edfinance/apps/api/src/users/users.service.spec.ts[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/integration/admin-dashboard.integration.spec.ts[2m [ apps/api/test/integration/admin-dashboard.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/analytics/analytics.module (resolved id: ../../src/analytics/analytics.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/admin-dashboard.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/integration/ai-course-flow.e2e-spec.ts[2m > [22mAI & Course Integration (e2e)
[31m[1mError[22m: Nest can't resolve dependencies of the GamificationService (PrismaService, ?). Please make sure that the argument EventEmitter at index [1] is available in the CommonModule context.

Potential solutions:
- Is CommonModule a valid NestJS module?
- If EventEmitter is a provider, is it part of the current CommonModule?
- If EventEmitter is exported from a separate @Module, is that module imported within CommonModule?
  @Module({
    imports: [ /* the Module containing EventEmitter */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[90m [2mâ¯[22m TestingInjector.lookupComponentInParentModules node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m286:19[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveComponentWrapper node_modules/.pnpm/@nestjs+testing@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_r_5vf4xikaifpz6ermp5d5enz4yy/node_modules/@nestjs/testing/testing-injector.js:[2m19:45[22m[39m
[90m [2mâ¯[22m resolveParam node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m140:38[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveConstructorParams node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m169:27[22m[39m
[90m [2mâ¯[22m TestingInjector.loadInstance node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m75:13[22m[39m
[90m [2mâ¯[22m TestingInjector.loadProvider node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m103:9[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m56:13[22m[39m
[90m [2mâ¯[22m TestingInstanceLoader.createInstancesOfProviders node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m55:9[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/integration/auth-flow.e2e-spec.ts[2m > [22mAuth Integration (e2e)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prisma.user.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\integration\auth-flow.e2e-spec.ts:51:23

  48 prisma = app.get<PrismaService>(PrismaService);
  49 
  50 // Clean test data before tests
â†’ 51 await prisma.user.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m apps/api/test/integration/auth-flow.e2e-spec.ts:[2m51:5[22m[39m
    [90m 49| [39m    
    [90m 50| [39m    [90m// Clean test data before tests[39m
    [90m 51| [39m    [35mawait[39m prisma[33m.[39muser[33m.[39m[34mdeleteMany[39m({
    [90m   | [39m    [31m^[39m
    [90m 52| [39m      where[33m:[39m { email[33m:[39m { contains[33m:[39m [32m'test-integration'[39m } }[33m,[39m
    [90m 53| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/integration/auth-flow.e2e-spec.ts[2m > [22mAuth Integration (e2e)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prisma.user.deleteMany()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\integration\auth-flow.e2e-spec.ts:58:25

  55 
  56 afterAll(async () => {
  57   if (app) {
â†’ 58     await prisma.user.deleteMany(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m apps/api/test/integration/auth-flow.e2e-spec.ts:[2m58:7[22m[39m
    [90m 56| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m 57| [39m    [35mif[39m (app) {
    [90m 58| [39m      [35mawait[39m prisma[33m.[39muser[33m.[39m[34mdeleteMany[39m({
    [90m   | [39m      [31m^[39m
    [90m 59| [39m        where[33m:[39m { email[33m:[39m { contains[33m:[39m [32m'test-integration'[39m } }[33m,[39m
    [90m 60| [39m      })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/integration/disaster-recovery.integration.spec.ts[2m [ apps/api/test/integration/disaster-recovery.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/health/health.module (resolved id: ../../src/health/health.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/disaster-recovery.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/integration/multi-device-sync.integration.spec.ts[2m [ apps/api/test/integration/multi-device-sync.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/websocket/websocket.module (resolved id: ../../src/websocket/websocket.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/multi-device-sync.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/integration/recommendation-refresh.integration.spec.ts[2m [ apps/api/test/integration/recommendation-refresh.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/behavior-analytics/behavior-analytics.module (resolved id: ../../src/behavior-analytics/behavior-analytics.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/recommendation-refresh.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/integration/security-audit-trail.integration.spec.ts[2m [ apps/api/test/integration/security-audit-trail.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/audit/audit.module (resolved id: ../../src/audit/audit.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/security-audit-trail.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/integration/user-lifecycle.integration.spec.ts[2m [ apps/api/test/integration/user-lifecycle.integration.spec.ts ][22m
[31m[1mError[22m: Failed to load url ../../src/social/social.module (resolved id: ../../src/social/social.module) in C:/Users/luaho/Demo project/v-edfinance/apps/api/test/integration/user-lifecycle.integration.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/nudge-scheduler.service.spec.ts[2m [ apps/api/src/modules/nudge/nudge-scheduler.service.spec.ts ][22m
[31m[1mError[22m: Failed to load url ./nudge-scheduler.service (resolved id: ./nudge-scheduler.service) in C:/Users/luaho/Demo project/v-edfinance/apps/api/src/modules/nudge/nudge-scheduler.service.spec.ts. Does the file exist?[39m
[90m [2mâ¯[22m loadAndTransform ../../Demo%20project/v-edfinance/node_modules/.pnpm/vite@5.4.21_@types+node@25.0.3_lightningcss@1.30.2_terser@5.44.1/node_modules/vite/dist/node/chunks/dep-BK3b2jBa.js:[2m51969:17[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/172]âŽ¯[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1m[7m Failed Tests 145 [27m[22mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/admin-integrity.e2e-spec.ts[2m > [22mPHÆ¯Æ NG ÃN 3: Admin Integrity Audit[2m > [22mHá»‡ thá»‘ng pháº£i vÆ°á»£t qua bÃ i kiá»ƒm tra tÃ­nh toÃ n váº¹n (Integrity Check)
[31m[1mPrismaClientInitializationError[22m: 
Invalid `this.prisma.behaviorLog.count()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\src\modules\debug\diagnostic.service.ts:94:31

  91 private async collectRealTimeMetrics() {
  92   const last10Min = new Date(Date.now() - 10 * 60 * 1000);
  93   const [behaviorCount, errorCount, nudgeCount] = await Promise.all([
â†’ 94     this.prisma.behaviorLog.count(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m DiagnosticService.collectRealTimeMetrics apps/api/src/modules/debug/diagnostic.service.ts:[2m93:53[22m[39m
    [90m 91| [39m  [35mprivate[39m [35masync[39m [34mcollectRealTimeMetrics[39m() {
    [90m 92| [39m    [35mconst[39m last10Min [33m=[39m [35mnew[39m [33mDate[39m([33mDate[39m[33m.[39m[34mnow[39m() [33m-[39m [34m10[39m [33m*[39m [34m60[39m [33m*[39m [34m1000[39m)[33m;[39m
    [90m 93| [39m    [35mconst[39m [behaviorCount[33m,[39m errorCount[33m,[39m nudgeCount] [33m=[39m [35mawait[39m [33mPromise[39m[33m.[39m[34mall[39m([
    [90m   | [39m                                                    [31m^[39m
    [90m 94| [39m      [35mthis[39m[33m.[39mprisma[33m.[39mbehaviorLog[33m.[39m[34mcount[39m({
    [90m 95| [39m        where[33m:[39m { timestamp[33m:[39m { gte[33m:[39m last10Min } }[33m,[39m
[90m [2mâ¯[22m DiagnosticService.runFullDiagnostics apps/api/src/modules/debug/diagnostic.service.ts:[2m83:16[22m[39m
[90m [2mâ¯[22m apps/api/test/admin-integrity.e2e-spec.ts:[2m26:21[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/behavioral-stress.e2e-spec.ts[2m > [22mPHÆ¯Æ NG ÃN 2: Behavioral Stress Test (E2B Inspired)[2m > [22mNÃªn giáº£ láº­p thÃ nh cÃ´ng 50 hÃ nh vi ngÆ°á»i dÃ¹ng mÃ  khÃ´ng cÃ³ lá»—i schema
[31m[1mPrismaClientInitializationError[22m: 
Invalid `prismaService.user.upsert()` invocation in
C:\Users\luaho\Demo project\v-edfinance\apps\api\test\behavioral-stress.e2e-spec.ts:31:30

  28 
  29 // Äáº£m báº£o user tá»“n táº¡i Ä‘á»ƒ trÃ¡nh vi pháº¡m Foreign Key
  30 // LÆ°u Ã½: Field 'name' khÃ´ng cÃ³ trong User model, thay vÃ o Ä‘Ã³ lÃ  JSONB 'metadata'
â†’ 31 await prismaService.user.upsert(
Can't reach database server at `localhost:5432`

Please make sure your database server is running at `localhost:5432`.[39m
[90m [2mâ¯[22m $n.handleRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:7615[22m[39m
[90m [2mâ¯[22m $n.handleAndLogRequestError node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6623[22m[39m
[90m [2mâ¯[22m $n.request node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m121:6307[22m[39m
[90m [2mâ¯[22m l node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/runtime/library.js:[2m130:9633[22m[39m
[36m [2mâ¯[22m apps/api/test/behavioral-stress.e2e-spec.ts:[2m31:5[22m[39m
    [90m 29| [39m    [90m// Äáº£m báº£o user tá»“n táº¡i Ä‘á»ƒ trÃ¡nh vi pháº¡m Foreign Key[39m
    [90m 30| [39m    [90m// LÆ°u Ã½: Field 'name' khÃ´ng cÃ³ trong User model, thay vÃ o Ä‘Ã³ lÃ  J[39mâ€¦
    [90m 31| [39m    [35mawait[39m prismaService[33m.[39muser[33m.[39m[34mupsert[39m({
    [90m   | [39m    [31m^[39m
    [90m 32| [39m      where[33m:[39m { id[33m:[39m userId }[33m,[39m
    [90m 33| [39m      update[33m:[39m {}[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/auth/auth.service.spec.ts[2m > [22mAuthService[2m > [22mToken Rotation Edge Cases (S001)[2m > [22mshould reject refresh token exactly at expiry boundary
[31m[1mAssertionError[22m: expected error to be instance of UnauthorizedException[39m

[32m- Expected:[39m 
[Function UnauthorizedException]

[31m+ Received:[39m 
[TypeError: tx.refreshToken.update is not a function]

[36m [2mâ¯[22m apps/api/src/auth/auth.service.spec.ts:[2m323:13[22m[39m
    [90m321| [39m            prismaService[33m.[39mrefreshToken[33m.[39mfindUnique [33m=[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockResolv[39mâ€¦
    [90m322| [39m
    [90m323| [39m            [35mawait[39m [34mexpect[39m(service[33m.[39m[34mrefreshToken[39m({ refreshToken[33m:[39m [32m'boundar[39mâ€¦
    [90m   | [39m            [31m^[39m
    [90m324| [39m                [33mUnauthorizedException[39m
    [90m325| [39m            )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/behavior/behavior.controller.spec.ts[2m > [22mBehaviorController (Gamification)[2m > [22mgetMyHistory - Behavior Analytics[2m > [22mshould throw UnauthorizedException for missing auth
[31m[1mAssertionError[22m: promise resolved "[]" instead of rejecting[39m

[32m- Expected:[39m 
[Error: rejected promise]

[31m+ Received:[39m 
Array []

[36m [2mâ¯[22m apps/api/src/behavior/behavior.controller.spec.ts:[2m221:59[22m[39m
    [90m219| [39m      [35mconst[39m testController [33m=[39m module[33m.[39m[35mget[39m[33m<[39m[33mBehaviorController[39m[33m>[39m([33mBehaviorCo[39mâ€¦
    [90m220| [39m
    [90m221| [39m      [35mawait[39m [34mexpect[39m(testController[33m.[39m[34mgetMyHistory[39m({ user[33m:[39m {} }))[33m.[39mrejects[33m.[39mâ€¦
    [90m   | [39m                                                          [31m^[39m
    [90m222| [39m        [33mUnauthorizedException[39m
    [90m223| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/storage/storage.controller.spec.ts[2m > [22mStorageController (C013)[2m > [22mConcurrent Uploads[2m > [22mshould generate unique keys for concurrent uploads
[31m[1mAssertionError[22m: expected 'uploads/1766339268223-same.jpg' not to be 'uploads/1766339268223-same.jpg' // Object.is equality[39m
[36m [2mâ¯[22m apps/api/src/storage/storage.controller.spec.ts:[2m268:31[22m[39m
    [90m266| [39m      ])[33m;[39m
    [90m267| [39m
    [90m268| [39m      [34mexpect[39m(result1[33m.[39mkey)[33m.[39mnot[33m.[39m[34mtoBe[39m(result2[33m.[39mkey)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m269| [39m    })[33m;[39m
    [90m270| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/users/users.controller.spec.ts[2m > [22mUsersController[2m > [22mgetProfile[2m > [22mshould throw UnauthorizedException when userId is missing
[31m[1mAssertionError[22m: expected error to be instance of UnauthorizedException[39m

[32m- Expected:[39m 
[Function UnauthorizedException]

[31m+ Received:[39m 
[NotFoundException: User not found]

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/users/users.controller.spec.ts[2m > [22mUsersController[2m > [22mupdateInvestmentProfile[2m > [22mshould handle partial updates
[31m[1mReferenceError[22m: mockInvestmentProfile is not defined[39m
[36m [2mâ¯[22m apps/api/src/users/users.controller.spec.ts:[2m171:30[22m[39m
    [90m169| [39m    [34mit[39m([32m'should handle partial updates'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m170| [39m      [35mconst[39m partialDto [33m=[39m { riskTolerance[33m:[39m [32m'CONSERVATIVE'[39m }[33m;[39m
    [90m171| [39m      [35mconst[39m updatedProfile [33m=[39m { [33m...[39mmockInvestmentProfile[33m,[39m [33m...[39mpartialDtoâ€¦
    [90m   | [39m                             [31m^[39m
    [90m172| [39m      mockUsersService[33m.[39mupdateInvestmentProfile[33m.[39m[34mmockResolvedValue[39m(updatâ€¦
    [90m173| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/integration/behavior-flow.e2e-spec.ts[2m > [22mBehavior & Gamification Integration (e2e)[2m > [22mBehavior Tracking[2m > [22mshould retrieve behavior logs for user
[31m[1mAssertionError[22m: expected 0 to be greater than 0[39m
[36m [2mâ¯[22m apps/api/test/integration/behavior-flow.e2e-spec.ts:[2m185:36[22m[39m
    [90m183| [39m
    [90m184| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(response[33m.[39mbody))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m185| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mlength)[33m.[39m[34mtoBeGreaterThan[39m([34m0[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m186| [39m    })[33m;[39m
    [90m187| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/test/integration/behavior-flow.e2e-spec.ts[2m > [22mBehavior & Gamification Integration (e2e)[2m > [22mGamification & Streaks[2m > [22mshould trigger a nudge check (social proof)
[31m[1mAssertionError[22m: expected {} to have property "type"[39m
[36m [2mâ¯[22m apps/api/test/integration/behavior-flow.e2e-spec.ts:[2m212:31[22m[39m
    [90m210| [39m      [90m// Nudge might be null if no triggers meet criteria, but the end[39mâ€¦
    [90m211| [39m      [35mif[39m (response[33m.[39mbody) {
    [90m212| [39m        [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'type'[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m213| [39m        [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'content'[39m)[33m;[39m
    [90m214| [39m      }

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22mAdaptiveDifficultyService[2m > [22mDifficulty Adjustment Algorithms[2m > [22madjustLearningPath[2m > [22mshould handle score of 0
[31m[1mAssertionError[22m: expected 'STAY' to be 'REINFORCE' // Object.is equality[39m

Expected: [32m"REINFORCE"[39m
Received: [31m"STAY"[39m

[36m [2mâ¯[22m apps/api/src/modules/ai/adaptive-difficulty.service.spec.ts:[2m153:35[22m[39m
    [90m151| [39m        })[33m;[39m
    [90m152| [39m
    [90m153| [39m        [34mexpect[39m(result[33m.[39madjustment)[33m.[39m[34mtoBe[39m([32m'REINFORCE'[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m154| [39m      })[33m;[39m
    [90m155| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[33/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould return cached response on cache hit for GENERAL_FAQ
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage apps/api/src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse apps/api/src/ai/ai.service.ts:[2m218:20[22m[39m
[90m [2mâ¯[22m apps/api/src/modules/ai/ai-cache.service.spec.ts:[2m79:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[34/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould make AI call on cache miss for GENERAL_FAQ
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage apps/api/src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse apps/api/src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m apps/api/src/modules/ai/ai-cache.service.spec.ts:[2m122:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[35/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould skip cache for PERSONALIZED_ADVICE queries
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage apps/api/src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse apps/api/src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m apps/api/src/modules/ai/ai-cache.service.spec.ts:[2m165:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[36/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mTTL Expiration[2m > [22mshould set cache with 24-hour TTL for FAQ responses
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage apps/api/src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse apps/api/src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m apps/api/src/modules/ai/ai-cache.service.spec.ts:[2m229:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[37/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mTTL Expiration[2m > [22mshould handle expired cache gracefully (cache miss scenario)
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage apps/api/src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse apps/api/src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m apps/api/src/modules/ai/ai-cache.service.spec.ts:[2m270:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[38/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Invalidation[2m > [22mshould re-cache response after invalidation
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage apps/api/src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse apps/api/src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m apps/api/src/modules/ai/ai-cache.service.spec.ts:[2m330:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mEdge Cases & Error Handling[2m > [22mshould save both user and assistant messages when cache hit occurs
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage apps/api/src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse apps/api/src/ai/ai.service.ts:[2m218:20[22m[39m
[90m [2mâ¯[22m apps/api/src/modules/ai/ai-cache.service.spec.ts:[2m490:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[40/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mEdge Cases & Error Handling[2m > [22mshould track token usage in behavior logs after AI call
[31m[1mTypeError[22m: this.prisma.$transaction is not a function[39m
[36m [2mâ¯[22m AiService.saveMessage apps/api/src/ai/ai.service.ts:[2m137:24[22m[39m
    [90m135| [39m
    [90m136| [39m  [35masync[39m [34msaveMessage[39m(threadId[33m:[39m string[33m,[39m role[33m:[39m [33mChatRole[39m[33m,[39m content[33m:[39m string[33m,[39mâ€¦
    [90m137| [39m    [35mreturn[39m [35mthis[39m[33m.[39mprisma[33m.[39m[34m$transaction[39m([35masync[39m (tx) [33m=>[39m {
    [90m   | [39m                       [31m^[39m
    [90m138| [39m      [35mconst[39m msg [33m=[39m [35mawait[39m tx[33m.[39mchatMessage[33m.[39m[34mcreate[39m({
    [90m139| [39m        data[33m:[39m { threadId[33m,[39m role[33m,[39m content[33m,[39m metadata }[33m,[39m
[90m [2mâ¯[22m AiService.generateResponse apps/api/src/ai/ai.service.ts:[2m321:16[22m[39m
[90m [2mâ¯[22m apps/api/src/modules/ai/ai-cache.service.spec.ts:[2m576:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[41/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould increment strike count for HIGH severity violations
[31m[1mInternalServerErrorException[22m: Moderation API error[39m
[36m [2mâ¯[22m ModerationService.moderateContent apps/api/src/modules/ai/moderation.service.ts:[2m99:13[22m[39m
    [90m 97| [39m      }
    [90m 98| [39m
    [90m 99| [39m      [35mthrow[39m [35mnew[39m [33mInternalServerErrorException[39m([32m'Moderation API error'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m100| [39m    }
    [90m101| [39m  }
[90m [2mâ¯[22m apps/api/src/modules/ai/moderation.service.spec.ts:[2m482:9[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[42/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould ban user after 3 CRITICAL violations
[31m[1mAssertionError[22m: expected error to be instance of ForbiddenException[39m

[32m- Expected:[39m 
[Function ForbiddenException]

[31m+ Received:[39m 
[InternalServerErrorException: Moderation API error]

[36m [2mâ¯[22m apps/api/src/modules/ai/moderation.service.spec.ts:[2m506:9[22m[39m
    [90m504| [39m        })[33m;[39m
    [90m505| [39m
    [90m506| [39m        [35mawait[39m [34mexpect[39m(
    [90m   | [39m        [31m^[39m
    [90m507| [39m          service[33m.[39m[34mmoderateContent[39m(content[33m,[39m [32m'user-29'[39m[33m,[39m [32m'en'[39m[33m,[39m { enforceSâ€¦
    [90m508| [39m        )[33m.[39mrejects[33m.[39m[34mtoThrow[39m([33mForbiddenException[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[43/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould not count LOW severity towards strikes
[31m[1mInternalServerErrorException[22m: Moderation API error[39m
[36m [2mâ¯[22m ModerationService.moderateContent apps/api/src/modules/ai/moderation.service.ts:[2m99:13[22m[39m
    [90m 97| [39m      }
    [90m 98| [39m
    [90m 99| [39m      [35mthrow[39m [35mnew[39m [33mInternalServerErrorException[39m([32m'Moderation API error'[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m100| [39m    }
    [90m101| [39m  }
[90m [2mâ¯[22m apps/api/src/modules/ai/moderation.service.spec.ts:[2m520:9[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[44/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock OpenAI Moderation API response
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[39m

[32m- Expected:[39m 
false

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m apps/api/src/modules/ai/moderation.service.spec.ts:[2m624:32[22m[39m
    [90m622| [39m        [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mmoderateContent[39m(content[33m,[39m [32m'user-36[39mâ€¦
    [90m623| [39m
    [90m624| [39m        [34mexpect[39m(result[33m.[39mflagged)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m625| [39m      })[33m;[39m
    [90m626| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[45/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock Google Perspective API response
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[39m

[32m- Expected:[39m 
false

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m apps/api/src/modules/ai/moderation.service.spec.ts:[2m642:32[22m[39m
    [90m640| [39m        [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mmoderateContent[39m(content[33m,[39m [32m'user-37[39mâ€¦
    [90m641| [39m
    [90m642| [39m        [34mexpect[39m(result[33m.[39mflagged)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m643| [39m      })[33m;[39m
    [90m644| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[46/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock custom Gemini Moderation API
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[39m

[32m- Expected:[39m 
false

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m apps/api/src/modules/ai/moderation.service.spec.ts:[2m658:32[22m[39m
    [90m656| [39m        [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mmoderateContent[39m(content[33m,[39m [32m'user-38[39mâ€¦
    [90m657| [39m
    [90m658| [39m        [34mexpect[39m(result[33m.[39mflagged)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m659| [39m      })[33m;[39m
    [90m660| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[47/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/ab-testing.service.spec.ts[2m > [22mABTestingService - A/B Testing Framework[2m > [22mVariant Assignment[2m > [22mshould distribute variants according to weight ratios
[31m[1mAssertionError[22m: expected 0.882 to be less than 0.75[39m
[36m [2mâ¯[22m apps/api/src/modules/analytics/ab-testing.service.spec.ts:[2m268:28[22m[39m
    [90m266| [39m
    [90m267| [39m      [34mexpect[39m(controlRatio)[33m.[39m[34mtoBeGreaterThan[39m([34m0.65[39m)[33m;[39m
    [90m268| [39m      [34mexpect[39m(controlRatio)[33m.[39m[34mtoBeLessThan[39m([34m0.75[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m269| [39m    })[33m;[39m
    [90m270| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[48/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mhandleLogAggregation[2m > [22mshould handle empty log set gracefully
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[36m [2mâ¯[22m apps/api/src/modules/analytics/analytics.service.spec.ts:[2m135:49[22m[39m
    [90m133| [39m      [35mawait[39m service[33m.[39m[34mhandleLogAggregation[39m()[33m;[39m
    [90m134| [39m
    [90m135| [39m      [34mexpect[39m(mockPrisma[33m.[39mbehaviorLog[33m.[39mdeleteMany)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                                [31m^[39m
    [90m136| [39m    })[33m;[39m
    [90m137| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[49/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mhandleLogAggregation[2m > [22mshould delete logs older than 30 days
[31m[1mTypeError[22m: Cannot read properties of undefined (reading '0')[39m
[36m [2mâ¯[22m apps/api/src/modules/analytics/analytics.service.spec.ts:[2m144:71[22m[39m
    [90m142| [39m      [35mawait[39m service[33m.[39m[34mhandleLogAggregation[39m()[33m;[39m
    [90m143| [39m
    [90m144| [39m      [35mconst[39m callArgs [33m=[39m mockPrisma[33m.[39mbehaviorLog[33m.[39mdeleteMany[33m.[39mmock[33m.[39mcalls[[34m0[39m]â€¦
    [90m   | [39m                                                                      [31m^[39m
    [90m145| [39m      [34mexpect[39m(callArgs[33m.[39mwhere[33m.[39mtimestamp[33m.[39mlt)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m146| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[50/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mBehavior Log Archiving[2m > [22mshould archive logs in batches based on age threshold
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m apps/api/src/modules/analytics/analytics.service.spec.ts:[2m273:49[22m[39m
    [90m271| [39m      [35mawait[39m service[33m.[39m[34mhandleLogAggregation[39m()[33m;[39m
    [90m272| [39m
    [90m273| [39m      [34mexpect[39m(mockPrisma[33m.[39mbehaviorLog[33m.[39mdeleteMany)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                                                [31m^[39m
    [90m274| [39m        expect[33m.[39m[34mobjectContaining[39m({
    [90m275| [39m          where[33m:[39m {

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[51/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mBehavior Log Archiving[2m > [22mshould preserve recent logs during archiving
[31m[1mTypeError[22m: Cannot read properties of undefined (reading '0')[39m
[36m [2mâ¯[22m apps/api/src/modules/analytics/analytics.service.spec.ts:[2m290:73[22m[39m
    [90m288| [39m      [35mawait[39m service[33m.[39m[34mhandleLogAggregation[39m()[33m;[39m
    [90m289| [39m
    [90m290| [39m      [35mconst[39m deleteCall [33m=[39m mockPrisma[33m.[39mbehaviorLog[33m.[39mdeleteMany[33m.[39mmock[33m.[39mcalls[â€¦
    [90m   | [39m                                                                        [31m^[39m
    [90m291| [39m      [35mconst[39m threshold [33m=[39m deleteCall[33m.[39mwhere[33m.[39mtimestamp[33m.[39mlt[33m;[39m
    [90m292| [39m      [35mconst[39m daysSinceThreshold [33m=[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[52/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22mHeatmapService[2m > [22manalyzeScrollDepth[2m > [22mshould skip events without scrollPercentage
[31m[1mAssertionError[22m: expected 32.5 to be 65 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 65[39m
[31m+ 32.5[39m

[36m [2mâ¯[22m apps/api/src/modules/analytics/heatmap.service.spec.ts:[2m367:35[22m[39m
    [90m365| [39m      )[33m;[39m
    [90m366| [39m
    [90m367| [39m      [34mexpect[39m(result[33m.[39maverageDepth)[33m.[39m[34mtoBe[39m([34m65[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m368| [39m      [34mexpect[39m(result[33m.[39mmaxDepth)[33m.[39m[34mtoBe[39m([34m80[39m)[33m;[39m
    [90m369| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[53/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/heatmap.service.spec.ts[2m > [22mHeatmapService[2m > [22manalyzeUserEngagement[2m > [22mshould calculate comprehensive engagement metrics
[31m[1mAssertionError[22m: expected { totalClicks: 50, â€¦(3) } to deeply equal { totalClicks: 50, â€¦(3) }[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  Object {[22m
[32m-   "avgSessionDuration": 175,[39m
[31m+   "avgSessionDuration": 225,[39m
[2m    "mostVisitedPages": ArrayContaining [[22m
[2m      "/dashboard",[22m
[2m      "/courses",[22m
[2m    ],[22m
[2m    "totalClicks": 50,[22m
[2m    "totalScrolls": 30,[22m
[2m  }[22m

[36m [2mâ¯[22m apps/api/src/modules/analytics/heatmap.service.spec.ts:[2m541:22[22m[39m
    [90m539| [39m      )[33m;[39m
    [90m540| [39m
    [90m541| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m({
    [90m   | [39m                     [31m^[39m
    [90m542| [39m        totalClicks[33m:[39m [34m50[39m[33m,[39m
    [90m543| [39m        totalScrolls[33m:[39m [34m30[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[54/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22mMetricsService[2m > [22mcalculateRetention[2m > [22mshould handle empty cohort
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2mâ¯[22m MetricsService.calculateRetention apps/api/src/modules/analytics/metrics.service.ts:[2m133:42[22m[39m
    [90m131| [39m      })[33m;[39m
    [90m132| [39m
    [90m133| [39m      retainedUsers[day] [33m=[39m activeUserIds[33m.[39mlength[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m134| [39m    }
    [90m135| [39m
[90m [2mâ¯[22m apps/api/src/modules/analytics/metrics.service.spec.ts:[2m204:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[55/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/metrics.service.spec.ts[2m > [22mMetricsService[2m > [22mcalculatePercentile[2m > [22mshould calculate 95th percentile correctly
[31m[1mAssertionError[22m: expected 9.549999999999999 to be 9.55 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 9.55[39m
[31m+ 9.549999999999999[39m

[36m [2mâ¯[22m apps/api/src/modules/analytics/metrics.service.spec.ts:[2m308:22[22m[39m
    [90m306| [39m      [35mconst[39m values [33m=[39m [[34m1[39m[33m,[39m [34m2[39m[33m,[39m [34m3[39m[33m,[39m [34m4[39m[33m,[39m [34m5[39m[33m,[39m [34m6[39m[33m,[39m [34m7[39m[33m,[39m [34m8[39m[33m,[39m [34m9[39m[33m,[39m [34m10[39m][33m;[39m
    [90m307| [39m      [35mconst[39m result [33m=[39m service[33m.[39m[34mcalculatePercentile[39m(values[33m,[39m [34m95[39m)[33m;[39m
    [90m308| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([34m9.55[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m309| [39m    })[33m;[39m
    [90m310| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[56/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould collect real-time metrics from last 10 minutes
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould handle zero events gracefully
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould update Prometheus gauges on metrics collection
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould export metrics in Prometheus format
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould track active WebSocket connections
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould broadcast real-time events to all connected clients
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould send targeted events to specific users
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould broadcast to groups (rooms)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould handle client disconnection and cleanup
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould aggregate behavior logs efficiently for daily archival
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould perform health check aggregation every hour
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould calculate global system stats efficiently
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould analyze user learning habits from behavior logs
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould handle empty user learning habits
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould generate mock behavioral data for stress testing
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould run AI stress test with different complexity levels
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould handle AI stress test failures gracefully
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould simulate complete user flow for integration testing
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould run comprehensive diagnostics with all subsystems
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould detect database connection failure in diagnostics
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould validate JSONB schema integrity
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould warn on JSONB schema drift
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mPerformance Benchmarks[2m > [22mshould complete metrics collection in under 100ms (mocked)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mPerformance Benchmarks[2m > [22mshould handle high-volume log aggregation efficiently
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as HUNTER (risk-taker)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as SAVER (conservative)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as OBSERVER (default)
[31m[1mError[22m: Nest can't resolve dependencies of the WsJwtGuard (?). Please make sure that the argument JwtService at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If JwtService is a provider, is it part of the current RootTestModule?
- If JwtService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing JwtService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors[39m
[90m [2mâ¯[22m TestingInjector.lookupComponentInParentModules node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m286:19[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveComponentWrapper node_modules/.pnpm/@nestjs+testing@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_r_5vf4xikaifpz6ermp5d5enz4yy/node_modules/@nestjs/testing/testing-injector.js:[2m19:45[22m[39m
[90m [2mâ¯[22m resolveParam node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m140:38[22m[39m
[90m [2mâ¯[22m TestingInjector.resolveConstructorParams node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m169:27[22m[39m
[90m [2mâ¯[22m TestingInjector.loadInstance node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m75:13[22m[39m
[90m [2mâ¯[22m TestingInjector.loadEnhancersPerContext node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m447:9[22m[39m
[90m [2mâ¯[22m TestingInjector.loadProvider node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/injector.js:[2m104:9[22m[39m
[90m [2mâ¯[22m node_modules/.pnpm/@nestjs+core@11.1.9_@nestjs+common@11.1.9_class-transformer@0.5.1_class-validator@0.14.3_refl_qk4h2b4tkcnspbdlwat4iduqrm/node_modules/@nestjs/core/injector/instance-loader.js:[2m56:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[57/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22mReportsService[2m > [22mgenerateReport[2m > [22mshould generate daily report with correct metrics
[31m[1mAssertionError[22m: expected 3 to be 2 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 3[39m

[36m [2mâ¯[22m apps/api/src/modules/analytics/reports.service.spec.ts:[2m136:42[22m[39m
    [90m134| [39m      [34mexpect[39m(result[33m.[39mperiod)[33m.[39m[34mtoBe[39m([32m'HÃ ng ngÃ y'[39m)[33m;[39m
    [90m135| [39m      [34mexpect[39m(result[33m.[39mmetrics[33m.[39mtotalUsers)[33m.[39m[34mtoBe[39m([34m100[39m)[33m;[39m
    [90m136| [39m      [34mexpect[39m(result[33m.[39mmetrics[33m.[39mactiveUsers)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m137| [39m      [34mexpect[39m(result[33m.[39mmetrics[33m.[39mcompletedLessons)[33m.[39m[34mtoBe[39m([34m50[39m)[33m;[39m
    [90m138| [39m      [34mexpect[39m(result[33m.[39mmetrics[33m.[39maverageProgress)[33m.[39m[34mtoBe[39m([34m75.5[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[58/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/reports.service.spec.ts[2m > [22mReportsService[2m > [22mgenerateReport[2m > [22mshould generate monthly report with top users
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2mâ¯[22m map apps/api/src/modules/analytics/reports.service.ts:[2m276:36[22m[39m
    [90m274| [39m      userId[33m:[39m u[33m.[39mid[33m,[39m
    [90m275| [39m      points[33m:[39m u[33m.[39mpoints[33m,[39m
    [90m276| [39m      completedLessons[33m:[39m u[33m.[39mprogress[33m.[39mlength[33m,[39m
    [90m   | [39m                                   [31m^[39m
    [90m277| [39m    }))[33m;[39m
    [90m278| [39m  }
[90m [2mâ¯[22m ReportsService.getTopUsers apps/api/src/modules/analytics/reports.service.ts:[2m273:18[22m[39m
[90m [2mâ¯[22m ReportsService.generateReport apps/api/src/modules/analytics/reports.service.ts:[2m55:45[22m[39m
[90m [2mâ¯[22m apps/api/src/modules/analytics/reports.service.spec.ts:[2m200:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[59/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/analytics/user-segmentation.service.spec.ts[2m > [22mUserSegmentationService[2m > [22mComplex Multi-Criteria Filtering[2m > [22mshould handle empty result when no users match all criteria
[31m[1mTypeError[22m: activityCounts is not iterable[39m
[36m [2mâ¯[22m UserSegmentationService.filterByEngagement apps/api/src/modules/analytics/user-segmentation.service.ts:[2m162:25[22m[39m
    [90m160| [39m
    [90m161| [39m    [35mconst[39m result [33m=[39m [35mnew[39m [33mSet[39m[33m<[39mstring[33m>[39m()[33m;[39m
    [90m162| [39m    [35mfor[39m ([35mconst[39m entry [35mof[39m activityCounts) {
    [90m   | [39m                        [31m^[39m
    [90m163| [39m      [35mif[39m ([33m![39mentry[33m.[39muserId) [35mcontinue[39m[33m;[39m
    [90m164| [39m      [35mconst[39m count [33m=[39m entry[33m.[39m_count[33m.[39mid[33m;[39m
[90m [2mâ¯[22m UserSegmentationService.getUsersMatchingCriteria apps/api/src/modules/analytics/user-segmentation.service.ts:[2m127:31[22m[39m
[90m [2mâ¯[22m UserSegmentationService.updateSegment apps/api/src/modules/analytics/user-segmentation.service.ts:[2m60:19[22m[39m
[90m [2mâ¯[22m apps/api/src/modules/analytics/user-segmentation.service.spec.ts:[2m553:23[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[60/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/nudge.controller.spec.ts[2m > [22mNudgeController[2m > [22mGET /nudge/dashboard[2m > [22mshould return multiple dashboard nudges
[31m[1mAssertionError[22m: expected "spy" to be called 2 times, but got 5 times[39m
[36m [2mâ¯[22m apps/api/src/modules/nudge/nudge.controller.spec.ts:[2m86:41[22m[39m
    [90m 84| [39m      [35mconst[39m result [33m=[39m [35mawait[39m controller[33m.[39m[34mgetDashboardNudges[39m({ user[33m:[39m mockUâ€¦
    [90m 85| [39m
    [90m 86| [39m      [34mexpect[39m(nudgeEngine[33m.[39mgenerateNudge)[33m.[39m[34mtoHaveBeenCalledTimes[39m([34m2[39m)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m 87| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
    [90m 88| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[61/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mhandleStreakNudges[2m > [22mshould filter out zero-streak users
[31m[1mTypeError[22m: usersToNudge is not iterable[39m
[36m [2mâ¯[22m NudgeService.handleStreakNudges apps/api/src/modules/nudge/nudge.service.ts:[2m36:26[22m[39m
    [90m 34| [39m    })[33m;[39m
    [90m 35| [39m
    [90m 36| [39m    [35mfor[39m ([35mconst[39m streak [35mof[39m usersToNudge) {
    [90m   | [39m                         [31m^[39m
    [90m 37| [39m      [35mawait[39m [35mthis[39m[33m.[39m[34msendNudge[39m(streak)[33m;[39m
    [90m 38| [39m    }
[90m [2mâ¯[22m apps/api/src/modules/nudge/nudge.service.spec.ts:[2m91:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[62/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mhandleStreakNudges[2m > [22mshould include correct time boundaries (20-24 hours)
[31m[1mTypeError[22m: usersToNudge is not iterable[39m
[36m [2mâ¯[22m NudgeService.handleStreakNudges apps/api/src/modules/nudge/nudge.service.ts:[2m36:26[22m[39m
    [90m 34| [39m    })[33m;[39m
    [90m 35| [39m
    [90m 36| [39m    [35mfor[39m ([35mconst[39m streak [35mof[39m usersToNudge) {
    [90m   | [39m                         [31m^[39m
    [90m 37| [39m      [35mawait[39m [35mthis[39m[33m.[39m[34msendNudge[39m(streak)[33m;[39m
    [90m 38| [39m    }
[90m [2mâ¯[22m apps/api/src/modules/nudge/nudge.service.spec.ts:[2m124:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[63/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mTrigger Frequency Limits[2m > [22mshould not send nudge to same user within 24 hours
[31m[1mAssertionError[22m: expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T19:47:40.587Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m apps/api/src/modules/nudge/nudge.service.spec.ts:[2m237:52[22m[39m
    [90m235| [39m      [35mawait[39m service[33m.[39m[34mhandleStreakNudges[39m()[33m;[39m
    [90m236| [39m
    [90m237| [39m      [34mexpect[39m(prismaService[33m.[39mbehaviorLog[33m.[39mcreate)[33m.[39mnot[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                                   [31m^[39m
    [90m238| [39m    })[33m;[39m
    [90m239| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[64/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mTrigger Frequency Limits[2m > [22mshould enforce max 3 nudges per day per user
[31m[1mAssertionError[22m: expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T19:47:40.588Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m apps/api/src/modules/nudge/nudge.service.spec.ts:[2m260:52[22m[39m
    [90m258| [39m      [35mawait[39m service[33m.[39m[34mhandleStreakNudges[39m()[33m;[39m
    [90m259| [39m
    [90m260| [39m      [34mexpect[39m(prismaService[33m.[39mbehaviorLog[33m.[39mcreate)[33m.[39mnot[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                                   [31m^[39m
    [90m261| [39m    })[33m;[39m
    [90m262| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[65/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mUser Preference Overrides[2m > [22mshould respect user opt-out from nudges
[31m[1mAssertionError[22m: expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T19:47:40.592Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m apps/api/src/modules/nudge/nudge.service.spec.ts:[2m307:52[22m[39m
    [90m305| [39m      [35mawait[39m service[33m.[39m[34mhandleStreakNudges[39m()[33m;[39m
    [90m306| [39m
    [90m307| [39m      [34mexpect[39m(prismaService[33m.[39mbehaviorLog[33m.[39mcreate)[33m.[39mnot[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                                   [31m^[39m
    [90m308| [39m    })[33m;[39m
    [90m309| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[66/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mUser Preference Overrides[2m > [22mshould respect quiet hours preference
[31m[1mAssertionError[22m: expected "spy" to not be called at all, but actually been called 1 times[90m

Received: 

[1m  1st spy call:

[22m    Array [
      Object {
        "data": Object {
          "eventType": "STREAK_NUDGE_SENT",
          "path": "/nudge/streak-warning",
          "payload": Object {
            "currentStreak": 5,
            "lastActivity": 2025-12-20T19:47:40.593Z,
            "message": "Your 5-day streak is about to expire! Do a lesson now to keep it alive.",
          },
          "sessionId": "nudge-system",
          "userId": "user-1",
        },
      },
    ]
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m apps/api/src/modules/nudge/nudge.service.spec.ts:[2m329:54[22m[39m
    [90m327| [39m      [35mif[39m (currentHour [33m>=[39m [34m22[39m [33m||[39m currentHour [33m<[39m [34m8[39m) {
    [90m328| [39m        [35mawait[39m service[33m.[39m[34mhandleStreakNudges[39m()[33m;[39m
    [90m329| [39m        [34mexpect[39m(prismaService[33m.[39mbehaviorLog[33m.[39mcreate)[33m.[39mnot[33m.[39m[34mtoHaveBeenCalled[39m(â€¦
    [90m   | [39m                                                     [31m^[39m
    [90m330| [39m      }
    [90m331| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[67/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould deliver SOCIAL_PROOF nudge emphasizing competition
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould maintain high engagement for HUNTER persona
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould use competitive language for HUNTER
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould deliver LOSS_AVERSION nudge for high-risk scenarios
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould prioritize GOAL_GRADIENT for budgeting context
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould emphasize security and caution for SAVER
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould calculate progress correctly for SAVER budgeting
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould deliver default SOCIAL_PROOF nudge
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould use neutral language for OBSERVER
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould provide informative mapping for OBSERVER budgeting
[31m[1mReferenceError[22m: jest is not defined[39m
[36m [2mâ¯[22m apps/api/src/modules/nudge/personalization.service.spec.ts:[2m60:5[22m[39m
    [90m 58| [39m
    [90m 59| [39m  [34mafterEach[39m(() [33m=>[39m {
    [90m 60| [39m    jest[33m.[39m[34mclearAllMocks[39m()[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 61| [39m  })[33m;[39m
    [90m 62| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[68/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould adapt message based on risk level threshold
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould calculate real-world value mapping correctly
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould override persona logic when risk is critically high
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould maintain persona preference when risk is moderate
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle INVESTMENT_DECISION context
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle BUDGETING context
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle STREAK_WARNING context
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle SOCIAL_PROOF_REALTIME context
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould return null for unknown context
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for streak-critical situations
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for HUNTER investment decisions
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for SAVER loss aversion
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize MEDIUM for default social proof
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize LOW for OBSERVER budgeting nudges
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould fetch realtime social proof data
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould query behavior logs from last 24 hours
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould generate realtime social nudge when users are active
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould return null when no active users in last 24h
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Vietnamese translations
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide English translations
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Chinese translations
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing user gracefully
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle zero amount in budgeting
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle very large amounts in budgeting
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing data object
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle undefined risk level
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for HUNTER
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for SAVER
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould adapt dynamically to changing user behavior
[31m[1mReferenceError[22m: jest is not defined[39m
[36m [2mâ¯[22m apps/api/src/modules/nudge/personalization.service.spec.ts:[2m60:5[22m[39m
    [90m 58| [39m
    [90m 59| [39m  [34mafterEach[39m(() [33m=>[39m {
    [90m 60| [39m    jest[33m.[39m[34mclearAllMocks[39m()[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 61| [39m  })[33m;[39m
    [90m 62| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[69/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould override persona logic when risk is critically high
[31m[1mAssertionError[22m: expected 'SOCIAL_PROOF' to be 'LOSS_AVERSION' // Object.is equality[39m

Expected: [32m"LOSS_AVERSION"[39m
Received: [31m"SOCIAL_PROOF"[39m

[36m [2mâ¯[22m apps/api/src/modules/nudge/personalization.service.spec.ts:[2m239:26[22m[39m
    [90m237| [39m      })[33m;[39m
    [90m238| [39m
    [90m239| [39m      [34mexpect[39m(nudge[33m.[39mtype)[33m.[39m[34mtoBe[39m([33mNudgeType[39m[33m.[39m[33mLOSS_AVERSION[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m240| [39m      [34mexpect[39m(nudge[33m.[39mpriority)[33m.[39m[34mtoBe[39m([32m'HIGH'[39m)[33m;[39m
    [90m241| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[70/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing user gracefully
[31m[1mAssertionError[22m: promise resolved "{ type: 'SOCIAL_PROOF', â€¦(2) }" instead of rejecting[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- [Error: rejected promise][39m
[31m+ Object {[39m
[31m+   "message": Object {[39m
[31m+     "en": "85% of investors with your profile choose this diversified portfolio.",[39m
[31m+     "vi": "85% nhÃ  Ä‘áº§u tÆ° cÃ³ há»“ sÆ¡ giá»‘ng báº¡n chá»n danh má»¥c Ä‘a dáº¡ng hÃ³a nÃ y.",[39m
[31m+     "zh": "85% çš„å…·æœ‰æ‚¨èƒŒæ™¯çš„æŠ•èµ„è€…é€‰æ‹©äº†è¿™ä¸ªå¤šå…ƒåŒ–çš„æŠ•èµ„ç»„åˆã€‚",[39m
[31m+   },[39m
[31m+   "priority": "MEDIUM",[39m
[31m+   "type": "SOCIAL_PROOF",[39m
[31m+ }[39m

[36m [2mâ¯[22m apps/api/src/modules/nudge/personalization.service.spec.ts:[2m451:76[22m[39m
    [90m449| [39m
    [90m450| [39m      [35mawait[39m [34mexpect[39m(
    [90m451| [39m        service[33m.[39m[34mgenerateNudge[39m([32m'non-existent-user'[39m[33m,[39m [32m'INVESTMENT_DECISIO[39mâ€¦
    [90m   | [39m                                                                           [31m^[39m
    [90m452| [39m      )[33m.[39mrejects[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m453| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[71/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mVariable Reward Algorithms[2m > [22mshould apply RANDOM variable ratio schedule (VR-3: avg 3 actions per reward)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mVariable Reward Algorithms[2m > [22mshould apply FIXED interval schedule (FI-5: reward every 5th minute)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mVariable Reward Algorithms[2m > [22mshould calculate progressive reward multiplier based on streak
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mVariable Reward Algorithms[2m > [22mshould implement jackpot mechanic (1% chance for 10x reward)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Timing Optimization[2m > [22mshould delay reward delivery for suspense (200-500ms)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Timing Optimization[2m > [22mshould trigger reward immediately after critical milestone
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Timing Optimization[2m > [22mshould batch rewards during high-frequency actions (debounce 2s)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Timing Optimization[2m > [22mshould schedule prime-time bonuses (7-9 PM: +20% rewards)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Value Calculation[2m > [22mshould scale rewards based on user level (exponential curve)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Value Calculation[2m > [22mshould apply persona-based reward weights (HUNTER: 1.5x risk rewards)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Value Calculation[2m > [22mshould cap daily rewards to prevent exploitation (max 500 points/day)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mReward Value Calculation[2m > [22mshould calculate diminishing returns for repeated actions (5% decay per repeat)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mGamification Service Integration (Mocked)[2m > [22mshould emit points.earned event after reward distribution
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mGamification Service Integration (Mocked)[2m > [22mshould trigger nudge after reward threshold reached
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mGamification Service Integration (Mocked)[2m > [22mshould validate sufficient points before deduction
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mGamification Service Integration (Mocked)[2m > [22mshould successfully deduct points and log behavior
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mGamification Service Integration (Mocked)[2m > [22mshould handle concurrent reward distributions without race conditions
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould implement near-miss mechanic (show "almost won" at 95% threshold)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould trigger achievement unlock with celebration animation
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould implement loss aversion nudge (show potential loss: -20 points)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould apply social proof to boost motivation
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould create anticipation phase before big reward reveal (3s countdown)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould implement progress bar momentum (90% completion triggers urgency)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mDopamine-Driven Mechanics[2m > [22mshould randomize reward particle effects for variety
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mEdge Cases & Error Handling[2m > [22mshould handle negative reward values gracefully
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mEdge Cases & Error Handling[2m > [22mshould prevent reward overflow (max 999999 points)
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mEdge Cases & Error Handling[2m > [22mshould handle missing user gracefully during reward distribution
[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/reward.service.spec.ts[2m > [22mRewardDistributionSystem (Dopamine-Driven Mechanics)[2m > [22mEdge Cases & Error Handling[2m > [22mshould log simulation events without incrementing real points
[31m[1mReferenceError[22m: jest is not defined[39m
[36m [2mâ¯[22m apps/api/src/modules/nudge/reward.service.spec.ts:[2m60:5[22m[39m
    [90m 58| [39m    eventEmitter [33m=[39m module[33m.[39m[35mget[39m[33m<[39m[33mEventEmitter2[39m[33m>[39m([33mEventEmitter2[39m)[33m;[39m
    [90m 59| [39m
    [90m 60| [39m    jest[33m.[39m[34mclearAllMocks[39m()[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 61| [39m  })[33m;[39m
    [90m 62| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[72/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22mSocialProofService[2m > [22mgenerateCohortMessage - "X% of users like you"[2m > [22mshould return null if cohort has zero users
[31m[1mAssertionError[22m: expected { type: 'SOCIAL_PROOF', â€¦(3) } to be null[39m

[32m- Expected:[39m 
null

[31m+ Received:[39m 
Object {
  "message": Object {
    "en": "0% of users like you have completed this course. Join them!",
    "vi": "0% ngÆ°á»i dÃ¹ng giá»‘ng báº¡n Ä‘Ã£ hoÃ n thÃ nh khÃ³a há»c nÃ y. Tham gia ngay!",
    "zh": "0% çš„åƒæ‚¨è¿™æ ·çš„ç”¨æˆ·å·²ç»å®Œæˆäº†è¿™é—¨è¯¾ç¨‹ã€‚ç«‹å³åŠ å…¥ï¼",
  },
  "metadata": Object {
    "cohortSize": 1,
    "comparisonType": "SIMILAR_USERS",
    "percentage": 0,
  },
  "priority": "LOW",
  "type": "SOCIAL_PROOF",
}

[36m [2mâ¯[22m apps/api/src/modules/nudge/social-proof.service.spec.ts:[2m122:22[22m[39m
    [90m120| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mgenerateCohortMessage[39m([32m'u1'[39m[33m,[39m [32m'COURSE[39mâ€¦
    [90m121| [39m
    [90m122| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeNull[39m()[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m123| [39m    })[33m;[39m
    [90m124| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[73/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22mSocialProofService[2m > [22mgeneratePeerComparison - Peer ranking logic[2m > [22mshould generate congratulatory message when user is above average
[31m[1mAssertionError[22m: expected '100% ngÆ°á»i dÃ¹ng Ä‘ang dáº«n trÆ°á»›c báº¡n vá»â€¦' to contain 'vÆ°á»£t trá»™i'[39m

Expected: [32m"vÆ°á»£t trá»™i"[39m
Received: [31m"100% ngÆ°á»i dÃ¹ng Ä‘ang dáº«n trÆ°á»›c báº¡n vá» há»c táº­p. HÃ£y báº¯t ká»‹p há»!"[39m

[36m [2mâ¯[22m apps/api/src/modules/nudge/social-proof.service.spec.ts:[2m164:34[22m[39m
    [90m162| [39m      [34mexpect[39m(result[33m?.[39mmetadata[33m.[39mcomparisonType)[33m.[39m[34mtoBe[39m([32m'PEERS'[39m)[33m;[39m
    [90m163| [39m      [34mexpect[39m(result[33m?.[39mmetadata[33m.[39mpercentage)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m [90m// All peers below [39mâ€¦
    [90m164| [39m      [34mexpect[39m(result[33m?.[39mmessage[33m.[39mvi)[33m.[39m[34mtoContain[39m([32m'vÆ°á»£t trá»™i'[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m165| [39m      [34mexpect[39m(result[33m?.[39mmessage[33m.[39men)[33m.[39m[34mtoContain[39m([32m'outperforming'[39m)[33m;[39m
    [90m166| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[74/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/nudge/social-proof.service.spec.ts[2m > [22mSocialProofService[2m > [22mgeneratePeerComparison - Peer ranking logic[2m > [22mshould generate motivational message when user is below average
[31m[1mAssertionError[22m: expected 'MEDIUM' to be 'HIGH' // Object.is equality[39m

Expected: [32m"HIGH"[39m
Received: [31m"MEDIUM"[39m

[36m [2mâ¯[22m apps/api/src/modules/nudge/social-proof.service.spec.ts:[2m190:32[22m[39m
    [90m188| [39m
    [90m189| [39m      [34mexpect[39m(result[33m?.[39mmetadata[33m.[39mpercentage)[33m.[39m[34mtoBe[39m([34m100[39m)[33m;[39m [90m// All peers abov[39mâ€¦
    [90m190| [39m      [34mexpect[39m(result[33m?.[39mpriority)[33m.[39m[34mtoBe[39m([32m'HIGH'[39m)[33m;[39m [90m// Below average should b[39mâ€¦
    [90m   | [39m                               [31m^[39m
    [90m191| [39m      [34mexpect[39m(result[33m?.[39mmessage[33m.[39mvi)[33m.[39m[34mtoContain[39m([32m'dáº«n trÆ°á»›c'[39m)[33m;[39m
    [90m192| [39m      [34mexpect[39m(result[33m?.[39mmessage[33m.[39men)[33m.[39m[34mtoContain[39m([32m'ahead of you'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[75/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22mRecommendationService[2m > [22mPersona-Based Filtering[2m > [22mshould recommend risk-focused courses for HUNTER persona
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ StringContaining "HUNTER" ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   StringContaining "HUNTER",[90m
[31m+   "[90m
[31m+       System: You are an AI Financial Advisor for V-EdFinance.[90m
[31m+       User Profile: {\"riskTolerance\":\"HIGH\"}[90m
[31m+       Learning Habits: {\"peakLearningHour\":10}[90m
[31m+       Available Courses: [{\"id\":\"c1\",\"title\":{\"vi\":\"Crypto Trading\"}}][90m
[31m+       [90m
[31m+       Task: Recommend the top 2 courses for this user. [90m
[31m+       For each recommendation, provide a reason based on NUDGE theory (e.g., Social Proof, Goal Gradient).[90m
[31m+       [90m
[31m+       Format: JSON array of { \"courseId\": string, \"reason\": { \"vi\": string, \"en\": string, \"zh\": string }, \"strategy\": string }[90m
[31m+     ",[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m apps/api/src/modules/recommendations/recommendation.service.spec.ts:[2m118:44[22m[39m
    [90m116| [39m
    [90m117| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mstrategy)[33m.[39m[34mtoBe[39m([32m'PERSONA_MATCH'[39m)[33m;[39m
    [90m118| [39m      [34mexpect[39m(mockAi[33m.[39mmodel[33m.[39mgenerateContent)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                                           [31m^[39m
    [90m119| [39m        expect[33m.[39m[34mstringContaining[39m([32m'HUNTER'[39m)
    [90m120| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[76/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/recommendations/recommendation.service.spec.ts[2m > [22mRecommendationService[2m > [22mPersona-Based Filtering[2m > [22mshould recommend savings courses for SAVER persona
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ StringContaining "SAVER" ][90m

Received: 

[1m  1st spy call:

[22m[2m  Array [[22m
[32m-   StringContaining "SAVER",[90m
[31m+   "[90m
[31m+       System: You are an AI Financial Advisor for V-EdFinance.[90m
[31m+       User Profile: {\"riskTolerance\":\"LOW\"}[90m
[31m+       Learning Habits: {}[90m
[31m+       Available Courses: [{\"id\":\"c2\",\"title\":{\"vi\":\"Savings Strategies\"}}][90m
[31m+       [90m
[31m+       Task: Recommend the top 2 courses for this user. [90m
[31m+       For each recommendation, provide a reason based on NUDGE theory (e.g., Social Proof, Goal Gradient).[90m
[31m+       [90m
[31m+       Format: JSON array of { \"courseId\": string, \"reason\": { \"vi\": string, \"en\": string, \"zh\": string }, \"strategy\": string }[90m
[31m+     ",[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mâ¯[22m apps/api/src/modules/recommendations/recommendation.service.spec.ts:[2m155:44[22m[39m
    [90m153| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mgetPersonalizedRecommendations[39m([32m'u1'[39mâ€¦
    [90m154| [39m
    [90m155| [39m      [34mexpect[39m(mockAi[33m.[39mmodel[33m.[39mgenerateContent)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                                           [31m^[39m
    [90m156| [39m        expect[33m.[39m[34mstringContaining[39m([32m'SAVER'[39m)
    [90m157| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[77/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/social/social.controller.spec.ts[2m > [22mSocialController[2m > [22mGuard Protection[2m > [22mshould protect all endpoints with JwtAuthGuard
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2mâ¯[22m apps/api/src/modules/social/social.controller.spec.ts:[2m287:26[22m[39m
    [90m285| [39m        [35mconst[39m guards [33m=[39m [33mReflect[39m[33m.[39m[34mgetMetadata[39m([32m'__guards__'[39m[33m,[39m [33mSocialControl[39mâ€¦
    [90m286| [39m        [35mif[39m (endpoint [33m!==[39m [32m'getGroupDetails'[39m) {
    [90m287| [39m          [34mexpect[39m(guards)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m288| [39m        }
    [90m289| [39m      }

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[78/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/social/social.service.spec.ts[2m > [22mSocialService[2m > [22mChallenge Progress Tracking (S005)[2m > [22mshould handle challenge with no members
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[36m [2mâ¯[22m apps/api/src/modules/social/social.service.spec.ts:[2m393:54[22m[39m
    [90m391| [39m
    [90m392| [39m            [35mawait[39m service[33m.[39m[34mcheckChallengeProgress[39m([32m'c1'[39m)[33m;[39m
    [90m393| [39m            [34mexpect[39m(mockPrisma[33m.[39mbuddyChallenge[33m.[39m[35mdelete[39m)[33m.[39m[34mtoHaveBeenCalled[39m(â€¦
    [90m   | [39m                                                     [31m^[39m
    [90m394| [39m        })[33m;[39m
    [90m395| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[79/172]âŽ¯[22m[39m

[31m[1m[7m FAIL [27m[22m[39m apps/api/src/modules/social/social.service.spec.ts[2m > [22mSocialService[2m > [22mWebSocket Broadcast Integration (S005)[2m > [22mshould handle broadcast failure gracefully
[31m[1mAssertionError[22m: promise resolved "{ id: 'p1', userId: 'u1', â€¦(1) }" instead of rejecting[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- [Error: rejected promise][39m
[31m+ Object {[39m
[31m+   "id": "p1",[39m
[31m+   "type": "DISCUSSION",[39m
[31m+   "userId": "u1",[39m
[31m+ }[39m

[36m [2mâ¯[22m apps/api/src/modules/social/social.service.spec.ts:[2m475:100[22m[39m
    [90m473| [39m
    [90m474| [39m            [35mawait[39m [34mexpect[39m(
    [90m475| [39m                service[33m.[39m[34mcreatePost[39m([32m'u1'[39m[33m,[39m [33mPostType[39m[33m.[39m[33mDISCUSSION[39m[33m,[39m { vi[33m:[39m [32m'T[39mâ€¦
    [90m   | [39m                                                                                                   [31m^[39m
    [90m476| [39m            )[33m.[39mrejects[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m477| [39m        })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[80/172]âŽ¯[22m[39m

[2m Test Files [22m [1m[31m43 failed[39m[22m[2m | [22m[1m[32m74 passed[39m[22m[90m (117)[39m
[2m      Tests [22m [1m[31m145 failed[39m[22m[2m | [22m[1m[32m1557 passed[39m[22m[2m | [22m[33m49 skipped[39m[90m (1751)[39m
[2m   Start at [22m 00:47:29
[2m   Duration [22m 110.94s[2m (transform 2.05s, setup 477ms, collect 7.42s, tests 93.32s, environment 0ms, prepare 129ms)[22m

[1m[7m[31m FAIL [39m[27m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
