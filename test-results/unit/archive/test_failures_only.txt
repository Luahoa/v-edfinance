[31m     â†’ expected 0.882 to be less than 0.75[39m
Error: Database error
Error: Delete failed
[31m     â†’ expected 3 to be 2 // Object.is equality[39m
[31m     â†’ expected error to be instance of ForbiddenException[39m
[31m     â†’ expected undefined to be false // Object.is equality[39m
[31m     â†’ expected undefined to be false // Object.is equality[39m
[31m     â†’ expected undefined to be false // Object.is equality[39m
[31m     â†’ expected "spy" to be called at least once[39m
[31m     â†’ expected 9.549999999999999 to be 9.55 // Object.is equality[39m
[22m[39mAI Error in generateResponse: Network timeout Error: Network timeout
[31m     â†’ expected { type: 'SOCIAL_PROOF', â€¦(3) } to be null[39m
[31m     â†’ expected '100% ngÆ°á»i dÃ¹ng Ä‘ang dáº«n trÆ°á»›c báº¡n vá»â€¦' to contain 'vÆ°á»£t trá»™i'[39m
[31m     â†’ expected 'MEDIUM' to be 'HIGH' // Object.is equality[39m
[31m     â†’ expected [Function] to throw error including 'DB connection lost' but got 'Cannot read properties of undefined (â€¦'[39m
[31m     â†’ expected 32.5 to be 65 // Object.is equality[39m
[31m     â†’ expected { totalClicks: 50, â€¦(3) } to deeply equal { totalClicks: 50, â€¦(3) }[39m
[31m     â†’ expected error to be instance of UnauthorizedException[39m
[31m     â†’ expected "spy" to not be called at all, but actually been called 1 times[90m
[31m     â†’ expected "spy" to not be called at all, but actually been called 1 times[90m
[31m     â†’ expected "spy" to not be called at all, but actually been called 1 times[90m
[31m     â†’ expected 'STAY' to be 'REINFORCE' // Object.is equality[39m
[90mstdout[2m | src/ai/ai.controller.spec.ts[2m > [22m[2mAiController[2m > [22m[2mError Response Handling[2m > [22m[2mshould handle unexpected errors
[31m     â†’ expected "spy" to be called with arguments: [ StringContaining "HUNTER" ][90m
[31m     â†’ expected "spy" to be called with arguments: [ StringContaining "SAVER" ][90m
[31m     â†’ expected "spy" to be called at least once[39m
[31m     â†’ expected "spy" to be called at least once[39m
[31m     â†’ expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m
Error: DB Error
[31m     â†’ expected undefined to be defined[39m
[31m     â†’ expected "spy" to be called 2 times, but got 5 times[39m
[31m     â†’ expected 'not ready' to be 'ready' // Object.is equality[39m
[31m     â†’ expected "spy" to be called at least once[39m
[31m     â†’ expected 'not ready' to be 'ready' // Object.is equality[39m
[31m     â†’ expected "spy" to be called with arguments: [ ArrayContaining ["SELECT 1"] ][90m
[31m     â†’ expected 'not ready' to be 'ready' // Object.is equality[39m
[31m     â†’ expected [Function] to throw error including 'Query failed' but got 'Cannot read properties of undefined (â€¦'[39m
[31m     â†’ expected error to be instance of UnauthorizedException[39m
[31m[Nest] 9328  - [39m12/21/2025, 9:57:05 PM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39m[31mFailed to load system settings (Reference Error expected if DB not running)[39m
[31m[Nest] 9328  - [39m12/21/2025, 9:57:05 PM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39mError: Database connection failed
[31m[Nest] 9328  - [39m12/21/2025, 9:57:05 PM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39m[31mFailed to load system settings (Reference Error expected if DB not running)[39m
[31m[Nest] 9328  - [39m12/21/2025, 9:57:05 PM [31m  ERROR[39m [38;5;3m[DynamicConfigService] [39mError: Database error
[31m[Nest] 9328  - [39m12/21/2025, 9:57:05 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: File not found: missing.txt
[31m[Nest] 9328  - [39m12/21/2025, 9:57:05 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Storage error
[31m[Nest] 9328  - [39m12/21/2025, 9:57:05 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: List error
[31m[Nest] 9328  - [39m12/21/2025, 9:57:05 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Upload failed
[31m[Nest] 9328  - [39m12/21/2025, 9:57:05 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Download failed
[31m[Nest] 9328  - [39m12/21/2025, 9:57:05 PM [31m  ERROR[39m [38;5;3m[UnstorageService] [39mError: Delete failed
[31m     â†’ expected 0 to be greater than 0[39m
[31m     â†’ expected {} to have property "type"[39m
[31m     â†’ expected [Function] to throw error including 'Service down' but got 'Cannot read properties of undefined (â€¦'[39m
Error: Unexpected error
[31m[Nest] 9328  - [39m12/21/2025, 9:57:45 PM [31m  ERROR[39m [38;5;3m[ExceptionsHandler] [39mPrismaClientInitializationError: 
[31m[Nest] 9328  - [39m12/21/2025, 9:57:49 PM [31m  ERROR[39m [38;5;3m[ExceptionsHandler] [39mPrismaClientInitializationError: Can't reach database server at `localhost:5432`
[31m     â†’ expected 201 "Created", got 500 "Internal Server Error"[39m
[31m     â†’ expected 200 "OK", got 401 "Unauthorized"[39m
[31m     â†’ expected 200 "OK", got 401 "Unauthorized"[39m
[31m     â†’ expected 200 "OK", got 400 "Bad Request"[39m
[31m     â†’ expected 401 "Unauthorized", got 500 "Internal Server Error"[39m
[31m[Nest] 9328  - [39m12/21/2025, 9:57:53 PM [31m  ERROR[39m [38;5;3m[StorageService] [39mError: Upload failed
[31m[Nest] 9328  - [39m12/21/2025, 9:57:53 PM [31m  ERROR[39m [38;5;3m[StorageService] [39mError: Presigner error
[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration
[31m[1m[7m FAIL [27m[22m[39m test/course-progress.integration.spec.ts[2m > [22mCourse Learning Flow (Integration)
[31m[1m[7m FAIL [27m[22m[39m test/course-progress.integration.spec.ts[2m > [22mCourse Learning Flow (Integration)
[31m[1m[7m FAIL [27m[22m[39m test/example-usage.e2e-spec.ts[2m > [22mExample: Test Helpers Usage (E2E)
[31m[1m[7m FAIL [27m[22m[39m test/system-resilience.e2e-spec.ts[2m > [22mSystem Resilience (e2e)
[31m[1m[7m FAIL [27m[22m[39m test/example-usage.e2e-spec.ts[2m > [22mExample: Test Helpers Usage (E2E)
[31m[1m[7m FAIL [27m[22m[39m test/massive-stress.e2e-spec.ts[2m > [22mMassive Persona Stress Test (1000+ Actions Simulation)
[31m[1m[7m FAIL [27m[22m[39m test/massive-stress.e2e-spec.ts[2m > [22mMassive Persona Stress Test (1000+ Actions Simulation)
[31m[1m[7m FAIL [27m[22m[39m test/multi-market-stress.e2e-spec.ts[2m > [22mMulti-Market Market Stress Test (VI/EN/ZH Localized Content)
[31m[1m[7m FAIL [27m[22m[39m test/multi-market-stress.e2e-spec.ts[2m > [22mMulti-Market Market Stress Test (VI/EN/ZH Localized Content)
[31m[1m[7m FAIL [27m[22m[39m test/persona-simulation.e2e-spec.ts[2m > [22mDeep Persona Simulation (Whale vs Risk-Averse)
[31m[1m[7m FAIL [27m[22m[39m test/persona-simulation.e2e-spec.ts[2m > [22mDeep Persona Simulation (Whale vs Risk-Averse)
[31m[1m[7m FAIL [27m[22m[39m src/ai/ai.integration.spec.ts[2m > [22mAI Module - Integration Tests
[31m[1m[7m FAIL [27m[22m[39m src/ai/ai.integration.spec.ts[2m > [22mAI Module - Integration Tests
[31m[1m[7m FAIL [27m[22m[39m src/users/users.service.spec.ts[2m [ src/users/users.service.spec.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m test/integration/admin-dashboard.integration.spec.ts[2m [ test/integration/admin-dashboard.integration.spec.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m test/integration/ai-course-flow.e2e-spec.ts[2m > [22mAI & Course Integration (e2e)
[31m[1m[7m FAIL [27m[22m[39m test/integration/auth-flow.e2e-spec.ts[2m > [22mAuth Integration (e2e)
[31m[1m[7m FAIL [27m[22m[39m test/integration/auth-flow.e2e-spec.ts[2m > [22mAuth Integration (e2e)
[31m[1m[7m FAIL [27m[22m[39m test/integration/disaster-recovery.integration.spec.ts[2m [ test/integration/disaster-recovery.integration.spec.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m test/integration/multi-device-sync.integration.spec.ts[2m [ test/integration/multi-device-sync.integration.spec.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m test/integration/recommendation-refresh.integration.spec.ts[2m [ test/integration/recommendation-refresh.integration.spec.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m test/integration/security-audit-trail.integration.spec.ts[2m [ test/integration/security-audit-trail.integration.spec.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m test/integration/user-lifecycle.integration.spec.ts[2m [ test/integration/user-lifecycle.integration.spec.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge-scheduler.service.spec.ts[2m [ src/modules/nudge/nudge-scheduler.service.spec.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/reward.service.spec.ts[2m [ src/modules/nudge/reward.service.spec.ts ][22m
[31m[1m[7m FAIL [27m[22m[39m test/admin-integrity.e2e-spec.ts[2m > [22mPHÆ¯Æ NG ÃN 3: Admin Integrity Audit[2m > [22mHá»‡ thá»‘ng pháº£i vÆ°á»£t qua bÃ i kiá»ƒm tra tÃ­nh toÃ n váº¹n (Integrity Check)
[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration[2m > [22m1. Register â†’ Login â†’ Get Profile
[31m[1mError[22m: expected 201 "Created", got 500 "Internal Server Error"[39m
[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration[2m > [22m2. Update Profile (Multi-locale)
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration[2m > [22m3. Change Password
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration[2m > [22m4. Token Refresh Logic
[31m[1mError[22m: expected 200 "OK", got 400 "Bad Request"[39m
[31m[1m[7m FAIL [27m[22m[39m test/auth-profile.integration.spec.ts[2m > [22mAuth & Profile Integration[2m > [22m5. Token Reuse Detection (Security)
[31m[1mError[22m: expected 401 "Unauthorized", got 500 "Internal Server Error"[39m
[31m[1m[7m FAIL [27m[22m[39m test/behavioral-stress.e2e-spec.ts[2m > [22mPHÆ¯Æ NG ÃN 2: Behavioral Stress Test (E2B Inspired)[2m > [22mNÃªn giáº£ láº­p thÃ nh cÃ´ng 50 hÃ nh vi ngÆ°á»i dÃ¹ng mÃ  khÃ´ng cÃ³ lá»—i schema
[31m[1m[7m FAIL [27m[22m[39m src/auth/auth.service.spec.ts[2m > [22mAuthService[2m > [22mToken Rotation Edge Cases (S001)[2m > [22mshould reject refresh token exactly at expiry boundary
[31m[1mAssertionError[22m: expected error to be instance of UnauthorizedException[39m
[TypeError: tx.refreshToken.update is not a function]
[31m[1m[7m FAIL [27m[22m[39m src/behavior/behavior.controller.spec.ts[2m > [22mBehaviorController (Gamification)[2m > [22mgetMyHistory - Behavior Analytics[2m > [22mshould throw UnauthorizedException for missing auth
[Error: rejected promise]
[31m[1m[7m FAIL [27m[22m[39m src/common/gamification.service.spec.ts[2m > [22mGamificationService (Pure Unit Test)[2m > [22mDeduction Edge Cases (S004)[2m > [22mshould emit deduction event
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /ready[2m > [22mshould return ready status when DB is connected
[31m[1mAssertionError[22m: expected 'not ready' to be 'ready' // Object.is equality[39m
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /ready[2m > [22mshould execute DB connectivity check
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /ready[2m > [22mshould retry on transient failures
[31m[1mAssertionError[22m: expected 'not ready' to be 'ready' // Object.is equality[39m
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return user count
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return course count
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return behavior log count
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould return timestamp
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould fetch all metrics in parallel
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould handle zero counts
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mGET /metrics[2m > [22mshould handle large counts
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mDB Connectivity[2m > [22mshould verify Prisma connection
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ ArrayContaining ["SELECT 1"] ][90m
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mService Status[2m > [22mshould indicate healthy service
[31m[1mAssertionError[22m: expected 'not ready' to be 'ready' // Object.is equality[39m
[31m[1m[7m FAIL [27m[22m[39m src/common/health.controller.spec.ts[2m > [22mHealthController (C015)[2m > [22mError Handling[2m > [22mshould handle metrics query failures
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Query failed' but got 'Cannot read properties of undefined (â€¦'[39m
[31m[1m[7m FAIL [27m[22m[39m src/users/users.controller.spec.ts[2m > [22mUsersController[2m > [22mgetProfile[2m > [22mshould throw UnauthorizedException when userId is missing
[31m[1mAssertionError[22m: expected error to be instance of UnauthorizedException[39m
[31m[1m[7m FAIL [27m[22m[39m src/users/users.controller.spec.ts[2m > [22mUsersController[2m > [22mupdateInvestmentProfile[2m > [22mshould handle partial updates
[31m[1m[7m FAIL [27m[22m[39m test/integration/behavior-flow.e2e-spec.ts[2m > [22mBehavior & Gamification Integration (e2e)[2m > [22mBehavior Tracking[2m > [22mshould retrieve behavior logs for user
[31m[1mAssertionError[22m: expected 0 to be greater than 0[39m
[31m[1m[7m FAIL [27m[22m[39m test/integration/behavior-flow.e2e-spec.ts[2m > [22mBehavior & Gamification Integration (e2e)[2m > [22mGamification & Streaks[2m > [22mshould trigger a nudge check (social proof)
[31m[1mAssertionError[22m: expected {} to have property "type"[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/adaptive-difficulty.service.spec.ts[2m > [22mAdaptiveDifficultyService[2m > [22mDifficulty Adjustment Algorithms[2m > [22madjustLearningPath[2m > [22mshould handle score of 0
[31m[1mAssertionError[22m: expected 'STAY' to be 'REINFORCE' // Object.is equality[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould return cached response on cache hit for GENERAL_FAQ
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould make AI call on cache miss for GENERAL_FAQ
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Hit/Miss Logic[2m > [22mshould skip cache for PERSONALIZED_ADVICE queries
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mTTL Expiration[2m > [22mshould set cache with 24-hour TTL for FAQ responses
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mTTL Expiration[2m > [22mshould handle expired cache gracefully (cache miss scenario)
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mCache Invalidation[2m > [22mshould re-cache response after invalidation
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mEdge Cases & Error Handling[2m > [22mshould save both user and assistant messages when cache hit occurs
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/ai-cache.service.spec.ts[2m > [22mAiService - Cache Layer[2m > [22mEdge Cases & Error Handling[2m > [22mshould track token usage in behavior logs after AI call
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould increment strike count for HIGH severity violations
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould ban user after 3 CRITICAL violations
[31m[1mAssertionError[22m: expected error to be instance of ForbiddenException[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mUser Strike System[2m > [22mshould not count LOW severity towards strikes
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock OpenAI Moderation API response
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock Google Perspective API response
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/ai/moderation.service.spec.ts[2m > [22mModerationService (AI Content Moderation)[2m > [22mmoderateContent[2m > [22mAI API Mocking[2m > [22mshould mock custom Gemini Moderation API
[31m[1mAssertionError[22m: expected undefined to be false // Object.is equality[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/ab-testing.service.spec.ts[2m > [22mABTestingService - A/B Testing Framework[2m > [22mVariant Assignment[2m > [22mshould distribute variants according to weight ratios
[31m[1mAssertionError[22m: expected 0.882 to be less than 0.75[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mhandleLogAggregation[2m > [22mshould handle empty log set gracefully
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mhandleLogAggregation[2m > [22mshould delete logs older than 30 days
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mBehavior Log Archiving[2m > [22mshould archive logs in batches based on age threshold
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ ObjectContaining{â€¦} ][90m
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/analytics.service.spec.ts[2m > [22mAnalyticsService[2m > [22mBehavior Log Archiving[2m > [22mshould preserve recent logs during archiving
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/heatmap.service.spec.ts[2m > [22mHeatmapService[2m > [22manalyzeScrollDepth[2m > [22mshould skip events without scrollPercentage
[31m[1mAssertionError[22m: expected 32.5 to be 65 // Object.is equality[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/heatmap.service.spec.ts[2m > [22mHeatmapService[2m > [22manalyzeUserEngagement[2m > [22mshould calculate comprehensive engagement metrics
[31m[1mAssertionError[22m: expected { totalClicks: 50, â€¦(3) } to deeply equal { totalClicks: 50, â€¦(3) }[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/metrics.service.spec.ts[2m > [22mMetricsService[2m > [22mcalculateRetention[2m > [22mshould handle empty cohort
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/metrics.service.spec.ts[2m > [22mMetricsService[2m > [22mcalculatePercentile[2m > [22mshould calculate 95th percentile correctly
[31m[1mAssertionError[22m: expected 9.549999999999999 to be 9.55 // Object.is equality[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould collect real-time metrics from last 10 minutes
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould handle zero events gracefully
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould update Prometheus gauges on metrics collection
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mLive Metric Updates[2m > [22mshould export metrics in Prometheus format
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould track active WebSocket connections
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould broadcast real-time events to all connected clients
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould send targeted events to specific users
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould broadcast to groups (rooms)
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mWebSocket Event Streaming[2m > [22mshould handle client disconnection and cleanup
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould aggregate behavior logs efficiently for daily archival
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould perform health check aggregation every hour
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould calculate global system stats efficiently
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould analyze user learning habits from behavior logs
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mData Aggregation Performance[2m > [22mshould handle empty user learning habits
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould generate mock behavioral data for stress testing
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould run AI stress test with different complexity levels
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould handle AI stress test failures gracefully
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mMock Real-Time Data Sources[2m > [22mshould simulate complete user flow for integration testing
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould run comprehensive diagnostics with all subsystems
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould detect database connection failure in diagnostics
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould validate JSONB schema integrity
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mFull System Diagnostics Integration[2m > [22mshould warn on JSONB schema drift
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mPerformance Benchmarks[2m > [22mshould complete metrics collection in under 100ms (mocked)
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mPerformance Benchmarks[2m > [22mshould handle high-volume log aggregation efficiently
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as HUNTER (risk-taker)
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as SAVER (conservative)
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/realtime-dashboard.service.spec.ts[2m > [22mRealtimeDashboardService (Integration)[2m > [22mUser Persona Classification[2m > [22mshould classify user as OBSERVER (default)
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/reports.service.spec.ts[2m > [22mReportsService[2m > [22mgenerateReport[2m > [22mshould generate daily report with correct metrics
[31m[1mAssertionError[22m: expected 3 to be 2 // Object.is equality[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/reports.service.spec.ts[2m > [22mReportsService[2m > [22mgenerateReport[2m > [22mshould generate monthly report with top users
[31m[1m[7m FAIL [27m[22m[39m src/modules/analytics/user-segmentation.service.spec.ts[2m > [22mUserSegmentationService[2m > [22mComplex Multi-Criteria Filtering[2m > [22mshould handle empty result when no users match all criteria
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould generate GAIN-framed message with positive outcome emphasis
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould generate LOSS-framed message with loss aversion emphasis
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould use GAIN framing for opportunity contexts
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mGain vs Loss Framing[2m > [22mshould use LOSS framing for risk scenarios
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mDefault Effect Logic[2m > [22mshould apply DEFAULT framing and select based on context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould generate Vietnamese framed message
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould generate English framed message
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould generate Chinese framed message
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould fallback to Vietnamese if locale is invalid
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould get all localized templates for a context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mLocalization (vi/en/zh)[2m > [22mshould handle parameter interpolation in all locales
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould correctly interpolate amount parameter
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould correctly interpolate days parameter
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould correctly interpolate count parameter
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mMessage Template Mocking[2m > [22mshould handle multiple parameters in template
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould assign variant from A/B test when experimentId is provided
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould use original framing if no A/B test assignment
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould work without experimentId (no A/B testing)
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould track variant assignment for analytics
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mA/B Testing Integration[2m > [22mshould handle A/B test error gracefully
[31m[1mAssertionError[22m: expected [Function] to throw error including 'DB connection lost' but got 'Cannot read properties of undefined (â€¦'[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mEdge Cases & Error Handling[2m > [22mshould handle missing parameters gracefully
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mEdge Cases & Error Handling[2m > [22mshould handle empty locale with fallback
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mEdge Cases & Error Handling[2m > [22mshould return valid message key when translation not found
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mCoverage Edge Cases (85%+ Target)[2m > [22mshould handle null params in generateFramedMessage
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mCoverage Edge Cases (85%+ Target)[2m > [22mshould generate consistent messages for same inputs
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/framing.service.spec.ts[2m > [22mFramingService - Message Framing with Nudge Theory[2m > [22mCoverage Edge Cases (85%+ Target)[2m > [22mshould handle concurrent framing requests
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.controller.spec.ts[2m > [22mNudgeController[2m > [22mGET /nudge/dashboard[2m > [22mshould return multiple dashboard nudges
[31m[1mAssertionError[22m: expected "spy" to be called 2 times, but got 5 times[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mhandleStreakNudges[2m > [22mshould filter out zero-streak users
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mhandleStreakNudges[2m > [22mshould include correct time boundaries (20-24 hours)
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mTrigger Frequency Limits[2m > [22mshould not send nudge to same user within 24 hours
[31m[1mAssertionError[22m: expected "spy" to not be called at all, but actually been called 1 times[90m
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mTrigger Frequency Limits[2m > [22mshould enforce max 3 nudges per day per user
[31m[1mAssertionError[22m: expected "spy" to not be called at all, but actually been called 1 times[90m
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/nudge.service.spec.ts[2m > [22mNudgeService[2m > [22mUser Preference Overrides[2m > [22mshould respect user opt-out from nudges
[31m[1mAssertionError[22m: expected "spy" to not be called at all, but actually been called 1 times[90m
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould deliver SOCIAL_PROOF nudge emphasizing competition
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould maintain high engagement for HUNTER persona
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould use competitive language for HUNTER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould deliver LOSS_AVERSION nudge for high-risk scenarios
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould prioritize GOAL_GRADIENT for budgeting context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould emphasize security and caution for SAVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould calculate progress correctly for SAVER budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould deliver default SOCIAL_PROOF nudge
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould use neutral language for OBSERVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould provide informative mapping for OBSERVER budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould deliver SOCIAL_PROOF nudge emphasizing competition
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould maintain high engagement for HUNTER persona
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mHUNTER Persona (Risk-Taker)[2m > [22mshould use competitive language for HUNTER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould deliver LOSS_AVERSION nudge for high-risk scenarios
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould prioritize GOAL_GRADIENT for budgeting context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould emphasize security and caution for SAVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mSAVER Persona (Conservative)[2m > [22mshould calculate progress correctly for SAVER budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould deliver default SOCIAL_PROOF nudge
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould use neutral language for OBSERVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mPersona-Based Nudging[2m > [22mOBSERVER Persona (Passive)[2m > [22mshould provide informative mapping for OBSERVER budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould adapt message based on risk level threshold
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould calculate real-world value mapping correctly
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould override persona logic when risk is critically high
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould maintain persona preference when risk is moderate
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle INVESTMENT_DECISION context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle BUDGETING context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle STREAK_WARNING context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle SOCIAL_PROOF_REALTIME context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould return null for unknown context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for streak-critical situations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for HUNTER investment decisions
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for SAVER loss aversion
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize MEDIUM for default social proof
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize LOW for OBSERVER budgeting nudges
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould fetch realtime social proof data
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould query behavior logs from last 24 hours
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould generate realtime social nudge when users are active
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould return null when no active users in last 24h
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Vietnamese translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide English translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Chinese translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing user gracefully
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle zero amount in budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle very large amounts in budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing data object
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle undefined risk level
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for HUNTER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for SAVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould adapt dynamically to changing user behavior
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould adapt message based on risk level threshold
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould calculate real-world value mapping correctly
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould override persona logic when risk is critically high
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mBehavior-Adaptive Messaging[2m > [22mshould maintain persona preference when risk is moderate
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle INVESTMENT_DECISION context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle BUDGETING context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle STREAK_WARNING context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould handle SOCIAL_PROOF_REALTIME context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mContext-Specific Triggers[2m > [22mshould return null for unknown context
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for streak-critical situations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for HUNTER investment decisions
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize HIGH for SAVER loss aversion
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize MEDIUM for default social proof
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEngagement Optimization[2m > [22mshould prioritize LOW for OBSERVER budgeting nudges
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould fetch realtime social proof data
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould query behavior logs from last 24 hours
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould generate realtime social nudge when users are active
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mRealtime Social Proof[2m > [22mshould return null when no active users in last 24h
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Vietnamese translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide English translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mMulti-Language Support[2m > [22mshould provide Chinese translations
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing user gracefully
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle zero amount in budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle very large amounts in budgeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle missing data object
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mEdge Cases[2m > [22mshould handle undefined risk level
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for HUNTER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould deliver cohesive persona journey for SAVER
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/personalization.service.spec.ts[2m > [22mNudgeEngineService - Personalization[2m > [22mIntegration Scenarios[2m > [22mshould adapt dynamically to changing user behavior
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/social-proof.service.spec.ts[2m > [22mSocialProofService[2m > [22mgenerateCohortMessage - "X% of users like you"[2m > [22mshould return null if cohort has zero users
[31m[1mAssertionError[22m: expected { type: 'SOCIAL_PROOF', â€¦(3) } to be null[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/social-proof.service.spec.ts[2m > [22mSocialProofService[2m > [22mgeneratePeerComparison - Peer ranking logic[2m > [22mshould generate congratulatory message when user is above average
[31m[1mAssertionError[22m: expected '100% ngÆ°á»i dÃ¹ng Ä‘ang dáº«n trÆ°á»›c báº¡n vá»â€¦' to contain 'vÆ°á»£t trá»™i'[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/nudge/social-proof.service.spec.ts[2m > [22mSocialProofService[2m > [22mgeneratePeerComparison - Peer ranking logic[2m > [22mshould generate motivational message when user is below average
[31m[1mAssertionError[22m: expected 'MEDIUM' to be 'HIGH' // Object.is equality[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/recommendations/recommendation.service.spec.ts[2m > [22mRecommendationService[2m > [22mPersona-Based Filtering[2m > [22mshould recommend risk-focused courses for HUNTER persona
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ StringContaining "HUNTER" ][90m
[31m[1m[7m FAIL [27m[22m[39m src/modules/recommendations/recommendation.service.spec.ts[2m > [22mRecommendationService[2m > [22mPersona-Based Filtering[2m > [22mshould recommend savings courses for SAVER persona
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ StringContaining "SAVER" ][90m
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22msendNotification[2m > [22mshould send push notification via SocialService
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22msendNotification[2m > [22mshould broadcast notification via WebSocket
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22msendNotification[2m > [22mshould handle notification with empty body
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22msendNotification[2m > [22mshould handle notification errors gracefully
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Service down' but got 'Cannot read properties of undefined (â€¦'[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22msendNotification[2m > [22mshould send notifications to multiple users
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22mWebSocket broadcast validation[2m > [22mshould validate WebSocket room targeting
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22mEdge Cases[2m > [22mshould handle special characters in notification content
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22mEdge Cases[2m > [22mshould handle very long notification bodies
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/notification.controller.spec.ts[2m > [22mNotificationController (C011)[2m > [22mEdge Cases[2m > [22mshould handle concurrent notifications
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/social.controller.spec.ts[2m > [22mSocialController[2m > [22mGuard Protection[2m > [22mshould protect all endpoints with JwtAuthGuard
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/social.service.spec.ts[2m > [22mSocialService[2m > [22mChallenge Progress Tracking (S005)[2m > [22mshould handle challenge with no members
[31m[1mAssertionError[22m: expected "spy" to be called at least once[39m
[31m[1m[7m FAIL [27m[22m[39m src/modules/social/social.service.spec.ts[2m > [22mSocialService[2m > [22mWebSocket Broadcast Integration (S005)[2m > [22mshould handle broadcast failure gracefully
[32m- [Error: rejected promise][39m
â€‰ERR_PNPM_RECURSIVE_RUN_FIRST_FAILâ€‰ api@0.0.1 test: `vitest run`
