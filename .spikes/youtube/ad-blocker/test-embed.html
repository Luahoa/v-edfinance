<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Embed Ad Blocker Detection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
        }
        .test-container {
            margin: 20px 0;
            border: 2px solid #ccc;
            padding: 20px;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .fallback-ui {
            background: #f8f9fa;
            border: 2px dashed #6c757d;
            padding: 30px;
            text-align: center;
            border-radius: 8px;
            display: none;
        }
        .fallback-ui.active {
            display: block;
        }
        iframe {
            width: 100%;
            height: 400px;
            border: none;
        }
    </style>
</head>
<body>
    <h1>YouTube Embed Ad Blocker Detection</h1>
    <p><strong>Test Instructions:</strong> Enable/disable uBlock Origin and reload to see detection in action.</p>
    
    <div class="test-container">
        <h2>Method 1: iframe.onError Event</h2>
        <div id="status-1" class="status warning">Testing...</div>
        <div id="iframe-container-1">
            <iframe 
                id="yt-iframe-1"
                src="https://www.youtube.com/embed/dQw4w9WgXcQ"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen>
            </iframe>
        </div>
        <div id="fallback-1" class="fallback-ui">
            <h3>üö´ Video Unavailable</h3>
            <p>The YouTube video couldn't be loaded. This might be due to:</p>
            <ul style="text-align: left; display: inline-block;">
                <li>Ad blocker or privacy extension</li>
                <li>Network restrictions</li>
                <li>Browser security settings</li>
            </ul>
            <p><a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank">Watch on YouTube ‚Üí</a></p>
        </div>
    </div>

    <div class="test-container">
        <h2>Method 2: Load Timeout (3s)</h2>
        <div id="status-2" class="status warning">Testing...</div>
        <div id="iframe-container-2">
            <iframe 
                id="yt-iframe-2"
                src="https://www.youtube.com/embed/dQw4w9WgXcQ"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen>
            </iframe>
        </div>
        <div id="fallback-2" class="fallback-ui">
            <h3>‚è±Ô∏è Loading Timeout</h3>
            <p>The video is taking too long to load.</p>
            <p><a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank">Open in YouTube ‚Üí</a></p>
        </div>
    </div>

    <div class="test-container">
        <h2>Method 3: YouTube API Ready Check</h2>
        <div id="status-3" class="status warning">Testing...</div>
        <div id="iframe-container-3">
            <div id="yt-player-3"></div>
        </div>
        <div id="fallback-3" class="fallback-ui">
            <h3>üé• Player Initialization Failed</h3>
            <p>YouTube player could not initialize.</p>
            <p><a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank">Watch directly on YouTube ‚Üí</a></p>
        </div>
    </div>

    <div class="test-container">
        <h2>Method 4: Network Request Detection</h2>
        <div id="status-4" class="status warning">Testing...</div>
        <div id="result-4"></div>
    </div>

    <script>
        // Method 1: iframe onerror (Limited effectiveness)
        const iframe1 = document.getElementById('yt-iframe-1');
        const status1 = document.getElementById('status-1');
        const fallback1 = document.getElementById('fallback-1');
        const container1 = document.getElementById('iframe-container-1');

        iframe1.onerror = function() {
            status1.className = 'status error';
            status1.textContent = '‚ùå FAILED: iframe.onError triggered';
            container1.style.display = 'none';
            fallback1.classList.add('active');
        };

        iframe1.onload = function() {
            status1.className = 'status success';
            status1.textContent = '‚úÖ LOADED: iframe.onload triggered (Note: May still be blocked by ad blocker)';
        };

        // Method 2: Load timeout
        const iframe2 = document.getElementById('yt-iframe-2');
        const status2 = document.getElementById('status-2');
        const fallback2 = document.getElementById('fallback-2');
        const container2 = document.getElementById('iframe-container-2');

        let loaded2 = false;
        iframe2.onload = function() {
            loaded2 = true;
            status2.className = 'status success';
            status2.textContent = '‚úÖ LOADED: iframe loaded within timeout';
        };

        setTimeout(() => {
            if (!loaded2) {
                status2.className = 'status error';
                status2.textContent = '‚ùå TIMEOUT: iframe did not load in 3s';
                container2.style.display = 'none';
                fallback2.classList.add('active');
            }
        }, 3000);

        // Method 3: YouTube IFrame API
        const status3 = document.getElementById('status-3');
        const fallback3 = document.getElementById('fallback-3');
        const container3 = document.getElementById('iframe-container-3');

        let player3;
        let apiLoaded = false;

        function onYouTubeIframeAPIReady() {
            apiLoaded = true;
            try {
                player3 = new YT.Player('yt-player-3', {
                    height: '400',
                    width: '100%',
                    videoId: 'dQw4w9WgXcQ',
                    events: {
                        'onReady': onPlayerReady,
                        'onError': onPlayerError
                    }
                });
            } catch (e) {
                status3.className = 'status error';
                status3.textContent = '‚ùå FAILED: Player creation error - ' + e.message;
                container3.style.display = 'none';
                fallback3.classList.add('active');
            }
        }

        function onPlayerReady(event) {
            status3.className = 'status success';
            status3.textContent = '‚úÖ SUCCESS: YouTube player initialized';
        }

        function onPlayerError(event) {
            status3.className = 'status error';
            status3.textContent = '‚ùå FAILED: Player error code ' + event.data;
            container3.style.display = 'none';
            fallback3.classList.add('active');
        }

        // Load YouTube API
        const tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // API load timeout
        setTimeout(() => {
            if (!apiLoaded) {
                status3.className = 'status error';
                status3.textContent = '‚ùå FAILED: YouTube API did not load (blocked)';
                container3.style.display = 'none';
                fallback3.classList.add('active');
            }
        }, 5000);

        // Method 4: Network request test
        const status4 = document.getElementById('status-4');
        const result4 = document.getElementById('result-4');

        fetch('https://www.youtube.com/iframe_api', { mode: 'no-cors' })
            .then(() => {
                status4.className = 'status success';
                status4.textContent = '‚úÖ SUCCESS: YouTube API accessible';
                result4.textContent = 'Network request to YouTube API succeeded (or CORS prevented error)';
            })
            .catch(err => {
                status4.className = 'status error';
                status4.textContent = '‚ùå FAILED: YouTube API blocked';
                result4.textContent = 'Error: ' + err.message;
            });

        // Overall detection summary
        setTimeout(() => {
            const summary = document.createElement('div');
            summary.className = 'test-container';
            summary.innerHTML = `
                <h2>Detection Summary</h2>
                <p><strong>Most Reliable Method:</strong> YouTube IFrame API with timeout (Method 3)</p>
                <p><strong>Reasoning:</strong></p>
                <ul>
                    <li>iframe.onerror rarely fires for ad blocker scenarios</li>
                    <li>iframe.onload may fire even when content is blocked</li>
                    <li>API loading + player initialization provides strongest signal</li>
                    <li>Timeout ensures we don't wait indefinitely</li>
                </ul>
            `;
            document.body.appendChild(summary);
        }, 6000);
    </script>
</body>
</html>
